<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Roy Vincent Luna Canseco">
        <link rel="canonical" href="https://roycan.gitlab.io/mkdocs/Learn%20Ruby%20on%20Rails%20Book%20Two/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Learn Ruby on Rails Book Two - roycan docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/docco.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">roycan docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../2019-01-cv/" class="nav-link">About</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">skills <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../2014-01-15-maple-review/" class="dropdown-item"> Quickly relearning Maple </a>
</li>
                                    
<li>
    <a href="../2014-03-03-joomla-backup/" class="dropdown-item">Backing up a Joomla Site</a>
</li>
                                    
<li>
    <a href="../2018-07-13-aws-jasperreports/" class="dropdown-item">Jasper Server on AWS Attempt</a>
</li>
                                    
<li>
    <a href="../2018-08-10-laravel/" class="dropdown-item">PHP Laravel</a>
</li>
                                    
<li>
    <a href="../2019-01-09-digital-ads/" class="dropdown-item">2019 01 09 digital ads</a>
</li>
                                    
<li>
    <a href="../2019-01-09-email-marketing/" class="dropdown-item">Email marketing</a>
</li>
                                    
<li>
    <a href="../2019-01-10-digital-marketing/" class="dropdown-item">Digitial marketing</a>
</li>
                                    
<li>
    <a href="../2019-01-12-pro-rails-project/" class="dropdown-item">Professional Rails Project Steps</a>
</li>
                                    
<li>
    <a href="../2019-03-30-se_proj_planning/" class="dropdown-item">This Project Planning from SDLC</a>
</li>
                                    
<li>
    <a href="../2019-04-xp_virtualbox/" class="dropdown-item">Setting up Networking for WinXP on virtualbox</a>
</li>
                                    
<li>
    <a href="../2019-03-phalcon_php/" class="dropdown-item">Installing Phalcon PHP in Ubuntu 18.04</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">research <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../2018-07-07-phd-hunt/" class="dropdown-item">To PhD Abroad I Go</a>
</li>
                                    
<li>
    <a href="../2018-07-08-EUSE-seminar/" class="dropdown-item">End-User Software Engineering</a>
</li>
                                    
<li>
    <a href="../2018-07-08-phd-hunt/" class="dropdown-item">My PhD Hunt  (day 2)</a>
</li>
                                    
<li>
    <a href="../2018-07-09-phd-hunt/" class="dropdown-item">My PhD Hunt  (day 3)</a>
</li>
                                    
<li>
    <a href="../2018-07-10-phd-thoughts/" class="dropdown-item">My PhD Hunt  (day 4)</a>
</li>
                                    
<li>
    <a href="../2018-07-11-phd-australia/" class="dropdown-item">Australian Uni's w/ good CS PhD Programs </a>
</li>
                                    
<li>
    <a href="../2018-07-12-phd-hunt/" class="dropdown-item">Deeper look Australian Uni's - part 1</a>
</li>
                                    
<li>
    <a href="../2018-07-13-phd-hunt/" class="dropdown-item">Deeper look Australian Uni's - part 2</a>
</li>
                                    
<li>
    <a href="../2018-07-15-phd-hunt/" class="dropdown-item">Deeper look Australian Uni's - part 3 (last)</a>
</li>
                                    
<li>
    <a href="../2018-07-19-phd-hunt/" class="dropdown-item">PhD Top 3</a>
</li>
                                    
<li>
    <a href="../2018-07-20-phd-hunt/" class="dropdown-item">Melbourne for PhD</a>
</li>
                                    
<li>
    <a href="../2019-01-09-marketing-trends-ph/" class="dropdown-item">Philippine Digital Marketing Trends 2018</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">relationships <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../2018-08-27-self-made/" class="dropdown-item"> Billionaire's Habits </a>
</li>
                                    
<li>
    <a href="../2018-10-19-block_rosary/" class="dropdown-item">Block Rosary</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">teaching <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../2018-09-14-gslides/" class="dropdown-item">Google slides with Audio</a>
</li>
                                    
<li>
    <a href="../2018-09-16-info_sys/" class="dropdown-item">My Information System Development Philosophy</a>
</li>
                                    
<li>
    <a href="../2018-09-25-IS_prog-js_dates/" class="dropdown-item">Javascript Date Object</a>
</li>
                                    
<li>
    <a href="../2018-09-25-js_loops/" class="dropdown-item">Javascript loops</a>
</li>
                                    
<li>
    <a href="../2018-09-26-mysql_datatypes/" class="dropdown-item">MySQL datatypes</a>
</li>
                                    
<li>
    <a href="../2018-10-01-WAPP-setup/" class="dropdown-item">WAPP Setup</a>
</li>
                                    
<li>
    <a href="../2018-10-14-BA186_syllabus/" class="dropdown-item">BA186 SYSTEMS ANALYSIS AND DESIGN</a>
</li>
                                    
<li>
    <a href="../2018-10-19-configure_git/" class="dropdown-item">Setup Git and Github</a>
</li>
                                    
<li>
    <a href="../2018-10-19-install_rails/" class="dropdown-item">Install rails in Ubuntu 18.04</a>
</li>
                                    
<li>
    <a href="../2018-10-19-setup_mysql/" class="dropdown-item">Setting Up MySQL in Ubuntu 18.04</a>
</li>
                                    
<li>
    <a href="../2018-10-19-setup_postgresql/" class="dropdown-item">Setting Up PostgreSQL in Ubuntu 18.04</a>
</li>
                                    
<li>
    <a href="../2018-11-01-aws_upkeep/" class="dropdown-item">Setting up an AWS account for Team Development</a>
</li>
                                    
<li>
    <a href="../2019-02-pisay_application/" class="dropdown-item">Teacher Career Path Evaluation Sheet</a>
</li>
                                    
<li>
    <a href="../2018-01-IPSE-syllabus/" class="dropdown-item">2018 01 IPSE syllabus</a>
</li>
                                    
<li>
    <a href="../2019-04-pisay_promotion/" class="dropdown-item">Teacher Career Path Evaluation Sheet</a>
</li>
                                    
<li>
    <a href="../2019-03-pisay_cs4_setup/" class="dropdown-item">2019 03 pisay cs4 setup</a>
</li>
                                    
<li>
    <a href="../2020-03-pisay_cs4_setup/" class="dropdown-item">2020 03 pisay cs4 setup</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">projects <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../2019-01-05-pcari-site/" class="dropdown-item">2019 01 05 pcari site</a>
</li>
                                    
<li>
    <a href="../pcari-site-proposal/" class="dropdown-item">Pcari site proposal</a>
</li>
                                    
<li>
    <a href="../UP-IC/" class="dropdown-item">UP IC</a>
</li>
                                    
<li>
    <a href="../2019-01-05-IS-proj-start/" class="dropdown-item">Beginning an Information System Project</a>
</li>
                                    
<li>
    <a href="../2018-collated_screens/" class="dropdown-item">2018 collated screens</a>
</li>
                                    
<li>
    <a href="../2018-11-IC-comments/" class="dropdown-item">2018 11 IC comments</a>
</li>
                                    
<li>
    <a href="../2018-mobile_screens/" class="dropdown-item">2018 mobile screens</a>
</li>
                                    
<li>
    <a href="../2019-01-16-DENR_TOR/" class="dropdown-item">2019 01 16 DENR TOR</a>
</li>
                                    
<li>
    <a href="../2019-02-UPPFI-WW-DOD-1/" class="dropdown-item">Definitions of Done - UPPFI-WW web app</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#learn-ruby-on-rails-book-two" class="nav-link">Learn Ruby on Rails: Book Two</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#version-420-2-august-2017" class="nav-link">Version 4.2.0, 2 August 2017</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#daniel-kehoe" class="nav-link">Daniel Kehoe</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#contents" class="nav-link">Contents</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-1-version-check-videos-and-more" class="nav-link">Chapter 1 Version Check, Videos, and More</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#11-version-check" class="nav-link">1.1 Version Check</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#12-get-the-videos" class="nav-link">1.2 Get the Videos</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-2-introduction" class="nav-link">Chapter 2 Introduction</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#21-is-it-for-you" class="nav-link">2.1 Is It for You?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#22-what-to-expect" class="nav-link">2.2 What To Expect</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-3-get-help-when-you-need-it" class="nav-link">Chapter 3 Get Help When You Need It</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#31-example-code" class="nav-link">3.1 Example Code</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#32-version-check" class="nav-link">3.2 Version Check</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#33-getting-help-with-the-book" class="nav-link">3.3 Getting Help With the Book</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#34-getting-help-with-rails" class="nav-link">3.4 Getting Help With Rails</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#35-references" class="nav-link">3.5 References</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#36-meetups-hack-nights-and-workshops" class="nav-link">3.6 Meetups, Hack Nights, and Workshops</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#37-pair-programming" class="nav-link">3.7 Pair Programming</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#38-pairing-with-a-mentor" class="nav-link">3.8 Pairing With a Mentor</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#39-code-review" class="nav-link">3.9 Code Review</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#310-staying-up-to-date" class="nav-link">3.10 Staying Up-to-Date</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-4-accounts-you-may-need" class="nav-link">Chapter 4 Accounts You May Need</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#41-github" class="nav-link">4.1 GitHub</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#42-mailchimp" class="nav-link">4.2 MailChimp</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#43-sendgrid" class="nav-link">4.3 SendGrid</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#44-heroku" class="nav-link">4.4 Heroku</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-5-get-started" class="nav-link">Chapter 5 Get Started</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#51-text-editor-and-terminal-applications" class="nav-link">5.1 Text Editor and Terminal Applications</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#52-copying-and-pasting-code" class="nav-link">5.2 Copying and Pasting Code</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#53-your-computer" class="nav-link">5.3 Your Computer</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#54-try-the-terminal" class="nav-link">5.4 Try the Terminal</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#55-installing-ruby" class="nav-link">5.5 Installing Ruby</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#56-your-workspace" class="nav-link">5.6 Your Workspace</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#57-understanding-version-numbers" class="nav-link">5.7 Understanding Version Numbers</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#58-ruby-and-rails-version-check" class="nav-link">5.8 Ruby and Rails Version Check</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#59-rvm" class="nav-link">5.9 RVM</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#510-project-specific-gemset" class="nav-link">5.10 Project-Specific Gemset</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-6-create-the-application" class="nav-link">Chapter 6 Create the Application</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#61-starter-applications" class="nav-link">6.1 Starter Applications</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#62-workspace-folder-and-rvm-gemset" class="nav-link">6.2 Workspace Folder and RVM Gemset</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#63-use-rails-new-to-build-the-application" class="nav-link">6.3 Use “Rails New” to Build the Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#64-make-a-sticky-gemset" class="nav-link">6.4 Make a Sticky Gemset</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#65-test-the-application" class="nav-link">6.5 Test the Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#66-get-organized-for-efficiency" class="nav-link">6.6 Get Organized for Efficiency</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-7-the-parking-structure" class="nav-link">Chapter 7 The Parking Structure</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#71-video-option" class="nav-link">7.1 Video Option</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#72-project-directory" class="nav-link">7.2 Project Directory</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#73-get-to-know-the-folders-and-files" class="nav-link">7.3 Get to Know the Folders and Files</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#74-the-app-directory" class="nav-link">7.4 The App Directory</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-8-time-travel-with-git" class="nav-link">Chapter 8 Time Travel with Git</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#81-git" class="nav-link">8.1 Git</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#82-is-git-installed" class="nav-link">8.2 Is Git Installed?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#83-is-git-configured" class="nav-link">8.3 Is Git Configured?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#84-create-a-repository" class="nav-link">8.4 Create a Repository</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#85-gitignore" class="nav-link">8.5 GitIgnore</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#see-httpshelpgithubcomarticlesignoring-files-for-more-about-ignoring-files" class="nav-link">See https://help.github.com/articles/ignoring-files for more about ignoring files.</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#_1" class="nav-link"></a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#if-you-find-yourself-ignoring-temporary-files-generated-by-your-text-editor" class="nav-link">If you find yourself ignoring temporary files generated by your text editor</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#or-operating-system-you-probably-want-to-add-a-global-ignore-instead" class="nav-link">or operating system, you probably want to add a global ignore instead:</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#git-config-global-coreexcludesfile-gitignore_global" class="nav-link">git config --global core.excludesfile '~/.gitignore_global'</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#ignore-bundler-config" class="nav-link">Ignore bundler config.</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#ignore-the-default-sqlite-database" class="nav-link">Ignore the default SQLite database.</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#ignore-all-logfiles-and-tempfiles" class="nav-link">Ignore all logfiles and tempfiles.</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#ignore-byebug-command-history-file" class="nav-link">Ignore Byebug command history file.</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#86-git-workflow" class="nav-link">8.6 Git Workflow</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#87-the-readme" class="nav-link">8.7 The README</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-9-gems" class="nav-link">Chapter 9 Gems</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#91-videos" class="nav-link">9.1 Videos</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#92-rubygems" class="nav-link">9.2 RubyGems</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#93-rails-gems" class="nav-link">9.3 Rails Gems</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#94-gems-for-a-rails-default-application" class="nav-link">9.4 Gems for a Rails Default Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#95-where-do-gems-live" class="nav-link">9.5 Where Do Gems Live?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#96-gemfile" class="nav-link">9.6 Gemfile</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#97-gemfile-for-a-rails-default-application" class="nav-link">9.7 Gemfile for a Rails Default Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#98-adding-gems" class="nav-link">9.8 Adding Gems</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#99-about-the-rails-version" class="nav-link">9.9 About the Rails Version</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#910-install-the-gems" class="nav-link">9.10 Install the Gems</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#911-git" class="nav-link">9.11 Git</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-10-configure" class="nav-link">Chapter 10 Configure</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#101-configuration-security" class="nav-link">10.1 Configuration Security</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#102-videos" class="nav-link">10.2 Videos</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#103-about-environment-variables" class="nav-link">10.3 About Environment Variables</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#104-viewing-hidden-files" class="nav-link">10.4 Viewing Hidden Files</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#105-set-environment-variables" class="nav-link">10.5 Set Environment Variables</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#106-the-secrets-file" class="nav-link">10.6 The Secrets File</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#107-secret-key-base" class="nav-link">10.7 Secret Key Base</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#108-configure-email" class="nav-link">10.8 Configure Email</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#109-git" class="nav-link">10.9 Git</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-11-static-pages-and-routing" class="nav-link">Chapter 11 Static Pages and Routing</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#111-add-a-home-page" class="nav-link">11.1 Add a Home Page</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#112-routing-error" class="nav-link">11.2 Routing Error</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#113-add-an-about-page" class="nav-link">11.3 Add an About Page</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#114-introducing-routes" class="nav-link">11.4 Introducing Routes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#115-using-the-about-page" class="nav-link">11.5 Using the “About” Page</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-12-request-and-response" class="nav-link">Chapter 12 Request and Response</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#121-investigating-the-request-response-cycle" class="nav-link">12.1 Investigating the Request Response Cycle</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#122-how-the-browser-works" class="nav-link">12.2 How the Browser Works</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#123-how-the-application-works" class="nav-link">12.3 How the Application Works</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#124-remove-the-about-page" class="nav-link">12.4 Remove the About Page</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-13-dynamic-home-page" class="nav-link">Chapter 13 Dynamic Home Page</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#131-user-story" class="nav-link">13.1 User Story</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#132-routes-model-view-and-controller" class="nav-link">13.2 Routes, Model, View, and Controller</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#133-the-name-game" class="nav-link">13.3 The Name Game</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#134-naming-conventions" class="nav-link">13.4 Naming Conventions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#135-routing" class="nav-link">13.5 Routing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#136-model" class="nav-link">13.6 Model</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#137-view" class="nav-link">13.7 View</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#138-controller" class="nav-link">13.8 Controller</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#139-scaffolding" class="nav-link">13.9 Scaffolding</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1310-test-the-application" class="nav-link">13.10 Test the Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1311-git" class="nav-link">13.11 Git</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-14-troubleshoot" class="nav-link">Chapter 14 Troubleshoot</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#141-git" class="nav-link">14.1 Git</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#142-interactive-ruby-shell" class="nav-link">14.2 Interactive Ruby Shell</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#143-rails-console" class="nav-link">14.3 Rails Console</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#144-rails-logger" class="nav-link">14.4 Rails Logger</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#145-revisiting-the-request-response-cycle" class="nav-link">14.5 Revisiting the Request-Response Cycle</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#146-the-stack-trace" class="nav-link">14.6 The Stack Trace</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#147-raising-an-exception" class="nav-link">14.7 Raising an Exception</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#148-git" class="nav-link">14.8 Git</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#changes-not-staged-for-commit" class="nav-link">Changes not staged for commit:</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#use-git-add-to-update-what-will-be-committed" class="nav-link">(use "git add ..." to update what will be committed)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#use-git-checkout-to-discard-changes-in-working-directory" class="nav-link">(use "git checkout -- ..." to discard changes in working directory)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#_2" class="nav-link"></a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#modified-appcontrollersvisitors_controllerrb" class="nav-link">modified:   app/controllers/visitors_controller.rb</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#modified-appmodelsownerrb" class="nav-link">modified:   app/models/owner.rb</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#_3" class="nav-link"></a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#on-branch-master" class="nav-link">On branch master</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-15-just-enough-ruby" class="nav-link">Chapter 15 Just Enough Ruby</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#151-reading-knowledge-of-ruby" class="nav-link">15.1 Reading Knowledge of Ruby</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#152-ruby-example" class="nav-link">15.2 Ruby Example</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#153-ruby-keywords" class="nav-link">15.3 Ruby Keywords</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#154-ruby-files" class="nav-link">15.4 Ruby Files</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#155-whitespace-and-line-endings" class="nav-link">15.5 Whitespace and Line Endings</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#156-comments" class="nav-link">15.6 Comments</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#157-the-heart-of-programming" class="nav-link">15.7 The Heart of Programming</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#158-assignment" class="nav-link">15.8 Assignment</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#159-object-oriented-terminology" class="nav-link">15.9 Object-Oriented Terminology</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1510-classes" class="nav-link">15.10 Classes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1511-methods" class="nav-link">15.11 Methods</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1512-dot-operator" class="nav-link">15.12 Dot Operator</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1513-initialize-method" class="nav-link">15.13 Initialize Method</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1514-method-parameters" class="nav-link">15.14 Method Parameters</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1515-variable" class="nav-link">15.15 Variable</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1516-attributes" class="nav-link">15.16 Attributes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1517-instance-variable" class="nav-link">15.17 Instance Variable</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1518-double-bar-equals-operator" class="nav-link">15.18 Double Bar Equals Operator</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1519-conditional" class="nav-link">15.19 Conditional</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1520-ternary-operator" class="nav-link">15.20 Ternary Operator</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1521-interpolation" class="nav-link">15.21 Interpolation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1522-access-control" class="nav-link">15.22 Access Control</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1523-hash" class="nav-link">15.23 Hash</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1524-array" class="nav-link">15.24 Array</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1525-iterator" class="nav-link">15.25 Iterator</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1526-block" class="nav-link">15.26 Block</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1527-rails-and-more-keywords" class="nav-link">15.27 Rails and More Keywords</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1528-more-ruby" class="nav-link">15.28 More Ruby</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1529-git" class="nav-link">15.29 Git</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#on-branch-master_1" class="nav-link">On branch master</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-16-layout-and-views" class="nav-link">Chapter 16 Layout and Views</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#161-template-languages" class="nav-link">16.1 Template Languages</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#162-introducing-the-application-layout" class="nav-link">16.2 Introducing the Application Layout</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#163-where-did-all-the-extra-html-come-from" class="nav-link">16.3 Where did all the extra HTML come from?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#164-yield" class="nav-link">16.4 Yield</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#165-yield-variations" class="nav-link">16.5 Yield Variations</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#166-erb-delimiters" class="nav-link">16.6 ERB Delimiters</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#167-introducing-view-helpers" class="nav-link">16.7 Introducing View Helpers</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#168-the-rails-layout-gem" class="nav-link">16.8 The Rails Layout Gem</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#169-basic-boilerplate" class="nav-link">16.9 Basic Boilerplate</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1610-adding-boilerplate" class="nav-link">16.10 Adding Boilerplate</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1611-asset-pipeline" class="nav-link">16.11 Asset Pipeline</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1612-navigation-links" class="nav-link">16.12 Navigation Links</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1613-flash-messages" class="nav-link">16.13 Flash Messages</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1614-html5-elements" class="nav-link">16.14 HTML5 Elements</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1615-application-layout" class="nav-link">16.15 Application Layout</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1616-simple-css" class="nav-link">16.16 Simple CSS</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1617-test-the-application" class="nav-link">16.17 Test the Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1618-git" class="nav-link">16.18 Git</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-17-front-end-framework" class="nav-link">Chapter 17 Front-End Framework</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#171-css-frameworks" class="nav-link">17.1 CSS Frameworks</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#172-javascript-libraries-and-frameworks" class="nav-link">17.2 JavaScript Libraries and Frameworks</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#173-front-end-frameworks" class="nav-link">17.3 Front-End Frameworks</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#174-css-preprocessing-with-sass" class="nav-link">17.4 CSS Preprocessing with Sass</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#175-bootstrap-or-others" class="nav-link">17.5 Bootstrap or Others?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#176-graphic-design-options" class="nav-link">17.6 Graphic Design Options</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#177-bootstrap-3-or-4" class="nav-link">17.7 Bootstrap 3 or 4?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#178-bootstrap-gem" class="nav-link">17.8 Bootstrap Gem</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#179-rails-layout-gem-with-bootstrap" class="nav-link">17.9 Rails Layout Gem with Bootstrap</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1710-renaming-the-applicationcss-file" class="nav-link">17.10 Renaming the application.css File</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1711-the-applicationcssscss-file" class="nav-link">17.11 The application.css.scss File</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1712-bootstrap-javascript" class="nav-link">17.12 Bootstrap JavaScript</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1713-bootstrap-css" class="nav-link">17.13 Bootstrap CSS</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1714-using-bootstrap-css-classes" class="nav-link">17.14 Using Bootstrap CSS Classes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1715-application-layout-with-bootstrap" class="nav-link">17.15 Application Layout with Bootstrap</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1716-flash-messages-with-bootstrap" class="nav-link">17.16 Flash Messages with Bootstrap</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1717-navigation-partial-with-bootstrap" class="nav-link">17.17 Navigation Partial with Bootstrap</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1718-navigation-links-partial" class="nav-link">17.18 Navigation Links Partial</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1719-test-the-application" class="nav-link">17.19 Test the Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1720-remove-the-flash-messages" class="nav-link">17.20 Remove the Flash Messages</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1721-git" class="nav-link">17.21 Git</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-18-add-pages" class="nav-link">Chapter 18 Add Pages</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#181-high-voltage-gem" class="nav-link">18.1 High Voltage Gem</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#182-views-folder" class="nav-link">18.2 Views Folder</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#183-about-page" class="nav-link">18.3 “About” Page</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#184-contact-page" class="nav-link">18.4 Contact Page</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#185-routing-for-the-high-voltage-gem" class="nav-link">18.5 Routing for the High Voltage Gem</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#186-update-the-navigation-partial" class="nav-link">18.6 Update the Navigation Partial</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#187-test-the-application" class="nav-link">18.7 Test the Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#188-git" class="nav-link">18.8 Git</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-19-contact-form" class="nav-link">Chapter 19 Contact Form</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#191-the-old-way-and-the-rails-way" class="nav-link">19.1 The “Old Way” and the “Rails Way”</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#192-user-story" class="nav-link">19.2 User Story</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#193-routing" class="nav-link">19.3 Routing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#194-adding-a-form-to-the-contact-page" class="nav-link">19.4 Adding a Form to the Contact Page</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#195-controller" class="nav-link">19.5 Controller</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#196-test-the-application" class="nav-link">19.6 Test the Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#197-the-validation-problem" class="nav-link">19.7 The Validation Problem</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#198-remove-the-contact-page" class="nav-link">19.8 Remove the Contact Page</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#199-implementing-the-rails-way" class="nav-link">19.9 Implementing the “Rails Way”</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1910-activemodel" class="nav-link">19.10 ActiveModel</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1911-model" class="nav-link">19.11 Model</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1912-create-a-new-contact-page" class="nav-link">19.12 Create a New Contact Page</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1913-seven-controller-actions" class="nav-link">19.13 Seven Controller Actions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1914-controller" class="nav-link">19.14 Controller</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1915-routing" class="nav-link">19.15 Routing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1916-change-navigation-links" class="nav-link">19.16 Change Navigation Links</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1917-test-the-application" class="nav-link">19.17 Test the Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#1918-git" class="nav-link">19.18 Git</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-20-send-mail" class="nav-link">Chapter 20 Send Mail</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#201-user-story" class="nav-link">20.1 User Story</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#202-implementation" class="nav-link">20.2 Implementation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#203-create-view-folder-and-mailer" class="nav-link">20.3 Create View Folder and Mailer</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#204-edit-the-mailer" class="nav-link">20.4 Edit the Mailer</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#205-create-mailer-view" class="nav-link">20.5 Create Mailer View</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#206-modify-controller" class="nav-link">20.6 Modify Controller</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#207-test-the-application" class="nav-link">20.7 Test the Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#208-troubleshooting" class="nav-link">20.8 Troubleshooting</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#209-asynchronous-mailing" class="nav-link">20.9 Asynchronous Mailing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2010-git" class="nav-link">20.10 Git</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-21-mailing-list" class="nav-link">Chapter 21 Mailing List</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#211-user-story" class="nav-link">21.1 User Story</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#212-implementation" class="nav-link">21.2 Implementation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#213-gibbon-gem" class="nav-link">21.3 Gibbon Gem</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#214-home-page" class="nav-link">21.4 Home Page</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#215-visitor-model" class="nav-link">21.5 Visitor Model</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#216-visitors-controller" class="nav-link">21.6 Visitors Controller</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#217-clean-up" class="nav-link">21.7 Clean Up</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#218-routing" class="nav-link">21.8 Routing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#219-test-the-application" class="nav-link">21.9 Test the Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2110-git" class="nav-link">21.10 Git</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-22-deploy" class="nav-link">Chapter 22 Deploy</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#221-heroku-costs" class="nav-link">22.1 Heroku Costs</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#222-test-the-application" class="nav-link">22.2 Test the Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#223-preparing-for-heroku" class="nav-link">22.3 Preparing for Heroku</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#_4" class="nav-link"></a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#to-ban-all-spiders-from-the-entire-site-uncomment-the-next-two-lines" class="nav-link">To ban all spiders from the entire site uncomment the next two lines:</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#user-agent" class="nav-link">User-agent: *</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#disallow" class="nav-link">Disallow: /</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#224-sign-up-for-a-heroku-account" class="nav-link">22.4 Sign Up for a Heroku Account</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#225-heroku-toolbelt" class="nav-link">22.5 Heroku Toolbelt</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#226-heroku-create" class="nav-link">22.6 Heroku Create</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#227-enable-email" class="nav-link">22.7 Enable Email</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#228-set-heroku-environment-variables" class="nav-link">22.8 Set Heroku Environment Variables</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#229-push-to-heroku" class="nav-link">22.9 Push to Heroku</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2210-updating-the-application" class="nav-link">22.10 Updating the Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2211-visit-your-site" class="nav-link">22.11 Visit Your Site</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2212-customizing" class="nav-link">22.12 Customizing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2213-troubleshooting" class="nav-link">22.13 Troubleshooting</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2214-where-to-get-help" class="nav-link">22.14 Where to Get Help</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-23-analytics" class="nav-link">Chapter 23 Analytics</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#231-segmentcom" class="nav-link">23.1 Segment.com</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#232-accounts-you-will-need" class="nav-link">23.2 Accounts You Will Need</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#233-installing-the-javascript-library" class="nav-link">23.3 Installing the JavaScript Library</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#234-replace-the-write-key" class="nav-link">23.4 Replace the Write Key</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#235-add-integration-code" class="nav-link">23.5 Add Integration Code</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#236-page-view-tracking-with-turbolinks" class="nav-link">23.6 Page View Tracking with Turbolinks</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#237-event-tracking" class="nav-link">23.7 Event Tracking</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#238-troubleshooting" class="nav-link">23.8 Troubleshooting</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#239-segmentcom-integrations" class="nav-link">23.9 Segment.com Integrations</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2310-deploy" class="nav-link">23.10 Deploy</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2311-improving-the-user-experience" class="nav-link">23.11 Improving the User Experience</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2312-conversion-tracking" class="nav-link">23.12 Conversion Tracking</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2313-enjoy-what-youve-achieved" class="nav-link">23.13 Enjoy What You’ve Achieved</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-24-testing" class="nav-link">Chapter 24 Testing</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#241-why-test" class="nav-link">24.1 Why Test?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#242-what-are-tests" class="nav-link">24.2 What Are Tests?</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#243-scripted-or-exploratory" class="nav-link">24.3 Scripted or Exploratory</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#244-regression-and-acceptance" class="nav-link">24.4 Regression and Acceptance</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#245-units-and-integration" class="nav-link">24.5 Units and Integration</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#246-sample-data" class="nav-link">24.6 Sample Data</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#247-test-doubles" class="nav-link">24.7 Test Doubles</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#248-minitest-and-rspec" class="nav-link">24.8 Minitest and RSpec</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#249-capybara-the-ghost-in-the-machine" class="nav-link">24.9 Capybara, the Ghost in the Machine</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2410-four-phases-of-feature-tests" class="nav-link">24.10 Four Phases of Feature Tests</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2411-four-phases-of-unit-tests" class="nav-link">24.11 Four Phases of Unit Tests</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2412-set-up-minitest" class="nav-link">24.12 Set Up Minitest</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#running" class="nav-link">Running:</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#running_1" class="nav-link">Running:</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#2413-unit-test-standard-syntax" class="nav-link">24.13 Unit Test (Standard Syntax)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2414-unit-test-spec-syntax" class="nav-link">24.14 Unit Test (Spec Syntax)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2415-run-tests" class="nav-link">24.15 Run Tests</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#running_2" class="nav-link">Running:</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#running_3" class="nav-link">Running:</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#2416-feature-test" class="nav-link">24.16 Feature Test</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2417-run-tests" class="nav-link">24.17 Run Tests</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#running_4" class="nav-link">Running:</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#running_5" class="nav-link">Running:</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#2418-other-tests" class="nav-link">24.18 Other Tests</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2419-behavior-driven-development" class="nav-link">24.19 Behavior-Driven Development</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2420-test-driven-development" class="nav-link">24.20 Test-Driven Development</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2421-test-first-development" class="nav-link">24.21 Test-First Development</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2422-words-of-encouragement" class="nav-link">24.22 Words of Encouragement</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-25-rails-composer" class="nav-link">Chapter 25 Rails Composer</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#251-building-starter-applications" class="nav-link">25.1 Building Starter Applications</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#252-build-learn-rails-in-less-than-five-minutes" class="nav-link">25.2 Build ‘Learn Rails’ in Less Than Five Minutes</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#253-a-collection-of-starter-applications" class="nav-link">25.3 A Collection of Starter Applications</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#254-rails-composer-options" class="nav-link">25.4 Rails Composer Options</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#255-try-it-out" class="nav-link">25.5 Try It Out</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-26-version-notes" class="nav-link">Chapter 26 Version Notes</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#261-version-420" class="nav-link">26.1 Version 4.2.0</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#262-version-410" class="nav-link">26.2 Version 4.1.0</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#263-version-402" class="nav-link">26.3 Version 4.0.2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#264-version-401" class="nav-link">26.4 Version 4.0.1</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#265-version-400" class="nav-link">26.5 Version 4.0.0</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#266-version-310" class="nav-link">26.6 Version 3.1.0</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#267-version-302" class="nav-link">26.7 Version 3.0.2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#268-version-301" class="nav-link">26.8 Version 3.0.1</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#269-version-300" class="nav-link">26.9 Version 3.0.0</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2610-version-222" class="nav-link">26.10 Version 2.2.2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2611-version-221" class="nav-link">26.11 Version 2.2.1</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2612-version-220" class="nav-link">26.12 Version 2.2.0</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2613-version-216" class="nav-link">26.13 Version 2.1.6</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2614-version-215" class="nav-link">26.14 Version 2.1.5</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2615-version-214" class="nav-link">26.15 Version 2.1.4</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2616-version-213" class="nav-link">26.16 Version 2.1.3</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2617-version-212" class="nav-link">26.17 Version 2.1.2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2618-version-211" class="nav-link">26.18 Version 2.1.1</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2619-version-210" class="nav-link">26.19 Version 2.1.0</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2620-version-202" class="nav-link">26.20 Version 2.0.2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2621-version-201" class="nav-link">26.21 Version 2.0.1</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2622-version-200" class="nav-link">26.22 Version 2.0.0</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2623-version-119" class="nav-link">26.23 Version 1.19</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2624-version-118" class="nav-link">26.24 Version 1.18</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#2625-version-117" class="nav-link">26.25 Version 1.17</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#chapter-27-credits-and-comments" class="nav-link">Chapter 27 Credits and Comments</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#271-credits" class="nav-link">27.1 Credits</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#272-comments" class="nav-link">27.2 Comments</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="learn-ruby-on-rails-book-two">Learn Ruby on Rails: Book Two</h1>
<h1 id="version-420-2-august-2017">Version 4.2.0, 2 August 2017</h1>
<h2 id="daniel-kehoe">Daniel Kehoe</h2>
<h1 id="contents">Contents</h1>
<ul>
<li><a href="#cid1">Chapter 1 Version Check, Videos, and More</a></li>
<li>
<ul>
<li><a href="#cid2">1.1 Version Check</a></li>
<li><a href="#cid3">1.2 Get the Videos</a></li>
</ul>
</li>
<li><a href="#cid4">Chapter 2 Introduction</a></li>
<li>
<ul>
<li><a href="#cid5">2.1 Is It for You?</a></li>
<li><a href="#cid6">2.2 What To Expect</a></li>
<li>
<ul>
<li><a href="#uid3">2.2.1 About Book One</a></li>
<li><a href="#uid4">2.2.2 What’s in This Book</a></li>
<li><a href="#uid5">2.2.3 A Warning About Links</a></li>
<li><a href="#uid6">2.2.4 What Comes Next</a></li>
<li><a href="#uid7">2.2.5 Staying In Touch</a></li>
<li><a href="#uid9">2.2.6 A Note to Reviewers and Teachers</a></li>
<li><a href="#uid10">2.2.7 Using the Book in the Classroom</a></li>
<li><a href="#uid11">2.2.8 Let’s Get Started</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cid7">Chapter 3 Get Help When You Need It</a></li>
<li>
<ul>
<li><a href="#cid8">3.1 Example Code</a></li>
<li><a href="#cid9">3.2 Version Check</a></li>
<li><a href="#cid10">3.3 Getting Help With the Book</a></li>
<li><a href="#cid11">3.4 Getting Help With Rails</a></li>
<li>
<ul>
<li><a href="#uid14">3.4.1 Video Option</a></li>
<li><a href="#uid16">3.4.2 Where To Go For Help?</a></li>
</ul>
</li>
<li><a href="#cid12">3.5 References</a></li>
<li>
<ul>
<li><a href="#uid17">3.5.1 RailsGuides</a></li>
<li><a href="#uid18">3.5.2 Cheatsheets</a></li>
<li><a href="#uid19">3.5.3 API Documentation</a></li>
</ul>
</li>
<li><a href="#cid13">3.6 Meetups, Hack Nights, and Workshops</a></li>
<li><a href="#cid14">3.7 Pair Programming</a></li>
<li><a href="#cid15">3.8 Pairing With a Mentor</a></li>
<li><a href="#cid16">3.9 Code Review</a></li>
<li><a href="#cid17">3.10 Staying Up-to-Date</a></li>
</ul>
</li>
<li><a href="#cid18">Chapter 4 Accounts You May Need</a></li>
<li>
<ul>
<li><a href="#cid19">4.1 GitHub</a></li>
<li><a href="#cid20">4.2 MailChimp</a></li>
<li><a href="#cid21">4.3 SendGrid</a></li>
<li><a href="#cid22">4.4 Heroku</a></li>
</ul>
</li>
<li><a href="#cid23">Chapter 5 Get Started</a></li>
<li>
<ul>
<li><a href="#cid24">5.1 Text Editor and Terminal Applications</a></li>
<li><a href="#cid25">5.2 Copying and Pasting Code</a></li>
<li><a href="#cid26">5.3 Your Computer</a></li>
<li>
<ul>
<li><a href="#uid35">5.3.1 Hosted Computing</a></li>
</ul>
</li>
<li><a href="#cid27">5.4 Try the Terminal</a></li>
<li><a href="#cid28">5.5 Installing Ruby</a></li>
<li>
<ul>
<li><a href="#uid39">5.5.1 MacOS</a></li>
<li><a href="#uid40">5.5.2 Ubuntu Linux</a></li>
<li><a href="#uid41">5.5.3 Hosted Computing</a></li>
<li><a href="#uid42">5.5.4 Windows</a></li>
</ul>
</li>
<li><a href="#cid29">5.6 Your Workspace</a></li>
<li>
<ul>
<li><a href="#uid46">5.6.1 Video Option</a></li>
</ul>
</li>
<li><a href="#cid30">5.7 Understanding Version Numbers</a></li>
<li><a href="#cid31">5.8 Ruby and Rails Version Check</a></li>
<li><a href="#cid32">5.9 RVM</a></li>
<li><a href="#cid33">5.10 Project-Specific Gemset</a></li>
</ul>
</li>
<li><a href="#cid34">Chapter 6 Create the Application</a></li>
<li>
<ul>
<li><a href="#cid35">6.1 Starter Applications</a></li>
<li><a href="#cid36">6.2 Workspace Folder and RVM Gemset</a></li>
<li><a href="#cid37">6.3 Use “Rails New” to Build the Application</a></li>
<li><a href="#cid38">6.4 Make a Sticky Gemset</a></li>
<li><a href="#cid39">6.5 Test the Application</a></li>
<li>
<ul>
<li><a href="#uid61">6.5.1 Launching the Web Server</a></li>
<li><a href="#uid62">6.5.2 Errors for Linux Users</a></li>
<li><a href="#uid63">6.5.3 Viewing in the Web Browser</a></li>
<li><a href="#uid65">6.5.4 Watch Log Messages</a></li>
<li><a href="#uid66">6.5.5 Multiple Terminal Windows</a></li>
<li><a href="#uid67">6.5.6 Stop the Web Server</a></li>
</ul>
</li>
<li><a href="#cid40">6.6 Get Organized for Efficiency</a></li>
</ul>
</li>
<li><a href="#cid41">Chapter 7 The Parking Structure</a></li>
<li>
<ul>
<li><a href="#cid42">7.1 Video Option</a></li>
<li><a href="#cid43">7.2 Project Directory</a></li>
<li><a href="#cid44">7.3 Get to Know the Folders and Files</a></li>
<li>
<ul>
<li><a href="#uid71">7.3.1 Important Folders and Files</a></li>
<li><a href="#uid72">7.3.2 Not-So-Important Folders and Files</a></li>
<li><a href="#uid73">7.3.3 Folders for Testing</a></li>
</ul>
</li>
<li><a href="#cid45">7.4 The App Directory</a></li>
<li>
<ul>
<li><a href="#uid83">7.4.1 Folders of Future Importance</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cid46">Chapter 8 Time Travel with Git</a></li>
<li>
<ul>
<li><a href="#cid47">8.1 Git</a></li>
<li><a href="#cid48">8.2 Is Git Installed?</a></li>
<li><a href="#cid49">8.3 Is Git Configured?</a></li>
<li><a href="#cid50">8.4 Create a Repository</a></li>
<li><a href="#cid51">8.5 GitIgnore</a></li>
<li><a href="#cid52">8.6 Git Workflow</a></li>
<li>
<ul>
<li><a href="#uid87">8.6.1 Untracked Files</a></li>
<li><a href="#uid88">8.6.2 Staging</a></li>
<li><a href="#uid92">8.6.3 Committing</a></li>
<li><a href="#uid93">8.6.4 Git Log</a></li>
<li><a href="#uid94">8.6.5 Repositories</a></li>
<li><a href="#uid95">8.6.6 Pushing to GitHub</a></li>
</ul>
</li>
<li><a href="#cid53">8.7 The README</a></li>
</ul>
</li>
<li><a href="#cid54">Chapter 9 Gems</a></li>
<li>
<ul>
<li><a href="#cid55">9.1 Videos</a></li>
<li><a href="#cid56">9.2 RubyGems</a></li>
<li><a href="#cid57">9.3 Rails Gems</a></li>
<li><a href="#cid58">9.4 Gems for a Rails Default Application</a></li>
<li><a href="#cid59">9.5 Where Do Gems Live?</a></li>
<li><a href="#cid60">9.6 Gemfile</a></li>
<li><a href="#cid61">9.7 Gemfile for a Rails Default Application</a></li>
<li><a href="#cid62">9.8 Adding Gems</a></li>
<li><a href="#cid63">9.9 About the Rails Version</a></li>
<li><a href="#cid64">9.10 Install the Gems</a></li>
<li>
<ul>
<li><a href="#uid141">9.10.1 Troubleshooting</a></li>
</ul>
</li>
<li><a href="#cid65">9.11 Git</a></li>
</ul>
</li>
<li><a href="#cid66">Chapter 10 Configure</a></li>
<li>
<ul>
<li><a href="#cid67">10.1 Configuration Security</a></li>
<li><a href="#cid68">10.2 Videos</a></li>
<li><a href="#cid69">10.3 About Environment Variables</a></li>
<li><a href="#cid70">10.4 Viewing Hidden Files</a></li>
<li><a href="#cid71">10.5 Set Environment Variables</a></li>
<li>
<ul>
<li><a href="#uid149">10.5.1 SendGrid</a></li>
<li><a href="#uid150">10.5.2 MailChimp</a></li>
<li><a href="#uid151">10.5.3 Owner Email</a></li>
<li><a href="#uid152">10.5.4 Restart the Terminal Session</a></li>
<li><a href="#uid153">10.5.5 Troubleshooting</a></li>
</ul>
</li>
<li><a href="#cid72">10.6 The Secrets File</a></li>
<li>
<ul>
<li><a href="#uid154">10.6.1 Domain Name</a></li>
<li><a href="#uid155">10.6.2 Securing the Secrets File</a></li>
<li><a href="#uid156">10.6.3 Troubleshooting</a></li>
</ul>
</li>
<li><a href="#cid73">10.7 Secret Key Base</a></li>
<li><a href="#cid74">10.8 Configure Email</a></li>
<li>
<ul>
<li><a href="#uid157">10.8.1 Connect to an Email Server</a></li>
<li><a href="#uid167">10.8.2 Perform Deliveries in Development</a></li>
</ul>
</li>
<li><a href="#cid75">10.9 Git</a></li>
</ul>
</li>
<li><a href="#cid76">Chapter 11 Static Pages and Routing</a></li>
<li>
<ul>
<li><a href="#cid77">11.1 Add a Home Page</a></li>
<li><a href="#cid78">11.2 Routing Error</a></li>
<li><a href="#cid79">11.3 Add an About Page</a></li>
<li>
<ul>
<li><a href="#uid168">11.3.1 Introducing TDD</a></li>
</ul>
</li>
<li><a href="#cid80">11.4 Introducing Routes</a></li>
<li><a href="#cid81">11.5 Using the “About” Page</a></li>
</ul>
</li>
<li><a href="#cid82">Chapter 12 Request and Response</a></li>
<li>
<ul>
<li><a href="#cid83">12.1 Investigating the Request Response Cycle</a></li>
<li>
<ul>
<li><a href="#uid170">12.1.1 Inside the Browser</a></li>
<li><a href="#uid178">12.1.2 Inside the Server</a></li>
</ul>
</li>
<li><a href="#cid84">12.2 How the Browser Works</a></li>
<li>
<ul>
<li><a href="#uid179">12.2.1 Document Object Model</a></li>
<li><a href="#uid180">12.2.2 Rendering</a></li>
</ul>
</li>
<li><a href="#cid85">12.3 How the Application Works</a></li>
<li>
<ul>
<li><a href="#uid181">12.3.1 Video Option</a></li>
<li><a href="#uid183">12.3.2 The Model View Controller Concept</a></li>
</ul>
</li>
<li><a href="#cid86">12.4 Remove the About Page</a></li>
</ul>
</li>
<li><a href="#cid87">Chapter 13 Dynamic Home Page</a></li>
<li>
<ul>
<li><a href="#cid88">13.1 User Story</a></li>
<li><a href="#cid89">13.2 Routes, Model, View, and Controller</a></li>
<li><a href="#cid90">13.3 The Name Game</a></li>
<li><a href="#cid91">13.4 Naming Conventions</a></li>
<li><a href="#cid92">13.5 Routing</a></li>
<li><a href="#cid93">13.6 Model</a></li>
<li><a href="#cid94">13.7 View</a></li>
<li><a href="#cid95">13.8 Controller</a></li>
<li><a href="#cid96">13.9 Scaffolding</a></li>
<li><a href="#cid97">13.10 Test the Application</a></li>
<li><a href="#cid98">13.11 Git</a></li>
</ul>
</li>
<li><a href="#cid99">Chapter 14 Troubleshoot</a></li>
<li>
<ul>
<li><a href="#cid100">14.1 Git</a></li>
<li><a href="#cid101">14.2 Interactive Ruby Shell</a></li>
<li>
<ul>
<li><a href="#uid202">14.2.1 IRB for Blocks of Code</a></li>
<li><a href="#uid203">14.2.2 Quitting IRB</a></li>
<li><a href="#uid204">14.2.3 Learn More About IRB</a></li>
<li><a href="#uid207">14.2.4 Beyond IRB</a></li>
</ul>
</li>
<li><a href="#cid102">14.3 Rails Console</a></li>
<li><a href="#cid103">14.4 Rails Logger</a></li>
<li><a href="#cid104">14.5 Revisiting the Request-Response Cycle</a></li>
<li><a href="#cid105">14.6 The Stack Trace</a></li>
<li><a href="#cid106">14.7 Raising an Exception</a></li>
<li><a href="#cid107">14.8 Git</a></li>
</ul>
</li>
<li><a href="#cid108">Chapter 15 Just Enough Ruby</a></li>
<li>
<ul>
<li><a href="#cid109">15.1 Reading Knowledge of Ruby</a></li>
<li><a href="#cid110">15.2 Ruby Example</a></li>
<li><a href="#cid111">15.3 Ruby Keywords</a></li>
<li>
<ul>
<li><a href="#uid211">15.3.1 API Documentation</a></li>
</ul>
</li>
<li><a href="#cid112">15.4 Ruby Files</a></li>
<li>
<ul>
<li><a href="#uid214">15.4.1 Using IRB</a></li>
</ul>
</li>
<li><a href="#cid113">15.5 Whitespace and Line Endings</a></li>
<li><a href="#cid114">15.6 Comments</a></li>
<li><a href="#cid115">15.7 The Heart of Programming</a></li>
<li><a href="#cid116">15.8 Assignment</a></li>
<li><a href="#cid117">15.9 Object-Oriented Terminology</a></li>
<li>
<ul>
<li><a href="#uid224">15.9.1 Houses</a></li>
<li><a href="#uid225">15.9.2 Vehicles</a></li>
<li><a href="#uid226">15.9.3 Cookies</a></li>
<li><a href="#uid227">15.9.4 Limitations of Metaphors</a></li>
<li><a href="#uid228">15.9.5 Definitions</a></li>
</ul>
</li>
<li><a href="#cid118">15.10 Classes</a></li>
<li><a href="#cid119">15.11 Methods</a></li>
<li><a href="#cid120">15.12 Dot Operator</a></li>
<li>
<ul>
<li><a href="#uid238">15.12.1 Question and Exclamation Methods</a></li>
</ul>
</li>
<li><a href="#cid121">15.13 Initialize Method</a></li>
<li><a href="#cid122">15.14 Method Parameters</a></li>
<li><a href="#cid123">15.15 Variable</a></li>
<li>
<ul>
<li><a href="#uid239">15.15.1 Symbol</a></li>
</ul>
</li>
<li><a href="#cid124">15.16 Attributes</a></li>
<li><a href="#cid125">15.17 Instance Variable</a></li>
<li>
<ul>
<li><a href="#uid240">15.17.1 Instance Variables in Rails</a></li>
</ul>
</li>
<li><a href="#cid126">15.18 Double Bar Equals Operator</a></li>
<li><a href="#cid127">15.19 Conditional</a></li>
<li><a href="#cid128">15.20 Ternary Operator</a></li>
<li><a href="#cid129">15.21 Interpolation</a></li>
<li><a href="#cid130">15.22 Access Control</a></li>
<li><a href="#cid131">15.23 Hash</a></li>
<li><a href="#cid132">15.24 Array</a></li>
<li><a href="#cid133">15.25 Iterator</a></li>
<li><a href="#cid134">15.26 Block</a></li>
<li><a href="#cid135">15.27 Rails and More Keywords</a></li>
<li><a href="#cid136">15.28 More Ruby</a></li>
<li>
<ul>
<li><a href="#uid241">15.28.1 Collaborative Learning</a></li>
<li><a href="#uid243">15.28.2 Online Tutorials</a></li>
<li><a href="#uid251">15.28.3 Books</a></li>
<li><a href="#uid259">15.28.4 Newsletters</a></li>
<li><a href="#uid262">15.28.5 Screencasts</a></li>
</ul>
</li>
<li><a href="#cid137">15.29 Git</a></li>
</ul>
</li>
<li><a href="#cid138">Chapter 16 Layout and Views</a></li>
<li>
<ul>
<li><a href="#cid139">16.1 Template Languages</a></li>
<li><a href="#cid140">16.2 Introducing the Application Layout</a></li>
<li><a href="#cid141">16.3 Where did all the extra HTML come from?</a></li>
<li><a href="#cid142">16.4 Yield</a></li>
<li><a href="#cid143">16.5 Yield Variations</a></li>
<li><a href="#cid144">16.6 ERB Delimiters</a></li>
<li><a href="#cid145">16.7 Introducing View Helpers</a></li>
<li><a href="#cid146">16.8 The Rails Layout Gem</a></li>
<li><a href="#cid147">16.9 Basic Boilerplate</a></li>
<li><a href="#cid148">16.10 Adding Boilerplate</a></li>
<li>
<ul>
<li><a href="#uid274">16.10.1 Viewport</a></li>
<li><a href="#uid275">16.10.2 Title and Description</a></li>
</ul>
</li>
<li><a href="#cid149">16.11 Asset Pipeline</a></li>
<li>
<ul>
<li><a href="#uid278">16.11.1 Assets Without Rails</a></li>
<li><a href="#uid279">16.11.2 Assets With Rails</a></li>
</ul>
</li>
<li><a href="#cid150">16.12 Navigation Links</a></li>
<li>
<ul>
<li><a href="#uid282">16.12.1 Introducing Partials</a></li>
<li><a href="#uid283">16.12.2 Introducing Link Helpers</a></li>
<li><a href="#uid284">16.12.3 Navigation Partial</a></li>
<li><a href="#uid285">16.12.4 Navigation Links Partial</a></li>
</ul>
</li>
<li><a href="#cid151">16.13 Flash Messages</a></li>
<li>
<ul>
<li><a href="#uid287">16.13.1 Creating Flash Messages</a></li>
<li><a href="#uid288">16.13.2 Flash and Flash Now</a></li>
<li><a href="#uid289">16.13.3 Explaining the Ruby Code</a></li>
<li><a href="#uid290">16.13.4 The Flash Messages Partial</a></li>
</ul>
</li>
<li><a href="#cid152">16.14 HTML5 Elements</a></li>
<li><a href="#cid153">16.15 Application Layout</a></li>
<li><a href="#cid154">16.16 Simple CSS</a></li>
<li><a href="#cid155">16.17 Test the Application</a></li>
<li><a href="#cid156">16.18 Git</a></li>
</ul>
</li>
<li><a href="#cid157">Chapter 17 Front-End Framework</a></li>
<li>
<ul>
<li><a href="#cid158">17.1 CSS Frameworks</a></li>
<li><a href="#cid159">17.2 JavaScript Libraries and Frameworks</a></li>
<li><a href="#cid160">17.3 Front-End Frameworks</a></li>
<li><a href="#cid161">17.4 CSS Preprocessing with Sass</a></li>
<li><a href="#cid162">17.5 Bootstrap or Others?</a></li>
<li><a href="#cid163">17.6 Graphic Design Options</a></li>
<li><a href="#cid164">17.7 Bootstrap 3 or 4?</a></li>
<li><a href="#cid165">17.8 Bootstrap Gem</a></li>
<li><a href="#cid166">17.9 Rails Layout Gem with Bootstrap</a></li>
<li><a href="#cid167">17.10 Renaming the application.css File</a></li>
<li><a href="#cid168">17.11 The application.css.scss File</a></li>
<li>
<ul>
<li><a href="#uid323">17.11.1 A Global CSS File</a></li>
<li><a href="#uid324">17.11.2 A Manifest File</a></li>
</ul>
</li>
<li><a href="#cid169">17.12 Bootstrap JavaScript</a></li>
<li><a href="#cid170">17.13 Bootstrap CSS</a></li>
<li><a href="#cid171">17.14 Using Bootstrap CSS Classes</a></li>
<li>
<ul>
<li><a href="#uid328">17.14.1 Bootstrap Grid</a></li>
<li><a href="#uid333">17.14.2 Presentational Versus Semantic Styles</a></li>
<li><a href="#uid336">17.14.3 Use Bootstrap Classes Directly</a></li>
<li><a href="#uid338">17.14.4 Or Use Sass Mixins with Bootstrap</a></li>
</ul>
</li>
<li><a href="#cid172">17.15 Application Layout with Bootstrap</a></li>
<li><a href="#cid173">17.16 Flash Messages with Bootstrap</a></li>
<li><a href="#cid174">17.17 Navigation Partial with Bootstrap</a></li>
<li><a href="#cid175">17.18 Navigation Links Partial</a></li>
<li><a href="#cid176">17.19 Test the Application</a></li>
<li><a href="#cid177">17.20 Remove the Flash Messages</a></li>
<li><a href="#cid178">17.21 Git</a></li>
</ul>
</li>
<li><a href="#cid179">Chapter 18 Add Pages</a></li>
<li>
<ul>
<li><a href="#cid180">18.1 High Voltage Gem</a></li>
<li><a href="#cid181">18.2 Views Folder</a></li>
<li><a href="#cid182">18.3 “About” Page</a></li>
<li><a href="#cid183">18.4 Contact Page</a></li>
<li><a href="#cid184">18.5 Routing for the High Voltage Gem</a></li>
<li><a href="#cid185">18.6 Update the Navigation Partial</a></li>
<li><a href="#cid186">18.7 Test the Application</a></li>
<li><a href="#cid187">18.8 Git</a></li>
</ul>
</li>
<li><a href="#cid188">Chapter 19 Contact Form</a></li>
<li>
<ul>
<li><a href="#cid189">19.1 The “Old Way” and the “Rails Way”</a></li>
<li><a href="#cid190">19.2 User Story</a></li>
<li><a href="#cid191">19.3 Routing</a></li>
<li><a href="#cid192">19.4 Adding a Form to the Contact Page</a></li>
<li><a href="#cid193">19.5 Controller</a></li>
<li>
<ul>
<li><a href="#uid359">19.5.1 Params Hash</a></li>
<li><a href="#uid365">19.5.2 Process_form Method</a></li>
</ul>
</li>
<li><a href="#cid194">19.6 Test the Application</a></li>
<li><a href="#cid195">19.7 The Validation Problem</a></li>
<li><a href="#cid196">19.8 Remove the Contact Page</a></li>
<li><a href="#cid197">19.9 Implementing the “Rails Way”</a></li>
<li><a href="#cid198">19.10 ActiveModel</a></li>
<li><a href="#cid199">19.11 Model</a></li>
<li><a href="#cid200">19.12 Create a New Contact Page</a></li>
<li><a href="#cid201">19.13 Seven Controller Actions</a></li>
<li><a href="#cid202">19.14 Controller</a></li>
<li>
<ul>
<li><a href="#uid393">19.14.1 Mass-Assignment Vulnerabilities</a></li>
<li><a href="#uid396">19.14.2 Private Methods</a></li>
</ul>
</li>
<li><a href="#cid203">19.15 Routing</a></li>
<li><a href="#cid204">19.16 Change Navigation Links</a></li>
<li><a href="#cid205">19.17 Test the Application</a></li>
<li><a href="#cid206">19.18 Git</a></li>
</ul>
</li>
<li><a href="#cid207">Chapter 20 Send Mail</a></li>
<li>
<ul>
<li><a href="#cid208">20.1 User Story</a></li>
<li><a href="#cid209">20.2 Implementation</a></li>
<li><a href="#cid210">20.3 Create View Folder and Mailer</a></li>
<li><a href="#cid211">20.4 Edit the Mailer</a></li>
<li><a href="#cid212">20.5 Create Mailer View</a></li>
<li><a href="#cid213">20.6 Modify Controller</a></li>
<li><a href="#cid214">20.7 Test the Application</a></li>
<li><a href="#cid215">20.8 Troubleshooting</a></li>
<li>
<ul>
<li><a href="#uid418">20.8.1 User Name Issues</a></li>
<li><a href="#uid419">20.8.2 Password Issues</a></li>
<li><a href="#uid420">20.8.3 Problems with Environment Variables</a></li>
</ul>
</li>
<li><a href="#cid216">20.9 Asynchronous Mailing</a></li>
<li><a href="#cid217">20.10 Git</a></li>
</ul>
</li>
<li><a href="#cid218">Chapter 21 Mailing List</a></li>
<li>
<ul>
<li><a href="#cid219">21.1 User Story</a></li>
<li><a href="#cid220">21.2 Implementation</a></li>
<li><a href="#cid221">21.3 Gibbon Gem</a></li>
<li><a href="#cid222">21.4 Home Page</a></li>
<li>
<ul>
<li><a href="#uid425">21.4.1 Photo Options</a></li>
</ul>
</li>
<li><a href="#cid223">21.5 Visitor Model</a></li>
<li><a href="#cid224">21.6 Visitors Controller</a></li>
<li><a href="#cid225">21.7 Clean Up</a></li>
<li><a href="#cid226">21.8 Routing</a></li>
<li><a href="#cid227">21.9 Test the Application</a></li>
<li><a href="#cid228">21.10 Git</a></li>
</ul>
</li>
<li><a href="#cid229">Chapter 22 Deploy</a></li>
<li>
<ul>
<li><a href="#cid230">22.1 Heroku Costs</a></li>
<li><a href="#cid231">22.2 Test the Application</a></li>
<li><a href="#cid232">22.3 Preparing for Heroku</a></li>
<li>
<ul>
<li><a href="#uid442">22.3.1 Gemfile</a></li>
<li><a href="#uid444">22.3.2 Asset Pipeline in Production</a></li>
<li><a href="#uid445">22.3.3 Option to Ban Spiders</a></li>
<li><a href="#uid446">22.3.4 Humans.txt</a></li>
</ul>
</li>
<li><a href="#cid233">22.4 Sign Up for a Heroku Account</a></li>
<li><a href="#cid234">22.5 Heroku Toolbelt</a></li>
<li><a href="#cid235">22.6 Heroku Create</a></li>
<li><a href="#cid236">22.7 Enable Email</a></li>
<li><a href="#cid237">22.8 Set Heroku Environment Variables</a></li>
<li><a href="#cid238">22.9 Push to Heroku</a></li>
<li><a href="#cid239">22.10 Updating the Application</a></li>
<li><a href="#cid240">22.11 Visit Your Site</a></li>
<li><a href="#cid241">22.12 Customizing</a></li>
<li><a href="#cid242">22.13 Troubleshooting</a></li>
<li><a href="#cid243">22.14 Where to Get Help</a></li>
</ul>
</li>
<li><a href="#cid244">Chapter 23 Analytics</a></li>
<li>
<ul>
<li><a href="#cid245">23.1 Segment.com</a></li>
<li><a href="#cid246">23.2 Accounts You Will Need</a></li>
<li><a href="#cid247">23.3 Installing the JavaScript Library</a></li>
<li><a href="#cid248">23.4 Replace the Write Key</a></li>
<li><a href="#cid249">23.5 Add Integration Code</a></li>
<li><a href="#cid250">23.6 Page View Tracking with Turbolinks</a></li>
<li><a href="#cid251">23.7 Event Tracking</a></li>
<li><a href="#cid252">23.8 Troubleshooting</a></li>
<li><a href="#cid253">23.9 Segment.com Integrations</a></li>
<li><a href="#cid254">23.10 Deploy</a></li>
<li><a href="#cid255">23.11 Improving the User Experience</a></li>
<li><a href="#cid256">23.12 Conversion Tracking</a></li>
<li><a href="#cid257">23.13 Enjoy What You’ve Achieved</a></li>
</ul>
</li>
<li><a href="#cid258">Chapter 24 Testing</a></li>
<li>
<ul>
<li><a href="#cid259">24.1 Why Test?</a></li>
<li><a href="#cid260">24.2 What Are Tests?</a></li>
<li><a href="#cid261">24.3 Scripted or Exploratory</a></li>
<li><a href="#cid262">24.4 Regression and Acceptance</a></li>
<li><a href="#cid263">24.5 Units and Integration</a></li>
<li><a href="#cid264">24.6 Sample Data</a></li>
<li><a href="#cid265">24.7 Test Doubles</a></li>
<li><a href="#cid266">24.8 Minitest and RSpec</a></li>
<li><a href="#cid267">24.9 Capybara, the Ghost in the Machine</a></li>
<li><a href="#cid268">24.10 Four Phases of Feature Tests</a></li>
<li><a href="#cid269">24.11 Four Phases of Unit Tests</a></li>
<li><a href="#cid270">24.12 Set Up Minitest</a></li>
<li>
<ul>
<li><a href="#uid459">24.12.1 Run Tests</a></li>
</ul>
</li>
<li><a href="#cid271">24.13 Unit Test (Standard Syntax)</a></li>
<li><a href="#cid272">24.14 Unit Test (Spec Syntax)</a></li>
<li>
<ul>
<li><a href="#uid460">24.14.1 Create a Test Class With Describe</a></li>
<li><a href="#uid461">24.14.2 Setup Phase</a></li>
<li><a href="#uid462">24.14.3 Do It</a></li>
</ul>
</li>
<li><a href="#cid273">24.15 Run Tests</a></li>
<li>
<ul>
<li><a href="#uid463">24.15.1 Breaking the Test</a></li>
</ul>
</li>
<li><a href="#cid274">24.16 Feature Test</a></li>
<li>
<ul>
<li><a href="#uid464">24.16.1 Feature</a></li>
<li><a href="#uid465">24.16.2 Scenario</a></li>
</ul>
</li>
<li><a href="#cid275">24.17 Run Tests</a></li>
<li>
<ul>
<li><a href="#uid466">24.17.1 Troubleshooting</a></li>
<li><a href="#uid467">24.17.2 Breaking the Test</a></li>
<li><a href="#uid468">24.17.3 Using Capybara</a></li>
</ul>
</li>
<li><a href="#cid276">24.18 Other Tests</a></li>
<li><a href="#cid277">24.19 Behavior-Driven Development</a></li>
<li><a href="#cid278">24.20 Test-Driven Development</a></li>
<li><a href="#cid279">24.21 Test-First Development</a></li>
<li><a href="#cid280">24.22 Words of Encouragement</a></li>
</ul>
</li>
<li><a href="#cid281">Chapter 25 Rails Composer</a></li>
<li>
<ul>
<li><a href="#cid282">25.1 Building Starter Applications</a></li>
<li><a href="#cid283">25.2 Build ‘Learn Rails’ in Less Than Five Minutes</a></li>
<li><a href="#cid284">25.3 A Collection of Starter Applications</a></li>
<li>
<ul>
<li><a href="#uid470">25.3.1 Rails Bootstrap</a></li>
<li><a href="#uid471">25.3.2 Rails Foundation</a></li>
<li><a href="#uid472">25.3.3 Rails Mailing List with Active Job</a></li>
<li><a href="#uid473">25.3.4 Rails OmniAuth</a></li>
<li><a href="#uid474">25.3.5 Rails Devise</a></li>
<li><a href="#uid475">25.3.6 Rails Devise Roles</a></li>
<li><a href="#uid476">25.3.7 Rails Devise Pundit</a></li>
<li><a href="#uid477">25.3.8 Other Starter Applications</a></li>
</ul>
</li>
<li><a href="#cid285">25.4 Rails Composer Options</a></li>
<li><a href="#cid286">25.5 Try It Out</a></li>
</ul>
</li>
<li><a href="#cid287">Chapter 26 Version Notes</a></li>
<li>
<ul>
<li><a href="#cid288">26.1 Version 4.2.0</a></li>
<li><a href="#cid289">26.2 Version 4.1.0</a></li>
<li><a href="#cid290">26.3 Version 4.0.2</a></li>
<li><a href="#cid291">26.4 Version 4.0.1</a></li>
<li><a href="#cid292">26.5 Version 4.0.0</a></li>
<li><a href="#cid293">26.6 Version 3.1.0</a></li>
<li><a href="#cid294">26.7 Version 3.0.2</a></li>
<li><a href="#cid295">26.8 Version 3.0.1</a></li>
<li><a href="#cid296">26.9 Version 3.0.0</a></li>
<li><a href="#cid297">26.10 Version 2.2.2</a></li>
<li><a href="#cid298">26.11 Version 2.2.1</a></li>
<li><a href="#cid299">26.12 Version 2.2.0</a></li>
<li><a href="#cid300">26.13 Version 2.1.6</a></li>
<li><a href="#cid301">26.14 Version 2.1.5</a></li>
<li><a href="#cid302">26.15 Version 2.1.4</a></li>
<li><a href="#cid303">26.16 Version 2.1.3</a></li>
<li><a href="#cid304">26.17 Version 2.1.2</a></li>
<li><a href="#cid305">26.18 Version 2.1.1</a></li>
<li><a href="#cid306">26.19 Version 2.1.0</a></li>
<li><a href="#cid307">26.20 Version 2.0.2</a></li>
<li><a href="#cid308">26.21 Version 2.0.1</a></li>
<li><a href="#cid309">26.22 Version 2.0.0</a></li>
<li><a href="#cid310">26.23 Version 1.19</a></li>
<li><a href="#cid311">26.24 Version 1.18</a></li>
<li><a href="#cid312">26.25 Version 1.17</a></li>
</ul>
</li>
<li><a href="#cid313">Chapter 27 Credits and Comments</a></li>
<li>
<ul>
<li><a href="#cid314">27.1 Credits</a></li>
<li>
<ul>
<li><a href="#uid486">27.1.1 Kickstarter</a></li>
<li><a href="#uid489">27.1.2 Financial Backers for the First Edition</a></li>
<li><a href="#uid490">27.1.3 Technical Editors</a></li>
<li><a href="#uid496">27.1.4 Editors and Proofreaders</a></li>
<li><a href="#uid497">27.1.5 Photos</a></li>
</ul>
</li>
<li><a href="#cid315">27.2 Comments</a></li>
</ul>
</li>
</ul>
<h1 id="chapter-1-version-check-videos-and-more"><a href="#cid1">Chapter 1 Version Check, Videos, and More</a></h1>
<p>Before you get started, I want you to have the most current version of my book. Also, I’ll tell you how to get the videos and advanced tutorials.</p>
<h2 id="11-version-check"><a href="#cid2">1.1 Version Check</a></h2>
<p>If you have the PDF, ePub, or Mobi versions of the book, check the title page for the version number and look on the webpage for the <a href="https://github.com/RailsApps/learn-rails">learn-rails GitHub repository</a> to make sure you have the newest version of the book.</p>
<p>I suggest to use the online edition as you build the tutorial application. It is always up to date.</p>
<h2 id="12-get-the-videos"><a href="#cid3">1.2 Get the Videos</a></h2>
<p>You can watch videos as you read the book. A subscription is only $19 per month (there’s also a discount when you get the video series plus advanced tutorials). It’s easy and you’ll learn more:</p>
<ul>
<li><a href="https://tutorials.railsapps.org/#plans">Get the Videos and Advanced Tutorials</a></li>
</ul>
<p>The videos are a great introduction to Rails. With the videos and the advanced tutorials, I promise there is no better way to learn Rails.</p>
<h1 id="chapter-2-introduction"><a href="#cid4">Chapter 2 Introduction</a></h1>
<p>Welcome. This is Book Two in my <a href="http://learn-rails.com/learn-ruby-on-rails.html">Ruby on Rails book series</a>. It is written for Rails 5.1.</p>
<p>In this book, you’ll build a working web application so you’ll gain hands-on experience. Along the way, you’ll practice techniques used by professional Rails developers. And I’ll help you understand why Rails is a popular choice for web development.</p>
<p>Read Book One to get the big picture that’s missing from other tutorials. Read it anywhere, on your phone or tablet. It introduces key concepts so you’ll have a solid foundation for continued study. You can start this book before you finish Book One.</p>
<p>This book (Book Two) is for hands-on learning so you’ll need your computer to follow this tutorial.</p>
<p>In this book, I also provide links to videos. You can get the videos along with advanced tutorials at the <a href="https://tutorials.railsapps.org/">tutorials.railsapps.org</a> site.</p>
<p><img alt="images/figures/learn-rails" src="http://learn-rails.com/images/figures/learn-rails-2/learn-rails.png" /></p>
<p>Figure 2.1: The application you will build.</p>
<h2 id="21-is-it-for-you"><a href="#cid5">2.1 Is It for You?</a></h2>
<p>You don’t need to be a programmer to succeed with this book. You’ll be surprised how quickly you become familiar with the Unix command line interface and the Ruby programming language even if you’ve never tried programming before.</p>
<p>Book One provides a primer for the Unix command line, the terminal, and a text editor. If you have no experience with Unix commands, the terminal window, or a text editor, read Book One first. Everything else you need is self-contained in this book.</p>
<p>With this book, my aim is to introduce you to Rails and the techniques of web application development so you can launch a startup or begin a new career.</p>
<h2 id="22-what-to-expect"><a href="#cid6">2.2 What To Expect</a></h2>
<p>There is deep satisfaction in building an application and making it run. With this book, I’ll give you everything you need to build a real-world Rails application. More importantly, I’ll explain everything you build, so you understand how it works. There will be no mystery code.</p>
<p>When you’ve completed this tutorial, you will be ready for more advanced self-study, including the <a href="https://tutorials.railsapps.org/">Capstone Rails Tutorials</a>, textbook introductions to Rails such as Michael Hartl’s <a href="https://www.railstutorial.org/">Ruby on Rails Tutorial</a>, or workshops and code camps that provide intensive training in Ruby on Rails.</p>
<h3 id="221-about-book-one"><a href="#uid3">2.2.1 About Book One</a></h3>
<p>Here’s what is covered in Book One, in case you missed it.</p>
<p>In Book One, I explain the culture and practices of the Rails community. I introduce the basic concepts you’ll need to understand web application development.</p>
<p>Book One will teach you how to be a successful beginner. There is a roadmap, or study guide, in the “Level Up” chapter. It helps to have a map because there is so much to learn. More importantly, to become a skilled Rails developer, you’ll need to start writing code, and Book One contains a chapter, “Crossing the Chasm,” that will give you a strategy for building your own applications.</p>
<h3 id="222-whats-in-this-book"><a href="#uid4">2.2.2 What’s in This Book</a></h3>
<p>You’ll start coding immediately in this book. It’s a hands-on tutorial that leads you through the code needed to build a real-world web application. Don’t skip around in this book. The tutorial is designed to unfold in steps, one section leading to another, until you reach the “Testing” chapter.</p>
<p>You can complete this book in one long weekend, though it will take concentration and stamina. If you work through the book over a longer timespan, try to set aside uninterrupted blocks of two hours or more for reading and coding, as it takes time to focus and concentrate.</p>
<h3 id="223-a-warning-about-links"><a href="#uid5">2.2.3 A Warning About Links</a></h3>
<p>My books are densely packed with links for background reading. If you click every link, you’ll be a well-informed student, but you may never finish the book! It’s up to you to master your curiosity. Follow the links only when you want to dive deeper.</p>
<h3 id="224-what-comes-next"><a href="#uid6">2.2.4 What Comes Next</a></h3>
<p>The best way to learn is by doing; when it comes to code, that means building applications. Hands-on learning with actual Rails applications is the key to absorbing and retaining knowledge.</p>
<p>After you read this book, you’ll be able to work with the example applications from the <a href="https://railsapps.github.io/">RailsApps Project</a>. The project provides open source example applications for Rails developers, for free. Each application is accompanied by a tutorial in the Capstone Rails Tutorials series, so there’s no mystery code. Each application can be generated in a few minutes with the <a href="https://www.railscomposer.com">Rails Composer</a> tool, which professional developers use to create starter applications.</p>
<p>The open source project is solely supported by subscriptions to the video series and sales of the <a href="https://tutorials.railsapps.org/">Capstone Rails Tutorials</a>. If you get the videos or the advanced tutorials, you’ll have my sincere appreciation for your support.</p>
<h3 id="225-staying-in-touch"><a href="#uid7">2.2.5 Staying In Touch</a></h3>
<p>If you obtained this book from Amazon or a download site, take a moment to get on the mailing list for the book. I’ll let you know when I release updates to the book.</p>
<ul>
<li><a href="http://learn-rails.com/mailinglist">Get on the mailing list for the book</a></li>
</ul>
<h3 id="226-a-note-to-reviewers-and-teachers"><a href="#uid9">2.2.6 A Note to Reviewers and Teachers</a></h3>
<p>This book approaches the subject differently than most introductions to Rails. In this book, rather than show the student how to use scaffolding, I introduce the model-view-controller design pattern by creating the components manually. Lastly, though every other Rails tutorial shows how to use a database, this book doesn’t, because I want the book to be a short introduction and I believe the basic principles of a web application stand out more clearly without adding a database to the application. Though this tutorial is not a typical Rails introduction, I hope you’ll agree that it does a good job in preparing Rails beginners for continued study, whether it is a course or more advanced books.</p>
<h3 id="227-using-the-book-in-the-classroom"><a href="#uid10">2.2.7 Using the Book in the Classroom</a></h3>
<p>If you’ve organized a workshop, course, or code camp, and would like to assign the book as recommended reading, contact me at <a href="/cdn-cgi/l/email-protection#395d5857505c55795d5857505c55525c51565c175a5654">[email protected]</a> to arrange access to the book for your students at no charge.</p>
<h3 id="228-lets-get-started"><a href="#uid11">2.2.8 Let’s Get Started</a></h3>
<p>In the next chapter, we’ll learn how to get help when you need it.</p>
<h1 id="chapter-3-get-help-when-you-need-it"><a href="#cid7">Chapter 3 Get Help When You Need It</a></h1>
<p>This chapter appears in the first book in this series, but I’ve included an expanded version here in Book Two because it is important.</p>
<h2 id="31-example-code"><a href="#cid8">3.1 Example Code</a></h2>
<p>If you follow this tutorial closely, you’ll have a working application that closely matches the example app in the <a href="https://github.com/RailsApps/learn-rails/">learn-rails</a> GitHub repository. If your application doesn’t work after following the tutorial, compare the code to the example app in the GitHub repository, which is known to work.</p>
<h2 id="32-version-check"><a href="#cid9">3.2 Version Check</a></h2>
<p>The code in this tutorial was tested by many people and worked flawlessly at the time this was written. The <a href="https://github.com/RailsApps/learn-rails/">learn-rails</a> example application on GitHub serves as a “reference implementation” if you have problems. The example application is updated more frequently than the published tutorial.</p>
<p>You’ll find the version number and release date on the first page of this book (under the book title). Check the <a href="https://github.com/RailsApps/learn-rails">learn-rails GitHub repository</a> to find out if you have the newest version of the book. The README page on the GitHub repo always shows the most recent version number for the book and the tutorial application.</p>
<p>Don’t worry if the <a href="https://github.com/RailsApps/learn-rails">learn-rails GitHub repository</a> seems complicated or difficult to understand. You’ll get to know GitHub over time and it will become familiar. For now, it is only important to know that it is there in case you have problems.</p>
<p>Take a moment now to look at the <a href="https://github.com/RailsApps/learn-rails/issues?page=1&amp;state=open">open issues</a> on GitHub to see what problems you may encounter as you work your way through the tutorial. You can look at the <a href="https://github.com/RailsApps/learn-rails/issues?page=1&amp;state=closed">closed issues</a> to see some of the solved problems.</p>
<p>If you have trouble building the application in this book, and suspect something may be out of date, you can <a href="https://github.com/RailsApps/learn-rails/blob/master/Gemfile">compare the Gemfile in the repo</a> to see if we’ve changed gems or specified version numbers to avoid compatibility issues.</p>
<p>You can also check the <a href="https://github.com/RailsApps/learn-rails/blob/master/CHANGELOG.textile">CHANGELOG</a> and look at <a href="https://github.com/RailsApps/learn-rails/commits/master">recent commits</a> to see the current state of the application.</p>
<h2 id="33-getting-help-with-the-book"><a href="#cid10">3.3 Getting Help With the Book</a></h2>
<p>Let’s consider what to do if you encounter problems as you build the tutorial application in this book.</p>
<p>If you are in a classroom, or studying in a group, ask a peer to look at your problem. Most problems are caused by simple typos or formatting errors. Your classmate may see what you overlooked.</p>
<p><a href="https://stackoverflow.com/questions/tagged/learn-ruby-on-rails">Stack Overflow</a> provides a question-and-answer forum for readers of this book. As the author of this book, I can’t solve your individual problems or help you directly by email. If I did, I would not have time to create the tutorials and videos that benefit so many people. However, I watch for questions on Stack Overflow. Everyone benefits when solutions are made public.</p>
<ul>
<li>tag your questions on Stack Overflow with <strong>railsapps</strong> for extra attention</li>
</ul>
<p>If your questions aren’t answered on Stack Overflow, try the Reddit forum:</p>
<ul>
<li><a href="https://www.reddit.com/r/rails/">/r/rails</a></li>
</ul>
<p>I sincerely hope you won’t encounter obstacles as you build the tutorial application. Thousands of beginners have successfully completed the book and, unless a gem has recently changed, you should have no problem.</p>
<p>Now let’s consider where to look for help when you are working on your own Rails projects.</p>
<h2 id="34-getting-help-with-rails"><a href="#cid11">3.4 Getting Help With Rails</a></h2>
<h3 id="341-video-option"><a href="#uid14">3.4.1 Video Option</a></h3>
<p>Watch the six minute video if you have subscribed:</p>
<ul>
<li><a href="https://tutorials.railsapps.org/videos/5">Get Help with Rails</a></li>
</ul>
<h3 id="342-where-to-go-for-help"><a href="#uid16">3.4.2 Where To Go For Help?</a></h3>
<p>What will you do when you get stuck?</p>
<p>“Google it,” of course. But here’s a trick to keep in mind. Google has options under “Search tools” to show only recent results from the past year. Use it to filter out stale advice that pertains only to older versions of Rails.</p>
<p><a href="https://stackoverflow.com/questions/tagged/ruby-on-rails">Stack Overflow</a> is as important as Google for finding answers to programming problems. Stack Overflow answers are often included in Google search results, but you can go directly to Stack Overflow to search for answers to your questions. Like Google, answers from Stack Overflow are helpful if you check carefully to make sure the answers are recent. Also be sure to compare answers to similar questions; the most popular answer is not always the correct answer to your particular problem.</p>
<p>Requests for advice (especially anything that provokes opinions) are often rejected on Stack Overflow. Instead, try Reddit for advice or recommendations. You’ll find discussion forums (“subreddits”) devoted to <a href="https://www.reddit.com/r/rails">Rails</a> and <a href="https://www.reddit.com/r/ruby/">Ruby</a>. You can also visit the <a href="https://www.quora.com/">Quora</a> question-and-answer site for topics devoted to <a href="https://www.quora.com/Ruby-on-Rails-web-framework">Rails</a> and <a href="https://www.quora.com/Ruby-programming-language">Ruby</a>.</p>
<h2 id="35-references"><a href="#cid12">3.5 References</a></h2>
<p>Here are suggestions for the most important references.</p>
<p>If you feel overwhelmed by all the links, remember that you can use this book to build the tutorial application without any additional resources. Right now, it’s important to know additional help is available when you need it.</p>
<h3 id="351-railsguides"><a href="#uid17">3.5.1 RailsGuides</a></h3>
<p>The <a href="http://guides.rubyonrails.org/">Rails Guides</a> are Rails’s official documentation, written for intermediate-level developers who already have experience writing web applications. The Rails Guides are an excellent reference if you want to check the correct syntax for Rails code. You’ll be able to use the Rails Guides after completing this tutorial.</p>
<h3 id="352-cheatsheets"><a href="#uid18">3.5.2 Cheatsheets</a></h3>
<p>Tobias Pfeiffer has created a useful <a href="https://pragtob.github.io/rails-beginner-cheatsheet/index.html">Rails Beginner Cheat Sheet</a> that provides a good overview of Rails syntax and commands.</p>
<p>Even better than a cheatsheet, for Mac users, is an application named <a href="http://kapeli.com/dash">Dash</a> that offers fingertip access to reference documentation for Ruby, Rails, HTML, CSS, JavaScript, and many other languages and frameworks.</p>
<h3 id="353-api-documentation"><a href="#uid19">3.5.3 API Documentation</a></h3>
<p>The API documentation for Ruby and Rails shows every class and method. These are extremely technical documents (the only thing more technical is reading the source code itself). The documents offer very little help for beginners, as each class and method is considered in isolation, but there are times when checking the API documentation is the only way to know for certain how something works.</p>
<ul>
<li><a href="http://api.rubyonrails.org/">Rails Documentation</a> - official API docs</li>
<li><a href="http://apidock.com/rails">apidock.com/rails</a> - Rails API docs with usage notes</li>
<li><a href="http://apidock.com/ruby">apidock.com/ruby</a> - Ruby API docs with usage notes</li>
</ul>
<p>I recommend <a href="http://kapeli.com/dash">Dash</a> as a tool to look up classes, modules, and methods in Ruby and Rails. Dash is a macOS app; use <a href="https://zealdocs.org/">Zeal</a> on Linux. Dash and Zeal run offline (they don’t need an Internet connection) so you can use them anywhere.</p>
<h2 id="36-meetups-hack-nights-and-workshops"><a href="#cid13">3.6 Meetups, Hack Nights, and Workshops</a></h2>
<p>I’d like to urge you to find ways you can work with others who are learning Rails. Peer support is really important when you face a challenge and want to overcome obstacles.</p>
<p>Most large urban areas have meetups or user group meetings for Rails developers. Try <a href="https://www.meetup.com/">Meetup.com</a> or google “ruby rails (my city)”. The community of Rails developers is friendly and eager to help beginners. If you are near a Rails meetup, it is really worthwhile to connect to other developers for help and support. You may find a group that meets weekly for beginners who study together.</p>
<p>Local user groups often sponsor hack nights or <a href="https://en.wikipedia.org/wiki/Hackathon">hackathons</a> which can be evening or weekend collaborative coding sessions. You don’t have to be an expert. Beginners are welcome. You can bring your own project which can be as simple as completing a tutorial. You will likely find a study partner at your level or a mentor to help you learn.</p>
<p>If you are a woman learning Rails, look for one of the free workshops from <a href="http://railsbridge.org/">RailsBridge</a> or <a href="http://railsgirls.com/">Rails Girls</a>. These are not exclusively for women; everyone considered a “minority” in the tech professions is encouraged to participate; and men are included when invited by a woman colleague or friend.</p>
<h2 id="37-pair-programming"><a href="#cid14">3.7 Pair Programming</a></h2>
<p>Learning to code is challenging, especially if you do it alone. Make it social and you’ll learn faster and have more fun.</p>
<p>There’s a popular trend in the workplace for programmers to work side-by-side on the same code, sharing a keyboard and screen. It’s effective, both to increase productivity and to share knowledge, and many coders love it. When programmers are not in the same office, they share a screen remotely and communicate with video chat.</p>
<p>Look for opportunities to pair program. It’s the best way to learn to code, even if your pairing partner is only another beginner. Learn more about pair programming on the site <a href="http://www.pairprogramwith.me/">pairprogramwith.me</a> and find a pairing partner at <a href="http://www.codermatch.me/">codermatch.me</a> or <a href="http://www.letspair.net/">letspair.net</a>.</p>
<p>Remote pair programming requires tools for screen sharing and video chat. Pairing sessions often use:</p>
<ul>
<li><a href="https://www.google.com/+/learnmore/hangouts/">Google+ Hangouts</a></li>
<li><a href="http://screenhero.com/">Screenhero</a></li>
<li><a href="https://floobits.com/">Floobits</a></li>
<li><a href="https://c9.io/">Cloud9 IDE</a></li>
</ul>
<p>More tools are emerging as remote pair programming becomes popular.</p>
<h2 id="38-pairing-with-a-mentor"><a href="#cid15">3.8 Pairing With a Mentor</a></h2>
<p>By far, the best way to learn is to have a mentor at your side as you undertake a project. That is an opportunity that is seldom available, unless you’ve been hired to be part of a team in a company that encourages pair programming.</p>
<p>You can try <a href="http://www.railsmentors.org/">RailsMentors</a>, a network of volunteer mentors offering free help.</p>
<p>If you can pay for help, find a mentor using <a href="https://hackhands.com/">HackHands</a> or <a href="https://www.airpair.com/">AirPair</a>. Market rates are expensive for a student, obviously, but if you are learning on the job or building an application for your own business, connecting online with a mentor might be a godsend.</p>
<p><a href="https://www.airpair.com/">AirPair</a> connects developers for real-time help using video chat and screen sharing. Experts set their own rate and the site matches you according to your budget. Expect to pay market rates for consulting ranging from USD $40 per hour to $150 per hour or more.</p>
<p><a href="https://hackhands.com/">HackHands</a> promises to instantly connect you with a qualified expert at a cost of one dollar per minute for mentorship using video chat and screen sharing.</p>
<h2 id="39-code-review"><a href="#cid16">3.9 Code Review</a></h2>
<p>Code review is an essential part of the development process. There’s always more than one way to implement a feature, and some ways are better than others, but you may not know it unless you ask someone to look at your code. When you pair with a mentor, you get the benefit of code review. But even if you don’t have a mentor, you can get code review online. StackExchange, the parent of StackOverflow, has a free site for code review, and a new service promises code review as a service:</p>
<ul>
<li><a href="https://codereview.stackexchange.com/">codereview.stackexchange.com</a></li>
</ul>
<p>Expert code review will accelerate your learning faster than anything else.</p>
<p>Knowing where to go for help is important; it is just as important to stay current.</p>
<h2 id="310-staying-up-to-date"><a href="#cid17">3.10 Staying Up-to-Date</a></h2>
<p>Rails changes frequently and its community is very active. Changes to Rails, expert blog articles, and new gems can impact your projects, even if you don’t work full-time as a Rails developer. Consequently, I urge you to stay up-to-date with news from the community.</p>
<p>I suggest signing up for two weekly email newsletters:</p>
<ul>
<li><a href="http://rubyweekly.com/">Ruby Weekly</a></li>
<li><a href="http://greenruby.org/">Green Ruby News</a></li>
</ul>
<p>Another weekly email newsletter is more technical, and focused on code arriving in the next version of Rails:</p>
<ul>
<li><a href="https://rails-weekly.ongoodbits.com/">This Week in Rails</a></li>
</ul>
<p>For daily news about Rails, check Peter Cooper’s <a href="http://www.rubyflow.com/">RubyFlow</a> site which lists new blog posts from Rails developers each day.</p>
<p>Also take a look at this list of top blogs for Rails developers:</p>
<ul>
<li><a href="http://blog.honeypot.io/45-ruby-blogs/">45 Ruby Blogs</a></li>
</ul>
<p>If you like podcasts, check out <a href="http://rubyrogues.com/">Ruby Rogues</a> and Envy Labs’s <a href="http://ruby5.envylabs.com/">Ruby5</a>.</p>
<p>Finally, you can follow <a href="https://twitter.com/rails_apps">@rails_apps</a> on Twitter for news about the RailsApps project.</p>
<h1 id="chapter-4-accounts-you-may-need"><a href="#cid18">Chapter 4 Accounts You May Need</a></h1>
<p>You’ll need accounts with four services before you begin building the application in this book.</p>
<p>This tutorial will show you how to save your work using <a href="https://github.com/">GitHub</a>. You can sign up for a GitHub account for free. Every experienced Rails developer has a GitHub account; it is where we collaborate on our code, both commercial and open source projects.</p>
<p>We’ll create a form that allows website visitors to “opt-in” to a mailing list. You’ll need a <a href="https://mailchimp.com/">MailChimp</a> account, which is free. If you send email to a mailing list, you will find it is useful to have an account with MailChimp or a similar service.</p>
<p>We’ll also send email from the application, which will require a <a href="https://sendgrid.com/">SendGrid</a> account. SendGrid is a transactional email service that lets you send email messages efficiently and reliably. SendGrid offers a free account that allows you to send 12,000 messages per month for free.</p>
<p>Finally, we’ll deploy the tutorial application to <a href="https://www.heroku.com/">Heroku</a> which provides Rails application hosting. It costs nothing to set up a Heroku account and deploy as many applications as you want. It is the easiest way to deploy a Rails application and most Rails developers use Heroku at some time in their careers.</p>
<h2 id="41-github"><a href="#cid19">4.1 GitHub</a></h2>
<p>Rails developers use <a href="https://github.com/">GitHub</a> for collaboration and remote backup of projects.</p>
<p>For this tutorial, I suggest you get a <a href="https://github.com/signup/free">free personal GitHub account</a> if you don’t already have one. As a developer, your GitHub account establishes your reputation in the open source community. If you’re seeking a job as a developer, employers will look at your GitHub account. When you work with other developers, they may check to see what you’ve worked on recently. Don’t be reluctant to set up a GitHub account, even if you’re a beginner. It shows you are serious about learning Rails.</p>
<p>You’ll be asked to provide a username. This can be a nickname or short version of your real name (for example, your Twitter username).</p>
<p>You’ll be asked to provide an email address. It’s very important that you use the same email address for your GitHub account that you use to configure Git locally (there will be more about configuring Git later). If you create a Heroku account to deploy and host your Rails applications, you should use the same email address.</p>
<p>After you create your GitHub account, log in and look for the button “Edit Your Profile.” Take a few minutes to add some public information to your account. It is really important to provide your real name and a public email address. Displaying your real name on your GitHub account makes it easy for people to associate you with your work when they meet you in real life, for example at a meetup, a hackathon, or a conference. Providing a public email address makes it possible for other developers to reach you if you ask questions or submit issues. If you can, provide a website address (even just your Twitter or Facebook page). In general, you won’t be exposed to stalkers or spammers (except some recruiters) if you are open about yourself on GitHub.</p>
<p>Later I’ll show you how to set up and use Git and GitHub.</p>
<h2 id="42-mailchimp"><a href="#cid20">4.2 MailChimp</a></h2>
<p>This tutorial shows how website visitors can sign up to receive a newsletter provided by a <a href="https://mailchimp.com/">MailChimp</a> mailing list. MailChimp allows you to send up to 12,000 emails/month to a list of 2000 or fewer subscribers for free. There is no cost to set up an account.</p>
<p>MailChimp will ask you to provide a website address and company details for your account. These details are included when email messages are sent to your subscribers. If you don’t have your own website, you can enter the URL for your GitHub account for now. Use your own name for a company if you don’t have one.</p>
<p>After you have set up a MailChimp account, create a new mailing list where you can collect email addresses of visitors who have asked to subscribe to a newsletter. The MailChimp “Lists” page has a button for “Create List.” The list name and other details are up to you.</p>
<p>If you get frustrated with the complex and confusing MailChimp interface, try to remember that the friendly MailChimp monkey is laughing with you, not at you.</p>
<h2 id="43-sendgrid"><a href="#cid21">4.3 SendGrid</a></h2>
<p>Earlier editions of this book showed how to use a <a href="https://accounts.google.com/SignUp?service=mail">Gmail</a> account to send email from the application. Google has taken steps to make Gmail more secure and now it can be difficult to send email from a Rails application using Gmail.</p>
<p>This tutorial provides instructions for <a href="https://sendgrid.com/">SendGrid</a>. SendGrid offers a free account that allows you to send 12,000 messages per month for free.</p>
<p>Scroll to the bottom of the <a href="https://sendgrid.com/pricing">SendGrid pricing page</a> to see details about the free plan. Click the “Try for Free” link to set up an account. No credit card is needed.</p>
<h2 id="44-heroku"><a href="#cid22">4.4 Heroku</a></h2>
<p>We’ll use <a href="https://www.heroku.com/">Heroku</a> to host the tutorial application so anyone can reach it.</p>
<p>To deploy an app to Heroku, you must have a Heroku account. Visit <a href="https://signup.heroku.com/devcenter">https://signup.heroku.com/devcenter</a> to set up an account.</p>
<p>Be sure to use the same email address you used to register for GitHub. It’s very important that you use the same email address for GitHub and Heroku accounts.</p>
<h1 id="chapter-5-get-started"><a href="#cid23">Chapter 5 Get Started</a></h1>
<p>Before you can start building, you’ll need to install Ruby (the language) and Rails (the gem). I’ll provide links to installation instructions that are up to date. Even if you’ve already installed Rails, please review the instructions to make sure your development environment is set up correctly. Other books and tutorials often skip important details.</p>
<h2 id="51-text-editor-and-terminal-applications"><a href="#cid24">5.1 Text Editor and Terminal Applications</a></h2>
<p>I’ve explained how to use a text editor and terminal application in Book One. If you haven’t used the Unix command line before, refer to Book One for an introduction.</p>
<p>I recommend the <a href="https://atom.io/">Atom</a> text editor but you may use <a href="https://www.sublimetext.com/">Sublime Text</a> or any others that provide syntax highlighting. Refer to Book One for important instructions about setting up the text editor so you can open a file from the command line.</p>
<h2 id="52-copying-and-pasting-code"><a href="#cid25">5.2 Copying and Pasting Code</a></h2>
<p>In the next chapter you’ll begin building a Rails application.</p>
<p>You need to get the code from this tutorial into your computer. You could just read and imagine, but really, building a working application is the only way to learn.</p>
<p>The most obvious way is to copy and paste from this tutorial into your text editor, assuming you are reading this on your computer (not a tablet or printed pages). It’s a bit tedious and error-prone but you’ll have a good opportunity to examine the code closely.</p>
<p>Some students like to type in the code, character by character. If you have patience, it’s a worthwhile approach because you’ll become more familiar with the code than by copying and pasting.</p>
<p>Don’t feel shy about copying code; it’s how you will learn. Working programmers spend a lot of time copying code from others. At first, you will copy a lot of code. As you gain proficiency, you will copy code and adapt it, more extensively as you gain confidence and skill. Only when you’ve been working full-time as a coder for months or years will you find yourself writing code from scratch; even then, when you encounter new problems, you will still look for code examples to copy and adapt.</p>
<p>Box 5.1. Warning About the PDF and Kindle Versions</p>
<p>This book is available in several formats, including online (HTML), PDF, ePub (Apple iBooks), and mobi (Kindle) versions.</p>
<p>Use the online edition of the book if you can. With the online edition, you’ll be able to copy and paste the code without any problem. The ePub version (using Apple iBooks) also preserves line breaks and indentation when copying code.</p>
<p>Copying without line breaks will cause code errors. You’ll lose line breaks when copying code with the following versions:</p>
<ul>
<li>PDF version on macOS using the Preview application</li>
<li>mobi (Kindle)</li>
</ul>
<p>If you use <a href="https://get.adobe.com/reader/">Adobe Acrobat</a> you’ll be able to copy the line breaks (though indenting is lost). You can also open a PDF file in Chrome or Safari web browsers and copy code with line breaks. With the mobi (Kindle) version, you’ll have to carefully reformat the code after pasting into your text editor.</p>
<p>Indentation makes code more readable, so try to preserve the indentation you see in the code samples. In YAML files (with the file extension <strong>.yml</strong>), indentation is required (your application will break without it).</p>
<h2 id="53-your-computer"><a href="#cid26">5.3 Your Computer</a></h2>
<p>You can develop web applications with Rails on computers running Mac OS X, Linux, or Microsoft Windows operating systems. Most Rails developers use macOS or Linux because the underlying Unix operating system has long been the basis for open source programming.</p>
<p>Later in this chapter, I’ll give links to installation instructions for macOS and Linux.</p>
<p>For Windows users, I have to say, installing Rails on Windows is frustrating and painful. Readers and workshop students often tell me that they’ve given up on learning Rails because installation of Ruby on Windows is difficult and introduces bugs or creates configuration issues. Even when you succeed in getting Rails to run on Windows, you will encounter gems you cannot install. For these reasons, I urge you to use Cloud9, a browser-based development environment, on your Windows laptop.</p>
<h3 id="531-hosted-computing"><a href="#uid35">5.3.1 Hosted Computing</a></h3>
<p>If you are using Windows, or have difficulty installing Ruby on your computer, try using Cloud9.</p>
<p><a href="https://c9.io/">Cloud9</a> provides a hosted development environment. That means you set up an account and then access a remote computer from your web browser. The Cloud9 service is free for ordinary use. There is no credit card required to set up an account. You’ll only be charged if you add extra computer memory or disk space (which you don’t need for ordinary Rails development).</p>
<p>The Cloud9 service gives you everything you need for Rails development, including a Unix shell with Ruby pre-installed, plus a browser-based file manager and text editor. Any device that runs a web browser will give you access to Cloud9, including a tablet or smartphone, though you need a broadband connection, a sizable screen, and a keyboard to be productive.</p>
<h2 id="54-try-the-terminal"><a href="#cid27">5.4 Try the Terminal</a></h2>
<p>Look for the Terminal application in the following places:</p>
<ul>
<li>MacOS: <em>Applications - Utilities - Terminal</em></li>
<li>Linux: <em>Applications - Accessories - Terminal</em></li>
<li>Windows: <em>Taskbar Start Button - Command Prompt</em></li>
</ul>
<p>On the Mac, search for the macOS Terminal application by pressing the Command-Spacebar combination (which Apple calls “Spotlight Search”) and searching for “Terminal.” The magnifying glass in the upper right corner of your screen will also launch “Spotlight Search.” Or look in the <strong>Applications/Utilities/</strong> folder for the Terminal application. You’ll need to click the name of the application to launch the Terminal.</p>
<p>For Linux or Windows, <a href="http://cli.learncodethehardway.org/book/">The Command Line Crash Course</a> explains <a href="http://cli.learncodethehardway.org/book/ex1.html">how to launch a terminal application</a>.</p>
<p>Launch your terminal application now.</p>
<p>Try out the terminal application by entering a shell command.</p>
<p>$ whoami</p>
<p>Don’t type the <code>$</code> character. The <code>$</code> character is a cue that you should enter a shell command. This is a longtime convention that indicates you should enter a command in the terminal application or console.</p>
<p>The Unix shell command <code>whoami</code> returns your username.</p>
<p>Don’t type the <code>$</code> prompt.</p>
<p>You might see:</p>
<p>command not found: $</p>
<p>which indicates you typed the <code>$</code> character by mistake.</p>
<p>If you are new to programming, using a text editor and the shell will seem primitive compared to the complexity and sophistication of Microsoft Word or Photoshop. Software developers edit files with simple text editors and run programs in the shell. That’s all we do. We have to remember the commands we need (or consult a cheatsheet) because there are no graphical menus or toolbars. Yet with nothing more than a text editor and the command line interface, programmers have created everything that you use on your computer.</p>
<h2 id="55-installing-ruby"><a href="#cid28">5.5 Installing Ruby</a></h2>
<p>Your first challenge in learning Rails is installing Ruby on your computer.</p>
<p>Frankly, this can be the most difficult step in learning Rails because no tutorial can sort out the specific configuration of your computer. Get over this hump and everything else becomes easy.</p>
<p>The focus of this book is learning Rails, not installing Ruby, so to keep the book short and readable, I’m going to give you links to articles that will help you install Ruby.</p>
<p>You’ll spend at least an hour installing Ruby and Rails, so be sure to allow enough time for the task.</p>
<h3 id="551-macos"><a href="#uid39">5.5.1 MacOS</a></h3>
<p>See this article for macOS installation instructions:</p>
<p><a href="https://railsapps.github.io/installrubyonrails-mac.html"><strong>Install Ruby on Rails - MacOS</strong></a></p>
<h3 id="552-ubuntu-linux"><a href="#uid40">5.5.2 Ubuntu Linux</a></h3>
<p>See this article for Ubuntu installation instructions:</p>
<p><a href="https://railsapps.github.io/installrubyonrails-ubuntu.html"><strong>Install Ruby on Rails - Ubuntu</strong></a></p>
<h3 id="553-hosted-computing"><a href="#uid41">5.5.3 Hosted Computing</a></h3>
<p><a href="https://c9.io/">Cloud9</a> is a browser-based development environment. Cloud9 is free for small projects. If you have a fast broadband connection to the Internet, this is your best choice for developing Rails on Windows. And it is a good option if you have any trouble installing Ruby on Mac or Linux because the Cloud9 hosted environment provides everything you need, including a Unix shell with Ruby and RVM pre-installed, plus a browser-based file manager and text editor. Using a hosted development environment is unconventional but leading developers do so and it may be the wave of the future.</p>
<p>See this article for Cloud9 installation instructions:</p>
<p><a href="https://railsapps.github.io/rubyonrails-cloud9.html"><strong>Install Ruby on Rails - Cloud9</strong></a></p>
<p>The article shows how to get started with Cloud9.</p>
<p>If you use Cloud9, be sure to pick the “Blank” template for your workspace, not the “Ruby” or “Ruby on Rails” templates that provide a prebuilt Rails application. We’re building from scratch in this tutorial.</p>
<h3 id="554-windows"><a href="#uid42">5.5.4 Windows</a></h3>
<p>Here are your choices for Windows:</p>
<ul>
<li>Use the <a href="https://railsapps.github.io/rubyonrails-cloud9.html">Cloud9</a> hosted development environment</li>
<li>Install the <a href="https://github.com/railsbridge/railsbridge-virtual-machine">Railsbridge Virtual Machine</a></li>
<li>Use <a href="http://rubyinstaller.org/">RubyInstaller for Windows</a></li>
</ul>
<p>Cloud9 is ideal if you have a fast Internet connection. If not, download the Railsbridge Virtual Machine to create a virtual Linux computer using <a href="https://www.vagrantup.com/">Vagrant</a>. Other tutorials may suggest using <a href="http://railsinstaller.org/">RailsInstaller</a>, but it will not provide an up-to-date version of Ruby or Rails. Also, RVM does not run on Windows.</p>
<h2 id="56-your-workspace"><a href="#cid29">5.6 Your Workspace</a></h2>
<p>Take a moment to think about where on your computer you’ll do your work and store your files. You may have a <strong>documents/</strong> folder. You could make a similar folder named <strong>projects/</strong> or <strong>code/</strong> or <strong>workspace/</strong> for your programming projects. Use the Unix <code>mkdir</code> command to create a folder or create it with your file browser.</p>
<p>If you haven’t done so already, make a folder to contain your programming projects. You don’t need to do this if you already created a <strong>workspace/</strong> folder in the Unix chapter in Book One.</p>
<p>$ cd ~
$ pwd
/Users/danielkehoe
$ mkdir workspace
$ cd workspace</p>
<p>In this tutorial, the terms “folders” and “directories” mean the same thing.</p>
<p>Use the Unix <code>cd</code> command to change directories.</p>
<p>When you enter the Unix command <code>cd ~</code>, you’ll move to your home (or “user”) directory. The squiggly <code>~</code> “tilde” character is a Unix shortcut that indicates your home folder.</p>
<p>The Unix <code>pwd</code> command shows the “present working directory,” where you are.</p>
<p>The Unix <code>mkdir</code> command creates an empty folder and we move into it with the Unix <code>cd</code> command.</p>
<h3 id="561-video-option"><a href="#uid46">5.6.1 Video Option</a></h3>
<p>Watch the four minute video if you have subscribed:</p>
<ul>
<li><a href="https://tutorials.railsapps.org/videos/2">UNIX Commands Basics</a></li>
</ul>
<h2 id="57-understanding-version-numbers"><a href="#cid30">5.7 Understanding Version Numbers</a></h2>
<p>Rails follows a convention named <em>semantic versioning</em>:</p>
<ul>
<li>The first number denotes a <em>major version</em> (Rails 4)</li>
<li>The second number denotes a <em>minor release</em> (Rails 4.2)</li>
<li>The third number denotes a <em>patch level</em> (Rails 4.2.1)</li>
</ul>
<p>A major release includes new features, including changes which break backward compatibility. For example, switching from Rails 3.2 to Rails 4.0 required a significant rewrite of every Rails application.</p>
<p>A minor release introduces new features but doesn’t break anything. For example, Rails 3.2 added the asset pipeline, and Rails 4.2 added the Active Job feature for background processing.</p>
<p>A patch release fixes bugs but doesn’t introduce significant features. Usually this means you can change the version number in the Gemfile and run <code>bundle update</code> without making any other changes to your application.</p>
<h2 id="58-ruby-and-rails-version-check"><a href="#cid31">5.8 Ruby and Rails Version Check</a></h2>
<p>Check that appropriate versions of Ruby and Rails are installed in your development environment. You’ll need:</p>
<ul>
<li>The Ruby language (version 2.3 or newer)</li>
<li>The Rails gem (version 5.1 or newer)</li>
</ul>
<p>Open your terminal application and enter:</p>
<p>$ ruby -v</p>
<p>You might see:</p>
<p>ruby 2.4.1p0 (...)</p>
<p>You’ve got Ruby version 2.4.1, patch level “p0” (Ruby versions add an extra patch level to semantic versioning). If you’ve got a newer version of Ruby, no problem; minor updates to Ruby don’t affect Rails.</p>
<p>Try:</p>
<p>$ rails -v</p>
<p>You might see:</p>
<p>Rails 5.1.2</p>
<p>If you see:</p>
<p>Rails is not currently installed on this system.</p>
<p>You are not using an RVM gemset where the Rails gem is installed. Go to the <a href="https://railsapps.github.io/installing-rails.html">Installing Rails</a> instructions for your computer if you have not set up Rails. The next section explains more about RVM gemsets which may be all you need to find Rails.</p>
<p>If you have Rails 4.2 or older versions, you must update to Rails 5.1. See the <a href="https://railsapps.github.io/installing-rails.html">Installing Rails</a> instructions for your computer.</p>
<p>Versions such as <code>5.0.0.beta3</code> or <code>5.0.0.rc1</code> are beta versions or “release candidates.” You can use a release candidate in the weeks before a final release becomes available.</p>
<p>If you’ve got Rails 5.1.3 or newer, that’s fine. It means minor bugs have been fixed since this was written, but the book is still current. You can check for the <a href="https://rubygems.org/gems/rails">current version of Rails</a> here.</p>
<p>Box 5.2. Rails 5.1</p>
<p>This edition of the book was prepared using Rails 5.1.2. The newest version of the book is listed on the README page of the <a href="https://github.com/RailsApps/learn-rails">learn-rails</a> GitHub repository.</p>
<h2 id="59-rvm"><a href="#cid32">5.9 RVM</a></h2>
<p>I promised that this book would introduce you to the practices of professional Rails developers. One of the most important utilities you’ll need in setting up a real-world Rails development environment is RVM, the <a href="https://rvm.io/">Ruby Version Manager</a>.</p>
<p>RVM lets you switch between different versions of Ruby. Right now, that might not seem important, but as soon as a new version of Ruby is released, you’ll need to upgrade, and it is best to be ready by installing the current version of Ruby with RVM, so you can easily add a new version of Ruby later, and still switch back to older versions as needed.</p>
<p>RVM also helps you manage your collections of gems, by letting you create multiple <em>gemsets</em>. Each gemset is the collection of gems you need for a specific project. Rails changes frequently; with RVM, you can install a specific version of Rails in a project gemset, along with all the gems you need for the project. When a new version of Rails is released, you can create a new gemset with the new Rails version when you start a new project. Your old project will still have the version of Rails it needs in its own gemset.</p>
<p>If you’ve followed the instructions in the article <a href="https://railsapps.github.io/installing-rails.html">Installing Rails</a> and installed RVM, you’ll be ready to handle multiple versions of Ruby, and multiple versions of Rails. That’s as it should be. Most professional Rails developers have more than one version of Ruby or Rails, and RVM makes it easy to switch.</p>
<p>RVM will show you a list of available Ruby versions:</p>
<p>$ rvm list</p>
<p>You can see a list of available gemsets associated with the current Ruby version:</p>
<p>$ rvm gemset list</p>
<p>You will see an arrow that shows which gemset is active.</p>
<p>You will see a <code>global</code> gemset as well as any others you have created, such as a gemset for <code>Rails5.0</code>.</p>
<p>Here’s how to switch between gemsets:</p>
<p>$ rvm gemset use global</p>
<p>And switch back to another:</p>
<p>$ rvm gemset use default</p>
<p>After you’ve worked on a few Rails applications, you’ll see several project-specific gemsets if you are using RVM in the way most developers do.</p>
<p>RVM is not the only utility you can use to manage multiple Ruby versions. Some developers like <a href="https://github.com/postmodern/chruby">Chruby</a> or <a href="https://github.com/sstephenson/rbenv">rbenv</a>. Don’t be worried if you hear debates about RVM versus Chruby or rbenv; developers love to compare the merits of their tools. RVM is popular, well-supported, and an excellent utility to help a developer install Ruby and manage gemsets; that’s why we use it.</p>
<h2 id="510-project-specific-gemset"><a href="#cid33">5.10 Project-Specific Gemset</a></h2>
<p>For our learn-rails application, we’ll create a project-specific gemset using RVM. We’ll give the gemset the same name as our application.</p>
<p>By creating a gemset for our tutorial application, we’ll isolate the current version of Rails and the gems we need for this project. Whether you use RVM or another Ruby version manager, this will introduce you to the idea of “sandboxing” (isolating) your development environment so you can avoid conflicts among projects.</p>
<p>After we create the project-specific gemset, we’ll install the Rails gem into the gemset. Enter these commands:</p>
<p>$ rvm use <a href="/cdn-cgi/l/email-protection">[email protected]</a> --create
$ gem install rails</p>
<p>This will install the newest version of Rails 5.0. It takes a few minutes to automatically install all the gems that are needed for Rails.</p>
<p>It’s absolutely necessary to create a gemset and install Rails so we can move on to creating the application in the next chapter. If you have trouble at this point, refer to the article <a href="https://railsapps.github.io/installing-rails.html">Installing Rails</a> or the <a href="https://rvm.io/">RVM website</a>. Linux users may need to check instructions for <a href="https://rvm.io/integration/gnome-terminal">Integrating RVM</a>.</p>
<p>Let’s make sure Rails is ready to run. Open a terminal and type:</p>
<p>$ rails -v</p>
<p>You should see the message “Rails 5.1.2” (or something similar).</p>
<p>Now let’s explore the <code>rails new</code> command and get started building the tutorial application.</p>
<h1 id="chapter-6-create-the-application"><a href="#cid34">Chapter 6 Create the Application</a></h1>
<p>In this chapter, we’ll begin building the tutorial application. But first, let’s consider the options you have for starter applications.</p>
<h2 id="61-starter-applications"><a href="#cid35">6.1 Starter Applications</a></h2>
<p>Rails provides a <em>framework</em>; that is, a software library that provides utilities, conventions, and organizing principles to allow us to build complex web applications. Without a framework, we’d have to code everything from scratch. Rails gives us the basics we need for many websites.</p>
<p>Still, the framework doesn’t give us all the features we need for many common types of websites. For example, we might want users to register for an account and log in to access the website (“user management and authentication”). We might want to restrict portions of our website to just administrators (“authorization”). We also might want to add gems that enhance Rails to aid development (gems for testing, for example) or improve the look and feel of our application (the Bootstrap or Foundation front-end frameworks). Developers often mix and match components to make a customized Rails stack.</p>
<p>Developers often use a <em>starter application</em> instead of assembling an application from scratch. You might call this a “template” but we use that term to refer to the <em>view files</em> that combine HTML with Ruby code to generate web pages. Most experienced developers have one or more starter applications that save time when beginning a new project. The <a href="https://railsapps.github.io/">RailsApps project</a> was launched to provide open source starter applications so developers could collaborate on their starter applications and avoid duplicated effort. After you gain some skill with this tutorial, you might use the RailsApps starter apps to instantly generate a Rails application with features like authentication, authorization, and an attractive design. At the end of this book, you’ll learn about <a href="http://www.railscomposer.com/">Rails Composer</a>, a tool for building starter applications.</p>
<p>For now, we’ll begin with the Rails default starter application.</p>
<h2 id="62-workspace-folder-and-rvm-gemset"><a href="#cid36">6.2 Workspace Folder and RVM Gemset</a></h2>
<p>Are you in the folder named <strong>workspace/</strong> you created earlier?</p>
<p>$ pwd
/Users/danielkehoe/workspace/</p>
<p>If you’re not in your workspace folder, enter a Unix command to move to the folder:</p>
<p>$ cd ~/workspace</p>
<p>We already created a project-specific gemset using RVM. Make sure it’s ready to use:</p>
<p>$ rvm use <a href="/cdn-cgi/l/email-protection">[email protected]</a>
$ rvm gemset list
gemsets for ruby-2.4.1...
 (default)
 global
\=&gt; learn-rails</p>
<p>You should see an arrow pointing to the <code>learn-rails</code> gemset. If not, go back to the previous “Get Started” chapter.</p>
<h2 id="63-use-rails-new-to-build-the-application"><a href="#cid37">6.3 Use “Rails New” to Build the Application</a></h2>
<p>Let’s go! We have selected a gemset, we have Rails installed, and we’re in our <strong>workspace/</strong> folder. Let’s build a Rails application!</p>
<p>To create the Rails default starter application, type:</p>
<p>$ rails new learn-rails</p>
<p>This will create a new Rails application named “learn-rails.”</p>
<p>It takes a few minutes when the build script runs <code>bundle install</code>. Don’t worry; just give it enough time to finish (but no more than five minutes even if your Internet connection is very slow).</p>
<p>In the future, you can give your application a different name. For this tutorial, it is VERY IMPORTANT that you use the name “learn-rails.” You’ll be copying code that assumes the name is “learn-rails;” it will save you trouble to use this name.</p>
<p>The <code>rails new</code> command will create ten folders and 93 files.</p>
<p>It will install 62 gems into your gemset.</p>
<p>After you create the application, switch to its folder to continue work directly in the application:</p>
<p>$ cd learn-rails</p>
<p>This is your project directory. It is also called the application root directory. You’ll spend all your time inside this folder.</p>
<p>Box 6.1. Spring</p>
<p>After creating a new Rails application, you may see a message to run a command:</p>
<p>$ bundle exec spring binstub --all</p>
<p>The command sets up Spring. Spring is a Rails application preloader. It speeds up development by keeping your application running in the background so you don’t need to stop and restart it when you make changes.</p>
<p>After you change into the project directory, you can run the command.</p>
<p>Type the <code>ls</code> command to show the folders and files in a directory. Soon we’ll learn more about each of these folders and files.</p>
<p>$ ls
Gemfile      Rakefile     config       lib          test
Gemfile.lock app          config.ru    log          tmp
README.md    bin          db           public       vendor</p>
<h2 id="64-make-a-sticky-gemset"><a href="#cid38">6.4 Make a Sticky Gemset</a></h2>
<p>RVM gives us a convenient technique to make sure we are always using the correct gemset when we enter the project directory. It will create hidden files to designate the correct Ruby version and project-specific gemset. Enter this command to create the hidden files:</p>
<p>$ rvm use <a href="/cdn-cgi/l/email-protection">[email protected]</a> --ruby-version</p>
<p>The <code>–ruby-version</code> argument creates two files, <strong>.ruby-version</strong> and <strong>.ruby-gemset</strong>, that set RVM every time we <code>cd</code> to the project directory. Without these two hidden files, you’d need to remember to enter <code>rvm use [[email protected]](/cdn-cgi/l/email-protection)</code> every time you start work on your project after closing the console.</p>
<p>If you see “ERROR: Gemset ‘learn-rails’ does not exist”, perhaps you overlooked an earlier step in the <em>Project-Specific Gemset</em> section (in the previous chapter) where we created the learn-rails gemset.</p>
<p>After creating the two hidden files, check if they are there:</p>
<p>$ ls -1pa
./
../
.gitignore
.ruby-gemset
.ruby-version
Gemfile
Gemfile.lock
README.md
Rakefile
app/
bin/
config/
config.ru
db/
lib/
log/
public/
test/
tmp/
vendor/</p>
<p>The “a” flag in the Unix <code>ls -1pa</code> command displays hidden files. Each hidden file is listed with a dot (period or full stop) at the beginning of the filename. You’ll notice <code>.ruby-gemset</code> and <code>.ruby-version</code>.</p>
<p>You’ll also see two “special files” which are not files at all:</p>
<ul>
<li><code>./</code> - an alias that represents the current directory</li>
<li><code>../</code> - an alias that represents the parent directory</li>
</ul>
<p>Box 6.2. Hidden Files in Cloud9</p>
<p>If you’re using Cloud9, you must change preferences to see hidden files. In the window that contains the file list, there is a gear icon (dark in color and difficult to see). Clicking the gear option will give you options:</p>
<ul>
<li>Show Root File System</li>
<li>Show Home in Favorites</li>
<li>Show Hidden Files</li>
</ul>
<p>You must select all three options to see the hidden files.</p>
<p><img alt="images/figures/23_cloud9_hidden_files" src="http://learn-rails.com/images/figures/learn-rails-2/23_cloud9_hidden_files.jpg" /></p>
<p>That’s a brief diversion into Unix; let’s try running our new Rails application.</p>
<h2 id="65-test-the-application"><a href="#cid39">6.5 Test the Application</a></h2>
<p>You’ve created a simple default web application. It’s ready to run.</p>
<h3 id="651-launching-the-web-server"><a href="#uid61">6.5.1 Launching the Web Server</a></h3>
<p>You can launch the application by entering the command:</p>
<p>$ rails server</p>
<p>Alternatively, to save typing, you can abbreviate the <code>rails server</code> command:</p>
<p>$ rails s</p>
<p>If you are using the Cloud9 hosted service, you’ll need to enter <code>bin/rails server -p $PORT -b $IP</code>.</p>
<p>You’ll see:</p>
<p>\=&gt; Booting Puma
\=&gt; Rails 5.1.2 application starting in development on http://localhost:3000
\=&gt; Run `rails server -h` for more startup options
\=&gt; Ctrl-C to shutdown server
Puma starting in single mode...
* Version 3.4.0 (ruby 2.4.1-p0), codename: Owl Bowl Brawl
* Min threads: 5, max threads: 5
* Environment: development
* Listening on tcp://localhost:3000
Use Ctrl-C to stop</p>
<p>The <code>rails server</code> command launches the <a href="http://puma.io/">Puma web server</a> that is provided with Rails.</p>
<h3 id="652-errors-for-linux-users"><a href="#uid62">6.5.2 Errors for Linux Users</a></h3>
<p>If you enter the command <code>rails server</code> and get an error message:</p>
<p>... Could not find a JavaScript runtime ...</p>
<p>You need to install Node.js. For help, see <a href="https://railsapps.github.io/installrubyonrails-ubuntu.html">Install Ruby on Rails - Ubuntu</a>.</p>
<h3 id="653-viewing-in-the-web-browser"><a href="#uid63">6.5.3 Viewing in the Web Browser</a></h3>
<p>To see your application in action, open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>. You’ll see the Rails default information page.</p>
<p>Box 6.3. Viewing on a Hosted Platform</p>
<p>It is easy to see your web application in action on your local computer. If you are using a hosted service such as Cloud9, it is a little more complicated.</p>
<p>If you are using <strong>Cloud9</strong>, click the “Preview” link in the IDE menu (at the top of the page). There is a “Run” link, too, but it doesn’t work if you have created your Rails application in a folder within the <strong>workspace/</strong> folder. You can also open a browser tab or window and enter the URL for the application, as hosted by Cloud9. When you launch the Rails server, Cloud9 displays a helpful message showing the URL where you can view your application.</p>
<h3 id="654-watch-log-messages"><a href="#uid65">6.5.4 Watch Log Messages</a></h3>
<p>Notice that messages scroll in the console window when your browser requests the Rails default web page.</p>
<p>Open the file <strong>log/development.log</strong> and you’ll see the same messages. When a browser sends requests to the Puma web server, diagnostic messages are written to the console and to the <strong>log/development.log</strong> file. These diagnostic messages are an important tool for troubleshooting when you are developing.</p>
<h3 id="655-multiple-terminal-windows"><a href="#uid66">6.5.5 Multiple Terminal Windows</a></h3>
<p>You can keep more than one terminal window open. For convenience, you may want to keep a terminal window open for running the web server and watching diagnostic messages. In the Terminal or iTerm2 applications, Command-t opens additional console sessions in new “tabs.”</p>
<p>Developers typically open more than one terminal window when they work on a Rails application. They’ll start the server with the <code>rails server</code> command in one window (or tab) and watch the log messages. In another window (or tab), they’ll enter commands as they build the application. They might create folders with a Unix command, run generators, or try out code with the <code>rails console</code> command (you’ll learn about the <code>rails console</code> command in the “Troubleshoot” chapter).</p>
<p>To some people, the text editor and the terminal window look very similar. When you work on a file in a text editor, you make changes to one file, in one place. The terminal window is very different. Your computer can run multiple programs at once. You can open multiple terminal windows. In each terminal window, you can use the command line to launch a different program. Each program you start in a terminal window is a separate <em>process</em> and multiple processes can run simultaneously. You can end a process by pressing Control-c (in most cases), Control-d (in some cases), or closing the terminal window (almost always). From this perspective, a terminal window is a tool you use to launch processes and your computer is a machine that runs processes.</p>
<h3 id="656-stop-the-web-server"><a href="#uid67">6.5.6 Stop the Web Server</a></h3>
<p>You can stop the server with Control-c to return to the command prompt. When we say Control-c, we mean hold down the Control key as you press the letter “c”.</p>
<p>Most of the time you’ll keep the web server running as you add or edit files in your project. Changes will automatically appear when you refresh the browser or request a new page. There is a tricky exception, however. If you make changes to the Gemfile, or changes to configuration files, the web server must be shut down and relaunched for changes to be activated.</p>
<p>As a rule of thumb, files that produce web pages can be changed without a restart. This includes any file in the <strong>app/</strong> folder which creates web pages, as well as the <strong>config/routes.rb</strong> file. Changes to files that create the environment for the web application, such as gems or configuration files, and are loaded at web server launch, won’t be seen until the web server is restarted.</p>
<h2 id="66-get-organized-for-efficiency"><a href="#cid40">6.6 Get Organized for Efficiency</a></h2>
<p>Before we learn about the Rails directory structure, take a minute to organize your screen real estate. During development, you’ll jump between the console in a terminal application, your text editor, and a web browser window. As a Rails developer, you’ll do this constantly, so think about how you can do this efficiently. Multiple screens make it easy, but even on a laptop you can get organized for efficiency.</p>
<p><img alt="images/figures/learn-rails-getting-organized" src="http://learn-rails.com/images/figures/learn-rails-2/learn-rails-getting-organized.png" /></p>
<p>Figure 6.1: Getting organized for efficiency.</p>
<p>Here’s some ideas. Open a window in the terminal application, place it on the left side of your screen, and stretch it to the maximum vertical height of your screen. Open multiple tabs in your terminal application. Keep one tabbed window open for entering shell commands (like <code>cd</code> or <code>ls</code>) and another terminal window open for running the <code>rails server</code> command and viewing the log output.</p>
<p>Place your text editor window next to the terminal window and stretch it to full vertical height. If you are using Atom or Sublime Text, you can open two editor panels side-by-side. Some developers find it helpful to leave the file browser panel open to navigate the project directory; others hide the file browser panel to save space.</p>
<p>If you have enough screen space, leave your web browser open and place it next to your text editor. If your screen space is limited, you may have to overlap the web browser with the text editor, but position your web browser window so you can bring it to the front with a single click. You’ll need multiple tabs open in your web browser. Unless you like constant distraction, close Gmail, Facebook, Twitter, and Hacker News. Open tabs for <a href="http://localhost:3000/">http://localhost:3000/</a>, this tutorial, and additional references or documentation.</p>
<p>On the Mac, there are window management utilities that reposition windows with just a click or keyboard command; I use <a href="http://manytricks.com/moom/">Moom</a> but you can find others if you search for “mac window management utilities.”</p>
<p>This is just a guide; I’m sure you can improve upon these suggestions.</p>
<h1 id="chapter-7-the-parking-structure"><a href="#cid41">Chapter 7 The Parking Structure</a></h1>
<p>We’ve created the default Rails starter application.</p>
<p>The <code>rails new</code> command has created a project directory for us.</p>
<p>It is a parking structure for our code. Unlike an ordinary parking structure, where you park anywhere you like, this garage has assigned parking. You have to park your code in the right place. This is Rails, where convention brings order to the development process.</p>
<p>As you develop a web application, you’ll do all your work in the project directory. It is important to know your way around and understand the purpose of each folder and file.</p>
<p>If you’ve built simple websites with HTML and CSS, or built websites with unstructured platforms such as Perl or PHP, you’ll be surprised at the complexity of the Rails project directory. Rails is a software machine with many moving parts; the project directory provides a structure to manage the complexity. The logic and order of the project directory structure is familiar to every Rails developer, and consistent for every Rails application, which makes it easy to collaborate, maintain an application, and create open source projects.</p>
<h2 id="71-video-option"><a href="#cid42">7.1 Video Option</a></h2>
<p>Watch the eleven minute video if you have subscribed:</p>
<ul>
<li><a href="https://tutorials.railsapps.org/videos/9">Rails Project Directory</a></li>
</ul>
<h2 id="72-project-directory"><a href="#cid43">7.2 Project Directory</a></h2>
<p>Use the Unix <code>ls</code> command to list the contents of the project directory. For a one-column list that shows each subdirectory (marked with a slash), we’ll add the <code>-1p</code> option to the command.</p>
<p>$ ls -1p</p>
<p>You’ll see:</p>
<p>Gemfile
Gemfile.lock
README.md
Rakefile
app/
bin/
config/
config.ru
db/
lib/
log/
public/
tmp/
vendor/</p>
<p>Now is a good time to open a file browser window and look at the contents of the project directory. On the Mac, there’s a command you can use to open the graphical file browser from the console. If you’re in the project directory, type <code>open .</code>. The period (or “dot”) is a Unix symbol that means “the directory I’m in.”</p>
<p>$ open .</p>
<p><img alt="images/figures/24_rails_directory_structure" src="http://learn-rails.com/images/figures/learn-rails-2/24_rails_directory_structure.png" /></p>
<p>Figure 7.1: Rails directory structure.</p>
<p>You’ll learn more about each file and folder as you proceed through the tutorial.</p>
<h2 id="73-get-to-know-the-folders-and-files"><a href="#cid44">7.3 Get to Know the Folders and Files</a></h2>
<p>To get you started, here are three tables. The first describes the files and folders that are important for every beginner. The second table describes the files and folders that you can ignore. The third table is a preview of things to come.</p>
<h3 id="731-important-folders-and-files"><a href="#uid71">7.3.1 Important Folders and Files</a></h3>
<p>These folders and files are <strong>important</strong> to beginners. This is where you will spend your time in Rails.</p>
<p>Gemfile</p>
<p>Lists all the gems used by the application.</p>
<p>Gemfile.lock</p>
<p>Lists gem versions and dependencies.</p>
<p>README.md</p>
<p>A page for documentation.</p>
<p>app/</p>
<p>Application folders and files.</p>
<p>config/</p>
<p>Configuration folders and files.</p>
<p>db/</p>
<p>Database folders and files.</p>
<p>public/</p>
<p>Files for web pages that do not contain Ruby code, such as error pages.</p>
<h3 id="732-not-so-important-folders-and-files"><a href="#uid72">7.3.2 Not-So-Important Folders and Files</a></h3>
<p>These folders and files are <strong>not important</strong> to beginners.</p>
<p>Rakefile</p>
<p>Scripts for the Rake utility program.</p>
<p>bin/</p>
<p>Folder for binary (executable) programs.</p>
<p>config.ru</p>
<p>Configuration file for Rack (a software library for web servers).</p>
<p>lib/</p>
<p>Folder for miscellaneous Ruby code.</p>
<p>log/</p>
<p>Folder for application server logfiles.</p>
<p>tmp/</p>
<p>Temporary files created when your application is running.</p>
<p>vendor/</p>
<p>Folder for Ruby software libraries that are not gems.</p>
<h3 id="733-folders-for-testing"><a href="#uid73">7.3.3 Folders for Testing</a></h3>
<p>spec/</p>
<p>Folder for the popular RSpec testing framework.</p>
<p>test/</p>
<p>Folder for the default Rails testing framework.</p>
<p>The <strong>test/</strong> folder is present in the default Rails starter app. You’ll use the <strong>test/</strong> folder when you learn about test-driven development. Many Rails developers use a different gem for testing, named RSpec, and your RSpec tests will go in a <strong>spec/</strong> folder.</p>
<h2 id="74-the-app-directory"><a href="#cid45">7.4 The App Directory</a></h2>
<p>Take time to drill down into the <strong>app/</strong> folder in the project directory. This is easiest using the file browser.</p>
<p><img alt="images/figures/24_app_folder" src="http://learn-rails.com/images/figures/learn-rails-2/24_app_folder.png" /></p>
<p>Figure 7.2: Rails app folder.</p>
<p>You can also use your text editor to view the folder.</p>
<p>Or do it with Unix commands:</p>
<p>$ cd app
$ ls -1p
assets/
channels/
controllers/
helpers/
jobs/
mailers/
models/
views/</p>
<p>Whether you use the file browser, Unix commands, or your text editor, you are looking at the same file system.</p>
<p>Most of the work of developing a Rails application happens in the <strong>app/</strong> folder.</p>
<p>Earlier we described Rails as “a set of files organized with a specific structure.” We said the structure is the same for every Rails application. The <strong>app/</strong> directory is a good example. The folders in the <strong>app/</strong> directory are the same in every Rails application. This makes it easy to collaborate with other Rails developers, providing consistency and predictability.</p>
<ul>
<li><strong>assets</strong></li>
<li><strong>channels</strong></li>
<li><strong>controllers</strong></li>
<li><strong>helpers</strong></li>
<li><strong>jobs</strong></li>
<li><strong>mailers</strong></li>
<li><strong>models</strong></li>
<li><strong>views</strong></li>
</ul>
<p>You may recall our earlier description of Rails from the perspective of a software architect. In this folder, you’ll see evidence of the <a href="https://en.wikipedia.org/wiki/Model%E2%80%93View%E2%80%93Controller">model–view–controller</a> design pattern. Three folders named <strong>models/</strong>, <strong>views/</strong>, and <strong>controllers/</strong> enforce the software architect’s “separation of concerns” and impart structure to our code. As you build the application, we’ll explain the role of the MVC components in greater detail.</p>
<p>Five folders play supporting roles. The mailers folder is for code that sends email messages. The helpers folder is for Rails <em>view helpers</em>, snippets of reusable code that generate HTML. Later, when we learn more about <em>views</em>, we’ll say view helpers are like “macros” that expand a short command into a longer string of HTML tags and content. Rails 3.1 added the <strong>assets/</strong> folder as a location for CSS and JavaScript files. The <strong>jobs/</strong> folder is for background jobs built with the Rails ActiveJob feature. Rails 5.0 added the <strong>channels/</strong> folder for the ActionCable feature which uses WebSockets for real-time communication between web server and browser.</p>
<h3 id="741-folders-of-future-importance"><a href="#uid83">7.4.1 Folders of Future Importance</a></h3>
<p>You won’t encounter these when you are a beginner:</p>
<p>policies/</p>
<p>Folder for code that controls access to features</p>
<p>services/</p>
<p>Folder for code that reduces the complexity of models and controllers</p>
<p>If you join a project to work on a large and complex Rails application, you may see folders such as these in the <strong>app/</strong> directory. As an application grows in complexity, an experienced software architect may suggest reducing the size of models and controllers by moving code to “POROs” (<em>plain old Ruby objects</em>). Code in any folder in the <strong>app/</strong> directory is shared throughout a Rails application without any additional configuration (in contrast, code you add to the <strong>lib/</strong> directory is only available with some extra work). Rails provides a basic model–view–controller framework but it is often necessary to extend it with code in a <strong>services/</strong> folder. Similarly, a <strong>policies/</strong> folder can be used to consolidate code that controls access to various features or pages of a web application.</p>
<p>Use the <code>cd ..</code> command (“change directory dot dot”) to return to the project directory.</p>
<p>$ cd ..
$ pwd
/Users/danielkehoe/workspace/learn-rails</p>
<p>As a Rails developer, you’ll spend most of your time navigating the hierarchy of folders as you create and edit files. And because Rails provides a consistent structure, you’ll quickly find your way on any unfamiliar project.</p>
<h1 id="chapter-8-time-travel-with-git"><a href="#cid46">Chapter 8 Time Travel with Git</a></h1>
<p>Now that we’ve looked at our Rails project directory from the viewpoint of a programmer and software architect, let’s consider the viewpoint of the time traveler.</p>
<p>This chapter will introduce you to software <em>source control</em>, also called <em>version control</em> or <em>revision control</em>. The terms all have the same meaning. At first sight, the concept seems rather dull, like sorting your socks. But it makes professional software development possible and, at the core, it is essentially a form of time travel.</p>
<p>To understand time travel, we need to understand <em>state</em>. It’s a term you’ll encounter often in software development. We know about states of matter. Water can be ice, liquid, or steam. Imagine a machine with a button that, each time it is pressed, changes water from one state to another. We call this a <em>state machine</em>. Almost every software program is a state machine. When a program receives an input, it transitions from one state to another. Like flipping a light switch, there’s no in-between. Light or dark. Ice, liquid, or steam. Or, in a web application: logged in, logged out.</p>
<p>When we write software code, there’s a lot of in-between. We look things up, we think, we type errors and we make corrections. As humans, we spend a lot of time in a flow of undetermined state. We can save our work at any time, but we may be saving typos or unfinished code that doesn’t work. Every so often, we get to a point where a task is finished; we’ve fixed all our errors and our code runs. We want to preserve the state of our work. That’s when we need a version control system.</p>
<p>A version control system does more than a software application’s “Save” command. Like a “Save” command, it preserves the current state of our files. It also allows us to add a short note that describes the work we’ve done. More importantly, it archives a snapshot of the current state in a <em>repository</em> where it can be retrieved if needed.</p>
<p>Here’s where the time travel comes in. We can go back and recover the state of our work at any point where we committed a snapshot to the repository. In software development, travel to the past is essential because we often make mistakes or false starts and have to return to a point where we know things were working correctly.</p>
<p>What about time travel to the future? Often we need to try out code we may decide to discard, without disturbing work we’ve done earlier. Version control systems allow us to explore alternative futures by creating a <em>branch</em> for our work. If we like what we’ve done in our branch, we can merge it into the main trunk of our software project.</p>
<p>Unlike time travel in the movies, we can’t travel back to any arbitrary point in the flow of time. We can only travel to past or future states we’ve marked as significant by checking our work into the repository.</p>
<h2 id="81-git"><a href="#cid47">8.1 Git</a></h2>
<p>The dominant version control system among Rails developers is <a href="https://en.wikipedia.org/wiki/Git_(software)">Git</a>, created by the developer of the Linux operating system.</p>
<p>Unlike earlier version control systems, Git is ideal for wide-scale distributed open source software development. Combined with <a href="https://github.com/">GitHub</a>, the “social coding” website, Git makes it easy to share and merge code. When you work with others on a project, your Git <em>commit messages</em> (the notes that accompany your snapshot) offer a narrative about the progress of the project. Well-written commit messages describe your work to co-workers or open source collaborators.</p>
<p>GitHub’s support for <em>forking</em> (making your own copy of a repository) makes it possible to take someone else’s project and modify it without impacting the original. That means you can customize an open source project for your own needs. You can also fix bugs or add a feature to an open source project and submit a <em>pull request</em> for the project maintainer to add your work to the original. Fixing bugs (large or small) and adding features to open source projects are how you build your reputation in the Rails community. Your GitHub account, which shows all your commits, both to public projects and your own projects, is more important than your resumé when a potential employer considers hiring you because it shows the real work you have done.</p>
<p>Collaboration is easy when you use a <em>branch</em> in Git. If you and a coworker are working on the same codebase, you can each make a branch before adding to the code or making changes. Git supports several kinds of <em>merges</em>, so you can integrate your branch with the trunk when your task is complete. If your changes collide with your coworker’s changes, Git identifies the conflict so you can resolve the collision before completing the merge.</p>
<p>All the power of Git comes at a price. Git is difficult for a beginner to learn, largely because many of its procedures have no real-world analog. Have you noticed how time travel movies require mental gymnastics, especially when you try to make sense of alternative futures and intersecting timelines? Git is a lot like that, mostly because we use it to do things we don’t ordinarily do in the real world.</p>
<p>In this tutorial, you won’t encounter Git’s advanced procedures, like resolving merges or reverting to earlier versions. We’ll stick to the basics of archiving our work (and in one case, discarding work that we’ve done for practice). You can build the tutorial project without using Git. But I urge you to use Git and a GitHub account for this project, for two reasons. First, with your tutorial application on GitHub, you’ll show potential employers or collaborators that you’ve successfully built a useful, functioning Rails application. More importantly, you must get to know Git if you plan to do any serious coding, either as a professional or a hobbyist.</p>
<p>Before I show you Git commands, I want to mention that some people use graphical client applications to manage Git. MacOS has <a href="https://mac.github.com/">GitHub for Mac</a>, <a href="http://www.git-tower.com/">Git Tower</a>, and other <a href="http://list.ly/list/FO-mac-git-clients">Mac Git clients</a>. Graphical applications for Git are useful for colleagues who don’t use a Terminal application, such as graphic designers or writers. There’s no need for you to install these applications. Every developer I’ve met uses Git from the command line. It will take effort to master Git; the commands are not intuitive. But it is absolutely necessary to become familiar with Git basics.</p>
<p>Before you do any work on the tutorial application, I’ll show you the basics of setting up and using Git.</p>
<h2 id="82-is-git-installed"><a href="#cid48">8.2 Is Git Installed?</a></h2>
<p>As a first step, make sure Git is installed on your computer:</p>
<p>$ which git
/usr/local/bin/git
$ git version
git version ...</p>
<p>If Git is not found, install Git. See the article <a href="https://railsapps.github.io/rails-git.html">Rails with Git and GitHub</a> for installation instructions.</p>
<h2 id="83-is-git-configured"><a href="#cid49">8.3 Is Git Configured?</a></h2>
<p>Make sure Git knows who you are. Every time you update your Git repository with the <code>git commit</code> command, Git will identify you as the author of the changes.</p>
<p>$ git config --get user.name
$ git config --get user.email</p>
<p>You should see your name and email address. If not, configure Git:</p>
<p>$ git config --global user.name "Real Name"
$ git config --global user.email "<a href="/cdn-cgi/l/email-protection">[email protected]</a>"</p>
<p>Use your real name so people will associate you with your work when they meet you in real life. There’s no reason to use a clever name unless you have something to hide. And use your full name, not just your first name.</p>
<p>Use the same email address for Git, your GitHub account, and Heroku to avoid headaches.</p>
<h2 id="84-create-a-repository"><a href="#cid50">8.4 Create a Repository</a></h2>
<p>Now we’ll add a Git repository to our project. It’s a basic step you’ll repeat every time you create a new Rails project.</p>
<p>Extending the time traveler analogy, initializing a Git repository is equivalent to setting up the time machine.</p>
<p>Be sure you are in your project directory, not your user home directory or somewhere else. Use the <code>pwd</code> command to check:</p>
<p>$ pwd
/Users/danielkehoe/workspace/learn-rails</p>
<p>The <code>git init</code> command sets up a Git repository (a “repo”) in the project directory. We add the Unix symbol that indicates Git should be initialized in the current directory (git init dot):</p>
<p>$ git init .
Initialized empty Git repository in ...</p>
<p>It creates a hidden folder named <strong>.git/</strong> in the project directory. You can peek at the contents:</p>
<p>$ ls -1p .git
HEAD
config
description
hooks/
info/
objects/
refs/</p>
<p>All Git commands operate on the hidden files. The hidden files record the changing state of your project files each time you run the <code>git commit</code> command. There is no reason to ever edit files inside the hidden <strong>.git/</strong> folder (doing so could break your time machine).</p>
<h2 id="85-gitignore"><a href="#cid51">8.5 GitIgnore</a></h2>
<p>The hidden <strong>.git/</strong> folder contains the Git repository with all the snapshots of your changing project. The snapshots are highly compressed, only containing records of changes, so the repository takes up very little file space relative to the project as a whole.</p>
<p>Not every file should be included in a Git snapshot. Here are some types of files that should be ignored:</p>
<ul>
<li>log files created by the web server</li>
<li>database files</li>
<li>configuration files that include passwords or API keys</li>
</ul>
<p>Git gives us an easy way to ignore files. A hidden file in the project directory named <strong>.gitignore</strong> can specify a list of files that are never seen by Git. The <code>rails new</code> command creates a <strong>.gitignore</strong> file with defaults that include log files and database files. Later, when we add configuration files that include secrets, we’ll update the <strong>.gitignore</strong> file.</p>
<p>Take a look at the contents of the <strong>.gitignore</strong> file. We use the Unix <code>cat</code> command to display the contents of the file:</p>
<p>$ cat .gitignore</p>
<h1 id="see-httpshelpgithubcomarticlesignoring-files-for-more-about-ignoring-files">See https://help.github.com/articles/ignoring-files for more about ignoring files.</h1>
<h1 id="_1"></h1>
<h1 id="if-you-find-yourself-ignoring-temporary-files-generated-by-your-text-editor">If you find yourself ignoring temporary files generated by your text editor</h1>
<h1 id="or-operating-system-you-probably-want-to-add-a-global-ignore-instead">or operating system, you probably want to add a global ignore instead:</h1>
<h1 id="git-config-global-coreexcludesfile-gitignore_global">git config --global core.excludesfile '~/.gitignore_global'</h1>
<h1 id="ignore-bundler-config">Ignore bundler config.</h1>
<p>/.bundle</p>
<h1 id="ignore-the-default-sqlite-database">Ignore the default SQLite database.</h1>
<p>/db/*.sqlite3
/db/*.sqlite3-journal</p>
<h1 id="ignore-all-logfiles-and-tempfiles">Ignore all logfiles and tempfiles.</h1>
<p>/log/*
/tmp/*
!/log/.keep
!/tmp/.keep</p>
<h1 id="ignore-byebug-command-history-file">Ignore Byebug command history file.</h1>
<p>.byebug_history</p>
<p>For a <strong>.gitignore</strong> file that ignores more, see an <a href="https://github.com/RailsApps/rails-composer/blob/master/files/gitignore.txt">example .gitignore file</a> from the RailsApps project.</p>
<h2 id="86-git-workflow"><a href="#cid52">8.6 Git Workflow</a></h2>
<p>Your workflow with Git will move through four distinct phases as you add or edit files.</p>
<h3 id="861-untracked-files"><a href="#uid87">8.6.1 Untracked Files</a></h3>
<p>The first phase is a “dirty” state of untracked and changed files, before any snapshot. The <code>git status</code> command lists all folders or files that are not checked into the repository.</p>
<p>$ git status
On branch master</p>
<p>Initial commit</p>
<p>Untracked files:
 (use "git add <file>..." to include in what will be committed)</p>
<p>.gitignore
 Gemfile
 Gemfile.lock
 README.md
 Rakefile
 app/
 bin/
 config.ru
 config/
 db/
 lib/
 log/
 public/
 test/
 tmp/
 vendor/</p>
<p>nothing added to commit but untracked files present (use "git add" to track)</p>
<p>In the online version of this book (the HTML version), the example above appears in green. In the terminal window on your computer, it will be red, showing you untracked files.</p>
<p>Here the <code>git status</code> command tells us that we have many untracked files. We have created new files and they are saved on the computer’s hard disk but nothing has been recorded in the Git repository.</p>
<h3 id="862-staging"><a href="#uid88">8.6.2 Staging</a></h3>
<p>I call this step, “Pose for your snapshot.”</p>
<p>Recording files in the Git repository takes two steps: staging and committing. There will be times when you change many files at once. For example, you may fix a bug, add a new graphic, and change a form. You might think you’d like to have Git automatically record all the changes as you save each file. But the story of your project would be confusing and overly detailed. Git requires you to mark one or more files (“staging”) before recording the changes (“committing”). This gives you fine-grained control over the recorded history of your project.</p>
<p>You can mark individual files to be staged:</p>
<p>$ git add Gemfile</p>
<p>Adding individual files allows you to selectively record the history of your project. For example, you might stage and commit a series of bug fixes before you stage and commit new features. Applying the time traveler analogy, it will be easier to travel back to look at bug fixes if they are not mixed in with new features.</p>
<p>More often, you’ll mark all the files to be staged. Do so now:</p>
<p>$ git add -A</p>
<p>Running <code>git status</code> will show you a long list of files that are staged and ready to commit.</p>
<p>There are three forms of the <code>git add</code> command:</p>
<ul>
<li><code>git add foo.txt</code> adds a file named <strong>foo.txt</strong></li>
<li><code>git add .</code> adds all new files and changed files, except deleted files</li>
<li><code>git add -A</code> adds everything, including deletions</li>
</ul>
<p>If it seems nonsensical that the command <code>git add -A</code> “adds deletions,” don’t worry. Like time travel, Git will stretch your understanding of what makes sense.</p>
<p>Most often, you can simply use the <code>git add -A</code> form of the command.</p>
<p>Now that you’ve marked the files that will be committed to the repository, you’ve told everyone to pose, and you’re ready to take the snapshot.</p>
<h3 id="863-committing"><a href="#uid92">8.6.3 Committing</a></h3>
<p>The previous step, the “posing” step, or staging, gives you an opportunity to select particular files before you commit. If you’ve only worked on one feature, you’ll likely stage and commit all your files.</p>
<p>The next step is a “commit” which I like to call, “clicking the snapshot.”</p>
<p>When you “make a commit”, you include a message that describes the work you’ve done. For a time traveler, the “commit message” is important; you are leaving a trail to help you find your way into the past. Google will show you dozens of blog posts about “writing better commit messages” but common sense can be your guide. For example, writing “fix registration form to catch blank email addresses” will be more helpful than merely writing “fix bugs.” And if you wonder why commit messages are commonly written in the imperative not past tense (“fix” not “fixed”), it’s a time traveler convention.</p>
<p>Now commit your project to the repository:</p>
<p>$ git commit -m "Initial commit"</p>
<p>The <code>-m</code> flag lets you add a message for the commit.</p>
<p>The pristine state of your new Rails application is now recorded in the repository on your local computer.</p>
<p>Running <code>git status</code> will tell you “nothing to commit, working directory clean.”</p>
<p>$ git status
On branch master
nothing to commit, working directory clean</p>
<p>You’ve recorded your snapshot locally. Next let’s see a list of previous snapshots. Then we’ll learn how to save your snapshots remotely to GitHub.</p>
<h3 id="864-git-log"><a href="#uid93">8.6.4 Git Log</a></h3>
<p>You can use the <code>git log</code> command to see your project history:</p>
<p>$ git log
commit 8da41eec9e864ed91b4a445d8cefdf7893e2faf6
Author: Daniel Kehoe &lt;<a href="/cdn-cgi/l/email-protection">[email protected]</a>>
Date:   Fri Dec 18 10:30:12 2015 +0700</p>
<p>Initial commit</p>
<p>The long string of characters that follows “commit” is an ID, or marker, that will help you travel back in time if you need to do so.</p>
<p>If you get “stuck” in <code>git log</code>, type <code>q</code> to return to the command prompt.</p>
<p>I like to use the <code>git log</code> command with an option for a compact listing:</p>
<p>$ git log --oneline
8da41ee Initial commit</p>
<p>Don’t worry if your console doesn’t show <code>8da41ee</code>. The ID for your commit will be different.</p>
<p>The listing is easier to review when it is displayed in a compact format. The commit ID is abbreviated but it is all you need to travel back in time.</p>
<h3 id="865-repositories"><a href="#uid94">8.6.5 Repositories</a></h3>
<p>When we talk about repositories, or “repos,” we mean the archive of our git commits. The local repo is located in the hidden folder named <strong>.git/</strong> in the project directory. Of course, if your hard drive crashes, or your computer is lost or stolen, you’ll lose your local repo along with your project. So it is wise to save your repository in the cloud. The GitHub site is a place to save repositories. GitHub is also a place for collaboration. Most Rails developers save their repositories to Github, as either a public repo for open source projects, or a private repo for proprietary projects.</p>
<h3 id="866-pushing-to-github"><a href="#uid95">8.6.6 Pushing to GitHub</a></h3>
<p>We’ve seen three phases of the Git workflow: <em>untracked</em>, <em>staged</em>, and <em>committed</em>.</p>
<p>A fourth stage is important when you work with others: <em>pushing</em> to GitHub.</p>
<p>The repositories hosted on your GitHub account establish your reputation as a Rails developer for employers and developers you may work with. Even if your first project is copied from a tutorial, it shows you are serious about learning Rails and studying conscientiously.</p>
<p>Did you create a GitHub account? Now would be a good time to add your repo to GitHub.</p>
<p>Go to GitHub and <a href="https://github.com/new">create a new empty repository</a> for your project. Name the repository “learn-rails” and give it a description. If the repository is public, hosting on GitHub is free. Don’t be reluctant to go public with an unfinished or half-baked project; everyone expects projects on GitHub to be works in progress.</p>
<p>Add GitHub as a remote repository for your project and push your local project to GitHub. Before you copy and paste the command, notice that you need to insert your own GitHub account name. In other words, change <code>YOUR_GITHUB_ACCOUNT</code> in the command shown below.</p>
<p>Box 8.1. Warning</p>
<p>STOP! Be sure to change <code>YOUR_GITHUB_ACCOUNT</code> to your GitHub user name. If you don’t, you will create a mess that you have to <a href="https://github.com/RailsApps/learn-rails/issues/58">fix with the instructions here</a>.</p>
<p>$ git remote add origin https://github.com/YOUR_GITHUB_ACCOUNT/learn-rails.git
$ git push -u origin master</p>
<p>The <code>-u</code> option sets up Git so you can use <code>git push</code> in the future without explicitly specifying GitHub as the destination.</p>
<p>Now you can view your project repository on GitHub at:</p>
<ul>
<li><a href="https://github.com/YOUR_GITHUB_ACCOUNT/learn-rails">https://github.com/YOUR_GITHUB_ACCOUNT/learn-rails</a></li>
</ul>
<p>Obviously you must change <code>YOUR_GITHUB_ACCOUNT</code> in the web address to see your own repository.</p>
<p>Take a look. It’s an exact copy of the project on your local computer.</p>
<p>If you haven’t used GitHub before, take some time to explore. GitHub is absolutely essential to all open source Rails development.</p>
<p>You may notice that the <strong>README.md</strong> file is automatically incorporated into the home page of the project repository on GitHub. For our next step, we’ll update the README file, commit it to the local repo, and push it up to GitHub. It will be good practice for using Git.</p>
<h2 id="87-the-readme"><a href="#cid53">8.7 The README</a></h2>
<p>Changing the README file is a good way to practice with Git. It’s also a good habit to edit the README file whenever you create a new project. It’s easy to neglect the README for little projects that you’ve just started. But replacing a default README file shows you are a disciplined, conscientious developer who will be a good collaborator.</p>
<p>The new README file can be brief. Just state your intentions and acknowledge any code you’ve borrowed. For this project you could say, “Excited to learn Rails with help from Daniel Kehoe’s book!”</p>
<p>In your text editor, open the file <strong>README.md</strong> and replace the contents:</p>
<p># Learning Rails</p>
<p>Learning Rails with a tutorial from [learn-rails.com](http://learn-rails.com/).</p>
<p>GitHub lets you add formatting using your choice of markup syntax, depending on the file extension you add to the filename:</p>
<ul>
<li>README.md uses the <a href="https://help.github.com/articles/github-flavored-markdown">GitHub Flavored Markdown</a> syntax</li>
<li>README.textile uses the <a href="http://redcloth.org/hobix.com/textile/">Textile</a> syntax</li>
<li>README.rdoc uses the <a href="http://rdoc.rubyforge.org/RDoc.html">rdoc</a> syntax</li>
</ul>
<p>We’ll use Markdown syntax by adding the <code>#</code> character before the first line of text to force a headline. And we’ll add a link that leads to the <a href="http://learn-rails.com/">learn-rails.com</a> website.</p>
<p>There’s no requirement that you use Markdown syntax in your README file. Markdown simply is a popular way to add formatting to improve readability.</p>
<p>Use <code>git status</code> to see what has changed:</p>
<p>$ git status
On branch master
Changes not staged for commit:
 (use "git add <file>..." to update what will be committed)
 (use "git checkout -- <file>..." to discard changes in working directory)</p>
<p>modified:   README.md</p>
<p>no changes added to commit (use "git add" and/or "git commit -a")</p>
<p>Here’s our typical workflow. We’ll stage and commit the change:</p>
<p>$ git add -A
$ git commit -m "update README"</p>
<p>Then we’ll push the change to GitHub:</p>
<p>$ git push origin master</p>
<p>If you decide not to use GitHub for this tutorial, you can skip this step (and skip it throughout the tutorial).</p>
<p>Take a look at your GitHub repository (refresh the web page). Very cool! The README file has been updated.</p>
<p>The <code>git log</code> command will display your project history:</p>
<p>$ git log --oneline
69b9b6c update README
8da41ee Initial commit</p>
<p>To learn more about Git, I recommend the book <a href="https://www.learnenough.com/git-tutorial">Learn Enough Git to Be Dangerous</a> by my colleague Michael Hartl. An online version is available for free.</p>
<p>Now that you’re comfortable with Git, we can begin customizing our new Rails application.</p>
<h1 id="chapter-9-gems"><a href="#cid54">Chapter 9 Gems</a></h1>
<p>The art of selecting gems is at the heart of Rails development. I explained earlier that gems are packages of code, “software libraries,” that have been developed and tested by other developers. Some gems add functionality or features to a website. Other gems play a supporting role, making development easier or implementing basic infrastructure. Gems are open source. They are available at no charge and can be freely copied and modified.</p>
<h2 id="91-videos"><a href="#cid55">9.1 Videos</a></h2>
<p>If you have subscribed, two short videos introduce gems:</p>
<ul>
<li><a href="https://tutorials.railsapps.org/videos/3">What Are Rubygems</a></li>
<li><a href="https://tutorials.railsapps.org/videos/4">Find Rubygems</a></li>
</ul>
<h2 id="92-rubygems"><a href="#cid56">9.2 RubyGems</a></h2>
<p>It is a mark of honor to release a gem for public use, and a developer’s reputation can be established when a gem becomes popular and widely used. Gems are often created when a developer has used the same code as a component in more than one web application. He or she will take time to release the code as a gem. That’s how the Rails ecosystem was built, gem by gem since 2004.</p>
<p>There is no evaluation or review process in publishing gems. Gems are hosted on a public server, <a href="https://rubygems.org/">rubygems.org</a>. Gems are mostly text files (like any other Ruby code), organized in a particular format with some descriptive information (in a <strong>gemspec</strong> file), and compressed and archived as a single file. A single command, <code>gem push</code>, uploads a gem to the rubygems.org server for anyone to use.</p>
<p>Over 50,000 gems have been released since rubygems.org was established. Some of these gems are used by one or two developers on their own projects. Many others have been neglected and abandoned due to lack of interest. Only a few thousand gems are popular and widely used. As a Rails developer, you must master the art of finding and evaluating gems so you can base your applications on the tried-and-true work of others.</p>
<p>There is no single authoritative source of recommendations for gems. The <a href="https://ruby-toolbox.com/">Ruby Toolbox</a> website categorizes and ranks many gems by popularity, and it is a good place to begin hunting for useful gems. Other than that, it is useful to study example applications and search for blog posts to find which gems are most often recommended. When you find an interesting gem, search <a href="https://stackoverflow.com/questions/tagged/ruby-on-rails">Stack Overflow</a> or Google to see what people are saying. Look at the gem’s GitHub repository and check:</p>
<ul>
<li>How many issues are open? How many are closed?</li>
<li>How recent are the commits of patches or updates?</li>
<li>Is there a CHANGELOG file?</li>
<li>Is the gem well-documented?</li>
<li>How many “stars” (people favoriting) or “forks” (people hacking)?</li>
</ul>
<p>Popular gems are likely to have many reported issues, some of which are trivial problems or feature requests. Gems that are actively maintained will have many closed issues and, ideally, only a few open issues. When you find a gem that has many open issues and no recently closed issues, you’ve probably found a gem that has been abandoned. Also look at the commit log, which you’ll find on the GitHub project page in a tab at the top of the page. Regular and recent activity in the commit log indicates the gem is actively maintained.</p>
<h2 id="93-rails-gems"><a href="#cid57">9.3 Rails Gems</a></h2>
<p>Rails itself is a gem that, in turn, requires a collection of other gems. This becomes clear if you look at the <a href="https://rubygems.org/gems/rails">summary page for Rails</a> on the rubygems.org site. On that page, you’ll see photos of the Rails core team. More importantly, you’ll see a list of gems that are required to use Rails:</p>
<ul>
<li><a href="https://github.com/rails/rails/tree/master/actioncable">actioncable</a> - real-time communication using WebSockets</li>
<li><a href="https://github.com/rails/rails/tree/master/actionmailer">actionmailer</a> - framework for email delivery and testing</li>
<li><a href="https://github.com/rails/rails/tree/master/actionpack">actionpack</a> - framework for routing and responding to web requests</li>
<li><a href="https://github.com/rails/rails/tree/master/actionview">actionview</a> - view templates and rendering</li>
<li><a href="https://github.com/rails/rails/tree/master/activejob">activejob</a> - queueing slow tasks to run in the background</li>
<li><a href="https://github.com/rails/rails/tree/master/activemodel">activemodel</a> - architecture for model objects</li>
<li><a href="https://github.com/rails/rails/tree/master/activerecord">activerecord</a> - framework for connections to databases</li>
<li><a href="https://github.com/rails/rails/tree/master/activesupport">activesupport</a> - utility classes and Ruby library extensions</li>
<li><a href="http://gembundler.com/">bundler</a> - utility to manage gems</li>
<li><a href="https://github.com/rails/rails/tree/master/railties">railties</a> - console commands and generators</li>
<li><a href="https://github.com/rails/sprockets-rails">sprockets-rails</a> - support for the Rails asset pipeline</li>
</ul>
<p>These are the “runtime dependencies” for Rails. Each of these gems has its own dependencies as well. When you install Rails, a total of 63 gems are automatically installed in your development environment.</p>
<h2 id="94-gems-for-a-rails-default-application"><a href="#cid58">9.4 Gems for a Rails Default Application</a></h2>
<p>In addition to the Rails gem and its dependencies, a handful of other gems are included in every <code>rails new</code> default starter application:</p>
<ul>
<li><a href="https://github.com/luislavena/sqlite3-ruby">sqlite3</a> - adapter for the SQLite database</li>
<li><a href="https://github.com/puma/puma">puma</a> - web application server</li>
<li><a href="https://github.com/rails/sass-rails">sass-rails</a> - enables use of the SCSS syntax for stylesheets</li>
<li><a href="https://github.com/lautis/uglifier">uglifier</a> - JavaScript compressor</li>
<li><a href="https://github.com/rails/coffee-rails">coffee-rails</a> - enables use of the CoffeeScript syntax for JavaScript</li>
<li><a href="https://github.com/rails/turbolinks">turbolinks</a> - faster loading of webpages</li>
<li><a href="https://github.com/rails/jbuilder">jbuilder</a> - utility for encoding JSON data</li>
</ul>
<p>You may not need a SQLite database, SCSS for stylesheets, or the others, but many developers use these tools so they are included in the default starter application.</p>
<h2 id="95-where-do-gems-live"><a href="#cid59">9.5 Where Do Gems Live?</a></h2>
<p>Gems are files saved in the computer’s disk storage, containing someone else’s code that you can use in your own application.</p>
<p>When you run a Rails application, gems are loaded into the computer’s working memory immediately before your own custom code is loaded. Gems are handled by the Ruby interpreter no differently than your own code. It’s all Ruby code, whether you or someone else wrote it. When you are building an application in Rails, you don’t need to think about where gems are stored in your file system. It’s all handled automatically.</p>
<p>Experienced programmers who have used software libraries in other languages might wonder how it works. Here’s the technical explanation from the experts. Ruby has a <code>require</code> method that allows you to import software libraries into your programs. RubyGems extends the <code>require</code> method, adding gem directories to a <code>$LOAD_PATH</code>. When Rails loads, it will automatically require each of the gems listed in your Gemfile, finding the gems in the <code>$LOAD_PATH</code> directories.</p>
<p>If you’re a curious person, you might like to see where the gems live. You can run the <code>gem env</code> command to reveal the RubyGems environment details which are normally hidden from you:</p>
<p>$ gem env
RubyGems Environment:
 - RUBYGEMS VERSION: 2.6.4
 - RUBY VERSION: 2.4.1 (2016-04-26 patchlevel 112) [x86_64-darwin14]
 - INSTALLATION DIRECTORY: /Users/danielkehoe/.rvm/gems/<a href="/cdn-cgi/l/email-protection">[email protected]</a>
 - USER INSTALLATION DIRECTORY: /Users/danielkehoe/.gem/ruby/2.3.0
 - RUBY EXECUTABLE: /Users/danielkehoe/.rvm/rubies/ruby-2.4.1/bin/ruby
 - EXECUTABLE DIRECTORY: /Users/danielkehoe/.rvm/gems/<a href="/cdn-cgi/l/email-protection">[email protected]</a>/bin
 - SPEC CACHE DIRECTORY: /Users/danielkehoe/.gem/specs
 - SYSTEM CONFIGURATION DIRECTORY: /Users/danielkehoe/.rvm/rubies/ruby-2.4.1/etc
 - RUBYGEMS PLATFORMS:
 - ruby
 - x86_64-darwin-14
 - GEM PATHS:
 - /Users/danielkehoe/.rvm/gems/<a href="/cdn-cgi/l/email-protection">[email protected]</a>
 - /Users/danielkehoe/.rvm/gems/<a href="/cdn-cgi/l/email-protection">[email protected]</a>
.
.
.</p>
<p>If you use RVM, gems are saved to a hidden <strong>.rvm</strong> folder in your user directory. A <strong>global</strong> subfolder contains the Bundler gem. If you’ve followed the instructions in the “Get Started” chapter to install Rails, the project-specific <strong>learn-rails</strong> subfolder contains the Rails gem. If you use Chruby or Rbenv instead of RVM, your gems will be stored in a different location.</p>
<p>Run the <code>gem which</code> command and you’ll see where the gems live:</p>
<p>$ gem which bundler
/Users/danielkehoe/.rvm/gems/<a href="/cdn-cgi/l/email-protection">[email protected]</a>/gems/bundler-1.12.5/lib/bundler.rb
$ gem which rails
/Users/danielkehoe/.rvm/gems/<a href="/cdn-cgi/l/email-protection">[email protected]</a>/gems/railties-5.1.2/lib/rails.rb</p>
<p>These are details you’ll never need to know, because Ruby on Rails handles it for you.</p>
<p>You’ll never move or delete gems directly. Instead you’ll manage gems using the <a href="http://gembundler.com/">Bundler</a> utility. The key to Bundler is the Gemfile.</p>
<h2 id="96-gemfile"><a href="#cid60">9.6 Gemfile</a></h2>
<p>Every Rails application has a Gemfile. Earlier, I described Rails from the viewpoint of the “gem hunter,” the developer who wants to assemble an application from the best open source components he or she can find. To the gem hunter, the Gemfile is the most important file in the application. It lists each gem that the developer wants to use.</p>
<p>The Gemfile provides the information needed by the <a href="http://gembundler.com/">Bundler</a> utility to manage gems.</p>
<p>Bundler’s <code>bundle install</code> command reads the Gemfile, then downloads and saves each listed gem to the hidden gem folder. Bundler checks to see if the gem is already installed and only downloads gems that are needed. Bundler checks for the newest gem version and records the version number in the <strong>Gemfile.lock</strong> file. Bundler also downloads any gem dependencies and records the dependencies in the <strong>Gemfile.lock</strong> file. Between the Gemfile, with its list of gems that will be used by the application, and the <strong>Gemfile.lock</strong> file, with its list of dependencies and version numbers, you have a complete specification of every gem required to run the application. More importantly, when other developers install your application, Bundler will automatically install all the gems (including dependencies and correct versions) needed to run the application. When you deploy the application to production for others to use, automated deployment scripts (such as those used by Heroku) install all the required gems.</p>
<p>Bundler provides a <code>bundle update</code> command when we want to replace any gems with newer versions. If you run <code>bundle update</code>, any new gem versions will be downloaded and installed and the <strong>Gemfile.lock</strong> file will be updated. Be aware that updating gems can break your application, so only update gems when you have time to test and resolve any issues. You can run <code>bundle outdated</code> to see which gems are available in newer versions.</p>
<p>If you want to prevent your fellow developers (or yourself) from accidentally updating gems, you can specify a gem version number for any gem in the Gemfile. The Gemfile gives fine-grained control over rules for updating:</p>
<ul>
<li><code>gem ’rails’, ’5.0.0’</code> is “absolute” only version 5.0.0 will be used</li>
<li><code>gem ’rails’, ’&gt;= 5.0.0’</code> is “optimistic” any version newer than 5.0.0 will be used</li>
<li><code>gem ’rails’, ’~&gt; 5.0.0’</code> is “pessimistic”</li>
</ul>
<p>“Pessimistic” versioning needs some explanation. <code>~&gt; 5.0.0</code> means use any version greater than 5.0.0 and less than 5.1 (any patch version can be used). <code>~&gt; 5.0</code> means use any version greater than 5.0 and less than 6.0 (any minor version can be used).</p>
<p>In general, during development we only lock down any gem versions in the Gemfile if we know newer versions introduce problems.</p>
<p>Let’s take a look at the Gemfile created by the <code>rails new</code> command.</p>
<h2 id="97-gemfile-for-a-rails-default-application"><a href="#cid61">9.7 Gemfile for a Rails Default Application</a></h2>
<p>Open the <strong>Gemfile</strong> with your text editor:</p>
<p>source 'https://rubygems.org'</p>
<p>git_source(:github) do |repo_name|
  repo_name \= "#{repo_name}/#{repo_name}" unless repo_name.include?("/")
  "https://github.com/#{repo_name}.git"
end</p>
<p># Bundle edge Rails instead: gem 'rails', github: 'rails/rails'
gem 'rails', '~&gt; 5.1.2'
# Use sqlite3 as the database for Active Record
gem 'sqlite3'
# Use Puma as the app server
gem 'puma', '~&gt; 3.7'
# Use SCSS for stylesheets
gem 'sass-rails', '~&gt; 5.0'
# Use Uglifier as compressor for JavaScript assets
gem 'uglifier', '&gt;= 1.3.0'
# See https://github.com/rails/execjs#readme for more supported runtimes
# gem 'therubyracer', platforms: :ruby</p>
<p># Use CoffeeScript for .coffee assets and views
gem 'coffee-rails', '~&gt; 4.2'
# Turbolinks makes navigating your web application faster. Read more: https://github.com/turbolinks/turbolinks
gem 'turbolinks', '~&gt; 5'
# Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder
gem 'jbuilder', '~&gt; 2.5'
# Use Redis adapter to run Action Cable in production
# gem 'redis', '~&gt; 3.0'
# Use ActiveModel has_secure_password
# gem 'bcrypt', '~&gt; 3.1.7'</p>
<p># Use Capistrano for deployment
# gem 'capistrano-rails', group: :development</p>
<p>group :development, :test do
  # Call 'byebug' anywhere in the code to stop execution and get a debugger console
  gem 'byebug', platforms: [:mri, :mingw, :x64_mingw]
  # Adds support for Capybara system testing and selenium driver
  gem 'capybara', '~&gt; 2.13'
  gem 'selenium-webdriver'
end</p>
<p>group :development do
  # Access an IRB console on exception pages or by using &lt;%= console %&gt; anywhere in the code.
  gem 'web-console', '&gt;= 3.3.0'
  gem 'listen', '&gt;= 3.0.5', '&lt; 3.2'
  # Spring speeds up development by keeping your application running in the background. Read more: https://github.com/rails/spring
  gem 'spring'
  gem 'spring-watcher-listen', '~&gt; 2.0.0'
end</p>
<p># Windows does not include zoneinfo files, so bundle the tzinfo-data gem
gem 'tzinfo-data', platforms: [:mingw, :mswin, :x64_mingw, :jruby]</p>
<p>The file you see will be very similar. Some version numbers may be different if a newer Rails version was released since this was written.</p>
<p>The first line, <code>source ’https://rubygems.org’</code>, directs Bundler to use the <a href="https://rubygems.org/">rubygems.org</a> server as a source for any gems.</p>
<p>Notice that the second uncommented line directs Bundler to use Rails and specifies a range of acceptable versions. In this case, the Gemfile indicates we can use any version between 5.1.2 and 5.2.</p>
<p>In the Gemfile you’ll see the gems for a Rails default application, such as the sqlite3 database gem, which we described earlier. Other gems are commented out (the lines begin with the <code>#</code> character). These are suggestions and we can ignore them or remove them.</p>
<p>We won’t use a database for our application but we’ll keep the <code>gem ’sqlite3’</code> entry. Configuring Rails for no database is complicated; it is easier to keep the sqlite3 gem and not use it.</p>
<p>If you are developing your application on a computer using the Linux operating system, you may need to uncomment and use the statement <code>gem ’therubyracer’, platforms: :ruby</code>. Linux doesn’t have a built-in JavaScript interpreter so you must install Node.js in your environment or else add the therubyracer gem to each project Gemfile. For help, see <a href="https://railsapps.github.io/installrubyonrails-ubuntu.html">Install Ruby on Rails - Ubuntu</a>.</p>
<p>It’s wise to specify the Ruby version we’re using. This is needed for automated deployment scripts such as those used by Heroku. We can add that to the Gemfile:</p>
<p>ruby '2.4.1'</p>
<p>If you add the Ruby version and remove the extra clutter in the <strong>Gemfile</strong> it will look like this:</p>
<p>source 'https://rubygems.org'
ruby '2.4.1'
gem 'rails', '~&gt; 5.1.2'</p>
<p># Rails defaults
gem 'sqlite3'
gem 'puma', '~&gt; 3.7'
gem 'sass-rails', '~&gt; 5.0'
gem 'uglifier', '&gt;= 1.3.0'
gem 'coffee-rails', '~&gt; 4.2'
gem 'turbolinks', '~&gt; 5'
gem 'jbuilder', '~&gt; 2.5'
group :development, :test do
  gem 'byebug', platforms: [:mri, :mingw, :x64_mingw]
  gem 'capybara', '~&gt; 2.13'
  gem 'selenium-webdriver'
end
group :development do
  gem 'web-console', '&gt;= 3.3.0'
  gem 'listen', '&gt;= 3.0.5', '&lt; 3.2'
  gem 'spring'
  gem 'spring-watcher-listen', '~&gt; 2.0.0'
end</p>
<p>Try it now. Replace the Gemfile with the simplified code above.</p>
<h2 id="98-adding-gems"><a href="#cid62">9.8 Adding Gems</a></h2>
<p>I’ve identified several gems that will be useful for our tutorial application.</p>
<p>I learned about these gems from several places:</p>
<ul>
<li><a href="https://ruby-toolbox.com/">Ruby Toolbox</a></li>
<li><a href="http://www.rubyflow.com/">RubyFlow</a></li>
<li>various blog posts</li>
<li>example code and starter apps on GitHub</li>
<li>recommendations from colleagues</li>
</ul>
<p>We’re adding these gems at the beginning of our development process since we already know which gems we’ll need. On a real project, you’ll often discover useful gems and add them to the Gemfile during the ongoing process of development.</p>
<p>Here are gems we’ll add to the Gemfile:</p>
<ul>
<li><a href="https://github.com/twbs/bootstrap-sass">bootstrap-sass</a> - front-end framework</li>
<li><a href="https://github.com/amro/gibbon">gibbon</a> - access to the MailChimp API</li>
<li><a href="https://github.com/thoughtbot/high_voltage">high_voltage</a> - for static pages like “about”</li>
<li><a href="https://github.com/rails/jquery-rails">jquery-rails</a> - adds the <a href="https://jquery.com/">jQuery</a> JavaScript library</li>
</ul>
<p>Box 9.1. jQuery and Rails 5.1</p>
<p>Versions of Rails prior to Rails 5.1 included the <a href="https://github.com/rails/jquery-rails">jquery-rails</a> gem by default. The gem was dropped from Rails 5.1. We’ll add the jquery-rails gem because it is required by the Bootstrap front-end framework.</p>
<p>We’ll also add utilities that make development easier:</p>
<ul>
<li><a href="https://github.com/charliesome/better_errors">better_errors</a> - helps when things go wrong</li>
<li><a href="https://github.com/RailsApps/rails_layout">rails_layout</a> - generates files for an application layout</li>
</ul>
<p>Open your <strong>Gemfile</strong> and replace the contents with the following:</p>
<p>source 'https://rubygems.org'
ruby '2.4.1'
gem 'rails', '~&gt; 5.1.2'</p>
<p># Rails defaults
gem 'sqlite3'
gem 'puma', '~&gt; 3.7'
gem 'sass-rails', '~&gt; 5.0'
gem 'uglifier', '&gt;= 1.3.0'
gem 'coffee-rails', '~&gt; 4.2'
gem 'turbolinks', '~&gt; 5'
gem 'jbuilder', '~&gt; 2.5'
group :development, :test do
  gem 'byebug', platforms: [:mri, :mingw, :x64_mingw]
  gem 'capybara', '~&gt; 2.13'
  gem 'selenium-webdriver'
end
group :development do
  gem 'web-console', '&gt;= 3.3.0'
  gem 'listen', '&gt;= 3.0.5', '&lt; 3.2'
  gem 'spring'
  gem 'spring-watcher-listen', '~&gt; 2.0.0'
end</p>
<p># learn-rails
gem 'bootstrap-sass'
gem 'gibbon'
gem 'high_voltage'
gem 'jquery-rails'
group :development do
  gem 'better_errors'
  gem 'rails_layout'
end</p>
<p>Notice that we’ve placed two gems inside a “group.” Specifying a group for development or testing ensures a gem is not loaded in production, reducing the application’s memory footprint. Rails let you specify groups for <em>development</em>, <em>test</em>, or <em>production</em>.</p>
<h2 id="99-about-the-rails-version"><a href="#cid63">9.9 About the Rails Version</a></h2>
<p>The version of Rails specified in your Gemfile should match the version that is installed in your gemset.</p>
<p>If you’ve got Rails 5.1, there’s no need to make additional changes to the Gemfile. Any version beginning with 5.1, such as 5.1.1, will be fine.</p>
<p>If you have Rails 5.2 (which was not available when this was written), you must get a new version of this book. The newest available version of the book is listed on the README page of the <a href="https://github.com/RailsApps/learn-rails">learn-rails</a> GitHub repository. If a newer version of the book is not available, you can install Rails 5.0. See the articles <a href="https://railsapps.github.io/installing-rails.html">Install Rails</a> and <a href="https://railsapps.github.io/updating-rails.html">Updating Rails</a> for details about installing and switching between Rails versions.</p>
<h2 id="910-install-the-gems"><a href="#cid64">9.10 Install the Gems</a></h2>
<p>Each time you edit the Gemfile, you will run <code>bundle install</code> and restart your web server.</p>
<p>You’ve edited the Gemfile. Install the required gems on your computer:</p>
<p>$ bundle install</p>
<p>The <code>bundle install</code> command will download the gems from the <a href="https://rubygems.org/">rubygems.org</a> server and save them to a hidden directory that is managed by the RVM gemset you’ve specified.</p>
<p>We’ll see all the gems and their dependencies:</p>
<p>Fetching gem metadata from https://rubygems.org/
Fetching version metadata from https://rubygems.org/
Fetching dependency metadata from https://rubygems.org/
Resolving dependencies...
Using rake 11.3.0
Using concurrent-ruby 1.0.2
Using i18n 0.7.0
Using minitest 5.9.1
.
.
.
(many more gems not shown... you get the idea)
.
.
.
Bundle complete! 20 Gemfile dependencies, 73 gems now installed.
Use `bundle show [gemname]` to see where a bundled gem is installed.</p>
<p>You can use your text editor to view the contents of <strong>Gemfile.lock</strong> and you will see a detailed listing of every gem and each dependency, with version numbers. There’s no reason to edit a <strong>Gemfile.lock</strong> file; if it is ever in error, delete it and run <code>bundle install</code> to recreate it.</p>
<p>Run <code>gem list</code> to see all the gems that are loaded into the development environment:</p>
<p>$ gem list</p>
<p>The list of gems loaded in the environment is the same as the list specified in the <strong>Gemfile.lock</strong> file. Here’s how it works. RVM makes a place for the gems to be stored (the RVM gemset); the <strong>Gemfile</strong> lists the gems you want to use; <code>bundle install</code> reads the Gemfile and installs the gems into the RVM gemset; the <strong>Gemfile.lock</strong> file records dependencies and version numbers; and <code>gem list</code> shows you the gems that are in the gemset and available for use.</p>
<h3 id="9101-troubleshooting"><a href="#uid141">9.10.1 Troubleshooting</a></h3>
<p>If your development environment is set up correctly, there should be no difficulty installing gems with the <code>bundle install</code> command. If your development environment is not set up correctly, you may see error messages when Bundler attempts to install the <a href="http://nokogiri.org/">Nokogiri</a> gem. Nokogiri is often needed by other gems (it is a <em>dependency</em> of some gems) and Nokogiri can become a problem to install. Unlike most gems that are written in pure Ruby, parts of Nokogiri are written in the C language and must be compiled using system tools that vary with different operating systems. If you get an error while installing gems, and the message says, “An error occurred while installing nokogiri,” ask for help on <a href="https://stackoverflow.com/questions/tagged/learn-ruby-on-rails">Stack Overflow</a>.</p>
<h2 id="911-git"><a href="#cid65">9.11 Git</a></h2>
<p>Let’s commit our changes to the Git repository and push to GitHub:</p>
<p>$ git add -A
$ git commit -m "add gems"
$ git push origin master</p>
<p>After your first use of <code>git push origin master</code>, you can use the shortcut <code>git push</code>.</p>
<p>If you get a message:</p>
<p>fatal: Not a git repository (or any of the parent directories): .git</p>
<p>It indicates you are in a folder that has not been initialized with Git. You are probably not in your project directory. Use the Unix command <code>pwd</code> to see where you are.</p>
<p>If you get a message:</p>
<p>fatal: 'origin' does not appear to be a git repository
fatal: The remote end hung up unexpectedly</p>
<p>It shows that you can’t connect to GitHub to push the changes. To investigate, enter:</p>
<p>$ git remote show origin</p>
<p>It is not absolutely necessary to use GitHub for this tutorial. We’re only using it so you’ll be familiar with the workflow of professional development.</p>
<p>We’re ready to configure the application.</p>
<h1 id="chapter-10-configure"><a href="#cid66">Chapter 10 Configure</a></h1>
<p>Rails is known for its “convention over configuration” guiding principle. As applied, the principle reduces the need for many configuration files. It’s not possible to eliminate all configuration files, however. Many applications require configuration of settings such as email account credentials or API keys for external services.</p>
<p>In our tutorial application, we’ll need to store an API key to access MailChimp, which we’ll use to add visitors’ email addresses to a mailing list. We’ll also need to store credentials so we can send email using the SendGrid transactional email service.</p>
<p>Rails provides the <strong>config/secrets.yml</strong> file for our configuration settings. Any variable that is set in the <strong>config/secrets.yml</strong> file can be used elsewhere in our Rails application, providing a single location for all our configuration variables.</p>
<h2 id="101-configuration-security"><a href="#cid67">10.1 Configuration Security</a></h2>
<p>GitHub is a good place to store and share code. But when your repos are public, they are not a good place for secret account credentials. In fact, any shared Git repository, even a private repo, is a bad place to store email account credentials or private API keys.</p>
<p>Operating systems (Linux, macOS, Windows) provide mechanisms to set local <a href="https://en.wikipedia.org/wiki/Environment_variable">environment variables</a>, as does Heroku and other deployment platforms. With a bit of Unix savvy, you can set environment variables using the Unix shell. Environment variables can be accessed from Rails applications and provide an ideal place to set configuration settings that must remain private.</p>
<p>For the best security, set credentials as Unix environment variables and only use Unix environment variables in the <strong>config/secrets.yml</strong> file.</p>
<p>The article <a href="https://railsapps.github.io/rails-environment-variables.html">Rails Environment Variables</a> shows alternatives to using Unix environment variables, if for any reason you cannot set environment variables on your machine.</p>
<h2 id="102-videos"><a href="#cid68">10.2 Videos</a></h2>
<p>If you have subscribed, now’s a good time to watch:</p>
<ul>
<li><a href="https://tutorials.railsapps.org/videos/7">UNIX Environment Variables</a></li>
<li><a href="https://tutorials.railsapps.org/videos/8">Rails Environment Variables</a></li>
</ul>
<h2 id="103-about-environment-variables"><a href="#cid69">10.3 About Environment Variables</a></h2>
<p>Unix environment variables are typically set in a file that is read when starting an interactive shell. The <em>shell</em> is the program that gives us the command line interface we see in the Terminal or console application. Unix gives you a choice of shell programs (with names like <em>sh</em>, <em>bash</em>, <em>ksh</em>, and <em>zsh</em>); each has a slightly different way to set environment variables. The most common shell program is bash.</p>
<p>Let’s find out what shell you are using:</p>
<p>$ echo $SHELL
/bin/bash</p>
<p>If you see <code>/bin/bash</code>, that’s great! If not, you may have to do some research to find out how to set environment variables in your shell.</p>
<p>You might be surprised to see a dollar sign in the command. You don’t type the first dollar sign (it is just the convention that indicates you are entering a Unix command). You’ll type <code>echo $SHELL</code> to ask the operating system to show the variable <code>SHELL</code>. The dollar sign in the command tells Unix to return a variable named <code>SHELL</code>. Try typing <code>echo SHELL</code> without the dollar sign and you’ll see <code>echo</code> just displays what you type.</p>
<p>When you open a console window, the bash shell reads a configuration file in your user home directory. You can use a Unix command to list all the files in your user home directory (the <code>~</code> “tilde” character represents your home directory):</p>
<p>$ ls -1pa ~
.
.
.
.bash_profile
.
.
.</p>
<p>On the Mac, you’ll see <strong>.bash_profile</strong>. On Linux systems, you’ll see <strong>.bashrc</strong>.</p>
<h2 id="104-viewing-hidden-files"><a href="#cid70">10.4 Viewing Hidden Files</a></h2>
<p>The files <strong>.bash_profile</strong> or <strong>.bashrc</strong> are hidden in the file browser. You can force the Mac to display hidden files by entering the following command in the Terminal application:</p>
<p>defaults write com.apple.finder AppleShowAllFiles TRUE; killall Finder</p>
<p>Hidden files will appear in gray in the Finder window.</p>
<p>Use your text editor (Atom or Sublime) to open the <strong>.bash_profile</strong> or <strong>.bash_rc</strong> file.</p>
<p>To open the <strong>.bash_profile</strong> file with Atom:</p>
<p>$ atom ~/.bash_profile</p>
<p>In Unix, the squiggle (tilde) character is a shortcut to your user home folder.</p>
<p>Open either file and you’ll likely find a command such as:</p>
<p>export PATH=~/.bin:$PATH</p>
<p>That is a command that sets the <code>PATH</code> environment variable. The command might not be exactly the same but it is likely you will see some <code>export</code> commands.</p>
<p>You can add the environment variables anywhere in the file. For convenience, add the environment variables near the end of the file, above any existing <code>EXPORT</code> statement.</p>
<p>You should use quotes to surround configuration values (credentials) in the <strong>.bash_profile</strong> or <strong>.bashrc</strong> files.</p>
<p>If you don’t have a <strong>.bash_profile</strong> or <strong>.bashrc</strong> file in your user home directory, you can create one.</p>
<h2 id="105-set-environment-variables"><a href="#cid71">10.5 Set Environment Variables</a></h2>
<p>You’ll set the following environment variables in your <strong>.bashrc</strong> or <strong>.bash_profile</strong> file:</p>
<ul>
<li>SENDGRID_USERNAME</li>
<li>SENDGRID_PASSWORD</li>
<li>MAILCHIMP_API_KEY</li>
<li>MAILCHIMP_LIST_ID</li>
<li>OWNER_EMAIL</li>
</ul>
<p>Here are details.</p>
<h3 id="1051-sendgrid"><a href="#uid149">10.5.1 SendGrid</a></h3>
<p>You’ll need your SendGrid username and password. The credentials are the same you use to sign in to the SendGrid website.</p>
<p>Add your SendGrid username and password to your <strong>.bash_profile</strong> or <strong>.bashrc</strong> file:</p>
<p>export SENDGRID_USERNAME="example"
export SENDGRID_PASSWORD="secret"</p>
<p>Obviously, change “example” and “secret” to your own credentials.</p>
<h3 id="1052-mailchimp"><a href="#uid150">10.5.2 MailChimp</a></h3>
<p>When visitors sign up to receive a newsletter, we’ll add them to a MailChimp list. Add an environment variable for the MailChimp API key: <code>MAILCHIMP_API_KEY</code>. <a href="https://admin.mailchimp.com/">Sign in to MailChimp</a> to get your API key. Click your name at the top of the navigation menu, then click “Account.” Click “Extras,” then “API keys.” You have to generate an API key; MailChimp doesn’t create one automatically. The MailChimp API key is a long string of characters like a secret code that works like a password. Enter it in your <strong>.bash_profile</strong> or <strong>.bashrc</strong> file:</p>
<p>export MAILCHIMP_API_KEY="Your_MailChimp_API_Key"</p>
<p>You’ll need to create a MailChimp mailing list in preparation for our “Mailing List” chapter. Have you already created a MailChimp mailing list? If not, the MailChimp “Lists” page has a button for “Create List.” The list name and other details are up to you.</p>
<p>We’ll need the <code>MAILCHIMP_LIST_ID</code> for the mailing list you’ve created. To find the list ID, on the MailChimp “Lists” page, click the “down arrow” for a menu and click “Settings.” At the bottom of the “List Settings” page, you’ll find the unique ID for the mailing list.</p>
<p>export MAILCHIMP_LIST_ID="Your_List_ID"</p>
<p>Your environment variables are set up to use MailChimp.</p>
<h3 id="1053-owner-email"><a href="#uid151">10.5.3 Owner Email</a></h3>
<p>You’ll send email messages to this address when a visitor submits a contact request form. Set <code>OWNER_EMAIL</code> with an email address where you receive mail.</p>
<p>export OWNER_EMAIL="<a href="/cdn-cgi/l/email-protection">[email protected]</a>"</p>
<p>Enter an email address and your environment variables will be set up with the site owner email address.</p>
<h3 id="1054-restart-the-terminal-session"><a href="#uid152">10.5.4 Restart the Terminal Session</a></h3>
<p>Close and reopen your terminal to make sure the environment is updated with any recent changes.</p>
<h3 id="1055-troubleshooting"><a href="#uid153">10.5.5 Troubleshooting</a></h3>
<p>Check that the SendGrid user name is set in your Unix environment variables:</p>
<p>$ echo "$SENDGRID_USERNAME"</p>
<p>You should see your SendGrid user name in the console response. Make sure you’ve used underscores consistently and you’ve used <code>SENDGRID_USERNAME</code> not <code>SENDGRID_USER_NAME</code>.</p>
<p>If you have trouble, remember to close and reopen your terminal to make sure the environment includes any recent changes.</p>
<p>On Linux, if you’ve entered the environment variables in your <strong>.bashrc</strong> file but they don’t seem to work, try setting them in your <strong>.bash_profile</strong> file instead.</p>
<p>If you’ve set up Unix environment variables but <code>echo "$SENDGRID_USERNAME"</code> doesn’t return the correct variable in the console, you may have a problem with the way you’ve set Unix environment variables. Most computers use the bash shell and you can set environment variables in your <strong>.bash_profile</strong> or <strong>.bashrc</strong> files. But not every system is alike. If it seems Unix environment variables are not working, you may have to find a colleague who can help you troubleshoot. If you are having problems, you can continue with the tutorial and add the credentials directly to the <strong>config/secrets.yml</strong> file.</p>
<h2 id="106-the-secrets-file"><a href="#cid72">10.6 The Secrets File</a></h2>
<p>Use your text editor to add the Unix environment variables to the file <strong>config/secrets.yml</strong>:</p>
<p># Be sure to restart your server when you modify this file.</p>
<p># Your secret key is used for verifying the integrity of signed cookies.
# If you change this key, all old signed cookies will become invalid!</p>
<p># Make sure the secret is at least 30 characters and all random,
# no regular words or you'll be exposed to dictionary attacks.
# You can use `rails secret` to generate a secure secret key.</p>
<p># Make sure the secrets in this file are kept private
# if you're sharing your code publicly.</p>
<p># Shared secrets are available across all environments.</p>
<p># shared:
#   api_key: a1B2c3D4e5F6</p>
<p># Environmental secrets are only available for that specific environment.</p>
<p>development:
  email_provider_username: &lt;%= ENV["SENDGRID_USERNAME"] %&gt;
  email_provider_password: &lt;%= ENV["SENDGRID_PASSWORD"] %&gt;
  domain_name: example.com
  mailchimp_api_key: &lt;%= ENV["MAILCHIMP_API_KEY"] %&gt;
  mailchimp_list_id: &lt;%= ENV["MAILCHIMP_LIST_ID"] %&gt;
  owner_email: &lt;%= ENV["OWNER_EMAIL"] %&gt;
  secret_key_base: very_long_random_string</p>
<p>test:
  secret_key_base: very_long_random_string</p>
<p># Do not keep production secrets in the unencrypted secrets file.
# Instead, either read values from the environment.
# Or, use `bin/rails secrets:setup` to configure encrypted secrets
# and move the `production:` environment over there.</p>
<p>production:
  email_provider_username: &lt;%= ENV["SENDGRID_USERNAME"] %&gt;
  email_provider_password: &lt;%= ENV["SENDGRID_PASSWORD"] %&gt;
  domain_name: example.com
  mailchimp_api_key: &lt;%= ENV["MAILCHIMP_API_KEY"] %&gt;
  mailchimp_list_id: &lt;%= ENV["MAILCHIMP_LIST_ID"] %&gt;
  owner_email: &lt;%= ENV["OWNER_EMAIL"] %&gt;
  secret_key_base: &lt;%= ENV["SECRET_KEY_BASE"] %&gt;</p>
<p>Be sure to use spaces, not tabs. Make sure there is a space after each colon and before the value for each entry or you will get a message “Internal Server Error: mapping values are not allowed” when you start the web server.</p>
<p>You used quotes to surround configuration values in the <strong>.bashrc</strong> or <strong>.bash_profile</strong> files. Here, in the <strong>config/secrets.yml</strong> file, you don’t need quotes when you are importing Unix environment variables.</p>
<h3 id="1061-domain-name"><a href="#uid154">10.6.1 Domain Name</a></h3>
<p>We’ll need a domain name when we configure email for delivery in production. For development, use <code>example.com</code>. If you have your own domain name, you can use that instead. There’s no need to keep the <code>domain_name</code> configuration variable secret, so we don’t need to set it in a Unix environment variable.</p>
<p>You can decide for yourself if the <code>owner_email</code> variable really needs to be secret. Just for caution, I’m suggesting you set it as a Unix environment variable.</p>
<h3 id="1062-securing-the-secrets-file"><a href="#uid155">10.6.2 Securing the Secrets File</a></h3>
<p>Some developers take steps to prevent the <strong>config/secrets.yml</strong> file from being checked into Git. To prevent the file from being saved to your repo you could add the filename to the <strong>.gitignore</strong> file in your application root directory.</p>
<p>However, you don’t need to keep the <strong>config/secrets.yml</strong> file from being checked into Git if you’ve used Unix environment variables in the <strong>config/secrets.yml</strong> file. If you only reveal the <code>SECRET_KEY_BASE</code> used for development or testing, and no one can access your development machine, no useful secrets will be revealed in your GitHub repo.</p>
<p>When you deploy to Heroku, the <strong>config/secrets.yml</strong> file must be in your Git repository. For that reason, I suggest you save the file in your Git repo and keep your secrets safe by using environment variables.</p>
<h3 id="1063-troubleshooting"><a href="#uid156">10.6.3 Troubleshooting</a></h3>
<p>Remember, in YAML files (with the file extension <strong>.yml</strong>), indentation is required (your application will break without it).</p>
<p>Be sure to use spaces, not tabs. Make sure there is a space after each colon and before the value for each entry.</p>
<p>If you have trouble setting Unix environment variables, you can add credentials directly to the <strong>config/secrets.yml</strong> file. If you do so, you should not check the file into Git until you’ve deleted the secrets from the file.</p>
<p>Replace the following if you are troubleshooting:</p>
<p>development:
  email_provider_username: &lt;%= ENV["SENDGRID_USERNAME"] %&gt;
  email_provider_password: &lt;%= ENV["SENDGRID_PASSWORD"] %&gt;</p>
<p>with:</p>
<p>development:
  email_provider_username: example
  email_provider_password: 's#cr*t'</p>
<p>In a YAML file, you do not need quotes unless your string contains special characters. If your password contains any of these characters you should surround the string with single quotes:</p>
<p>: { } [ ] &amp; * # ? | - &lt; &gt; = ! % @ \</p>
<p>Again, DON’T CHECK THE FILE INTO GIT if you’ve hardcoded your credentials directly in the <strong>config/secrets.yml</strong> file.</p>
<p>The article <a href="https://railsapps.github.io/rails-environment-variables.html">Rails Environment Variables</a> shows alternatives to using Unix environment variables, if for any reason you cannot set environment variables on your machine.</p>
<h2 id="107-secret-key-base"><a href="#cid73">10.7 Secret Key Base</a></h2>
<p>It’s not necessary to set <code>SECRET_KEY_BASE</code> as an environment variable on the computer you use for development. Rails generates a unique <code>SECRET_KEY_BASE</code> in the <strong>config/secrets.yml</strong> file each time you create a new Rails application and you don’t need to replace it. If someone sees the <code>SECRET_KEY_BASE</code> in the <strong>config/secrets.yml</strong> file in your GitHub repo, there isn’t anything they can do with it, since they don’t have access to your local machine.</p>
<p>For your future reference, in case you want to change the <code>SECRET_KEY_BASE</code>, here’s how. Go to your Rails application directory and create a new secret token:</p>
<p>$ rails secret
very_long_random_string</p>
<p>And, if you wish, add it to your <strong>.bash_profile</strong> or <strong>.bashrc</strong> file:</p>
<p>export SECRET_KEY_BASE="very_long_random_string"</p>
<p>You should always use the environment variable <code>&lt;%= ENV["SECRET_KEY_BASE"] %&gt;</code> in the production section of your <strong>config/secrets.yml</strong> file, otherwise, someone who sees the secret token in your GitHub repo can gain access to your application in production. You’ll set the environment variables for production when you deploy to Heroku.</p>
<h2 id="108-configure-email"><a href="#cid74">10.8 Configure Email</a></h2>
<p>Email messages are visible in the console and the log file when you test the application. If you don’t want to actually send email, you can skip this step. But it’s more fun when your application can actually send email.</p>
<p>You can learn more in the article <a href="https://railsapps.github.io/rails-send-email.html">Send Email with Rails</a>.</p>
<h3 id="1081-connect-to-an-email-server"><a href="#uid157">10.8.1 Connect to an Email Server</a></h3>
<p>Web servers don’t send email. Our Rails application has to connect to an email server (also known as a <a href="https://en.wikipedia.org/wiki/Email_server">mail transfer agent</a> or “mail relay”). In the early days of the Internet, an experienced system administrator could set up an <a href="https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol">SMTP server</a> to distribute email. Now, because of efforts to reduce spam, it is necessary to use an established email service to ensure deliverability. In production, for high volume transactional email and improved deliverability, it is best to use a service such as <a href="https://sendgrid.com/">SendGrid</a>. Alternatives are:</p>
<ul>
<li><a href="https://aws.amazon.com/ses/">Amazon SES (Simple Email Service)</a></li>
<li><a href="https://mailgun.net/pricing">Mailgun</a></li>
<li><a href="http://mailjet.com/">Mailjet</a></li>
<li><a href="http://mandrill.com/">Mandrill</a></li>
<li><a href="http://postageapp.com/">PostageApp</a></li>
<li><a href="https://postmarkapp.com/">Postmark</a></li>
<li><a href="https://www.sparkpost.com/">SparkPost</a></li>
</ul>
<p>For our tutorial application, we’ll connect to SendGrid to send email.</p>
<p>For convenience during development, some developers use their own Gmail account to send email. Google has increased security measures for Gmail, so it is difficult to use Gmail to send email from a Rails application. SendGrid is easier to set up and you’re more likely to use it for a real application. That’s why we’ll use it.</p>
<p>In the file <strong>config/environments/development.rb</strong>, near the end of the file, find the statement:</p>
<p>config.assets.debug \= true</p>
<p>Immediately following, add this:</p>
<p>config.action_mailer.smtp_settings \= {
  address: "smtp.sendgrid.net",
  port: 587,
  domain: Rails.application.secrets.domain_name,
  authentication: "plain",
  enable_starttls_auto: true,
  user_name: Rails.application.secrets.email_provider_username,
  password: Rails.application.secrets.email_provider_password
}
# ActionMailer Config
config.action_mailer.default_url_options \= { :host \=&gt; 'localhost:3000' }
config.action_mailer.delivery_method \= :smtp
config.action_mailer.raise_delivery_errors \= true
# Send email in development mode?
config.action_mailer.perform_deliveries \= true</p>
<p>You can use port 25, 587, or 2525 (some ISPs restrict connections on port 25).</p>
<p>It’s important to add these changes in the body of the configuration file, before the <code>end</code> keyword. The order isn’t important but don’t add the configuration statements after the <code>end</code> keyword.</p>
<p>Notice that we are using configuration variables that are set in the <strong>config/secrets.yml</strong> file:</p>
<ul>
<li>Rails.application.secrets.email_provider_username</li>
<li>Rails.application.secrets.email_provider_password</li>
</ul>
<p>We could “hard code” a username and password here but that would expose confidential data if your GitHub repository is public. Using configuration variables that are set in the <strong>config/secrets.yml</strong> file keeps your secrets safe.</p>
<p>Again, if you need to troubleshoot, you can enter the SendGrid username and password directly in this file instead of the configuration variables. But for security, don’t commit to Git with the password hardcoded in this file.</p>
<h3 id="1082-perform-deliveries-in-development"><a href="#uid167">10.8.2 Perform Deliveries in Development</a></h3>
<p>If you want to send real messages when you test the application in development mode, modify the file <strong>config/environments/development.rb</strong>.</p>
<p>After the code you just added, add the statement:</p>
<p># Send email in development mode?
config.action_mailer.perform_deliveries \= true</p>
<p>This changes the configuration to send email when you’re working on the application.</p>
<p>Make sure any code you’ve added to the <strong>config/environments/development.rb</strong> file is placed before the final <code>end</code> keyword. If you add code after the final <code>end</code> keyword, your application will fail with errors when you start the web server.</p>
<p>Later, after we add a contact form to the tutorial application, the application will be ready to send email messages.</p>
<h2 id="109-git"><a href="#cid75">10.9 Git</a></h2>
<p>Make sure you’re in your application root directory.</p>
<p>Let’s commit our changes to the Git repository and push to GitHub:</p>
<p>$ git add -A
$ git commit -m "add configuration"
$ git push</p>
<p>We’re ready to create a home page for the application.</p>
<h1 id="chapter-11-static-pages-and-routing"><a href="#cid76">Chapter 11 Static Pages and Routing</a></h1>
<p>A Rails application can deliver static web pages just like an ordinary web server. The pages are delivered fast and no Ruby code is required. We’ll look at simple static pages and learn about Rails routing before we explore the complexities of dynamic web pages in Rails.</p>
<h2 id="111-add-a-home-page"><a href="#cid77">11.1 Add a Home Page</a></h2>
<p>Make sure you are in your project directory.</p>
<p>Start the application server:</p>
<p>$ rails server</p>
<p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>. You’ll see the Rails default information page.</p>
<p>For the next step, you’ll need to know how to use a text editor such as <a href="https://atom.io/">Atom</a> or <a href="https://www.sublimetext.com/">Sublime Text</a>. You can find free tutorials on YouTube. Or, if you prefer a book, try Michael Hartl’s <a href="https://www.learnenough.com/text-editor-tutorial">Learn Enough Text Editor to Be Dangerous</a>.</p>
<p>Use your text editor to create and save a file <strong>public/index.html</strong>:</p>
<h1>Hello World</h1>

<p>Refresh the browser window and you’ll see the “Hello World” message.</p>
<p>The Rails application server looks for any pages in the <strong>public</strong> folder by default.</p>
<p>If no filename is specified in the URL, the server will attempt to respond with a file named <strong>index.html</strong>. This is a convention that dates to 1993; if no filename was specified, one of the first web servers ever built (the NCSA httpd server) would return a list of all files in the directory, unless a file named <strong>index.html</strong> was present. Since then, <strong>index.html</strong> has been the default filename for a home page.</p>
<h2 id="112-routing-error"><a href="#cid78">11.2 Routing Error</a></h2>
<p>What happens when no file matches the requested web address?</p>
<p>Enter the URL <a href="http://localhost:3000/about.html">http://localhost:3000/about.html</a> in your browser.</p>
<p>You’ll see an error page that shows a routing error.</p>
<p>If you are using Cloud9, add “/about.html” to the URL in the preview browser window.</p>
<h2 id="113-add-an-about-page"><a href="#cid79">11.3 Add an About Page</a></h2>
<p>Use your text editor to create and save a file <strong>public/about.html</strong>:</p>
<h1>About</h1>

<p>Visit the URL <a href="http://localhost:3000/about.html">http://localhost:3000/about.html</a> in your browser. You’ll see the new “About” page.</p>
<p>By the way, you’ve just done test-driven development (TDD).</p>
<h3 id="1131-introducing-tdd"><a href="#uid168">11.3.1 Introducing TDD</a></h3>
<p>With test-driven development, a developer tests behavior before implementing a feature, expecting to see an error condition. Then the developer implements the feature and sees a successful result to the test. That’s exactly what you’ve done, in the simplest way.</p>
<p>Beginners tend to think TDD is scary and complicated. Now that you’ve experienced a simple form of TDD, maybe it won’t be intimidating. Real TDD means writing tests in Ruby before implementing features, but the principle is the same.</p>
<h2 id="114-introducing-routes"><a href="#cid80">11.4 Introducing Routes</a></h2>
<p>The guiding principle of “convention over configuration” governs Rails routing. If the web browser requests a page named “index.html”, Rails will deliver the page from the <strong>public</strong> folder by default. No configuration is required. But what if you want to override the default behavior? Rails provides a configuration file to control web request routing.</p>
<p>If you’ve got only one terminal window open, you’ll have to stop the Rails server with Control-c to get your terminal prompt. Here is where it is helpful to have two terminal sessions going in different tabs.</p>
<p>Let’s set the “About” page as the home page.</p>
<p>Open the file <strong>config/routes.rb</strong>. Remove all the comments and replace the file with this:</p>
<p>Rails.application.routes.draw do
  root to: redirect('/about.html')
end</p>
<p>This snippet of Rails routing code takes any request to the application root (<a href="http://localhost:3000/">http://localhost:3000/</a>) and redirects it to the <strong>about.html</strong> file (which is expected to be found in the <strong>public</strong> folder).</p>
<p>There is no need to restart your application server to see the new behavior. If you need to start the server:</p>
<p>$ rails server</p>
<p>Visit the page <a href="http://localhost:3000">http://localhost:3000/</a>. You’ll see the “About” page.</p>
<p>If you still see the “Hello World” page, you didn’t remove the the <strong>public/index.html</strong> file. Rails will use the index file in the public folder before it checks the routing file for a redirect.</p>
<p>You’ve just seen an example of Rails magic. Some developers complain that the “convention over configuration” principle is black magic. It’s not obvious why pages are delivered from the <strong>public</strong> folder; it just happens. If you don’t know the convention, you could be left scratching your head and looking for the code that maps <a href="http://localhost:3000/">http://localhost:3000/</a> to the <strong>public/index.html</strong> file. The code is buried deep in the Rails framework. However, if you know the convention and the technique for overriding it, you have both convenience and power at your disposal.</p>
<h2 id="115-using-the-about-page"><a href="#cid81">11.5 Using the “About” Page</a></h2>
<p>We’ve created an “About” page so we can learn about routing.</p>
<p>For the next chapter, we’ll use the static “About” page to investigate how a web application works.</p>
<p>Later in the tutorial we’ll create a new “About” page using a different approach.</p>
<h1 id="chapter-12-request-and-response"><a href="#cid82">Chapter 12 Request and Response</a></h1>
<p>You’ve configured the tutorial application, created static pages, and seen the magic of Rails routing.</p>
<p>In this chapter, we’ll investigate the web request-response cycle and look at the model-view-controller design pattern so you’ll be prepared to build a dynamic home page.</p>
<h2 id="121-investigating-the-request-response-cycle"><a href="#cid83">12.1 Investigating the Request Response Cycle</a></h2>
<p>Remember, at its core, the World Wide Web is nothing more than web browsers that request files from web servers.</p>
<p>Web browsers make <em>requests</em>. A web server <em>responds</em> to a request by sending an HTML file. Depending on the headers in the HTML file, the web browser may make additional requests and get additional CSS, JavaScript, and image files.</p>
<p>The beauty and simplicity of the World Wide Web architecture, as conceived by Tim Berners-Lee in 1990, is that the web is nothing more than a request from a web browser and a response from a web server. Some web pages now include streaming video, or music, requiring an open “pipe” between the web server and the web browser, but even so, an initial request-response cycle delivers the page that sets up the stream.</p>
<p>We can reduce the mystery of how the web works to its simplest components when we investigate the request-response cycle. We’ll see that everything that happens in a web application takes place within the flow of the request-response cycle.</p>
<p>Let’s look at the request-response cycle.</p>
<p><img alt="images/figures/learn-rails-41-request-response" src="http://learn-rails.com/images/figures/learn-rails-2/learn-rails-41-request-response.png" /></p>
<p>Figure 12.1: The request-response cycle.</p>
<h3 id="1211-inside-the-browser"><a href="#uid170">12.1.1 Inside the Browser</a></h3>
<p>We can see the actual request, and the actual response, by using the diagnostic tools built into the web browser.</p>
<p>Start the application server if it is not already running:</p>
<p>$ rails server</p>
<p>Developers use various web browsers during development. I’ll provide instructions for Chrome, since it is the most popular. Even if you prefer Mozilla Firefox or Apple Safari, try this in Chrome, so you can follow along with the text.</p>
<p>Start our investigation by putting Chrome into “Incognito Mode” with Command-Shift-N (on a Mac). On Linux, use Ctrl-Shift-N to get in incognito mode with Chrome. Alternatively, you can clear the browser cache. This clears any files that were previously cached by the browser.</p>
<p>The Developer Tools view is your primary diagnostic tool for front-end (browser-based) development, including CSS and JavaScript.</p>
<p>In Chrome on macOS, press Command-Option-I to open the <em>Developer Tools View</em> in a section of the browser window. Alternatively, you can find the menu item under View/Developer/Developer Tools.</p>
<p>In Chrome on Windows or Linux platforms, press Shift-Ctrl-I or select Menu/Tools/Developer Tools.</p>
<p>Initiate the request-response cycle by visiting the “About” page at <a href="http://localhost:3000/about.html">http://localhost:3000/about.html</a>.</p>
<p>In the Developer Tools view, under the Network tab, you’ll see files received by the browser from the web server. There is only one: “about.html”. This is the file that the browser evaluates to display a web page.</p>
<p><img alt="images/figures/learn-rails-41-request" src="http://learn-rails.com/images/figures/learn-rails-2/learn-rails-41-request.png" /></p>
<p>Figure 12.2: Viewing a request in the Developer Tools View.</p>
<p>Be sure to select the Network tab in the Developer Tools view.</p>
<p>Click the “about.html” file icon. Then click the tab “Headers.” The diagnostic window shows the entire request sent to the server and the entire response received by the browser.</p>
<p><img alt="images/figures/learn-rails-41-request-headers" src="http://learn-rails.com/images/figures/learn-rails-2/learn-rails-41-request-headers.png" /></p>
<p>Figure 12.3: Viewing request headers in the Developer Tools View.</p>
<p>Under the heading “General,” you can see the request is composed of:</p>
<ul>
<li>request URL (http://localhost:3000/about.html)</li>
<li>request method (GET)</li>
<li>status code (200 OK or 304 Not Modified)</li>
</ul>
<p>You can also see request and response headers:</p>
<ul>
<li>request headers (including the User Agent identifier)</li>
<li>response headers (including last-modified date/time)</li>
</ul>
<p>You can see the HTML sent to the browser by clicking the Preview or Response tabs in the view under the Network tab.</p>
<p>Here’s the point of the exercise: The browser’s Developer Tools view shows all the data exchanged between the browser and server. You’re looking at everything that passes through the plumbing.</p>
<h3 id="1212-inside-the-server"><a href="#uid178">12.1.2 Inside the Server</a></h3>
<p>The browser’s Developer Tools view doesn’t show you what happens on the server. For that, go to the server logs or the console window.</p>
<p>Started GET "/" for ::1 at ...</p>
<p>Notice how the diagnostic messages in the console window match the headers in the browser Developer Tools view. The browser’s “Request Method:GET” matches the server’s “Started GET.”</p>
<p>Notice there are no console log messages for pages delivered from the <strong>public</strong> folder.</p>
<p>Soon we’ll see much more in the console window, after we’ve built a dynamic web page that is assembled by the application server.</p>
<h2 id="122-how-the-browser-works"><a href="#cid84">12.2 How the Browser Works</a></h2>
<p>What happens after the browser receives a response from the server?</p>
<p>The response is not complete until all files are received (or the browser reaches a time-out limit). Modern browsers retrieve files asynchronously; the order and location of the files in the initial HTML file doesn’t matter because the browser will try to load all the files before displaying the page.</p>
<h3 id="1221-document-object-model"><a href="#uid179">12.2.1 Document Object Model</a></h3>
<p>When the web browser receives an HTML file, it creates an internal representation of the page in computer memory, called the Document Object Model (DOM). It provides a structural representation of the document. The DOM works like an API for HTML documents, allowing you to modify the content and visual presentation of the page by using JavaScript.</p>
<p>Later in the tutorial, we’ll see how a JavaScript library such as <a href="https://en.wikipedia.org/wiki/Jquery">jQuery</a> can be used to do things like hiding or revealing HTML elements on a page by manipulating the DOM.</p>
<h3 id="1222-rendering"><a href="#uid180">12.2.2 Rendering</a></h3>
<p>Each time the DOM changes, the browser engine converts the DOM to a visual representation of the page and renders it in the browser window.</p>
<p>Knowing about the DOM will help you understand what happens in the browser when it receives a web response. And understanding the DOM will help you work with JavaScript for front-end programming. But in this book, our focus is on building a server-side web application in Rails. Let’s see how a Rails application responds to a web request.</p>
<h2 id="123-how-the-application-works"><a href="#cid85">12.3 How the Application Works</a></h2>
<p>Now that we’ve investigated the request-response cycle, let’s dig deeper to understand what happens inside the Rails application in response to a browser request. To do so, we’ll need to understand the model–view–controller concept.</p>
<h3 id="1231-video-option"><a href="#uid181">12.3.1 Video Option</a></h3>
<p>This eight minute video introduces the model–view–controller concept:</p>
<ul>
<li><a href="https://tutorials.railsapps.org/videos/11">Model View Controller in Rails</a></li>
</ul>
<h3 id="1232-the-model-view-controller-concept"><a href="#uid183">12.3.2 The Model View Controller Concept</a></h3>
<p>The model–view–controller concept is key to understanding how a Rails application responds to a browser request.</p>
<p>Here is a diagram that shows what happens in the server during the request-response cycle.</p>
<p><img alt="images/figures/learn-rails-41-mvc-flow" src="http://learn-rails.com/images/figures/learn-rails-2/learn-rails-41-mvc-flow.png" /></p>
<p>Figure 12.4: Model–View–Controller in Rails.</p>
<p>You learned earlier that, from the perspective of a software architect, Rails is organized to conform to the <a href="https://en.wikipedia.org/wiki/Model%E2%80%93View%E2%80%93Controller">model–view–controller</a> software design pattern. This enforces “separation of concerns” to keep code manageable and organized. The MVC design pattern is optimal for web applications and is a central organizing principle for Rails.</p>
<p>The MVC design pattern originated in the design of desktop applications. “Model” classes manipulated data; “view” classes created the user interface; and a “controller” class responded to user interaction.</p>
<p>Some computer scientists feel the architecture of web applications doesn’t quite match the original MVC design pattern of desktop applications. We can see the reason for the quibble in the next diagram. The diagram shows the MVC architecture as part of the Rails software stack.</p>
<p>At the base of the stack is the web browser. A request flows upward through the layers and encounters the router which dispatches the request to an appropriate controller.</p>
<p>In a Rails application, there is a single routing file, <strong>config/routes.rb</strong>, and multiple controllers, models, and views.</p>
<p><img alt="images/figures/learn-rails-41-mvc-stack" src="http://learn-rails.com/images/figures/learn-rails-2/learn-rails-41-mvc-stack.png" /></p>
<p>Figure 12.5: Model–View–Controller stack in Rails.</p>
<p>Considering the importance of the router, perhaps we should call our Rails architecture the <em>RCMV</em>, or Routing-Controller-Model-View, pattern. Despite the quibble about nomenclature, the architecture is well understood and used by all Rails developers.</p>
<p>Here’s the step-by-step walk-through of what happens.</p>
<p>When the web browser makes a request, a <em>router</em> component will check the <strong>config/routes.rb</strong> file and determine which <em>controller</em> should handle the request, based on the web address and HTTP protocol. The controller will obtain any needed data from a <em>model</em>. After obtaining data, the controller will render a response combining data from the model with a <em>view</em> component that provides markup and layout. The response is an HTML file that the controller assembles for the browser to display.</p>
<p>The model, view, and controller are files you create containing Ruby code. Each file has a certain structure and syntax based on foundation model, view, and controller classes defined in the Rails framework. The model, view, and controller classes you create will <em>inherit</em> behavior from parent classes that are part of the framework, so you will have less code to write yourself.</p>
<p>In most Rails applications, a <strong>model</strong> obtains data from a database, though some models obtain data from a remote connection to another server. For example, a User model might retrieve a user name and email address from a local database. A User model could also obtain a user’s recent tweets from Twitter or a user’s hometown from Facebook. The controller can obtain data from more than one model if necessary.</p>
<p>A <strong>controller</strong> can have more than one <em>action</em>. For example, a User controller might have actions to display a list of users, or add or delete a user from a list. The <strong>config/routes.rb</strong> file matches a web request to a controller action. In the software architects’ terminology, each action is a <em>method</em> of the controller <em>class</em>. We use the terms <em>action</em> and <em>method</em> interchangeably when we talk about a Rails controller; to be precise, controller actions are implemented as methods.</p>
<p>In practice, Rails developers try to limit controllers to seven standard actions: <code>index</code>, <code>show</code>, <code>new</code>, <code>create</code>, <code>edit</code>, <code>update</code> and <code>destroy</code> actions. A controller that offers these actions is said to be “RESTful” (a term that refers to <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">representational state transfer</a>, another software design abstraction). It’s not important to understand the abstract principles of RESTful design; recognizing the term and knowing that Rails controllers have seven standard actions is sufficient for beginners.</p>
<p>A <strong>view</strong> file combines Ruby code with HTML markup. Typically there will be a view file associated with each controller action that displays a page. An index view might show a list of users. A “show” view might provide details of a user’s profile. View files look much like ordinary HTML files but typically contain data in the form of Ruby variables. Often you’ll see Ruby statements such as blocks that iterate through lists to create tables. Following the “separation of concerns” principle, it is considered good practice to limit Ruby code in view files to only displaying data; anything else belongs in a model.</p>
<p>Not every controller action has its own view file. In many controllers, on completion, the <code>destroy</code> action will redirect to the index view, and <code>create</code> will redirect to either <code>show</code> or <code>new</code>.</p>
<p>This conceptual overview will be easier to grasp when you actually see the code for a model, view, and controller. We’ll create model, view, and controller files in the next chapter.</p>
<h2 id="124-remove-the-about-page"><a href="#cid86">12.4 Remove the About Page</a></h2>
<p>We’ve been using the static “About” page to investigate the request-response cycle.</p>
<p>We’re done, so delete the file <strong>public/about.html</strong>:</p>
<p>$ rm public/about.html</p>
<p>Earlier, we set up the <strong>config/routes.rb</strong> file. You can leave it in place. We’ll change it in the next chapter.</p>
<p>Now we’ll look at ways to implement the home page using the full power of Rails.</p>
<h1 id="chapter-13-dynamic-home-page"><a href="#cid87">Chapter 13 Dynamic Home Page</a></h1>
<p>Earlier, we saw how Rails can deliver simple static web pages.</p>
<p>Here we’ll build a dynamic home page, illustrating basic concepts you’ll need to understand Rails.</p>
<h2 id="131-user-story"><a href="#cid88">13.1 User Story</a></h2>
<p>We’ll plan our work with a user story:</p>
<p>*Birthday Countdown*
As a visitor to the website
I want to see the owner's name
I want to see the owner's birthdate
I want to see how many days until the owner's next birthday
In order to send birthday greetings</p>
<p>This silly home page will help us explore Rails and learn about the Ruby language.</p>
<p>Our goal is to build a practical web application that you can really use. Later we’ll replace this silly home page with a useful web page that encourages visitors to sign up for a mailing list.</p>
<h2 id="132-routes-model-view-and-controller"><a href="#cid89">13.2 Routes, Model, View, and Controller</a></h2>
<p>We’ll use the model-view-controller design pattern as we build our new home page.</p>
<p>First, we’ll set up a route so a request URL gets directed to the appropriate controller.</p>
<p>We’ll set up a model so we obtain data we need for the home page.</p>
<p>We’ll set up a view that contains the HTML needed to display our home page.</p>
<p>And finally, we’ll create a controller that responds to the request, obtaining data from the model and rendering the view, sending a response to the web browser.</p>
<p>We can create the routes, model, view, and controller in any order. All must exist before our web application will respond to a request for a home page. In this tutorial, I’ve chosen to create the routes, model, view, and controller in an order that is convenient for learning.</p>
<h2 id="133-the-name-game"><a href="#cid90">13.3 The Name Game</a></h2>
<p>Much of the art of programming lies in choosing suitable names for our creations.</p>
<p>We’ll need a model as a source for data about the site owner. Choosing the most obvious name, we’ll call it the Owner model:</p>
<ul>
<li>Owner - the file will be <strong>app/models/owner.rb</strong></li>
</ul>
<p>What about a name for the controller that will render our home page? How about “Home controller” or “Welcome controller?” Those names are acceptable. But if we consider our user story, the name “Visitors controller” is best. A visitor is the actor, so “Visitors controller” is appropriate:</p>
<ul>
<li>VisitorsController - the file will be <strong>app/controllers/visitors_controller.rb</strong></li>
</ul>
<p>Later we’ll see this is a good choice because we’ll create a Visitor model to handle data about the website visitor. In Rails, there is often a model with the same name as a controller (though a controller can use data from multiple models).</p>
<h2 id="134-naming-conventions"><a href="#cid91">13.4 Naming Conventions</a></h2>
<p>Rails is picky about class names and filenames. That’s because of the “convention over configuration” principle. By requiring certain naming patterns, Rails avoids complex configuration files.</p>
<p>Before we look at class and filename conventions, here’s a note about typographic terminology:</p>
<ul>
<li>a <a href="https://en.wikipedia.org/wiki/String_(computer_science)">string</a> is a sequence of characters</li>
<li>you’re looking at an example of lowercase strings separated by spaces (words!)</li>
<li>Titlecase means there is an Initial Capital Letter in a string</li>
<li><a href="https://en.wikipedia.org/wiki/CamelCase">CamelCase</a> contains a capital letter in the middle of a string</li>
<li>snake_case combines words with an underscore character instead of a space</li>
</ul>
<p>When you write code, you’ll follow rules for class names:</p>
<ul>
<li><code>class Visitor</code> - the model class name is capitalized and singular</li>
<li><code>class VisitorsController &lt; ApplicationController</code> - for a controller, combine a pluralized model name with “Controller” in CamelCase</li>
</ul>
<p>Here are the rules for filenames. They are always lowercase, with words separated by underscores (snake_case):</p>
<ul>
<li>the model filename matches the model class name, but lowercase, for example <strong>app/models/visitor.rb</strong></li>
<li>the controller filename matches the controller class name, but snake_case, for example <strong>app/controllers/visitors_controller.rb</strong></li>
<li>the views folder matches the model class name, but plural and lowercase, for example <strong>app/views/visitors</strong></li>
</ul>
<p>At first the rules may seem arbitrary, but with experience they will make sense. The rule about no capital letters or spaces in filenames has its origins in computer antiquity.</p>
<p>If you stray from these naming conventions, you’ll encounter unexpected problems and frustration.</p>
<h2 id="135-routing"><a href="#cid92">13.5 Routing</a></h2>
<p>We’ll create the route before we implement the model and controller.</p>
<p>Open the file <strong>config/routes.rb</strong>. Replace the contents with this:</p>
<p>Rails.application.routes.draw do
  root to: 'visitors#new'
end</p>
<p>Any request to the application root (<a href="http://localhost:3000/">http://localhost:3000/</a>) will be directed to the VisitorsController <code>new</code> action.</p>
<p>Don’t be overly concerned about understanding the exact syntax of the code. It will become familiar soon and you can look up the details in the reference documentation, <a href="http://guides.rubyonrails.org/routing.html">RailsGuides: Routing from the Outside In</a>.</p>
<p>In general, when you change a configuration file you must restart your application server. However, the <strong>config/routes.rb</strong> file is an exception. You don’t need to restart the server after changing routes.</p>
<p>If you need to start the server:</p>
<p>$ rails server</p>
<p>Visit the page <a href="http://localhost:3000">http://localhost:3000/</a>. You’ll see an error message because we haven’t implemented the controller. The error message, “uninitialized constant VisitorsController,” means Rails is looking for a VisitorsController and can’t find it.</p>
<h2 id="136-model"><a href="#cid93">13.6 Model</a></h2>
<p>Most Rails models obtain data from a database. When you use a database, you can use the <code>rails generate model</code> command to create a model that inherits from the ActiveRecord class and knows how to connect to a database.</p>
<p>To keep things simple, our tutorial application doesn’t need a database. Instead of inheriting from ActiveRecord, we create a Ruby class with methods that return the owner’s name, birthdate, and days remaining until his birthday. This simple class provides an easy introduction to Ruby code.</p>
<p>Create a file <strong>app/models/owner.rb</strong> (don’t include the colon punctuation that follows):</p>
<p>class Owner</p>
<p>def name
    name \= 'Foobar Kadigan'
  end</p>
<p>def birthdate
    birthdate \= Date.new(1990, 12, 22)
  end</p>
<p>def countdown
    today \= Date.today
    birthday \= Date.new(today.year, birthdate.month, birthdate.day)
    if birthday > today
      countdown \= (birthday - today).to_i
    else
      countdown \= (birthday.next_year - today).to_i
    end
  end</p>
<p>end</p>
<p>This is your first close look at Ruby code. The oddest thing you’ll see is the owner’s name, “Foobar Kadigan.” Everything else will make sense with a bit of explanation.</p>
<p>Keep in mind that we are using a text file to create an abstraction that we can manipulate in the computer’s memory. Software architects call these abstractions <em>objects</em>. In Ruby, everything we create and manipulate is an <em>object</em>. To distinguish one object from another, we define it as a <em>class</em>, give it a <em>class name</em>, and add behavior in the form of <em>methods</em>.</p>
<p>The first line <code>class Owner</code> defines the class and assigns a name. At the very end of the file, the <code>end</code> keyword completes the class definition.</p>
<p>We define three methods, starting with <code>def</code> (for “method definition”) and ending with <code>end</code>.</p>
<ul>
<li><code>def name</code> … <code>end</code></li>
<li><code>def birthdate</code> … <code>end</code></li>
<li><code>def countdown</code> … <code>end</code></li>
</ul>
<p>Each method contains simple Ruby code that assigns data to a variable. Later, we’ll retrieve the data for use in our view file by <em>instantiating</em> the class and <em>calling</em> a method. Don’t be discouraged by the software architects’ terminology; the concepts are simple and we’ll soon see everything in action.</p>
<p>Ruby makes it easy for a method to <em>return</em> data when called; the value assigned by the last statement will be delivered when the method is called.</p>
<p>Looking more closely at the Ruby code inside the method definitions, you’ll see Ruby uses the <code>=</code> (equals) sign to assign values to a variable. The variable is named on the left side of the equals sign; a value is assigned on the right side. We call the equals sign an <em>assignment operator</em>.</p>
<p>We can assign any value to a variable, including a <em>string</em> (a series of characters that can be a word or name) such as “Foobar Kadigan.” Ruby recognizes a string when characters are enclosed in single or double quotes. Not surprisingly, a number also can be assigned to a variable, either a whole number (an <em>integer</em>) or a decimal fraction (a <em>float</em>).</p>
<p>More interestingly, any Ruby object can be assigned to a variable. That helps us “move around” any object very easily, giving us access to the object’s class methods anywhere we use the variable. We can create our own objects, as we have by creating the Owner class. Or we can use the library of objects that are supplied with Ruby. Ruby’s prefabricated objects are defined by the Ruby API (<em>application programming interface</em>); essentially the API is a catalog of prebuilt classes that are building blocks for any application. The Rails API gives us additional classes that are useful for web applications. Learning the syntax of Ruby code gets you started with Ruby programming; knowing the API classes leads to mastery of Ruby.</p>
<p>The <code>Date</code> class is provided by the Ruby API. It is described in the <a href="http://apidock.com/ruby/Date">Ruby API reference documentation</a>. The <code>Date</code> class has a <code>Date.new</code> method which <em>instantiates</em> (creates) a new date when supplied with year, month, and day <em>parameters</em>. You can see this syntax when we assign <code>Date.new(1990, 12, 22)</code> to the <code>birthdate</code> variable.</p>
<p>Note that Ruby has specific expectations about the syntax of numbers. The <code>Date.new(...)</code> method expects integers. Imagine a September birthday. You must use <code>Date.new(1990, 9, 22)</code>. If you enter a date in the format <code>Date.new(1990, 09, 22)</code>, you’ll get a syntax error “Invalid octal digit” when you test the application. Ruby expects numbers that begin with zero to be <a href="https://en.wikipedia.org/wiki/Octal">octal numbers</a>; you’ll get an error because octal numbers can’t contain the digit “9.”</p>
<p>Our <code>countdown</code> method contains the most complex code in the class.</p>
<p>First, we set a variable <code>today</code> with today’s date. The <code>Date.today</code> method creates an object that represents the current date. When the <code>Date.today</code> method is called, Ruby gets the current date from the computer’s system clock.</p>
<p>Next we create a <code>birthday</code> variable and assign a new date that combines today’s year with the month and day of the <code>birthdate</code>. This gives us the date of Foobar Kadigan’s birthday this year.</p>
<p>The <code>Date</code> class can perform complex calendar arithmetic. The variables <code>birthdate</code> and <code>today</code> are <em>instances</em> of the <code>Date</code> class. We can use a greater-than operator to determine if Foobar Kadigan’s birthday is in the future or the past.</p>
<p>The <code>if ... else ... end</code> structure is a <em>conditional statement</em>. If the birthday is in the future, we subtract <code>today</code> from <code>birthday</code> to calculate the number of days remaining until the owner’s birthday, which we assign to the <code>countdown</code> variable.</p>
<p>If the birthday has already passed, we apply a <code>next_year</code> method to the birthday to get next year’s birthday. Then we subtract <code>today</code> from <code>birthday.next_year</code> to calculate the number of days remaining until the owner’s birthday, which we assign to the <code>countdown</code> variable.</p>
<p>The result might be fractional so we use the utility method <code>to_i</code> to convert the result to a whole number (integer) before assigning it to the <code>countdown</code> variable.</p>
<p>This shows you the power of programming in Ruby. Notice that I needed 16 paragraphs and over 600 words to explain 15 short lines of code. We used only seven Ruby abstractions but they represent thousands of lines of code in the Ruby language implementation. With knowledge of Ruby syntax and the Ruby API, a few short lines of code in a text file gives us amazing ability.</p>
<p>In an upcoming chapter, we’ll look more closely at the syntax and keywords of the Ruby language. But without knowing more than this, we can build a simple web application.</p>
<p>Let’s see how we can put this functionality to use on a web page.</p>
<h2 id="137-view"><a href="#cid94">13.7 View</a></h2>
<p>The Owner model provides the data we want to see on the Home page.</p>
<p>We’ll create the markup and layout in a View file and add variables that present the data.</p>
<p>View files go in folders in the <strong>app/views/</strong> directory. In a typical application, one controller can render multiple views, so we make a folder to match each controller. You can make a new folder using your file browser or text editor. Or use the Unix <code>mkdir</code> command:</p>
<p>$ mkdir app/views/visitors</p>
<p>Create a file <strong>app/views/visitors/new.html.erb</strong> (don’t include the colon punctuation that follows):</p>
<h3>Home</h3>
<p>Welcome to the home of <%= @owner.name %>.</p>
<p>I was born on <%= @owner.birthdate %>.</p>
<p>Only <%= @owner.countdown %> days until my birthday!</p>

<p>We’ve created a <strong>visitors/</strong> folder within the <strong>app/views/</strong> directory. We have only a single <code>new</code> view but if we had more views associated with the Visitors controller, they’d go in the <strong>app/views/visitors/</strong> folder.</p>
<p>We name our View file <strong>new.html.erb</strong>, adding the <strong>.erb</strong> file extension so that Rails will use the ERB templating engine to interpret the markup.</p>
<p>There are several syntaxes that can be used for a view file. In this tutorial, we’ll use the ERB syntax that is most commonly used by beginners. Some experienced developers prefer to add gems that provide the <a href="https://railsapps.github.io/rails-haml.html">Haml</a> or <a href="http://slim-lang.com/">Slim</a> templating engines. As you might guess, a View that uses the Haml templating syntax would be named <strong>new.html.haml</strong>.</p>
<p>Our HTML markup is minimal, using only the <code>&lt;h3&gt;</code> and <code>&lt;p&gt;</code> tags. The only ERB markup we add are the <code>&lt;%= ... %&gt;</code> delimiters. This markup allows us to insert Ruby code which will be replaced by the result of evaluating the code. In other words, <code>&lt;%= @owner.name %&gt;</code> will appear on the page as Foobar Kadigan.</p>
<p>You may have noticed that we refer to the Owner model with the variable <code>@owner</code>. It will be clear when we create the Visitors controller why we use this syntax (a variable name that begins with the <code>@</code> character is called an <em>instance variable</em>).</p>
<p>Obviously, if all we wanted to do was include the owner’s name on the page, it would be easier to simply write the text. The Rails implementation becomes useful if the name is retrieved from a database or created programmatically.</p>
<p>We can better see the usefulness of the Owner model when we look at the use of <code>&lt;= @owner.countdown %&gt;</code>. There is no way to display a calculation using only static HTML, so Rails gives us a way to display the birthday countdown calculation.</p>
<p>If you’re a programmer, you might wonder why we only output the variable on the page. Since we can use ERB to embed any Ruby code, we could perform the calculation right on the page by embedding <code>&lt;%= (Date.new(today.year, @owner.birthdate.month, @owner.birthdate.day) - Date.today).to_i %&gt;</code>. If you’ve used JavaScript or PHP, you may have performed calculations like this, right on the page. Rails would allow us to do so, but the practice violates the “separation of concerns” principle that encourages us to perform complex calculations in a model and only display data in the view.</p>
<p>Before we can display the home page, we need to create the Visitors controller.</p>
<h2 id="138-controller"><a href="#cid95">13.8 Controller</a></h2>
<p>The Visitors controller is the glue that binds the Owner model with the VisitorsController#new view.</p>
<p><em>Note:</em> When we refer to a controller action, we use the notation “VisitorsController#new,” joining the controller class name with the action (method) that renders a page. In this context, the <code>#</code> character is only a documentation convention.</p>
<p><em>Note:</em> <code>VisitorsController</code> will be the class name and <strong>visitors_controller.rb</strong> will be the filename. The class name is written in <a href="https://en.wikipedia.org/wiki/CamelCase">camelCase</a> (with a hump in the middle, like a camel) so we can combine two words without a space.</p>
<p>Unix commands get messy when filenames include spaces so we create a filename that combines two words with an underscore (sometimes called “snake_case”).</p>
<p>Create a file <strong>app/controllers/visitors_controller.rb</strong> (don’t include the colon punctuation that follows):</p>
<p>class VisitorsController &lt; ApplicationController</p>
<p>def new
    @owner \= Owner.new
  end</p>
<p>end</p>
<p>We define the class and name it <code>class VisitorsController</code>, inheriting behavior from the ApplicationController class which is defined in the Rails API.</p>
<p>We only need to define the <code>new</code> method. We create an <em>instance variable</em> named <code>@owner</code> and assign an instance of the Owner model. Any instance variables (variables named with the <code>@</code> character) will be available in the corresponding view file.</p>
<p>If we don’t instantiate the Owner model, we’ll get an error when the controller <code>new</code> action attempts to render the view because we use the <code>@owner</code> instance in the view file.</p>
<p>Keep in mind the purpose of the controller. Each controller action (method) responds to a request by obtaining a model (if data is needed) and rendering a view.</p>
<p>You’ve already created a view file in the <strong>app/views/visitors</strong> folder. The <code>new</code> action of the VisitorsController renders the template <strong>app/views/visitors/new.html.erb</strong>.</p>
<p>The <code>new</code> method is deceptively simple. Hidden behavior inherited from the ApplicationController does all the work of rendering the view. We can make the hidden code explicit if we wish to. It would look something like this:</p>
<p>class VisitorsController &lt; ApplicationController</p>
<p>def new</p>
<pre><code>@owner \= Owner.new
render 'visitors/new'
</code></pre>
<p>end</p>
<p>end</p>
<p>This is an example of Rails magic. Some developers complain this is black magic because the “convention over configuration” principle leads to obscurity. Rails often offers default behavior that looks like magic because the underlying implementation is hidden in the depths of the Rails code library. This can be frustrating when, as a beginner, you want to understand what’s going on.</p>
<p>Revealing the hidden code, we see that invoking the <code>new</code> method calls a <code>render</code> method supplied by the ApplicationController parent class. The <code>render</code> method searches in the <strong>app/views/visitors</strong> directory for a view file named <strong>new</strong> (the file extension <strong>.html.erb</strong> is assumed by default). The code underlying the <code>render</code> method is complex. Fortunately, all we need to do is define the method and instantiate the Owner model. Rails takes care of the rest.</p>
<p>As a beginner, simply accept the magic and don’t confound yourself trying to find how it works. As you gain experience, you can dive into the Rails source code to unravel the magic.</p>
<h2 id="139-scaffolding"><a href="#cid96">13.9 Scaffolding</a></h2>
<p>This tutorial aims to give you a solid foundation in basic concepts. The model–view–controller pattern is one of the most important. I’ve found the best way to understand model–view–controller architecture is to create and examine the model, view, and controller files.</p>
<p>As you continue your study of Rails, you’ll find other tutorials that use the <em>scaffolding</em> shortcut. For example, <a href="http://guides.rubyonrails.org/getting_started.html">Rails Guides: Getting Started with Rails</a> includes a section “Getting Up and Running Quickly with Scaffolding” which shows how to use the <code>rails generate scaffold</code> command to create model, view, and controller files in a single operation. Students often use scaffolding to create simple Rails applications.</p>
<p>In practice, I’ve observed that working Rails developers seldom use scaffolding. There’s nothing wrong with it; it just seems that scaffolding doesn’t offer much that can’t be done as quickly by hand.</p>
<h2 id="1310-test-the-application"><a href="#cid97">13.10 Test the Application</a></h2>
<p>We’ve created a model, view, and controller. Now let’s run the application.</p>
<p>Enter the command:</p>
<p>$ rails server</p>
<p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>. You’ll see our new home page.</p>
<p><img alt="images/figures/learn-rails-42-home" src="http://learn-rails.com/images/figures/learn-rails-2/learn-rails-42-home.png" /></p>
<p>Figure 13.1: Dynamic home page shows days until a birthday.</p>
<p>It’s a very simple web page but it uses Ruby to calculate the countdown to the birthday. And the underlying code conforms to the conventions and structure of Rails.</p>
<h2 id="1311-git"><a href="#cid98">13.11 Git</a></h2>
<p>At this point, you might have the Rails server running in your console window. We’re going to run a git command in the console now.</p>
<p>You might think you have to enter Control-c to shut down the server and get the command prompt. But that’s not necessary. You can open more than one console view. Your terminal application lets you open multiple windows or tabs. If you open multiple tabs, you can easily switch between console views without using a lot of screen real estate. If you haven’t tried it, now is a good time. On the Mac, Command+t opens a new tab in the terminal application. It is convenient to have a console tab open for the server and another for various Unix commands.</p>
<p>Let’s commit our changes to the Git repository and push to GitHub:</p>
<p>$ git add -A
$ git commit -m "dynamic home page"
$ git push</p>
<p>Now let’s take a look at troubleshooting.</p>
<h1 id="chapter-14-troubleshoot"><a href="#cid99">Chapter 14 Troubleshoot</a></h1>
<p>In the last chapter, we built a dynamic home page and learned about the model–view–controller architecture of Rails. There was a lot to learn, but the code was simple, and I hope it worked the first time you tried it.</p>
<p>Before we do any more work on our tutorial application, we need to learn about troubleshooting and debugging. As a software developer, you’ll spend a lot of time with code that doesn’t work. You’ll need tools and techniques to diagnose problems.</p>
<h2 id="141-git"><a href="#cid100">14.1 Git</a></h2>
<p>In this chapter we’ll make changes to the application just for troubleshooting.</p>
<p>Before you get started, make sure the work you’ve done is committed to your git repository. Use the <code>git status</code> command to check:</p>
<p>$ git status</p>
<p>You should see:</p>
<p>On branch master
nothing to commit, working directory clean</p>
<p>If <code>git status</code> reports any uncommitted changes, go back to the last step in the previous chapter and commit your work to the git repository before continuing. At the end of this chapter, we’re going to throw away the work we’ve done in this chapter. We don’t want to accidentally throw away work from the previous chapter so make sure it is committed to the repository.</p>
<h2 id="142-interactive-ruby-shell"><a href="#cid101">14.2 Interactive Ruby Shell</a></h2>
<p>There will be times when you want to try a snippet of Ruby code just to see if it works. Your tool will be IRB, the Interactive Ruby shell.</p>
<p>IRB is a Ruby interpreter that runs from the command line. It executes any Ruby code and provides an immediate response, allowing you to experiment in real-time.</p>
<p>Let’s try it.</p>
<p>$ irb
>></p>
<p>The command <code>irb</code> launches the program and displays a prompt that shows your Ruby version, a line number, and an arrow. I’ll just show a simple prompt in the examples, instead.</p>
<p>If you enter a valid Ruby expression, the interpreter will display the result of evaluating the expression.</p>
<p>Try simple arithmetic:</p>
<p>>> n \= 2
 =&gt; 2
>> n + 2
 =&gt; 4</p>
<p>Wow! You are using your computer for simple math. Maybe you can delete the calculator app from your phone.</p>
<p>IRB will evaluate any Ruby expression and helps you quickly determine if syntax and logic is correct.</p>
<h3 id="1421-irb-for-blocks-of-code"><a href="#uid202">14.2.1 IRB for Blocks of Code</a></h3>
<p>At first glance, it appears IRB works on just one line of code.</p>
<p>Actually, IRB can handle multiple lines of code. Try it:</p>
<p>>> n \= 10
\=&gt; 10
>> if n &lt; 10
>>   puts "small"
>> else
?&gt;   puts "big"
>> end
big
\=&gt; nil
>></p>
<p>Here we set <code>n = 10</code> and then enter a conditional statement line-by-line. After we enter the final <code>end</code>, IRB interprets the code and outputs the result.</p>
<p>You’ll often enter more than one line of code in IRB. If you find yourself frustrated because you’ve entered typos and had to enter the same code repeatedly, you can use IRB to load code you’ve saved in a file:</p>
<p>>> load './mytest.rb'</p>
<h3 id="1422-quitting-irb"><a href="#uid203">14.2.2 Quitting IRB</a></h3>
<p>It can be very frustrating to find you are stuck inside IRB. Unlike most shell commands, you can’t quit with Control-c. Enter Control-d or type <code>exit</code> to quit IRB:</p>
<p>$ irb
>> exit</p>
<h3 id="1423-learn-more-about-irb"><a href="#uid204">14.2.3 Learn More About IRB</a></h3>
<p>Here’s an entertaining way to learn about IRB:</p>
<ul>
<li><a href="http://poignant.guide/book/expansion-pak-1.html">Why’s (Poignant) Guide to Ruby (with a Basic Introduction to IRB)</a></li>
</ul>
<p>Here’s a more conventional way to learn about IRB:</p>
<ul>
<li><a href="http://ruby-doc.com/docs/ProgrammingRuby/html/irb.html">The Pragmatic Programmer’s Guide</a></li>
</ul>
<h3 id="1424-beyond-irb"><a href="#uid207">14.2.4 Beyond IRB</a></h3>
<p>If you ask experienced Rails developers for help with IRB, they’ll often recommend you switch to Pry. <a href="http://pryrepl.org/">Pry</a> is a powerful alternative to the standard IRB shell for Ruby. As you gain experience, you might take a look at Pry to see what the enthusiasm is all about. But for now, as a beginner trying out a few lines of Ruby code, there’s no need to learn Pry.</p>
<h2 id="143-rails-console"><a href="#cid102">14.3 Rails Console</a></h2>
<p>IRB only evaluates expressions that are defined in the Ruby API. IRB doesn’t know Rails.</p>
<p>It’d be great to have a tool like IRB that evaluates any expression defined in the Rails API. The tool exists; it’s called the Rails console. It is particularly useful because it loads your entire Rails application. Your application will be running as if the application was waiting to respond to a web request. Then you can expose behavior of any pieces of the web application.</p>
<p>$ rails console
...
Loading development environment (Rails 5.x.x)
>></p>
<p>The Rails console behaves like IRB but loads your Rails development environment. The prompt shows it is ready to evaluate an expression.</p>
<p>Let’s use the Rails console to examine our Owner model:</p>
<p>>> myboss \= Owner.new
 =&gt; #<Owner:0x007fc18e91faf8></p>
<p>We’ve created a variable named <code>myboss</code> and created a new instance of the Owner class. The Rails console responds by displaying the unique identifier it uses to track the object. The identifier is not particularly useful, except to show that something was created.</p>
<p>If you’re unsure about the difference between an <em>instance</em> and a <em>class</em>, we’ve just seen that we can make one or more instances of a class by calling the <code>Owner.new</code> method. When we specify the <code>Owner</code> class, the class definition is loaded into the computer’s working memory (our development environment) from the class definition file on disk. Then we can use the <code>Owner.new</code> method to make one or more instances of the <code>Owner</code> class. Each instance is a unique object with its own data attributes but the same behavior as other objects instantiated from its class.</p>
<p>Let’s assign the name of our boss to a variable called <code>name</code>:</p>
<p>>> name \= myboss.name
 =&gt; "Foobar Kadigan"</p>
<p>Our variable <code>myboss</code> is an instance of an <code>Owner</code> class so it responds to the method <code>Owner.name</code> by returning the owner’s name.</p>
<p>We want to show respect to our boss so we’ll perform some <em>string manipulation</em>:</p>
<p>>> name \= 'Mr. ' + name
 =&gt; "Mr. Foobar Kadigan"</p>
<p>We’re done for now. When we quit the Rails console or shut down the computer the <code>Owner</code> class definition remains stored on disk but the instances disappear. The bits that were organized to create the variable <code>name</code> will evaporate into the ether.</p>
<p>Actually, the bits are still there, in the form of logic states in the computer’s chips, but they have no meaning until another program uses them.</p>
<p>Enter Control-d or type <code>exit</code> to quit the Rails console.</p>
<p>The Rails console is a useful utility. It is like a handy calculator for your code. Use it when you need to experiment or try out short code snippets.</p>
<h2 id="144-rails-logger"><a href="#cid103">14.4 Rails Logger</a></h2>
<p>As you know, a Rails application sends output to the browser that makes a web request. On every request, it also sends diagnostic output to the <em>server log file</em>. Depending on whether the application is running in the development environment or in production, the log file is here:</p>
<ul>
<li><strong>log/development.log</strong></li>
<li><strong>log/production.log</strong></li>
</ul>
<p>In development, everything written to the log file appears in the console window after you run the <code>rails server</code> command. Scrolling the console window is a good way to see diagnostics for every request.</p>
<p>Here’s what you see in the log after you visit the application home page:</p>
<p>Started GET "/" for ::1 at ...
Processing by VisitorsController#new as HTML
 Rendering visitors/new.html.erb within layouts/application
 Rendered visitors/new.html.erb within layouts/application (6.6ms)
Completed 200 OK in 650ms (Views: 634.4ms | ActiveRecord: 0.0ms)</p>
<p>You may have more than one console window open in the terminal application. If you don’t see your log output in your terminal, check if you have tabs with other windows.</p>
<p>Here’s the best part. You can add your own messages to the log output by using the Rails logger. Let’s try it out.</p>
<p>Modify the file <strong>app/controllers/visitors_controller.rb</strong>:</p>
<p>class VisitorsController &lt; ApplicationController</p>
<p>def new
    Rails.logger.debug 'DEBUG: entering new method'
    @owner \= Owner.new
    Rails.logger.debug 'DEBUG: Owner name is ' + @owner.name
  end</p>
<p>end</p>
<p>Visit the home page again and you’ll see this in the console output:</p>
<p>Started GET "/" for ::1 at ...
Processing by VisitorsController#new as HTML
DEBUG: entering new method
DEBUG: Owner name is Foobar Kadigan
 Rendering visitors/new.html.erb within layouts/application
 Rendered visitors/new.html.erb within layouts/application (1.1ms)
Completed 200 OK in 81ms (Views: 72.2ms | ActiveRecord: 0.0ms)</p>
<p>If you really needed to do so, you could add a logger statement at every step in the application. You could see how the application behaves, step by step. And you could “print” the value of every variable at every step. You’ll never need diagnostics at this level of detail in Rails, but the logger is extremely useful when you are trying to understand unexpected behavior.</p>
<p>Let’s add logger statements to the <code>Owner</code> model. Modify the file <strong>app/models/owner.rb</strong>:</p>
<p>class Owner</p>
<p>def name
    name \= 'Foobar Kadigan'
  end</p>
<p>def birthdate
    birthdate \= Date.new(1990, 12, 22)
  end</p>
<p>def countdown
    Rails.logger.debug 'DEBUG: entering Owner countdown method'
    today \= Date.today
    birthday \= Date.new(today.year, birthdate.month, birthdate.day)
    if birthday > today
      countdown \= (birthday - today).to_i
    else
      countdown \= (birthday.next_year - today).to_i
    end
  end</p>
<p>end</p>
<p>We added the <code>Rails.logger.debug</code> statement to the <code>Owner.countdown</code> method.</p>
<p>Visit the home page and here’s what you’ll see in the console output:</p>
<p>Started GET "/" for ::1 at ...
Processing by VisitorsController#new as HTML
DEBUG: entering new method
DEBUG: Owner name is Foobar Kadigan
 Rendering visitors/new.html.erb within layouts/application
DEBUG: entering Owner countdown method
 Rendered visitors/new.html.erb within layouts/application (0.7ms)
Completed 200 OK in 69ms (Views: 61.1ms | ActiveRecord: 0.0ms)</p>
<p>You’ll often need to “get inside” the model or controller to see what’s happening. The Rails logger is the best tool for the job.</p>
<p>Here are some tricks for the Rails logger.</p>
<p>In a controller, you can use the method <code>logger</code> on its own. In a model, you have to write <code>Rails.logger</code> (both class and method).</p>
<p>You can use any of the methods <code>logger.debug</code>, <code>logger.info</code>, <code>logger.warn</code>, <code>logger.error</code>, or <code>logger.fatal</code> to write log messages. By default, you’ll see any of these messages in the development log. Log messages written with the <code>logger.debug</code> method will not be recorded in a production log file.</p>
<p>If you want your log messages to stand out, you can add formating code for color:</p>
<p>Rails.logger.debug "\033[1;34;40m[DEBUG]\033[0m " + 'will appear in bold blue'</p>
<p>For more about the Rails logger, see the <a href="http://guides.rubyonrails.org/debugging_rails_applications.html">RailsGuide: Debugging Rails Applications</a>.</p>
<h2 id="145-revisiting-the-request-response-cycle"><a href="#cid104">14.5 Revisiting the Request-Response Cycle</a></h2>
<p>Earlier, when we investigated the request-response cycle, we looked in the server log to see the response to the web browser request.</p>
<p>Now, with debug statements in the controller and model, we’ll see messages showing the server’s traverse of the model-view-controller architecture.</p>
<p>Started GET "/" for ::1 at ...
Processing by VisitorsController#new as HTML
DEBUG: entering new method
DEBUG: Owner name is Foobar Kadigan
 Rendering visitors/new.html.erb within layouts/application
DEBUG: entering Owner countdown method
 Rendered visitors/new.html.erb within layouts/application (0.7ms)
Completed 200 OK in 69ms (Views: 61.1ms | ActiveRecord: 0.0ms)</p>
<p>Notice how the diagnostic messages in the console window match the headers in the browser Developer Tools view. The browser’s “Request Method:GET” matches the server’s “Started GET.” The browser’s “Status Code: 200” matches the server’s “Completed 200 OK” (you might have to clear the browser’s cache if the browser is showing “304 Not Modified”).</p>
<p>We can see evidence of the model-view-controller architecture. “Processing by VisitorsController#new” shows the program flow entering the controller. Our debug statements show we enter the <code>new</code> method and reveal the value of the Owner name. The next debug statement reveals the flow has passed to the Owner model. A diagnostic message shows the controller has rendered the <strong>visitors/new.html.erb</strong> view file. Finally, the “Completed 200 OK” message indicates the response has been sent to the browser.</p>
<p>As we learned, the model-view-controller architecture is an abstract design pattern. We’ve seen it reflected in the file structure of the Rails application directory. Now we can see it as activity in the server log.</p>
<h2 id="146-the-stack-trace"><a href="#cid105">14.6 The Stack Trace</a></h2>
<p>The Rails logger is extremely useful if you want to insert messages to show program flow or display variables. But there will be times when program flow halts and the console displays a <em>stack trace</em>.</p>
<p>Let’s deliberately create an error condition and see an error page and stack trace.</p>
<p>Modify the file <strong>app/controllers/visitors_controller.rb</strong>:</p>
<p>class VisitorsController &lt; ApplicationController</p>
<p>def new
    Rails.logger.debug 'DEBUG: entering new method'
    @owner \= Owner.new
    Rails.logger.debug 'DEBUG: Owner name is ' + @owner.name
    DISASTER
  end</p>
<p>end</p>
<p>Visit the home page and you’ll see an error page:</p>
<p><img alt="images/figures/learn-rails-43-error" src="http://learn-rails.com/images/figures/learn-rails-2/learn-rails-43-error.png" /></p>
<p>Figure 14.1: Error page.</p>
<p>You’ll see this error page because we’ve installed the <a href="https://github.com/charliesome/better_errors">better_errors</a> gem. Without the better_errors gem, you’d see the default Rails error page which is quite similar.</p>
<p>In the console log, the stack trace will show everything that happens before Rails encounters the error:</p>
<p>Started GET "/" for ::1 at ...
Processing by VisitorsController#new as HTML
DEBUG: entering new method
DEBUG: Owner name is Foobar Kadigan
Completed 500 Internal Server Error in 8ms (ActiveRecord: 0.0ms)</p>
<p>NameError - uninitialized constant VisitorsController::DISASTER:
 app/controllers/visitors_controller.rb:7:in `new'
 .
 .
 .</p>
<p>To save space, I’m only showing the top line of the stack trace. I’ve eliminated about sixty lines from the stack trace.</p>
<p>Don’t feel bad if your reaction to a stack trace is an immediate, “TMI!” Indeed, it is usually Too Much Information. There are times when it pays to carefully read through the stack trace line by line, but most often, only the top line of the stack trace is important.</p>
<p>In this case, both the error page and the top line of the stack trace show the application failed (I prefer to say, “barfed”) when it encountered an “uninitialized constant” at line 7 of the <strong>app/controllers/visitors_controller.rb</strong> file in the <code>new</code> method. It’s easy to find line 7 in the file and see that is exactly where we added a string that Rails doesn’t understand.</p>
<p>The point of this exercise is to encourage you to read the top line of the stack trace and use it to diagnose the problem. I’m always surprised how many developers ignore the stack trace, probably because it looks intimidating.</p>
<h2 id="147-raising-an-exception"><a href="#cid106">14.7 Raising an Exception</a></h2>
<p>As you just saw, you can purposefully break your application by adding characters that Rails doesn’t understand. However, there is a better way to force your program to halt, called <em>raising an exception</em>.</p>
<p>Let’s try it. Modify the file <strong>app/controllers/visitors_controller.rb</strong>:</p>
<p>class VisitorsController &lt; ApplicationController</p>
<p>def new
    Rails.logger.debug 'DEBUG: entering new method'
    @owner \= Owner.new
    Rails.logger.debug 'DEBUG: Owner name is ' + @owner.name
    raise 'Deliberate Failure'
  end</p>
<p>end</p>
<p>You can throw an error by using the <code>raise</code> keyword from the Ruby API. You can provide any error message you’d like in quotes following <code>raise</code>.</p>
<p>Here’s the console log after you try to visit the home page:</p>
<p>Started GET "/" for ::1 at ...
Processing by VisitorsController#new as HTML
DEBUG: entering new method
DEBUG: Owner name is Foobar Kadigan
Completed 500 Internal Server Error in 6ms (ActiveRecord: 0.0ms)</p>
<p>RuntimeError - Deliberate Failure:
 app/controllers/visitors_controller.rb:7:in `new'
 .
 .
 .</p>
<p>Before we continue, let’s remove the deliberate failure. Modify the file <strong>app/controllers/visitors_controller.rb</strong>:</p>
<p>class VisitorsController &lt; ApplicationController</p>
<p>def new
    Rails.logger.debug 'DEBUG: entering new method'
    @owner \= Owner.new
    Rails.logger.debug 'DEBUG: Owner name is ' + @owner.name
  end</p>
<p>end</p>
<p>Rails and the Ruby API provide a rich library of classes and methods to raise and handle exceptions. For example, you might want to display an error if a user enters a birthdate that is not in the past. Rails includes various exception handlers to display errors in production so users will see a helpful web page explaining the error.</p>
<h2 id="148-git"><a href="#cid107">14.8 Git</a></h2>
<p>There’s no need to save any of the changes we made for troubleshooting.</p>
<p>You could go to each file and carefully remove the debugging code you added. But there’s an easier way.</p>
<p>Check which files have changed:</p>
<p>$ git status</p>
<h1 id="changes-not-staged-for-commit">Changes not staged for commit:</h1>
<h1 id="use-git-add-to-update-what-will-be-committed">(use "git add ..." to update what will be committed)</h1>
<h1 id="use-git-checkout-to-discard-changes-in-working-directory">(use "git checkout -- ..." to discard changes in working directory)</h1>
<h1 id="_2"></h1>
<h1 id="modified-appcontrollersvisitors_controllerrb">modified:   app/controllers/visitors_controller.rb</h1>
<h1 id="modified-appmodelsownerrb">modified:   app/models/owner.rb</h1>
<h1 id="_3"></h1>
<p>no changes added to commit (use "git add" and/or "git commit -a")</p>
<p>Use Git to revert your project to the most recent commit:</p>
<p>$ git reset --hard HEAD</p>
<p>The Git command <code>git reset –hard HEAD</code> discards any changes you’ve made since the most recent commit. Check the status to make sure:</p>
<p>$ git status</p>
<h1 id="on-branch-master">On branch master</h1>
<p>nothing to commit, working directory clean</p>
<p>We’ve cleaned up after our troubleshooting exercise.</p>
<h1 id="chapter-15-just-enough-ruby"><a href="#cid108">Chapter 15 Just Enough Ruby</a></h1>
<p>Experienced Rails developers debate whether beginners should study Ruby before learning Rails.</p>
<p>By all means, if you love the precision and order of programming languages, dive into the study of Ruby from the beginning. But most people don’t delay starting Rails while learning Ruby; realistically, you’ll retain more knowledge of Ruby if you learn it as you build things in Rails. That is the approach we’ve taken in this book. You’ve already built a simple Rails application and used Ruby as you did so.</p>
<h2 id="151-reading-knowledge-of-ruby"><a href="#cid109">15.1 Reading Knowledge of Ruby</a></h2>
<p>What you need, more than anything, when you start working with Rails, is reading knowledge of Ruby.</p>
<p>With a reading knowledge of Ruby you’ll avoid feeling overwhelmed or lost when you encounter code examples or work through a tutorial. Later, as you tackle complex projects and write original code, you’ll need to know enough of the Ruby language to implement the features you need. But as a student, you’ll be following tutorials that give you all the Ruby you need. Your job is to recognize the language keywords and use the correct syntax when you type Ruby code in your text editor.</p>
<p>To that end, this chapter will review the Ruby keywords and syntax you’ve already learned. And you’ll extend your knowledge so you’ll be prepared for the Ruby you’ll encounter in upcoming chapters.</p>
<h2 id="152-ruby-example"><a href="#cid110">15.2 Ruby Example</a></h2>
<p>To improve your reading knowledge of Ruby, we’ll work with an example file that contains a variety of Ruby expressions.</p>
<p>We won’t use this file in our tutorial application, so you’ll delete it at the end of this chapter. But we’ll approach it as real Ruby code, so make a file and copy the code using your text editor.</p>
<p>First we have to consider where the file should go. It will not be a model, view, controller, or any other standard component of Rails. Rails has a place for miscellaneous files that don’t fit in the Rails API. We’ll create the file in the <strong>lib/</strong> folder. That’s the folder you’ll use for any supporting Ruby code that doesn’t fit elsewhere in the Rails framework.</p>
<p>Create a file <strong>lib/example.rb</strong>:</p>
<p>class Example &lt; Object</p>
<p># This is a comment.</p>
<p>attr_accessor :honorific
  attr_accessor :name
  attr_accessor :date</p>
<p>def initialize(name,date)
    @name \= name
    @date \= date.nil? ? Date.today : date
  end</p>
<p>def backwards_name
    @name.reverse
  end</p>
<p>def to_s
    @name
  end</p>
<p>def titled_name
    @honorific ||= 'Esteemed'
    titled_name \= "#{@honorific} #{@name}"
  end</p>
<p>def december_birthdays
    born_in_december \= [ ]
    famous_birthdays.each do |name, date|
      if date.month \== 12
        born_in_december &lt;&lt; name
      end
    end
    born_in_december
  end</p>
<p>private</p>
<p>def famous_birthdays
    birthdays \= {
      'Ludwig van Beethoven' \=&gt; Date.new(1770,12,16),
      'Dave Brubeck' \=&gt; Date.new(1920,12,6),
      'Buddy Holly' \=&gt; Date.new(1936,9,7),
      'Keith Richards' \=&gt; Date.new(1943,12,18)
    }
  end</p>
<p>end</p>
<p>In some ways, this Ruby code is like a poem from Lewis Carroll:</p>
<p>'Twas brillig, and the slithy toves
Did gyre and gimble in the wabe;
All mimsy were the borogoves,
And the mome raths outgrabe.</p>
<p>"Beware the Jabberwock, my son!
The jaws that bite, the claws that catch!
Beware the Jubjub bird, and shun
The frumious Bandersnatch!"</p>
<p>The poem corresponds to the rules of English syntax but is nonsense.</p>
<p>The code follows the rules of Ruby syntax, and unlike the poem, uses meaningful words. But it is unclear how the author intends anyone to use the code. If you’re beginning a career as a Rails developer, this won’t be the last time you look at code and wonder what the author was intending. In this case, I just want to give you some code that illustrates typical Ruby syntax and structure.</p>
<h2 id="153-ruby-keywords"><a href="#cid111">15.3 Ruby Keywords</a></h2>
<p>When reading Ruby code, the first challenge is determining which words are Ruby keywords and which were made up by the developer. Code is only strings of characters. But some strings have special meaning for everyone and all others are arbitrary words that only have meaning to an individual developer.</p>
<p>As you gain experience, you’ll recognize Ruby keywords because you’ve seen them before.</p>
<p>You’ll also recognize a developer’s made-up words because of their position relative to other words and symbols. Some made-up words will be obvious because they are just too idiosyncratic to be part of the Ruby language. For example, you’ll rightly guess that <code>myapp</code> or <code>fluffycat</code> are not part of the Ruby language.</p>
<p>If you’re reading a Lewis Carroll poem, you could look up words in a dictionary to see if you find them.</p>
<p>There is only one way to be sure which words are part of the Ruby language: Check the Ruby API.</p>
<p>As an exercise, pick one of the words from the example code that you think might be a Ruby keyword and search the API to find it.</p>
<p>If you want to be a diligent student, you can check every keyword in the example code to find out whether it is in the Ruby API. It is more practical to learn to recognize Ruby keywords, which we’ll do next.</p>
<h3 id="1531-api-documentation"><a href="#uid211">15.3.1 API Documentation</a></h3>
<p>The Ruby API documentation lists every keyword in the language:</p>
<ul>
<li><a href="https://ruby-doc.org/">ruby-doc.org</a> - the official Ruby API</li>
<li><a href="http://apidock.com/ruby">apidock.com/ruby</a> - Ruby API docs with usage notes</li>
</ul>
<h2 id="154-ruby-files"><a href="#cid112">15.4 Ruby Files</a></h2>
<p>When we write code, we save it in files. We’ve added our miscellaneous example file to the <strong>lib/</strong> folder.</p>
<p>By convention, Ruby files end with the file extension <strong>.rb</strong>.</p>
<h3 id="1541-using-irb"><a href="#uid214">15.4.1 Using IRB</a></h3>
<p>In the “Troubleshooting” chapter, you used IRB (the Interactive Ruby Shell) to try out Ruby code. You can use IRB to try out the example code in the console.</p>
<p>$ irb
>> load 'lib/example.rb'
\=&gt; true
>>  require 'date'
\=&gt; true
>> ex \= Example.new('Daniel',nil)
\=&gt; #&lt;Example:0x007fb46c9eecd8 @name="Daniel", @date=#<Date: 2015-12-23 ...
\>\> list \= ex.december\_birthdays
\=> ["Ludwig van Beethoven", "Dave Brubeck", "Keith Richards"]
>></p>
<p>Entering the <code>load</code> directive and the filename brings the code into IRB.</p>
<p>The <code>require ’date’</code> statement loads the Ruby date library.</p>
<p>The statement <code>ex = Example.new(’Daniel’,nil)</code> creates an object from the <code>Example</code> class.</p>
<p>The <code>ex.december_birthdays</code> method returns an array of names.</p>
<p>Remember you can use Control-d to exit from IRB.</p>
<p>Now, for practice, we’ll read the Ruby code.</p>
<h2 id="155-whitespace-and-line-endings"><a href="#cid113">15.5 Whitespace and Line Endings</a></h2>
<p>Whitespace characters such as spaces and tabs are generally ignored in Ruby code, except when they are included in strings. There are several special cases where whitespace is significant in Ruby expressions but you are not likely to encounter these cases as a beginning Rails developer.</p>
<p>Some programming languages (Java and the C family) require a semicolon as a terminator character at the end of statements. Ruby does not require a semicolon to terminate a statement. Instead, if the Ruby code on a line is a complete expression, the line ending signifies the end of the statement. If the line ends with a <code>+</code> or other operator, or a backslash character, the statement is split into multiple lines.</p>
<h2 id="156-comments"><a href="#cid114">15.6 Comments</a></h2>
<p>Ruby ignores everything that is marked as a comment. Use comments for notes to yourself or other programmers.</p>
<p># This is a comment.</p>
<p>You can also turn code into comments if you don’t want the code to run. This is a common trick when you want to “turn off” some part of your code but you don’t want to delete it just yet, because you are trying out alternatives.</p>
<h2 id="157-the-heart-of-programming"><a href="#cid115">15.7 The Heart of Programming</a></h2>
<p>Three principles are at the heart of all programming:</p>
<ul>
<li>syntax</li>
<li>conditional execution</li>
<li>transformation</li>
</ul>
<p>Computers allow no ambiguity. Code must exactly follow the <em>syntax</em> of a language. Typos, guesses, and code that is almost-but-not-quite right will simply fail, often without any helpful error messages.</p>
<p>Computers seem intelligent because they can execute code <em>conditionally</em>. You can write a program so that given one set of conditions, certain parts of the code will execute, and given different conditions, other parts of the code will execute.</p>
<p>Lastly, programs are written to transform abstractions from one form to another. That’s why computer programs look like math. When we learn simple arithmetic, we learn we can take the symbols for numbers and add them together to make a different number. Computer programs do more than add numbers; a program can transform words and other abstractions.</p>
<h2 id="158-assignment"><a href="#cid116">15.8 Assignment</a></h2>
<p>In Ruby, like many other programming languages, the equals sign indicates we are <em>assigning</em> a value.</p>
<p>name \= 'Foobar Kadigan'</p>
<p>Assignment is the first step to transformation. Here <code>’Foobar Kadigan’</code> is a string of letters. The equals sign is the assignment operator. And <code>name</code> is a <em>variable</em> that stores the value so it can be easily reused. We don’t have to type <code>’Foobar Kadigan’</code> every time we need a name; we can use <code>name</code> instead.</p>
<p>Just as we can assign a value to a variable, we can reassign a new value whenever we want. That is why we call them variables; the value can vary.</p>
<p>name \= 'Mr. Foobar Kadigan'</p>
<p>Variables can be assigned strings of letters, numbers, or anything else. “Anything else” is very broad because we can use Ruby to make complex structures that contain data and also “do work.” These complex structures are <em>objects</em> and we say that Ruby is <em>object-oriented</em> because it is easy to work with objects in Ruby.</p>
<h2 id="159-object-oriented-terminology"><a href="#cid117">15.9 Object-Oriented Terminology</a></h2>
<p>Software architects use a common vocabulary to talk about programming languages:</p>
<ul>
<li><strong>class</strong></li>
<li><strong>instance</strong> or <strong>object</strong></li>
<li><strong>method</strong></li>
<li><strong>attribute</strong> or <strong>property</strong></li>
<li><strong>inheritance</strong></li>
<li><strong>class hierarchy</strong></li>
</ul>
<p>There are three ways to learn what these words mean. You can memorize the definitions. You can write code and intuitively grasp the meanings. Or you can gain an understanding by applying metaphors.</p>
<h3 id="1591-houses"><a href="#uid224">15.9.1 Houses</a></h3>
<p>For example, some programming textbooks attempt to explain a <em>class</em> like this: A blueprint for a house design is like a <em>class definition</em>. All the houses built from that blueprint are <em>objects</em> of a class we could call House.</p>
<h3 id="1592-vehicles"><a href="#uid225">15.9.2 Vehicles</a></h3>
<p>Or: The concept of “vehicle” is like a <em>class</em>. Vehicles can have <em>attributes</em>, like color or number of doors. They have behavior, or <em>methods</em>, like buttons that turn on lights or honk a horn. The concepts of “truck” or “car” are also classes, <em>inheriting</em> common characteristics from a <em>superclass</em> “vehicle.” The blue car in your driveway with four doors is an object, a particular <em>instance</em> of the class “car.”</p>
<h3 id="1593-cookies"><a href="#uid226">15.9.3 Cookies</a></h3>
<p>I like the cookie metaphor the best.</p>
<p>A <em>class definition</em> is like a cookie cutter.</p>
<p>Bits in the computer memory are like cookie dough.</p>
<p>The cookie cutter makes as many individual cookies as you want. Each cookie is an <em>instance</em> of the Cookie class, with the same shape and size as the others. Cookies are <em>objects</em>.</p>
<p>You can decorate each cookie with sprinkles, which are <em>attributes</em> that are unique to each instance. Some cookies get red sprinkles, some get green, but the shape remains the same.</p>
<p>Running a program is like baking. The cookies change state from raw to cooked.</p>
<p>Sticking a toothpick in a cookie is like calling a <em>method</em>. The method returns a result that tells you about the state: Is it done?</p>
<h3 id="1594-limitations-of-metaphors"><a href="#uid227">15.9.4 Limitations of Metaphors</a></h3>
<p>Metaphors are imperfect.</p>
<p>If baking was like running a program, all the cookies would disappear as soon as the oven was turned off.</p>
<p>When a software program contains a “car” model, it doesn’t fully model cars in the physical world. It represents an abstraction of characteristics a programmer deems significant. Let’s make a model for a Person that contains an attribute Gender. What values are possible for the attribute Gender? For many years, Facebook offered two choices, male and female. In 2014, Facebook suddenly offered a choice of over fifty gender terms. As Sarah Mei discusses in a blog post, <a href="http://www.sarahmei.com/blog/2010/11/26/disalienation/">Why Gender is a Text Field on Diaspora</a>, your assumptions have consequences when you build a model.</p>
<p>Most classes in software APIs don’t model anything in the real world. They typically represent an abstraction, like an Array or a Hash, which inherits characteristics from another abstraction, for example, a Collection.</p>
<p>Given the limitations of metaphors, maybe it is easier to simply say that software allows us to create abstractions that are “made real” and then manipulated and transformed. Terminology such as <em>class</em> and <em>instance</em> describe the abstractions and the relationships among them.</p>
<h3 id="1595-definitions"><a href="#uid228">15.9.5 Definitions</a></h3>
<p>Here are definitions for some of the terms we encounter when we consider Rails from the perspective of a software architect:</p>
<p><strong>class</strong><em>   an abstraction that encapsulates data and behavior
</em><em>class definition</em><strong>   written code that describes a class
</strong>instance<strong> or </strong>object<strong><em>   a unique copy of a class that exists only while a program is running
</em>*inheritance</strong><em>   a way to make a class by borrowing from another class
</em><em>class hierarchy</em><strong>   classes that are related by inheritance
</strong>method<strong><em>   a command that returns data from an object
</em>*attribute</strong> or <strong>property</strong><em>   data that can be set or retrieved from the object
</em><em>variable</em><strong>   a name that can be assigned a value or object
</strong>expression<strong> or </strong>statement***   any combination of variables, classes, and methods that returns a result</p>
<p>Some of these terms are abstractions that are “made real” in the Ruby API (such as class and method); others are just terms that describe code, much like we use terms such as “adjective” or “noun” to talk about the grammar of the English spoken language.</p>
<h2 id="1510-classes"><a href="#cid118">15.10 Classes</a></h2>
<p>You don’t have to create classes to program in Ruby. If you only write simple programs, you won’t need classes. Classes are used to organize your code and make your software more modular. For the software architect, classes make it possible to create a structure for complex software programs. To use Rails, you’ll use the classes and methods that are defined in the Rails API.</p>
<p>There is one class at the apex of the Ruby class hierarchy: <a href="https://www.ruby-doc.org/core-2.4.1/BasicObject.html"><code>BasicObject</code></a>. <code>BasicObject</code> is a very simple class, with almost no methods of its own. The <a href="https://ruby-doc.org/core-2.4.1/Object.html"><code>Object</code></a> class inherits from <code>BasicObject</code>. All classes in the Ruby and Rails APIs inherit behavior from <code>Object</code>. <code>Object</code> provides basic methods such as <code>nil?</code> and <code>to_s</code> (“to string”) for every class that inherits from <code>Object</code>.</p>
<p>We create a class <code>Example</code> and inherit from <code>Object</code> with the <code>&lt;</code> “inherits from” operator:</p>
<p>class Example &lt; Object
.
.
.
end</p>
<p>The <code>end</code> statement indicates all the preceding code is part of the <code>Example</code> class.</p>
<p>In Ruby, all classes inherit from the Object class, so we don’t need to explicitly <em>subclass</em> from <code>Object</code> as we do here. The example just shows it for teaching purposes.</p>
<p>Here is the <code>Example</code> class without the explicit subclassing from <code>Object</code>:</p>
<p>class Example
.
.
.
end</p>
<p>Much of the art of programming is knowing what classes are available in the API and deciding when to subclass to inherit useful methods.</p>
<h2 id="1511-methods"><a href="#cid119">15.11 Methods</a></h2>
<p>Classes give organization and structure to a program. Methods get the work done.</p>
<p>Any class can have methods. Methods are a series of expressions that return a result (a value). We say methods describe the class behavior.</p>
<p>A method definition begins with the keyword <code>def</code> and (predictably) ends with <code>end</code>.</p>
<p>def backwards_name
    @name.reverse
  end</p>
<p>Initializing the object and calling the method returns a result:</p>
<p>ex \= Example.new('Daniel',nil)
my_backwards_name \= ex.backwards_name
  \=&gt; leinaD</p>
<p>We can also <em>override</em> a method from the parent class.</p>
<p>def to_s
    @name
  end</p>
<p>Here we are <em>overriding</em> the <code>to_s</code> (“to string”) method from the parent <code>Object</code> class.</p>
<p>Ordinarily, the <code>to_s</code> method returns the object’s class name and an object id. Here we will return the string assigned to the variable <code>@name</code>.</p>
<p>Most times you won’t override the <code>to_s</code> (“to string”) method. This example shows how you can override any method inherited from a parent class.</p>
<h2 id="1512-dot-operator"><a href="#cid120">15.12 Dot Operator</a></h2>
<p>The “dot” is the method operator. This tiny punctuation symbol is a powerful operator in Ruby.</p>
<p>It allows us to <em>call a method</em> to get a result.</p>
<p>Sometimes we say we <em>send a message</em> to the object when we invoke a method, implying the object will send a result.</p>
<p>Some classes, such as <code>Date</code>, provide <em>class methods</em> which can be called directly on the class without instantiating it first. For example, you can run this in the Rails console:</p>
<p>Date.today
 \=&gt; Tue, 15 Oct 2013</p>
<p>More often, methods are called on variables which are instances of a class. For example:</p>
<p>birthdate \= Date.new(1990, 12, 22)
 \=&gt; Sat, 22 Dec 1990
birthmonth \= birthdate.month
 \=&gt; 12</p>
<p>We can apply <em>method chaining</em> to objects. For example, <code>String</code> has methods <code>reverse</code> and <code>upcase</code> (among many others). We could write:</p>
<p>nonsense \= 'foobar'
 \=&gt; "foobar"
reversed \= nonsense.reverse
 \=&gt; "raboof"
capitalized \= reversed.upcase
 \=&gt; "RABOOF"</p>
<p>It is easier to use method chaining and write:</p>
<p>'foobar'.reverse.upcase
 \=&gt; "RABOOF"</p>
<p>Classes create a structure for our software programs and methods do all the work.</p>
<h3 id="15121-question-and-exclamation-methods"><a href="#uid238">15.12.1 Question and Exclamation Methods</a></h3>
<p>You’ll see question marks and exclamation points (sometimes called the “bang” character) used in method names. These characters are simply a naming convention for Ruby methods.</p>
<p>The question mark indicates the method will return a <em>boolean value</em> (true or false).</p>
<p>The bang character indicates the method is “dangerous.” In some cases it means the method will change the object rather just return a result. In Rails an exclamation point often means the method will throw an exception on failure rather than failing silently.</p>
<h2 id="1513-initialize-method"><a href="#cid121">15.13 Initialize Method</a></h2>
<p>Objects are created from classes before they are used. As I suggested earlier, class definitions are cookie cutters; the Ruby interpreter uses them to cut cookies. When we call the <code>new</code> method, we press the cookie cutter into the dough and get a new object. All the cookies will have the same shape but they can be decorated differently, by sprinkling attributes of different values.</p>
<p>The <code>initialize</code> method is one of the ways we sprinkle attributes on our cookie.</p>
<p>def initialize(name,date)</p>
<p>When we want to use an <code>Example</code> object and assign it to a variable, we will instantiate it with <code>Example.new(name,date)</code>. The <code>new</code> method calls the <code>initialize</code> method automatically. If we don’t define an <code>initialize</code> method, the <code>new</code> method still works, inherited from <code>Object</code>, so we can always instantiate any class.</p>
<h2 id="1514-method-parameters"><a href="#cid122">15.14 Method Parameters</a></h2>
<p>Methods are useful when they operate on data.</p>
<p>If we want to send data to a method, we define the method and indicate it will accept <em>parameters</em>. Parameters are placeholders for data values. The values that are passed to a method are <em>arguments</em>. “Parameters” are empty placeholders and “arguments” are the actual values. In practice, “parameters” and “arguments” are terms that are used interchangeably and not many developers will notice if you mix up the terms.</p>
<p>Our <code>initialize</code> method takes <code>name</code> and <code>date</code> arguments:</p>
<p>def initialize(name,date)</p>
<p>Ruby is clever with method parameters. You can define a method and specify default values for parameters. You can also pass extra arguments to a method if you define a method that allows optional parameters. This makes methods very flexible.</p>
<p>We separate our parameters with commas. For readability, we enclose our list of parameters in parentheses. In Ruby, parentheses are always optional but they often improve readability.</p>
<h2 id="1515-variable"><a href="#cid123">15.15 Variable</a></h2>
<p>In Ruby, everything is an object. We can assign any object to a variable. The variable works like an alias. We can use a variable anywhere as if it were the assigned object. The variable can be assigned a string, a numeric value, or an instance of any class (all are objects).</p>
<p>name</p>
<p>You can assign a new value to a variable anywhere in your method. You can assign a different kind of object if you want. You can take away someone’s name and give them a number. We can create a variable <code>player</code>, assign it the string <code>’Jackie Robinson’</code>, replace the value with an integer <code>42</code>, or even a date such as <code>Date.new(1947,4,15)</code>.</p>
<h3 id="15151-symbol"><a href="#uid239">15.15.1 Symbol</a></h3>
<p>Obviously, we see many symbols when we read Ruby code, such as punctuation marks and alphanumeric characters. But <em>symbol</em> has a specific meaning in Ruby. It is like a variable, but it can only be assigned a value once. After the initial assignment, it is <em>immutable</em>; it cannot be changed.</p>
<p>You will recognize a symbol by the colon that is always the first character.</p>
<p>:name</p>
<p>Symbols are efficient and fast because the Ruby interpreter doesn’t have to work to check their current values.</p>
<p>You’ll often see symbols used in Rails where you might expect a variable.</p>
<h2 id="1516-attributes"><a href="#cid124">15.16 Attributes</a></h2>
<p>In an object, methods do the work and data is stored as variables. We can use the <code>initialize</code> method to input data to the object. We can’t access data in variables from outside the object unless it is exposed as <em>attributes</em>.</p>
<p>Classes can have attributes, which we can “set” and “get.” That is, we can establish a value for an attribute and retrieve the value by specifying the attribute name.</p>
<p>Attributes are a convenient way to push data to an object and pull it out later.</p>
<p>In Ruby, attributes are also called properties.</p>
<p>Here we use the <code>attr_accessor</code> directive to specify that we want to expose <code>honorific</code>, <code>name</code> and <code>date</code> attributes.</p>
<p>attr_accessor :honorific
  attr_accessor :name
  attr_accessor :date</p>
<p>If we use <code>attr_accessor</code> to establish attributes, we can use the attribute names as methods. For example, we could write:</p>
<p>ex \= Example.new('Daniel',nil)
 my_name \= ex.name</p>
<p>In Ruby, attributes are just specialized methods that expose data outside the object.</p>
<h2 id="1517-instance-variable"><a href="#cid125">15.17 Instance Variable</a></h2>
<p>Inside an object, an ordinary variable only can be used within the method in which it appears. If you use a variable with the same name in two different methods, it will have a different value in each method. The <em>scope</em> of a variable is limited to the method in which it is used.</p>
<p>Often you want a variable to be available throughout an instance, within any method. You can declare an <em>instance variable</em> by using an <code>@</code> (at) sign as the first character of the variable name.</p>
<p>The instance variable can be used by any method after the class is instantiated.</p>
<p>@name \= name</p>
<p>The values assigned to instance variables are unique for every instance of the class. If you create multiple instances of a class, each will have its own values for its instance variables. Here we create two instances of the <code>Example</code> class. The <code>@name</code> instance variable will be “Daniel” in the first instance and “Foobar” in the second instance.</p>
<p>ex1 \= Example.new('Daniel',nil)
  ex2 \= Example.new('Foobar',nil)</p>
<p>An instance variable is not visible outside the object in which it appears; but when you create an <code>attr_accessor</code>, it creates an instance variable and makes it accessible outside the object.</p>
<h3 id="15171-instance-variables-in-rails"><a href="#uid240">15.17.1 Instance Variables in Rails</a></h3>
<p>In a Rails controller, you’ll often see a model assigned to an instance variable. Earlier we saw <code>@owner = Owner.new</code> when we instantiated an Owner model. We use an instance variable when we want a model to be available to the view template.</p>
<p>Rails beginners learn the simple rule that you have to use the <code>@</code> (at) sign if you want a variable to be available in the view. Intermediate Rails developers learn that the variable with the <code>@</code> (at) sign is called an instance variable and is only available within the <em>scope</em> of the instance (practically speaking, to other methods in the class definition). That leads to a question: Why is an instance variable available inside a view?</p>
<p>There is a good reason. A Rails view is NOT a separate class. It is a template and, under the hood, it is part of the current controller object. From the viewpoint of a programmer, a Rails controller and a view are separate files, segregated in separate folders. From the viewpoint of a software architect, the controller is a single object that evaluates the template code, so an instance variable can be used in the view file.</p>
<p>This example shows us that the programmer and the software architect have different perspectives on a Rails application. Understanding Rails requires an integration of multiple points of view.</p>
<h2 id="1518-double-bar-equals-operator"><a href="#cid126">15.18 Double Bar Equals Operator</a></h2>
<p>I’ve suggested that the best way to get help is to use Google or Stack Overflow to look for answers. But that’s difficult when you don’t know what symbols are called. Try googling “||=” and you’ll get no results. Instead, try googling “bar bar equals ruby” or “double pipe equals ruby” and you’ll find many explanations of the “or equals” operator. This is an example of mysterious shorthand code you’ll often find in Rails.</p>
<p>”||=” is used for conditional assignment. In this case, we only assign a value to the variable if no value has been previously assigned.</p>
<p>@honorific ||= 'Esteemed'</p>
<p>It is equivalent to this conditional expression:</p>
<p>if not x
    x \= y
  end</p>
<p>Conditional assignment is often used to assign a “default value” when no other value has been assigned.</p>
<h2 id="1519-conditional"><a href="#cid127">15.19 Conditional</a></h2>
<p>Conditional logic is fundamental to programming. Our code is always a path with many branches.</p>
<p>When the Ruby interpreter encounters an <code>if</code> keyword, it expects to find an expression which evaluates as true or false (a <em>boolean</em>).</p>
<p>If the expression is true, the statements following the condition are executed.</p>
<p>If the expression is false, any statements are ignored, unless there is an <code>else</code>, in which case an alternative is executed.</p>
<p>if date.month \== 12
    .
    .
    .
  end</p>
<p>Sometimes you’ll see <code>unless</code> instead of <code>if</code>, which is a convenient way of saying “execute the following if the condition is false.”</p>
<p>In Ruby, the conditional expression can be a simple comparison, as illustrated above with the <code>==</code> (double equals) operator. Or <code>if</code> can be followed by a variable that has been assigned a boolean value. Or you can call a method that returns a boolean result.</p>
<h2 id="1520-ternary-operator"><a href="#cid128">15.20 Ternary Operator</a></h2>
<p>A basic conditional structure might look like this:</p>
<p>if date.nil?
    @date \= Date.today
  else
    @date \= date
  end</p>
<p>We test if <code>date</code> is undefined (nil). If nil, we assign today’s date to the instance variable <code>@date</code>. If <code>date</code> is already assigned a value, we assign it to the instance variable <code>@date</code>. This is useful in the <code>initialize(name,date)</code> method in our example code because we want to set today’s date as the default value for the instance variable <code>@date</code> if the parameter <code>date</code> is nil.</p>
<p>Ruby developers like to keep their code tight and compact. So you’ll see a condensed version of this conditional structure often, particularly when a default value must be assigned.</p>
<p>This compact conditional syntax is named the <em>ternary operator</em> because it has three components. Here is the syntax:</p>
<p>condition ? value_if_true : value_if_false</p>
<p>Here is the ternary operator we use in our example code:</p>
<p>@date \= date.nil? ? Date.today : date</p>
<p>This is another example of Ruby syntax that you must learn to recognize by sight because it is difficult to interpret if you have never seen it before.</p>
<p>For more Ruby code that has been condensed into obscurity, see an article on <a href="http://www.sitepoint.com/ruby-golf/">Ruby Golf</a>. Ruby golf is the sport of writing code that uses as few characters as possible.</p>
<h2 id="1521-interpolation"><a href="#cid129">15.21 Interpolation</a></h2>
<p>Rubyists love to find special uses for orthography such as hashmarks and curly braces. It seems Rubyists feel sorry for punctuation marks that don’t get much use in the English language and like to give them new jobs.</p>
<p>We already know that we can assign a string to a variable:</p>
<p>name \= 'Foobar Kadigan'</p>
<p>We can also perform “string addition” to concatenate strings. Here we add an honorific, a space, and a name:</p>
<p>@honorific \= 'Mr.'
  @name \= 'Foobar Kadigan'
  titled_name \= @honorific + ' ' + @name
  \=&gt; "Mr. Foobar Kadigan"</p>
<p>Single quote marks indicate a string. In the example above, we enclose a space character within quote marks so we add a space to our string.</p>
<p>You can eliminate the ungainly mix of plus signs, single quote marks, and space characters in the example above.</p>
<p>Use double quote marks and you can perform <em>interpolation</em>, which gives a new job to the hashmark and curly brace characters:</p>
<p>@honorific \= 'Mr.'
  @name \= 'Foobar Kadigan'
  titled_name \= "#{@honorific} #{@name}"
  \=&gt; "Mr. Foobar Kadigan"</p>
<p>The hashmark indicates any expression within the curly braces is to be evaluated and returned as a string. This only works when you surround the expression with double quote marks.</p>
<p>Interpolation is cryptic when you first encounter the syntax, but it streamlines string concatenation.</p>
<h2 id="1522-access-control"><a href="#cid130">15.22 Access Control</a></h2>
<p>Any method you define will return a result.</p>
<p>Sometimes you want to create a method that only can be used by other methods in the same class. This is common when you need a simple utility method that is used by several other methods.</p>
<p>Any methods that follow the keyword <code>private</code> should only be used by methods in the same class (or a subclass).</p>
<p>private</p>
<p>You often see private methods in Rails. Ruby provides a <em>protected</em> keyword as well, but the difference between <em>protected</em> and <em>private</em> is subtle and <em>protected</em> is seldom seen in Rails applications.</p>
<h2 id="1523-hash"><a href="#cid131">15.23 Hash</a></h2>
<p>Our example code includes a private method named <code>famous_birthdays</code> that returns a collection of names and birthdays of famous musicians.</p>
<p>Computers have always been calculation machines; they are just as important in managing collections.</p>
<p>One important type of collection is named a Hash. A Hash is a data structure that associates a key to some value. You retrieve the value based upon its key. This construct is called a <em>dictionary</em>, an <em>associative array</em>, or a <em>map</em> in other languages. You use the key to “look up” a value, as you would look up a definition for a word in a dictionary.</p>
<p>You’ll recognize a Hash when you see curly braces (again, Rubyists give a job to under-utilized punctuation marks).</p>
<p>birthdays \= {
    'Ludwig van Beethoven' \=&gt; Date.new(1770,12,16),
    'Dave Brubeck' \=&gt; Date.new(1920,12,6),
    'Buddy Holly' \=&gt; Date.new(1936,9,7),
    'Keith Richards' \=&gt; Date.new(1943,12,18)
  }</p>
<p>Rubyists also like to create novel uses for mathematical symbols. The combination of an <code>=</code> (equals) sign and <code>&gt;</code> (greater than) sign is called a <em>hashrocket</em>. The <code>=&gt;</code> (hashrocket) operator associates a key and value pair in a Hash. You’ll often see hashrockets in code written before Ruby 1.9. Ruby 1.9 introduced a new syntax using colons instead of hashrockets.</p>
<p>Whether with colons or hashrockets, you’ll often see Hashes used in Rails.</p>
<p>With Ruby 1.9 and later, here’s how we associate key and value pairs in a Hash:</p>
<p>birthdays \= {
    beethoven: Date.new(1770,12,16),
    brubeck: Date.new(1920,12,6),
    holly: Date.new(1936,9,7),
    richards: Date.new(1943,12,18)
  }</p>
<p>Here, instead of using a string as the key, we are using Ruby symbols, which enable faster processing. The <code>:</code> (colon) character associates the key and value.</p>
<p>Ordinarily, a symbol is defined with a leading colon character. In a Hash, a trailing colon makes a string into a symbol.</p>
<p>If you want to transform a string containing spaces into a symbol in a Hash, you can do it, though the syntax is awkward:</p>
<p>birthdays \= {
    'Ludwig van Beethoven': Date.new(1770,12,16)
  }</p>
<h2 id="1524-array"><a href="#cid132">15.24 Array</a></h2>
<p>An <em>Array</em> is a list. Arrays can hold objects of any data type. In fact, arrays can contain a mix of different objects. For example, an array can contain a string and another array (this is an example of a <em>nested array</em>).</p>
<p>An array can be instantiated with square brackets:</p>
<p>born_in_december \= [ ]</p>
<p>We can populate the array with values when we create it:</p>
<p>my_list \= ['apples', 'oranges']</p>
<p>If we don’t want to use quote marks and commas to separate strings in a list, we can use the <code>%w</code> syntax:</p>
<p>my_list \= %w( apples oranges )</p>
<p>We can add new elements to an array with a <code>push</code> method:</p>
<p>my_list \= Array.new
  \=&gt; []
  my_list.push 'apples'
  \=&gt; ["apples"]
  my_list.push 'oranges'
  \=&gt; ["apples", "oranges"]</p>
<p>In our example code, we use the <code>&lt;&lt;</code> <em>shovel operator</em> to add items to the array:</p>
<p>born_in_december &lt;&lt; name</p>
<p>A Ruby array has close to a hundred available methods, including operations such as <code>size</code> and <code>sort</code>. See the <a href="https://www.ruby-doc.org/core-2.4.1/Array.html">Ruby API</a> for a full list.</p>
<h2 id="1525-iterator"><a href="#cid133">15.25 Iterator</a></h2>
<p>Of all the methods available for a Ruby collection such as Hash or Array, the <em>iterator</em> may be the most useful.</p>
<p>You’ll recognize an iterator when you see the <code>each</code> method applied to a Hash or Array:</p>
<p>famous_birthdays.each</p>
<p>The <code>each</code> keyword is always followed by a block of code. Each item in an Array, or key-value pair in a Hash, is passed to the block of code to be processed.</p>
<h2 id="1526-block"><a href="#cid134">15.26 Block</a></h2>
<p>You can recognize a <em>block</em> in Ruby when you see a <code>do ... end</code> structure. A block is a common way to process each item when an iterator such as <code>each</code> is applied to a Hash or Array.</p>
<p>In our example, we iterate over the <code>famous_birthdays</code> hash:</p>
<p>famous_birthdays.each do |name, date|
    .
    .
    .
  end</p>
<p>Within the two pipes (or bars), we assign the key and value to two variables.</p>
<p>The block is like an unnamed method. The two variables are available only within the block. As each key-value pair is presented by the iterator, the variables are assigned, and the statements in the block are executed.</p>
<p>In our example code, we evaluate each date in the <code>famous_birthdays</code> hash to determine if the musician was born in December. When we find a December birthday, we add the name of the musician to the <code>born_in_december</code> array:</p>
<p>famous_birthdays.each do |name, date|
    if date.month \== 12
      born_in_december &lt;&lt; name
    end
  end</p>
<p>When you use a block within a method, any variable in your method is available within the block. That’s why we can add <code>name</code> to the array <code>born_in_december</code>.</p>
<p>Computer scientists consider a block to be a programming language construct called a <em>closure</em>. Ruby has other closures, including the <em>proc</em> (short for procedure) and the <em>lambda</em>. Though blocks are common you’ll seldom see procs or lambdas in ordinary Rails code. They are more common in the Rails source code where advanced programming techniques are used more frequently.</p>
<p>The key point to know about a block (or a proc or a lambda) is that it works like a method. Though you don’t see a method definition, you can use a block to evaluate a sequence of statements and obtain a result.</p>
<h2 id="1527-rails-and-more-keywords"><a href="#cid135">15.27 Rails and More Keywords</a></h2>
<p>We’ve looked at only a few of the keywords and constructs you will see in Ruby code. The exercise has improved your Ruby literacy, so you’ll have an easier time reading Ruby code.</p>
<p>Nothing in the exercise is Rails. The example code only uses keywords from the Ruby API.</p>
<p>Rails has its own API, with hundreds of classes and methods. The Rails API uses the syntax and keywords of the Ruby language to construct new classes and create new keywords that are specific to Rails and useful for building web applications.</p>
<p>We say Ruby is a general-purpose language because it can be used for anything. Rails is a <em>domain-specific language</em> (DSL) because it is used only by people building web applications (in this sense, “domain” means area or field of activity). Ruby is a great language to use for building a DSL, which is why it was used for Rails. Unlike some other programming languages, Ruby easily can be extended or tweaked. For example, developers can redefine classes, add extra methods to existing classes, and use the special <code>method_missing</code> method to handle method calls that aren’t previously defined. Software architects call this <em>metaprogramming</em> which simply means clever programming that twists and reworks the programming language.</p>
<p>When you add a gem to a Rails project, you’ll add additional keywords. Some of the most powerful gems add their own DSLs to your project. For example, the Cucumber gem provides a DSL for turning user stories into automated tests.</p>
<p>Adding Rails, additional gems, and DSLs provides powerful functionality at the cost of complexity. But it all conforms to the syntax of the Ruby language. As you learn to recognize Ruby keywords and language structures, you’ll be able to pick apart the complexity and make sense of any code.</p>
<h2 id="1528-more-ruby"><a href="#cid136">15.28 More Ruby</a></h2>
<p>To develop your proficiency as a Rails developer, I hope you will make an effort to learn Ruby as you learn Rails. Don’t be lazy; when you encounter a bit of Ruby you don’t understand, make an effort to find out what is going on. Spend time with a Ruby textbook or interactive course when you work on Rails projects.</p>
<h3 id="15281-collaborative-learning"><a href="#uid241">15.28.1 Collaborative Learning</a></h3>
<p>The best way to learn Ruby is to actually use it. That’s the concept behind this site:</p>
<ul>
<li><a href="http://exercism.io/">Exercism.io</a></li>
</ul>
<p>With Exercism, you’ll work though code exercises and get feedback from other learners.</p>
<h3 id="15282-online-tutorials"><a href="#uid243">15.28.2 Online Tutorials</a></h3>
<ul>
<li><a href="http://www.tryruby.org">TryRuby.org</a> - free browser-based interactive tutorial from Code School</li>
<li><a href="https://www.codecademy.com/tracks/ruby">Codecademy Ruby Track</a> - free browser-based interactive tutorials from Codecademy</li>
<li><a href="http://rubykoans.com/">Ruby Koans</a> - free browser-based interactive exercises from Jim Weirich and Joe O’Brien</li>
<li><a href="http://tutorials.jumpstartlab.com/projects/ruby_in_100_minutes.html">Ruby in 100 Minutes</a> - free tutorial from JumpstartLab</li>
<li><a href="http://codelikethis.com/lessons">Code Like This</a> - free tutorials by Alex Chaffee</li>
<li><a href="http://curriculum.railsbridge.org/ruby/ruby">RailsBridge Ruby</a> - basic introduction to Ruby</li>
<li><a href="https://www.codeschool.com/paths/ruby">CodeSchool Ruby Track</a> - instructional videos with in-browser coding exercises</li>
</ul>
<h3 id="15283-books"><a href="#uid251">15.28.3 Books</a></h3>
<ul>
<li><a href="http://pine.fm/LearnToProgram/">Learn To Program</a> - free ebook by Chris Pine</li>
<li><a href="https://pragprog.com/book/ltp2/learn-to-program">Learn To Program</a> - expanded $18.50 ebook by Chris Pine</li>
<li><a href="http://ruby.learncodethehardway.org/">Learn Code the Hard Way</a> - free from Zed Shaw and Rob Sobers</li>
<li><a href="http://beginningruby.org/">Beginning Ruby</a> - by Peter Cooper</li>
<li><a href="https://pragprog.com/book/ruby4/programming-ruby-1-9-2-0">Programming Ruby</a> - by Dave Thomas, Andy Hunt, and Chad Fowler</li>
<li><a href="https://www.amazon.com/Eloquent-Ruby-Addison-Wesley-Professional-Series/dp/0321584104/">Eloquent Ruby</a> - by Russ Olsen</li>
<li><a href="https://shiprise.dpdcart.com/">Books by Avdi Grimm</a>, including <em>Confident Ruby</em> and <em>Objects on Rails</em>.</li>
</ul>
<h3 id="15284-newsletters"><a href="#uid259">15.28.4 Newsletters</a></h3>
<ul>
<li><a href="http://practicingruby.com/">Practicing Ruby</a> - $8/month for access to over 90 helpful articles on Ruby</li>
<li><a href="https://rubysteps.com/">RubySteps</a> - weekly lessons by email from Pat Maddox</li>
</ul>
<h3 id="15285-screencasts"><a href="#uid262">15.28.5 Screencasts</a></h3>
<ul>
<li><a href="http://www.rubytapas.com/">RubyTapas</a> - $9/month for access to over 100 screencasts on Ruby</li>
</ul>
<h2 id="1529-git"><a href="#cid137">15.29 Git</a></h2>
<p>There’s no need to save the file <strong>lib/example.rb</strong> file we created to learn Ruby.</p>
<p>You can simply delete the file:</p>
<p>$ rm lib/example.rb</p>
<p>Check the Git status to make sure the file is gone:</p>
<p>$ git status</p>
<h1 id="on-branch-master_1">On branch master</h1>
<p>nothing to commit, working directory clean</p>
<p>We’ve cleaned up after our Ruby exercise.</p>
<p>From here on, we’re done with silly code examples. No more fooling around. With the next chapter, we start building a real-world Rails website.</p>
<h1 id="chapter-16-layout-and-views"><a href="#cid138">Chapter 16 Layout and Views</a></h1>
<p>In previous chapters we created a dynamic home page and learned techniques for troubleshooting.</p>
<p>In this chapter we’ll look closely at view files, particularly the application layout, so we can organize the design of our web pages. We’ll also learn how to add a CSS stylesheet to improve the graphic design of our web pages.</p>
<p>This chapter covers a lot of ground, so take a break before jumping in, or pace yourself to absorb it all.</p>
<h2 id="161-template-languages"><a href="#cid139">16.1 Template Languages</a></h2>
<p>HTML is intended for markup, which means applying formatting to a text file. For a web application, ordinary HTML is not sufficient; we need to mix in Ruby code. We’ll use a <em>templating language</em> that gives us a syntax for mixing HTML tags and Ruby code. The Ruby code will be processed by a <em>templating engine</em> built into Rails. The output will be pure HTML sent to the browser.</p>
<p>The most popular templating language available for Rails is <em>ERB</em>, Embedded Ruby, which is the Rails default.</p>
<p>In the “Concepts” chapter in Book One, you learned that components of Rails can be mixed for different “stacks.” Some developers substitute <a href="http://haml.info/">Haml</a> or <a href="http://slim-lang.com/">Slim</a> for ERB. We’ll use ERB in this book because it is the most popular.</p>
<h2 id="162-introducing-the-application-layout"><a href="#cid140">16.2 Introducing the Application Layout</a></h2>
<p>We’ve already created the view file for our home page.</p>
<p>The file <strong>app/views/visitors/new.html.erb</strong> looks like this:</p>
<h3>Home</h3>
<p>Welcome to the home of <%= @owner.name %>.</p>
<p>I was born on <%= @owner.birthdate %>.</p>
<p>Only <%= @owner.countdown %> days until my birthday!</p>

<p>The first line in the file contains an HTML heading tag, <code>&lt;h3&gt;</code>, with headline text, “Home.”</p>
<p>When you used the browser Developer Tools view to see the HTML file received by the server, you saw this:</p>
<!DOCTYPE html>
<p><html>
<head>
<title>LearnRails</title>
<meta name="csrf-param" content="authenticity\_token" />
<meta name="csrf-token" content="..." />
<link rel="stylesheet" media="all" href="/assets/application.css?body=1" data-turbolinks-track="reload" /></p>
<script src="/assets/jquery.js?body=1" data-turbolinks-track="reload"\></script>
<script src="/assets/jquery\_ujs.js?body=1" data-turbolinks-track="reload"\></script>
<script src="/assets/turbolinks.js?body=1" data-turbolinks-track="reload"\></script>
<script src="/assets/action\_cable.js?body=1" data-turbolinks-track="reload"\></script>
<script src="/assets/cable.js?body=1" data-turbolinks-track="reload"\></script>
<script src="/assets/application.js?body=1" data-turbolinks-track="reload"\></script>
<p></head></p>
<body>

<h3>Home</h3>
<p>Welcome to the home of Foobar Kadigan.</p>
<p>I was born on 1990-09-22.</p>
<p>Only 126 days until my birthday!</p>

</body>
<p></html></p>
<p>If you’ve built websites before, you’ll recognize the HTML file conforms to the HTML5 specification, with a <code>DOCTYPE</code>, <code>&lt;head&gt;</code> and <code>&lt;body&gt;</code> tags, and miscellaneous tags in the HEAD section, including a title and various CSS and JavaScript assets.</p>
<p>If you look closely, you’ll see some HTML attributes you might not recognize, for example the <code>data-turbolinks-track</code> attribute. That is added by Rails to support <a href="https://github.com/turbolinks/turbolinks">turbolinks</a>, for faster loading of webpages.</p>
<p>For the most part, everything is ordinary HTML. But only part of it originates from the view file we’ve created for our home page.</p>
<h2 id="163-where-did-all-the-extra-html-come-from"><a href="#cid141">16.3 Where did all the extra HTML come from?</a></h2>
<p>The final HTML file is more than twice the size of the view file.</p>
<p>The additional tags come from the default <em>application layout</em> file.</p>
<p>Rails has combined the Visitors#New view with the default application layout file. To be precise, the <code>new</code> method in the Visitors controller creates the home page by combining two files:</p>
<ul>
<li>the application layout file <strong>app/views/layouts/application.html.erb</strong></li>
<li>the Visitors#New template in the file <strong>app/views/visitors/new.html.erb</strong></li>
</ul>
<p>We say Rails “renders” (or “delivers”) a new view by combining two files.</p>
<p>Let’s examine the application layout file.</p>
<p>Open the file <strong>app/views/layouts/application.html.erb</strong>:</p>
<!DOCTYPE html>
<p><html>
 <head>
 <title>LearnRails</title>
 &lt;%= csrf_meta_tags %&gt;</p>
<p>&lt;%= stylesheet_link_tag 'application', media: 'all',
        'data-turbolinks-track': 'reload' %&gt;
 &lt;%= javascript_include_tag 'application',
        'data-turbolinks-track': 'reload' %&gt;
 </head></p>
<body>
 <%= yield %>
 </body>
<p></html></p>
<p>Static pages delivered from the <strong>public</strong> folder do not use the default application layout. But every page generated by the model-view-controller architecture in the <strong>app/</strong> folder incorporates the default application layout, unless you specify otherwise.</p>
<p>The default application layout is where you put HTML that you want to include on every page of your website.</p>
<p>Remember when we looked at the hidden code in the controller that renders a view? The controller uses the <code>render</code> method to combine the view file with the application layout.</p>
<p>Here’s the Visitors controller, again, with the hidden <code>render</code> method revealed:</p>
<p>class VisitorsController &lt; ApplicationController</p>
<p>def new
    @owner \= Owner.new
    render 'visitors/new'
  end</p>
<p>end</p>
<p>The <code>render</code> method combines the <strong>app/views/visitors/new.html.erb</strong> view file with the <strong>app/views/layouts/application.html.erb</strong> application layout.</p>
<p>Alternatively, you could tell the controller to render the view without any application layout:</p>
<pre><code>render 'visitors/new', :layout \=&gt; false
</code></pre>
<p>Or you could specify an alternative layout file, for example <strong>app/views/layouts/special.html.erb</strong>:</p>
<pre><code>render 'visitors/new', :layout \=&gt; 'special'
</code></pre>
<p>An alternative layout can be useful for special categories of pages, such as administrative pages or landing pages.</p>
<p>We won’t use alternative layouts in this tutorial application, but it’s good to know they are an option. The reference <a href="http://guides.rubyonrails.org/layouts_and_rendering.html">RailsGuides: Layouts and Rendering in Rails</a> explains more about using alternative layouts.</p>
<h2 id="164-yield"><a href="#cid142">16.4 Yield</a></h2>
<p>How does the <code>render</code> method insert the view file in the application layout? How do the two files get combined?</p>
<p>Notice that the default application layout contains the Ruby keyword <code>yield</code>.</p>
<p>.
.
.
&lt;%= yield %&gt;
.
.
.</p>
<p>The <code>yield</code> keyword is replaced with a view file that is specific to the controller and action, in this case, the <strong>app/views/visitors/new.html.erb</strong> view file.</p>
<p>The content from the view is inserted where you place the <code>yield</code> keyword. The <code>yield</code> keyword pulls in another view file.</p>
<h2 id="165-yield-variations"><a href="#cid143">16.5 Yield Variations</a></h2>
<p>We won’t do it, but you could also use the <code>yield</code> keyword to insert a sidebar or a footer.</p>
<p>Rails provides ways to insert content into a layout file at different places. The <code>content_for</code> method is helpful when your layout contains distinct regions such as sidebars and footers that should contain their own blocks of content.</p>
<p>For example, you could create an application layout that includes a sidebar. This is just an example, so don’t add it to the application you are building:</p>
<!DOCTYPE html>
<p><html>
<head>
 <title>LearnRails</title>
 &lt;%= csrf_meta_tags %&gt;
 &lt;%= stylesheet_link_tag 'application', media: 'all',
      'data-turbolinks-track': 'reload' %&gt;
 &lt;%= javascript_include_tag 'application',
      'data-turbolinks-track': 'reload' %&gt;
</head></p>
<body>
 <div class="main">
 <%= yield %>
 </div>
 <div class="sidebar">
 <%= yield :sidebar %>
 </div>
</body>
<p></html></p>
<p>This view file provides both the main content and a sidebar:</p>
<p>&lt;% content_for :sidebar do %&gt;
 
<h3>Contact Info</h3></p>
<p>Email: [\[email protected\]](/cdn-cgi/l/email-protection)</p>
<p>&lt;% end %&gt;</p>
<h3>Main</h3>
<p>Welcome!</p>

<p>This section gets inserted at the <code>&lt;%= yield :sidebar %&gt;</code> location:</p>
<p>&lt;% content_for :sidebar do %&gt;
 
<h3>Contact Info</h3></p>
<p>Email: [\[email protected\]](/cdn-cgi/l/email-protection)</p>
<p>&lt;% end %&gt;
.
.
.</p>
<p>The rest of the file gets inserted at the main <code>&lt;%= yield %&gt;</code> location.</p>
<p>Again, don’t add this to your application. I’m just offering it as an example of multiple <code>yield</code> statements.</p>
<p>The reference <a href="http://guides.rubyonrails.org/layouts_and_rendering.html">RailsGuides: Layouts and Rendering in Rails</a> explains more about using <code>yield</code> and <code>content_for</code>.</p>
<h2 id="166-erb-delimiters"><a href="#cid144">16.6 ERB Delimiters</a></h2>
<p>Earlier, we saw ERB <code>&lt;%= ... %&gt;</code> delimiters allow us to insert Ruby expressions which are replaced by the result of evaluating the code. Here is an example that displays the number 4</p>
<p>&lt;%= 2 + 2 %&gt;</p>
<p>Look closely and you’ll see this ERB delimiter is slightly different:</p>
<p>&lt;% 3.times do %&gt;
 
<li>list item</li></p>
<p>&lt;% end %&gt;</p>
<p>An ERB delimiter that does not contain the <code>=</code> (equals) sign will execute Ruby code but will not display the result. It is commonly used to add Ruby blocks to HTML code, so you’ll often see <code>do</code> and <code>end</code> statements within ERB <code>&lt;% ... %&gt;</code> delimiters. The example above will create three list items, like this:</p>
<li>list item</li>
<li>list item</li>
<li>list item</li>

<p>A third version of the ERB delimiter syntax is rarely seen:</p>
<p>&lt;%# this is a comment %&gt;</p>
<p>It is only used for adding comments. The expression within the ERB <code>&lt;%# ... %&gt;</code> delimiters will not execute and will not appear when the page is output as HTML.</p>
<h2 id="167-introducing-view-helpers"><a href="#cid145">16.7 Introducing View Helpers</a></h2>
<p>We can use ERB delimiters to create Rails <em>view helpers</em>.</p>
<p>We’ve seen how ERB delimiters can enclose Ruby code.</p>
<p>In the application layout file, the <code>&lt;%= ... %&gt;</code> delimiters don’t include anything that looks like Ruby code. For example, we see <code>&lt;%= csrf_meta_tags %&gt;</code> which seems to be neither HTML nor anything from the Ruby API. In fact, this expression is Ruby code, but it is from the Rails API and only found in Rails applications.</p>
<p>Ruby is an ideal choice for a web application development platform such as Rails because it can easily be used to create a <em>domain-specific language</em> (or <em>DSL</em>). Much of Rails is a domain-specific language. The Smalltalk programming language was famous for its slogan “Code should read like a conversation.” Ruby, which borrows much from Smalltalk, makes it easy to add new words to the conversation. We can add new keywords that produce complex behaviour, creating entire new APIs such as Rails. Ruby makes it easy for the Rails core team to add keywords such as <code>csrf_meta_tags</code> that are additions to the Ruby language.</p>
<p>In this case, Ruby’s ability to produce a domain-specific language gives us Rails <em>view helpers</em>.</p>
<p>Think of Rails view helpers as “macros to generate HTML.” You may have used macros to automate a series of commands in World of Warcraft or other games. If you’re an office worker, you may have used macros in Microsoft Word or Excel. A Rails view helper is a keyword that expands into a longer string of HTML tags and content.</p>
<p>In this case, the <code>csrf_meta_tags</code> view helper expands into two lines of HTML:</p>
<p><meta name="csrf-param" content="authenticity\_token" />
<meta name="csrf-token" content="bhd8ZZJ7dsMza8ZT1Csm5IuCIxkNNq==" /></p>
<p>Why do we need this cryptic code? It turns out that almost any website that accepts user input via a form is vulnerable to a security bug (an <em>exploit</em>) named a <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">cross-site request forgery</a>. To prevent rampant CSRF exploits, the Rails core team includes the <code>csrf_meta_tags</code> view helper in the default application layout. Rails provides a number of similar features that make websites more secure.</p>
<p>A Rails view file becomes much less mysterious when you realize that many of the keywords you see are view helpers. Strange new keywords may be part of the Rails API. Or they may be provided by gems you’ve added (gem developers often use the Ruby DSL capability to create new keywords). Think of it this way: Ruby gives developers the power to create an unlimited number of new “HTML tags.” These tags are not really HTML because they are not part of the HTML specification. But they serve as shortcuts to produce complex snippets of HTML and content.</p>
<p>Now that we’ve learned about view helpers, we can start building our default application layout.</p>
<h2 id="168-the-rails-layout-gem"><a href="#cid146">16.8 The Rails Layout Gem</a></h2>
<p>Every Rails application needs a well-designed application layout. The Rails default starter application, which we get when we run <code>rails new</code>, provides a barebones application layout. It is purposefully simple so developers can add the code they need to accommodate any front-end framework (we’ll look closely at front-end frameworks in the next chapter).</p>
<p>In this chapter we’ll start with a simple application layout file, adding a little CSS for simple styling. In the next chapter, we’ll upgrade the application layout file to use the Bootstrap front-end framework.</p>
<p>To make it easy, we’ll use the <a href="https://github.com/RailsApps/rails_layout">rails_layout</a> gem to generate files for an application layout. In this chapter, we’ll use the rails_layout gem to create our basic layout and CSS files. In the next chapter, we’ll use the rails_layout gem to create layout files for Bootstrap.</p>
<p>In your <strong>Gemfile</strong>, you’ve already added:</p>
<p>gem 'rails_layout'</p>
<p>and previously run <code>$ bundle install</code>.</p>
<p>Rails provides the <code>rails generate</code> command to run simple scripts that are packaged into gems.</p>
<p>The rails_layout gem uses the <code>rails generate</code> command to set up files we need. Run:</p>
<p>$ rails generate layout:install simple --force</p>
<p>The <code>–force</code> argument will force the gem to replace the existing <strong>app/views/layouts/application.html.erb</strong> file.</p>
<p>If you have the <strong>app/views/layouts/application.html.erb</strong> file open in your text editor, it will change.</p>
<p>The rails_layout gem will rename the file:</p>
<ul>
<li><strong>app/assets/stylesheets/application.css</strong></li>
</ul>
<p>to:</p>
<ul>
<li><strong>app/assets/stylesheets/application.css.scss</strong></li>
</ul>
<p>The gem will add (or modify) five files:</p>
<ul>
<li><strong>app/views/layouts/application.html.erb</strong></li>
<li><strong>app/assets/stylesheets/simple.css</strong></li>
<li><strong>app/views/layouts/_messages.html.erb</strong></li>
<li><strong>app/views/layouts/_navigation.html.erb</strong></li>
<li><strong>app/views/layouts/_navigation_links.html.erb</strong></li>
</ul>
<p>Examining these files closely will reveal a great deal about the power of Rails. We’ll dedicate the rest of this chapter to exploring the contents of these files.</p>
<h2 id="169-basic-boilerplate"><a href="#cid147">16.9 Basic Boilerplate</a></h2>
<p>Open the file <strong>app/views/layouts/application.html.erb</strong>:</p>
<!DOCTYPE html>
<p><html>
 <head>
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>&lt;%= content_for?(:title) ? yield(:title) : "Learn Rails" %&gt;</title>
 &lt;meta name="description" content=
 "&lt;%= content_for?(:description) ? yield(:description) : "Learn Rails" %&gt;"&gt;
 &lt;%= stylesheet_link_tag 'application', media: 'all',
      'data-turbolinks-track' \=&gt; 'reload' %&gt;
 &lt;%= javascript_include_tag 'application', 'data-turbolinks-track' \=&gt; 'reload' %&gt;
 &lt;%= csrf_meta_tags %&gt;
 </head>
 
<body>
 <header>
 <%= render 'layouts/navigation' %>
 </header>
 <main role="main">
 <%= render 'layouts/messages' %>
 <%= yield %>
 </main>
 </body></p>
<p></html></p>
<p>Some of this code is already familiar.</p>
<p>You’ll recognize the standard HTML <code>DOCTYPE</code>, <code>&lt;head&gt;</code>, and <code>&lt;body&gt;</code> tags.</p>
<p>We’ve already discussed the <code>yield</code> keyword.</p>
<p>We’ve seen the <code>&lt;%= ... %&gt;</code> delimiters surrounding the <code>csrf_meta_tags</code> view helper:</p>
<ul>
<li><code>csrf_meta_tags</code> - generates <code>&lt;meta&gt;</code> tags that prevent <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">cross-site request forgery</a></li>
</ul>
<p>The rest of the file may be unfamiliar. We’ll examine it line by line.</p>
<h2 id="1610-adding-boilerplate"><a href="#cid148">16.10 Adding Boilerplate</a></h2>
<p>Webmasters who build static websites are accustomed to setting up web pages with “boilerplate,” or basic templates for a standard web page. The well-known <a href="http://html5boilerplate.com/">HTML5 Boilerplate</a> project has been recommending “best practice” tweaks to web pages since 2010. Very few of the HTML5 Boilerplate recommendations are relevant for Rails developers, as Rails already provides almost everything required. We’ll discuss one important boilerplate item and a few “nice to have” extras.</p>
<p>If you want to learn more, the article <a href="https://railsapps.github.io/rails-html5-boilerplate.html">HTML5 Boilerplate for Rails Developers</a> looks at the recommendations.</p>
<h3 id="16101-viewport"><a href="#uid274">16.10.1 Viewport</a></h3>
<p>The <code>viewport</code> metatag improves the presentation of web pages on mobile devices. Setting a viewport tells the browser how content should fit on the device’s screen. The tag is required for either Bootstrap or Zurb Foundation front-end frameworks.</p>
<p>The <code>viewport</code> metatag looks like this:</p>
<p><meta name="viewport" content="width=device-width, initial-scale=1.0"></p>
<p>Apple’s developer documentation on <a href="https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariWebContent/UsingtheViewport/UsingtheViewport.html">Configuring the Viewport</a> provides details.</p>
<h3 id="16102-title-and-description"><a href="#uid275">16.10.2 Title and Description</a></h3>
<p>If you want to maximize traffic to your website, you should make your web pages search-engine friendly. That means adding <em>title</em> and <em>description</em> metatags. Google uses contents of the title tag to display titles in search results. And it will sometimes use the content of a description metatag in search results snippets. See Google’s explanation of how it uses <a href="https://support.google.com/webmasters/bin/answer.py?hl=en&amp;answer=35624">Site Title and Description</a>. Good titles and descriptions improve clickthrough from Google searches.</p>
<p>Title and description looks like this:</p>
<p><title>&lt;%= content_for?(:title) ? yield(:title) : "Learn Rails" %&gt;</title>
&lt;meta name="description" content="&lt;%= content_for?(:description) ?
    yield(:description) : "Learn Rails" %&gt;"&gt;</p>
<p>The rails_layout gem has created a default title and description based on our project name.</p>
<p>Later in the tutorial, we’ll see how to use a <code>content_for</code> statement to set a title and description for each individual page.</p>
<p>The code is complex if you haven’t seen advanced Ruby before. It uses the Ruby <a href="http://ruby.about.com/od/beginningruby/a/The-Ternary-Or-Conditional-Operator.htm">ternary operator</a> which maximizes compactness at the price of introducing obscurity. You’ll recall from the “Just Enough Ruby” chapter that it is a fancy conditional statement that says, “if <code>content_for?(:title)</code> is present in the view file, use <code>yield(:title)</code> to include it, otherwise just display ‘Learn Rails’.”</p>
<h2 id="1611-asset-pipeline"><a href="#cid149">16.11 Asset Pipeline</a></h2>
<p>You may have noticed these Rails helper methods:</p>
<ul>
<li><code>stylesheet_link_tag</code></li>
<li><code>javascript_include_tag</code></li>
</ul>
<p>These are tags that add CSS and JavaScript to the web page using the Rails <em>asset pipeline</em>.</p>
<p>The Rails <em>asset pipeline</em> utility is one of the most powerful features of the platform. It offers convenience to the developer and helps organize an application; more importantly, it improves the speed and responsiveness of any complex website. If you’re going to do any front-end development with CSS or JavaScript in Rails, you must understand the Rails asset pipeline. Here’s how it works.</p>
<h3 id="16111-assets-without-rails"><a href="#uid278">16.11.1 Assets Without Rails</a></h3>
<p>When building non-Rails websites, webmasters add JavaScript to a page using the <code>&lt;script&gt;</code> tag. For every JavaScript file, they add an additional <code>&lt;script&gt;</code> tag, so a page HEAD section looks like this:</p>
<!DOCTYPE html>
<p><html>
<head>
  <title>Page that uses multiple JavaScript files</title>
<br />
<script src="jquery.js" type="text/javascript"\></script></p>
<script src="jquery.plugin.js" type="text/javascript"\></script>
<script src="custom.js" type="text/javascript"\></script>
<p></head></p>
<p>The same is true for CSS files in non-Rails websites. You add a <code>&lt;link&gt;</code> tag for each stylesheet file. With multiple stylesheets, the HEAD section of your application layout might look like this:</p>
<!DOCTYPE html>
<p><html>
<head>
  <title>Page that uses multiple CSS files</title>
  <link href="core.css" rel="stylesheet" type="text/css" />
  <link href="site.css" rel="stylesheet" type="text/css" />
  <link href="custom.css" rel="stylesheet" type="text/css" />
</head></p>
<p>If you want to handle CSS and JavaScript without Rails, you can place your files in the <strong>public</strong> folder. If you do so, every time you add a JavaScript or CSS file, you must modify the application layout file. Instead, use the asset pipeline and simplify this.</p>
<h3 id="16112-assets-with-rails"><a href="#uid279">16.11.2 Assets With Rails</a></h3>
<p>The asset pipeline consists of two folders:</p>
<ul>
<li><strong>app/assets/javascripts/</strong></li>
<li><strong>app/assets/stylesheets/</strong></li>
</ul>
<p>Any JavaScript and CSS file you add to these folders is automatically added to every page.</p>
<p>In development, when the web browser makes a page request, the files in the asset pipeline folders are combined together and concatenated as single large files, one for JavaScript and one for CSS.</p>
<p>If you examine the application layout file, you’ll see the tags that perform this service:</p>
<p>&lt;%= stylesheet_link_tag 'application', media: 'all',
    'data-turbolinks-track' \=&gt; 'reload' %&gt;
&lt;%= javascript_include_tag 'application', 'data-turbolinks-track' \=&gt; 'reload' %&gt;</p>
<p>The HTML delivered to the browser looks like this:</p>
<p><link href="/assets/application.css" media="all" rel="stylesheet" type="text/css" /></p>
<script src="/assets/application.js" type="text/javascript"\></script>

<p>Using the asset pipeline, there is no need to modify the application layout file each time you create a new JavaScript or CSS file. Create as many files as you need to organize your JavaScript or CSS code and, in production, you’ll automatically get one single file delivered to the browser. In development mode, Rails continues to deliver multiple files for easier debugging.</p>
<p>In production, there’s a big performance advantage with the asset pipeline. Requesting files from the server is a time-consuming operation for a web browser, so every extra file request slows down the browser. The Rails asset pipeline eliminates the performance penalty of multiple <code>&lt;script&gt;</code> or <code>&lt;link&gt;</code> tags. The Rails asset pipeline also compresses JavaScript and CSS files for faster page loads.</p>
<p>The asset pipeline is an example of a Rails convention that helps developers build complex websites. It is not needed for a simple website that uses a few JavaScript or CSS files. But it is beneficial on bigger projects.</p>
<p>The asset pipeline has limitations, especially for projects with complex front-end JavaScript. Rails developers who integrate JavaScript front-end frameworks such as React or Angular often choose not to use the asset pipeline. Instead they rely on JavaScript tooling such as <a href="https://webpack.github.io/">Webpack</a> to manage complex JavaScript assets.</p>
<p>Now that you understand the purpose of the Rails asset pipeline, let’s look at more of the code in the default application layout file.</p>
<h2 id="1612-navigation-links"><a href="#cid150">16.12 Navigation Links</a></h2>
<p>Every website needs navigation links.</p>
<p>You can add navigation links directly to your application layout but many Rails developers prefer to create a <a href="http://guides.rubyonrails.org/layouts_and_rendering.html#using-partials">partial template</a> ––a “partial”––to better organize the default application layout.</p>
<h3 id="16121-introducing-partials"><a href="#uid282">16.12.1 Introducing Partials</a></h3>
<p>A <em>partial</em> is similar to any view file, except the filename begins with an underscore character. Place the file in any view folder and you can use the <code>render</code> keyword to insert the partial.</p>
<p>We’re not going to add a footer to our tutorial application, but here is how we could do it. We’d use the <code>render</code> keyword with a file named <strong>app/views/layouts/_footer.html.erb</strong>:</p>
<p>&lt;%= render 'layouts/footer' %&gt;</p>
<p>Notice that you specify the folder within the <strong>app/views/</strong> directory with a truncated version of the filename. The <code>render</code> method doesn’t want the <code>_</code> underscore character or the <code>.html.erb</code> file extension. That can be confusing; it makes sense when you remember that Rails likes “convention over configuration” and economizes on extra characters when possible.</p>
<p>We’re not going to add a footer to our application, but we will add navigation links by using a partial. First, let’s learn about <em>link helpers</em>.</p>
<h3 id="16122-introducing-link-helpers"><a href="#uid283">16.12.2 Introducing Link Helpers</a></h3>
<p>There’s no rule against using raw HTML in our view files, so we could create a partial for navigation links that uses the HTML <code>&lt;a&gt;</code> anchor tag like this:</p>
<ul class="nav">
 <li><a href="/">Home</a></li>
 <li><a href="/about">About</a></li>
 <li><a href="/contact">Contact</a></li>
</ul>

<p>Rails gives us another option, however. We can use the Rails <code>link_to</code> view helper instead of the HTML <code>&lt;a&gt;</code> anchor tag. The Rails <code>link_to</code> helper eliminates the crufty <code>&lt;&gt;</code> angle brackets and the unnecessary <code>href=""</code>. More importantly, it adds a layer of abstraction, using the routing configuration file to form links. This is advantageous if we make changes to the location of the link destinations. Earlier, when we created a static “About” page, we first set the <strong>config/routes.rb</strong> file with a route to the “About” page: <code>root to: redirect(’/about.html’)</code>. Later we removed the static “About” page and set the <strong>config/routes.rb</strong> file with a route to the dynamic home page: <code>root to: ’visitors#new’</code>. If we used the raw HTML <code>&lt;a&gt;</code> anchor tag, we’d have to change the raw HTML everywhere we had a link to the home page. Using the Rails <code>link_to</code> helper, we name a route and make any changes once, in the <strong>config/routes.rb</strong> file.</p>
<p>When you use the Rails <code>link_to</code> helper, you’ll avoid the problem of link maintenance that webmasters face on static websites. Some webmasters like to use <em>absolute</em> URLs, specifying a host name in the link, for example <code>http://www.example.com/about.html</code>. Absolute URLs are a headache when moving the site, for example from <code>staging.example.com</code> to <code>www.example.com</code>. The problem is avoided by using <em>relative</em> URLs, such as <code>/about.html</code>, <code>about.html</code>, or even <code>../about.html</code>. But relative URLs are fragile, and moving files or directories often results in overlooked and broken links. Instead, with the Rails <code>link_to</code> helper, you always get the destination location specified in the <strong>config/routes.rb</strong> file.</p>
<h3 id="16123-navigation-partial"><a href="#uid284">16.12.3 Navigation Partial</a></h3>
<p>Examine the <strong>app/views/layouts/application.html.erb</strong> and you’ll see the use of the navigation partial.</p>
<p>We include the navigation partial in our application layout with the expression:</p>
<p>.
.
.
&lt;%= render 'layouts/navigation' %&gt;
.
.
.</p>
<p>Open the file <strong>app/views/layouts/_navigation.html.erb</strong>:</p>
<ul class="nav">
 <li><%= link\_to 'Home', root\_path %></li>
 <%= render 'layouts/navigation\_links' %>
</ul>

<p>You’ll see the <code>link_to</code> helper.</p>
<p>Here the <code>link_to</code> helper takes two parameters. The first parameter is the string displayed as the anchor text (<code>’Home’</code>). The second parameter is the route. In this case, the route <code>root_path</code> has been set in the <strong>config/routes.rb</strong> file.</p>
<p>The navigation partial includes another partial, which we’ll call the navigation links partial:</p>
<p>.
.
.
 &lt;%= render 'layouts/navigation_links' %&gt;
.
.
.</p>
<p>This demonstrates that one partial can include another partial, so that partials can be “nested.”</p>
<h3 id="16124-navigation-links-partial"><a href="#uid285">16.12.4 Navigation Links Partial</a></h3>
<p>In our simple application, there’s no obvious reason to nest another partial. But we’ll see in the next chapter that it is convenient, because we can isolate the complex markup required by Bootstrap from the simple list of links we need for navigation.</p>
<p>Open the file <strong>app/views/layouts/_navigation_links.html.erb</strong>:</p>
<p>&lt;%# add navigation links to this file %&gt;</p>
<p>As we add pages to our application, we’ll add links to this file.</p>
<p>For now, we have nothing to add.</p>
<h2 id="1613-flash-messages"><a href="#cid151">16.13 Flash Messages</a></h2>
<p>Rails provides a standard convention to display alerts (including error messages) and other notices (including success messages), called a <em>flash message</em>. The name comes from the term “flash memory” and should not be confused with the “Adobe Flash” web development platform that was once popular for animated websites. The flash message is documented in the <a href="http://guides.rubyonrails.org/action_controller_overview.html#the-flash">RailsGuides: Action Controller Overview</a>.</p>
<p>Here’s a flash message you might see after logging in to an application:</p>
<p><img alt="images/figures/learn-rails-44-flash" src="http://learn-rails.com/images/figures/learn-rails-2/learn-rails-44-flash.png" /></p>
<p>Figure 16.1: Flash message in Rails.</p>
<p>It is called a “flash message” because it appears on a page temporarily. When the page is reloaded or another page is visited, the message disappears.</p>
<p>Typically, you will see only one flash message on a page. But there is no limit to the number of flash messages that can appear on a page.</p>
<h3 id="16131-creating-flash-messages"><a href="#uid287">16.13.1 Creating Flash Messages</a></h3>
<p>Flash messages are created in a controller. For example, we can add messages to the home page by modifying the file <strong>app/controllers/visitors_controller.rb</strong> like this:</p>
<p>class VisitorsController &lt; ApplicationController</p>
<p>def new
    @owner \= Owner.new
    flash[:notice] \= 'Welcome!'
    flash[:alert] \= 'My birthday is soon.'
  end</p>
<p>end</p>
<p>If you test the application after adding the messages to the VisitorsController, you’ll see two flash messages appear on the page.</p>
<p>Rails provides the <code>flash</code> object so that messages can be created in the controller and displayed on the rendered web page.</p>
<p>In this example, we create a flash message by associating the object <code>flash[:notice]</code> with the string <code>’Welcome!’</code>. We can assign other messages, such as <code>flash[:alert]</code> or even <code>flash[:warning]</code>. In practice, Rails uses only <code>:notice</code> and <code>:alert</code> as flash message keys so it is wise to stick with just these.</p>
<h3 id="16132-flash-and-flash-now"><a href="#uid288">16.13.2 Flash and Flash Now</a></h3>
<p>You can control the persistence of the flash message by choosing from two variants of the <code>flash</code> directive.</p>
<p>Use <code>flash.now</code> in the controller when you immediately render a page, for example with a <code>render :new</code> directive. With <code>flash.now</code>, the message will vanish after the user clicks any links.</p>
<p>Use the simple variant, <code>flash</code>, in the controller when you redirect to another page, for example with a <code>redirect_to root_path</code> directive. If you use <code>flash.now</code> before a redirect, the user will not see the flash message because <code>flash.now</code> does not persist through redirects or links. If you use the simple <code>flash</code> directive before a <code>render</code> directive, the message will appear on the rendered page and reappear on a subsequent page after the user clicks a link.</p>
<p>In our example above, we really need to use the <code>flash.now</code> variant because the controller provides a hidden <code>render</code> method. Update the file <strong>app/controllers/visitors_controller.rb</strong>:</p>
<p>class VisitorsController &lt; ApplicationController</p>
<p>def new
    @owner \= Owner.new
    flash.now[:notice] \= 'Welcome!'
    flash.now[:alert] \= 'My birthday is soon.'
  end</p>
<p>end</p>
<p>Using <code>flash.now</code> will make sure the message only appears on the rendered page and will not persist after a user follows a link to a new page.</p>
<p>If you ever see a “sticky” flash message that won’t go away, you need to use <code>flash.now</code> instead of <code>flash</code>.</p>
<h3 id="16133-explaining-the-ruby-code"><a href="#uid289">16.13.3 Explaining the Ruby Code</a></h3>
<p>If you’re new to programming in Ruby, it may be helpful to learn how the <code>flash</code> object works.</p>
<p>The <code>flash</code> object is a Ruby <em>hash</em>.</p>
<p>You’ll recall from the “Just Enough Ruby” chapter that a hash is a data structure that associates a key to some value. You retrieve the value based upon its key. This construct is called a <em>dictionary</em> in other languages, which is appropriate because you use the key to “look up” a value, as you would look up a definition for a word in a dictionary.</p>
<p>Hash is a type of <em>collection</em>. Presumably, the Rails core contributors who implemented the code chose to use a collection so that a page could be given multiple flash messages. Because we have a collection with (possibly) multiple messages, we need to retrieve each message one at a time.</p>
<p>We learned earlier that all collections support an <em>iterator</em> method named <code>each</code>. Iterators return all the elements of a collection, one after the other. The iterator returns each key-value pair, item by item, to a <em>block</em>. In Ruby, a block is delimited by <code>do</code> and <code>end</code> or <code>{ }</code> braces. You can add any code to a block to process each item from the collection.</p>
<p>Here is simple Ruby code to iterate through a <code>flash</code> object, outputting each flash message in an HTML <code>div</code> tag and applying a CSS class for styling:</p>
<p>flash.each do |key, value|
  puts '' + value + ''
end</p>
<p>In this simple example, we use <code>each</code> to iterate through the flash hash, retrieving a <code>key</code> and <code>value</code> that are passed to a block to be output as a string. We’ve chosen the variable names <code>key</code> and <code>value</code> but the names are arbitrary. In the next example, we’ll use <code>name</code> and <code>msg</code> as variables for the key-value pair. The output string will appear as HTML like this:</p>
<div class="notice">Welcome!</div>
<div class="alert">My birthday is soon.</div>

<p>Let’s continue examining our layout files.</p>
<h3 id="16134-the-flash-messages-partial"><a href="#uid290">16.13.4 The Flash Messages Partial</a></h3>
<p>Flash messages are a very useful feature for a dynamic website.</p>
<p>Code to display flash messages can go directly in your application layout file or you can use a partial.</p>
<p>Examine the file <strong>app/views/layouts/_messages.html.erb</strong>:</p>
<p>&lt;% flash.each do |name, msg| %&gt;
 &lt;% if msg.is_a?(String) %&gt;
 &lt;%= content_tag :div, msg, :class \=&gt; "flash_#{name}" %&gt;
 &lt;% end %&gt;
&lt;% end %&gt;</p>
<p>It improves on our simple Ruby example in several ways. First, the expression <code>if msg.is_a?(String)</code> serves as a test to make sure we only display messages that are strings. Second, we use the Rails <code>content_tag</code> view helper to create the HTML <code>div</code>. The <code>content_tag</code> helper eliminates the messy soup of angle brackets and quote marks we used to create the HTML output in the example above. Finally, we apply a CSS <code>class</code> and combine the word “flash” with “notice” or “alert” to make the CSS class.</p>
<p>We include the flash messages partial in our application layout with the expression:</p>
<p>.
.
.
&lt;%= render 'layouts/messages' %&gt;
.
.
.</p>
<h2 id="1614-html5-elements"><a href="#cid152">16.14 HTML5 Elements</a></h2>
<p>Let’s look again at the <strong>app/views/layouts/application.html.erb</strong> file.</p>
<p>To complete our examination of the application layout file, we’ll look at a few structural elements. These elements are not unique to a Rails application and will be familiar to anyone who has done front-end development.</p>
<p>Notice the tags that are structural elements in the HTML5 specification:</p>
<ul>
<li><code>&lt;header&gt;</code></li>
<li><code>&lt;main&gt;</code></li>
</ul>
<p>These elements add structure to a web page. The tags don’t add any new behavior but make it easier to determine the structure of the page and apply CSS styles.</p>
<p>We wrap the navigation partial in the <code>&lt;header&gt;</code> tag:</p>
<header>
 <%= render 'layouts/navigation' %>
</header>

<p>The <code>&lt;header&gt;</code> tag is typically used for branding or navigation.</p>
<p>Notice the <em>main tag</em>:</p>
<main role="main">
 <%= render 'layouts/messages' %>
 <%= yield %>
</main>

<p>We wrap our messages partial and <code>yield</code> expression in a <code>&lt;main role="main"&gt;</code> element. The <code>&lt;main&gt;</code> tag is among the newest HTML5 elements (see the <a href="https://www.w3.org/html/wg/drafts/html/master/grouping-content.html#the-main-element">W3C specification</a> for details). From the specification: “The main content area of a document includes content that is unique to that document and excludes content that is repeated across a set of documents such as site navigation links, copyright information, site logos.” We follow the advice of the specification and wrap our unique content in the <code>&lt;main&gt;</code> tag.</p>
<p>The specification recommends, “Authors are advised to use ARIA role=’main’ attribute on the main element until user agents implement the required role mapping.” <a href="https://www.w3.org/WAI/intro/aria">ARIA</a>, the Accessible Rich Internet Applications Suite, is a specification to make web applications more accessible to people with disabilities. That means the <code>role="main"</code> attribute is there for any web browsers that don’t yet recognize the <code>&lt;main&gt;</code> tag, and may help people with disabilities.</p>
<p>We could add a <code>&lt;footer&gt;</code> tag. It typically contains links to copyright information, legal disclaimers, or contact information. We don’t have a footer in our tutorial application but you can add the <code>&lt;footer&gt;</code> tag, with additional content, if you want.</p>
<h2 id="1615-application-layout"><a href="#cid153">16.15 Application Layout</a></h2>
<p>Our application layout is complete. We don’t have to add anything because the rails_layout gem has created everything we need.</p>
<!DOCTYPE html>
<p><html>
 <head>
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>&lt;%= content_for?(:title) ? yield(:title) : "Learn Rails" %&gt;</title>
 &lt;meta name="description" content=
 "&lt;%= content_for?(:description) ? yield(:description) : "Learn Rails" %&gt;"&gt;
 &lt;%= stylesheet_link_tag 'application', media: 'all',
      'data-turbolinks-track' \=&gt; 'reload' %&gt;
 &lt;%= javascript_include_tag 'application', 'data-turbolinks-track' \=&gt; 'reload' %&gt;
 &lt;%= csrf_meta_tags %&gt;
 </head>
 
<body>
 <header>
 <%= render 'layouts/navigation' %>
 </header>
 <main role="main">
 <%= render 'layouts/messages' %>
 <%= yield %>
 </main>
 </body></p>
<p></html></p>
<p>We have the <code>viewport</code> metatag, a title, and a description.</p>
<p>We have partials for navigation links and flash messages.</p>
<p>Finally we have HTML5 structural elements.</p>
<p>That’s all we need for now. In the next chapter, we’ll revise it to support styling with Bootstrap.</p>
<h2 id="1616-simple-css"><a href="#cid154">16.16 Simple CSS</a></h2>
<p>So far, we’ve examined four files that were added by the rails_layout gem:</p>
<ul>
<li><strong>app/views/layouts/application.html.erb</strong></li>
<li><strong>app/views/layouts/_messages.html.erb</strong></li>
<li><strong>app/views/layouts/_navigation.html.erb</strong></li>
<li><strong>app/views/layouts/_navigation_links.html.erb</strong></li>
</ul>
<p>Let’s examine the CSS file that was created by the rails_layout gem.</p>
<p>Open the file <strong>app/assets/stylesheets/simple.css</strong>:</p>
<p>/*
 * Simple CSS stylesheet for a navigation bar and flash messages.
 */
main {
  background-color: #eee;
  padding-bottom: 80px;
  width: 100%;
  }
header {
  border: 1px solid #d4d4d4;
  background-image: linear-gradient(to bottom, white, #f2f2f2);
  background-color: #f9f9f9;
  -webkit-box-shadow: 0 1px 10px rgba(0, 0, 0, 0.1);
  -moz-box-shadow: 0 1px 10px rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 10px rgba(0, 0, 0, 0.1);
  margin-bottom: 20px;
  font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
}
ul.nav li {
  display: inline;
}
ul.nav li a {
  padding: 10px 15px 10px;
  color: #777777;
  text-decoration: none;
  text-shadow: 0 1px 0 white;
}
.flash_notice, .flash_alert {
  padding: 8px 35px 8px 14px;
  margin-bottom: 20px;
  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
  border: 1px solid #fbeed5;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  border-radius: 4px;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: 14px;
  line-height: 20px;
}
.flash_notice {
  background-color: #dff0d8;
  border-color: #d6e9c6;
  color: #468847;
}
.flash_alert {
  background-color: #f2dede;
  border-color: #eed3d7;
  color: #b94a48;
}</p>
<p>If you already know CSS, you’ll see we’ve set a background color for the <code>main</code> section of the page. We’ve also set styles for a header, navigation links, and flash messages. This book is about Rails, not CSS, so we won’t examine this closely. For more on CSS, there are thousands of tutorials on the web, but I like these:</p>
<ul>
<li><a href="https://www.codecademy.com/courses/web-beginner-en-TlhFi/0/1?curriculum_id=50579fb998b470000202dc8b">Codeacademy</a></li>
<li><a href="http://htmldog.com/guides/css/beginner/">HTML Dog</a></li>
</ul>
<p>Remember what we learned about the Rails asset pipeline. By default, any CSS file in the <strong>app/assets/stylesheets/</strong> folder will be added automatically to the <strong>application.css</strong> file that is included in the default application layout.</p>
<p>In the next chapter, we remove the <strong>app/assets/stylesheets/simple.css</strong> and use Bootstrap to supply styles for the header, navigation links, and flash messages. For now, the <strong>simple.css</strong> file adds some basic styling and layout to the application.</p>
<h2 id="1617-test-the-application"><a href="#cid155">16.17 Test the Application</a></h2>
<p>Let’s run the application to see how it looks with the new application layout. The web server may already be running. If not, enter the command:</p>
<p>$ rails server</p>
<p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>.</p>
<p>If you experimented with adding flash messages “Welcome” and “My birthday is soon,” you’ll see the messages when you visit the home page.</p>
<p>Our home page now has only one navigation link, for “Home.” We’ll add links for “About” and “Contact” pages soon.</p>
<h2 id="1618-git"><a href="#cid156">16.18 Git</a></h2>
<p>Let’s commit our changes to the Git repository and push to GitHub:</p>
<p>$ git add -A
$ git commit -m "update application layout"
$ git push</p>
<h1 id="chapter-17-front-end-framework"><a href="#cid157">Chapter 17 Front-End Framework</a></h1>
<p>This chapter discusses front-end development and design using CSS. I’ll show you how to add style to a Rails application, using Bootstrap for a simple theme.</p>
<p>What do we mean by “front-end development”? A website <em>back end</em> is the Rails application that assembles files that are sent to the browser, plus a database and any other server-side services. A website <em>front end</em> is all the code that runs in the browser. Everything that controls the appearance of the website in the browser is the responsibility of a front-end developer, including page layout, CSS stylesheets, and JavaScript code.</p>
<p>Front-end development has grown increasingly important as websites have become more sophisticated. And front-end technology has grown increasingly complex, to the degree that front-end development has become a job for specialists.</p>
<p>Front-end developers are primarily concerned with:</p>
<ul>
<li>markup - the layout and structure of the page</li>
<li>style - graphic design for visual communication</li>
<li>interactivity - browser-based visual effects and user interaction</li>
</ul>
<p>Broader concerns include:</p>
<ul>
<li>cross-browser and cross-device functionality</li>
<li>interaction design to improve website usability</li>
<li>accessibility for users with physical or perceptual limitations</li>
</ul>
<p>For years, front-end development was haphazard; webmasters each had their own quirky techniques. Around the time that Rails became popular, front-end developers at large companies began to share best practices and establish open source projects to bring structure and consistency to front-end development, leading to development of CSS frameworks.</p>
<h2 id="171-css-frameworks"><a href="#cid158">17.1 CSS Frameworks</a></h2>
<p>Web developers began putting together “boilerplate” CSS stylesheets as early as 2000, when browsers first began to fully support CSS. Boilerplate CSS made it easy to reuse CSS stylesheet rules from project to project. More importantly, designers often implemented “CSS reset” stylesheets to enforce typographic uniformity across different browsers.</p>
<p>Engineers at Yahoo! released the <a href="https://yuilibrary.com/">Yahoo! User Interface Library</a> (YUI) as an open source project <a href="http://www.yuiblog.com/blog/2006/02/">in February 2006</a>. Inspired by an <a href="https://web.archive.org/web/20080516101830/http://www.alistapart.com/articles/frameworksfordesigners/">article by Jeff Croft</a>, and reacting to the huge size of the YUI library, independent developers began releasing other CSS frameworks such as the <a href="http://960.gs/">960 grid system</a> and the <a href="http://www.blueprintcss.org/">Blueprint</a> CSS framework.</p>
<p>There are <a href="https://en.wikipedia.org/wiki/CSS_frameworks">dozens of CSS frameworks</a>. In general, they all seek to implement a common set of requirements:</p>
<ul>
<li>An easily customizable grid</li>
<li>Some default typography</li>
<li>A typographic baseline</li>
<li>CSS reset for default browser styles</li>
<li>A stylesheet for printing</li>
</ul>
<p>More recently, with the ubiquity of smartphones and tablets, CSS frameworks support <a href="https://en.wikipedia.org/wiki/Responsive_web_design">responsive web design</a>, accommodating differences in screen sizes across a range of devices.</p>
<p>In tandem with the development of CSS frameworks, we’ve seen the emergence of JavaScript libraries and frameworks.</p>
<h2 id="172-javascript-libraries-and-frameworks"><a href="#cid159">17.2 JavaScript Libraries and Frameworks</a></h2>
<p>JavaScript has nothing like RubyGems, a built-in package manager for code libraries, so initially there were few open source JavaScript libraries. Now there are several competing <a href="https://wibblycode.wordpress.com/2013/01/01/the-state-of-javascript-package-management/">JavaScript package managers</a> and many software libraries.</p>
<p><a href="https://en.wikipedia.org/wiki/Prototype_JavaScript_Framework">Prototype</a> was one of the first open source JavaScript libraries, created by Sam Stephenson in February 2005 to improve JavaScript support in Ruby on Rails. <a href="https://en.wikipedia.org/wiki/MooTools">MooTools</a>, <a href="https://en.wikipedia.org/wiki/Dojo_Toolkit">Dojo</a>, and <a href="https://en.wikipedia.org/wiki/Jquery">jQuery</a> soon followed. Of these libraries, jQuery has become the most popular, largely because of thousands of modular jQuery <em>plug-ins</em> that implement a wide range of effects and <em>widgets</em> (web page features). These plug-ins are used to add visual effects and interactivity to web pages. Examples are drop-down menus, modal windows, tabbed panels, autocompletion search forms, and sliders or carousels for images. Even without plugins, jQuery is useful as a high-level interface for manipulating the browser DOM (<a href="https://en.wikipedia.org/wiki/Document_Object_Model">document object model</a>), to make it easy to do things like hiding or revealing HTML elements on a page. Any Rails application can use jQuery because it is included by default in any new Rails application.</p>
<p>Libraries such as jQuery add functionality to server-side applications, such as those built with Rails. Other JavaScript libraries serve as fully featured web application development frameworks, allowing developers to build client-side applications that run in the browser and only interact with a server to read or write data. Examples of these full-fledged JavaScript frameworks are <a href="http://emberjs.com/">Ember.js</a>, <a href="http://www.angularjs.org/">AngularJS</a>, and <a href="http://backbonejs.org/">Backbone.js</a>. All use a variant of the model-view-controller (MVC) software design pattern to implement <a href="https://en.wikipedia.org/wiki/Single-page_application">single-page applications</a> which function more like desktop or mobile applications than websites. Developers who build a single-page application with one of these frameworks often use Ruby on Rails as a back end; an MVC JavaScript framework can replace all the Rails view files. None of these JavaScript frameworks dominate web application development like Ruby on Rails, but they are gaining popularity for single-page applications. We won’t look at Ember.js, AngularJS, or Backbone.js in this book; they are an advanced topic and require entire books themselves.</p>
<p>The biggest problem with adding JavaScript to Rails is the difficult-to-maintain “JavaScript soup” that results from adding JavaScript to Rails views. Ember.js, AngularJS, or Backbone.js are more than is needed for simply structuring JavaScript in Rails views. But there’s a newer framework that can be used to dry up JavaScript soup. It’s <a href="http://reactjs.com/">React</a>, a JavaScript framework developed by engineers at Facebook. Unlike AngularJS or Ember.js, React only manages views, not connections to databases or routing of requests, so it is not a full-stack framework, just a framework for the view layer. React’s approach to building web pages is abstract and complex. But React is a good choice for complex interactive features, if you’re determined to avoid JavaScript soup in your Rails application.</p>
<p>We won’t look at JavaScript frameworks in this book, but we will use the Bootstrap framework to manage our CSS stylesheets.</p>
<h2 id="173-front-end-frameworks"><a href="#cid160">17.3 Front-End Frameworks</a></h2>
<p>Front-end frameworks combine CSS and JavaScript libraries. Many elements that are found on sophisticated web pages, such as modal windows or tabs, require a combination of JavaScript and CSS. Combining CSS and JavaScript libraries in a common framework makes it possible to standardize and reuse common web page features.</p>
<p>There are many responsive front-end frameworks to choose from, including:</p>
<ul>
<li><a href="https://getbootstrap.com/">Bootstrap</a></li>
<li><a href="http://foundation.zurb.com/">Zurb Foundation</a></li>
<li><a href="https://getmdl.io/">Material Design Lite</a></li>
<li><a href="http://neat.bourbon.io/">Bourbon Neat</a></li>
<li><a href="http://semantic-ui.com/">Semantic UI</a></li>
<li><a href="http://speckyboy.com/2013/10/13/15-new-responsive-frameworks/">and many others</a></li>
</ul>
<p>Each has its fans, though Bootstrap and Zurb Foundation are the most popular among Rails developers. Each adds a library of markup, styles, and standardized web page features such as modal windows, pagination, breadcrumbs, and navigation.</p>
<p><a href="https://getbootstrap.com/">Bootstrap</a> is the best-known front-end framework. It is the result of an effort to document and share common design patterns and assets across projects at Twitter, released as an open source project in August 2011.</p>
<p>Just ahead, we’ll look at why we use Bootstrap in this book. But first, you’ll need to learn about Sass.</p>
<h2 id="174-css-preprocessing-with-sass"><a href="#cid161">17.4 CSS Preprocessing with Sass</a></h2>
<p>Ordinary CSS is not a programming language. As a result, CSS rules are verbose and often repetitive. To add efficiency to CSS, Bootstrap relies on a CSS preprocessor named <a href="http://sass-lang.com/">Sass</a>. Sass extends CSS to give it more powerful programming language features. As a result, your stylesheets can use variables, mixins, and nesting of CSS rules, just like a real programming language.</p>
<p>For example, in Sass you can create a variable such as <code>$blue: #3bbfce</code> and specify colors anywhere using the variable, such as <code>border-color: $blue</code>. <em>Mixins</em> are like variables that let you use snippets of reusable CSS. <em>Nesting</em> eliminates repetition by layering CSS selectors.</p>
<p>Sass is included in any new Rails application with the default <a href="https://github.com/rails/sass-rails">sass-rails</a> gem.</p>
<h2 id="175-bootstrap-or-others"><a href="#cid162">17.5 Bootstrap or Others?</a></h2>
<p>Which front-end framework should you use? Bootstrap or another such as Zurb Foundation?</p>
<p>The Bootstrap team maintains a Ruby gem that provides a drop-in version of Bootstrap for Rails. Other front-end frameworks, such as Zurb Foundation, are also available as Ruby gems. But Bootstrap has a large developer community and many more third-party projects, as evidenced by a <a href="http://www.bootstraphero.com/the-big-badass-list-of-twitter-bootstrap-resources/">Big Badass List of Useful Twitter Bootstrap Resources</a>. In its sheer magnitude, this list, from Michael Buckbee and Bootstrap Hero, demonstrates the popularity of Bootstrap and the vitality of its open source community. We’ll use Bootstrap here because of its sheer popularity and solid support.</p>
<p>Before I show you how to integrate Bootstrap with your Rails application, let’s briefly consider matters of design.</p>
<h2 id="176-graphic-design-options"><a href="#cid163">17.6 Graphic Design Options</a></h2>
<p>There are three approaches to graphic design for your Rails application.</p>
<p>If you’re well-funded and well-connected, you can put together a team or hire a freelance graphic designer to implement a unique design, built from scratch using CSS or customized from a framework such as Bootstrap or Zurb Foundation. If you’ve got strong design skills, or can partner with an experienced web designer, you’ll get a custom design that expresses the purpose and motif of your website.</p>
<p>A second approach is to use Bootstrap or another CSS framework to quickly add attractive CSS styling to your application. Many developers don’t have the skill or resources to customize the design. Consequently, sites that use Bootstrap look very similar. If that’s your situation, it’s okay, really! It’s better to have a decent site with the clean look of Bootstrap than to leak ugliness onto the web.</p>
<p>A third option is to obtain a pre-designed theme for your website. You may have visited <a href="https://themeforest.net/">ThemeForest</a> or other theme galleries that offer pre-built themes for a few dollars each. These huge commercial galleries offer themes for WordPress, Tumblr, or CMS applications such as Drupal or Joomla. They don’t offer themes for Rails. Your best option is to convert open source themes designed with Bootstrap. You can visit sites such as <a href="https://startbootstrap.com/">Start Bootstrap</a>, <a href="https://bootswatch.com/">Bootswatch</a>, or the <a href="http://code.divshot.com/themestrap/">Themestrap</a> gallery to find Bootstrap themes.</p>
<p>Whether you use a prepackaged theme or design your own layout, you’ll need to know how to set up a front-end framework in Rails. We’ll look at setting up Bootstrap next.</p>
<h2 id="177-bootstrap-3-or-4"><a href="#cid164">17.7 Bootstrap 3 or 4?</a></h2>
<p>At the time this was written, the new Bootstrap 4 version was in alpha release. The Bootstrap 4 version is significantly different from earlier versions. It has been in alpha for testing and feedback for over a year. Many Rails developers are already using the Bootstrap 4 version but almost all themes and third-party add-ons are only available for Bootstrap 3. Eventually, the Bootstrap 4 beta and final versions will be released but until then, I recommend sticking with Bootstrap 3. As a beginner, you’ll find more resources and help for Bootstrap 3. We’ll use it here for this tutorial.</p>
<h2 id="178-bootstrap-gem"><a href="#cid165">17.8 Bootstrap Gem</a></h2>
<p>Bootstrap provides a standard grid for layout plus dozens of reusable components for common page elements such as navigation, forms, and buttons. More importantly, it gives CSS the kind of structure and convention that makes Rails popular for back-end development. Bootstrap is packaged as a gem.</p>
<p>In your <strong>Gemfile</strong>, you’ve already added:</p>
<p>gem 'bootstrap-sass'</p>
<p>and previously run <code>$ bundle install</code>.</p>
<p>The <a href="https://github.com/twbs/bootstrap-sass">bootstrap-sass gem</a> provides the files required to integrate Bootstrap 3 with Rails. Developers who want to use the new Bootstrap 4 release will use the <a href="https://github.com/twbs/bootstrap-rubygem">Bootstrap 4 gem</a>.</p>
<p>Rather than following the installation instructions provided in the <a href="https://getbootstrap.com/getting-started/">Bootstrap documentation</a>, we’ll use the <a href="https://github.com/RailsApps/rails_layout">rails_layout</a> gem to set up Bootstrap and create the files we need.</p>
<h2 id="179-rails-layout-gem-with-bootstrap"><a href="#cid166">17.9 Rails Layout Gem with Bootstrap</a></h2>
<p>In the previous chapter, we used the <a href="https://github.com/RailsApps/rails_layout">rails_layout</a> gem to configure the default application layout with HTML5 elements, navigation links, and flash messages. Now we’ll use the rails_layout gem to set up Bootstrap and generate new files for the application layout as well as the navigation and messages partials. The new files will replace the layout files we created in the previous chapter.</p>
<p>We’ll use the generator provided by the rails_layout gem to set up Bootstrap and add the necessary files. Run:</p>
<p>$ rails generate layout:install bootstrap3 --force</p>
<p>With the <code>–force</code> argument, the rails_layout gem will replace existing files.</p>
<p>The gem will create the file:</p>
<ul>
<li><strong>app/assets/stylesheets/1st_load_framework.css.scss</strong></li>
</ul>
<p>and modify the files:</p>
<ul>
<li><strong>app/assets/javascripts/application.js</strong></li>
<li><strong>app/views/layouts/_messages.html.erb</strong></li>
<li><strong>app/views/layouts/_navigation.html.erb</strong></li>
<li><strong>app/views/layouts/application.html.erb</strong></li>
</ul>
<p>It will also remove the file:</p>
<ul>
<li><strong>app/assets/stylesheets/simple.css</strong></li>
</ul>
<p>Let’s examine the files to see how our application is configured to use Bootstrap.</p>
<h2 id="1710-renaming-the-applicationcss-file"><a href="#cid167">17.10 Renaming the application.css File</a></h2>
<p>The rails_layout gem renamed the <strong>app/assets/stylesheets/application.css</strong> file as <strong>app/assets/stylesheets/application.css.scss</strong>. Note the <strong>.scss</strong> file extension. This will allow you to use the advantages of an improved syntax for your application stylesheet.</p>
<p>You learned earlier that stylesheets can use variables, mixins, and nesting of CSS rules when you use Sass.</p>
<p>Sass has two syntaxes. The most commonly used syntax is known as “SCSS” (for “Sassy CSS”), and is a superset of the CSS syntax. This means that every valid CSS stylesheet is valid SCSS as well. SCSS files use the extension <strong>.scss</strong>. The Sass project also offers a second, older syntax with indented formatting that uses the extension <strong>.sass</strong>. We’ll use the SCSS syntax.</p>
<p>You can use Sass in any file by adding the file extension <strong>.scss</strong>. The asset pipeline will preprocess any <strong>.scss</strong> file and expand it as standard CSS.</p>
<p>For more on the advantages of Sass and how to use it, see the <a href="http://sass-lang.com/">Sass</a> website or the <a href="http://railscasts.com/episodes/268-sass-basics">Sass Basics RailsCast</a> from Ryan Bates.</p>
<p>Before you continue, make sure that the rails_layout gem renamed the <strong>app/assets/stylesheets/application.css</strong> file as <strong>app/assets/stylesheets/application.css.scss</strong>. Otherwise you won’t see the CSS styling we will apply.</p>
<h2 id="1711-the-applicationcssscss-file"><a href="#cid168">17.11 The application.css.scss File</a></h2>
<p>In the previous chapter, I introduced the Rails <em>asset pipeline</em>.</p>
<p>Your CSS stylesheets get concatenated and compacted for delivery to the browser when you add them to this directory:</p>
<ul>
<li><strong>app/assets/stylesheets/</strong></li>
</ul>
<p>The asset pipeline helps web pages display faster in the browser by combining all CSS files into a single file (it does the same for JavaScript).</p>
<p>Let’s examine the file <strong>app/assets/stylesheets/application.css.scss</strong>:</p>
<p>/*
 * This is a manifest file that'll be compiled into application.css, which will include all the files
 * listed below.
 *
 * Any CSS and SCSS file within this directory, lib/assets/stylesheets, or any plugin's
 * vendor/assets/stylesheets directory can be referenced here using a relative path.
 *
 * You're free to add application-wide styles to this file and they'll appear at the bottom of the
 * compiled file so the styles you add here take precedence over styles defined in any other CSS/SCSS
 * files in this directory. Styles in this file should be added after the last require_* statement.
 * It is generally better to create a new file per style scope.
 *
 *= require_tree .
 *= require_self
 */</p>
<p>The <strong>app/assets/stylesheets/application.css.scss</strong> file serves two purposes.</p>
<p>First, you can add any CSS rules to the file that you want to use anywhere on your website. Second, the file serves as a <em>manifest</em>, providing a list of files that should be concatenated and included in the single CSS file that is delivered to the browser.</p>
<p>If you are familiar with CSS syntax, it may seem odd that the relevant lines are commented out (using asterisks). These lines are not CSS, so they must be commented out so they won’t be interpreted as CSS. Though they are commented out, the Rails asset pipeline reads and understands them. It’s a bit of a hack, but it works.</p>
<h3 id="17111-a-global-css-file"><a href="#uid323">17.11.1 A Global CSS File</a></h3>
<p>Any CSS style rules that you add to the <strong>app/assets/stylesheets/application.css.scss</strong> file will be available to any view in the application. You could use this file for any style rules that are used on every page, particularly simple utility rules such as highlighting or resetting the appearance of links. However, in practice, you are more likely to modify the style rules provided by Bootstrap. These modifications don’t belong in the <strong>app/assets/stylesheets/application.css.scss</strong> file; they will go in the <strong>app/assets/stylesheets/1st_load_framework.css.scss</strong> file.</p>
<p>In general, it’s bad practice to place a lot of CSS in the <strong>app/assets/stylesheets/application.css.scss</strong> file (unless your CSS is very limited). Instead, structure your CSS in multiple files. CSS that is used on only a single page can go in a file with a name that matches the page. Or, if sections of the website share common elements, such as themes for landing pages or administrative pages, make a file for each theme. How you organize your CSS is up to you; the asset pipeline lets you organize your CSS so it is easier to develop and maintain. Just add the files to the <strong>app/assets/stylesheets/</strong> folder.</p>
<h3 id="17112-a-manifest-file"><a href="#uid324">17.11.2 A Manifest File</a></h3>
<p>It’s not obvious from the name of the <strong>app/assets/stylesheets/application.css.scss</strong> file that it serves as a <em>manifest file</em> as well as a location for miscellaneous CSS rules. For most websites, you can ignore its role as a manifest file. In the comments at the top of the file, the <code>*= require_self</code> directive indicates that any CSS in the file should be delivered to the browser. The <code>*= require_tree .</code> directive (note the Unix “dot operator”) indicates any files in the same folder, including files in subfolders, should be combined into a single file for delivery to the browser.</p>
<p>If your website is large and complex, you can remove the <code>*= require_tree .</code> directive and specify individual files to be included in the file that is generated by the asset pipeline. This gives you the option of reducing the size of the application-wide CSS file that is delivered to the browser. For example, you might segregate a file that includes CSS that is used only in the site’s administrative section. In general, only large and complex sites need this optimization. The speed of rendering a single large CSS file is faster than fetching multiple files.</p>
<h2 id="1712-bootstrap-javascript"><a href="#cid169">17.12 Bootstrap JavaScript</a></h2>
<p>Bootstrap provides both CSS and JavaScript libraries.</p>
<p>Like the <strong>application.css.scss</strong> file, the <strong>application.js</strong> file is a manifest that allows a developer to designate the JavaScript files that will be combined for delivery to the browser.</p>
<p>The rails_layout gem modified the file <strong>app/assets/javascripts/application.js</strong> to include jQuery and the Bootstrap JavaScript libraries:</p>
<p>//= require jquery
//= require jquery_ujs
//= require turbolinks
//= require bootstrap-sprockets
//= require_tree .</p>
<p>It added the directives <code>//= require jquery</code> and <code>//= require jquery_ujs</code> to make jQuery available to the application.</p>
<p>Keep in mind that Rails 5.1 dropped jQuery and no longer includes the <a href="https://github.com/rails/jquery-rails">jquery-rails</a> gem by default. We added the jquery-rails gem to the Gemfile (and ran <code>bundle install</code>). Without the jquery-rails gem, you’ll get an error when you run the application.</p>
<p>The rails_layout command also added the directive <code>//= require bootstrap-sprockets</code> before <code>//= require_tree .</code> to enable the Bootstrap front-end framework. Some of the features offered by Bootstrap require the jQuery library which is why the rails_layout command modifies the <strong>app/assets/javascripts/application.js</strong> file.</p>
<h2 id="1713-bootstrap-css"><a href="#cid170">17.13 Bootstrap CSS</a></h2>
<p>The rails_layout gem added a file <strong>app/assets/stylesheets/1st_load_framework.css.scss</strong> containing:</p>
<p>// import the CSS framework
@import "bootstrap-sprockets";
@import "bootstrap";
.
.
.</p>
<p>The file <strong>app/assets/stylesheets/1st_load_framework.css.scss</strong> is automatically included and compiled into your Rails application.css file by the <code>*= require_tree .</code> statement in the <strong>app/assets/stylesheets/application.css.scss</strong> file. The file could be named anything. However, by giving it a name beginning with “1” it will load before any other stylesheet files we may add later. The asset pipeline loads files in alphabetical order. We want the Bootstrap framework to load before any custom CSS files.</p>
<p>The <code>@import "bootstrap";</code> and <code>@import "bootstrap-sprockets";</code> directives will import the Bootstrap CSS rules from the Bootstrap gem.</p>
<p>You could add the Bootstrap <code>@import</code> code to the <strong>app/assets/stylesheets/application.css.scss</strong> file. However, it is better to have a separate <strong>app/assets/stylesheets/1st_load_framework.css.scss</strong> file. You may wish to modify the Bootstrap CSS rules; placing changes to Bootstrap CSS rules in the <strong>1st_load_framework.css.scss</strong> file will keep your CSS better organized.</p>
<p>In addition to the simple <code>@import</code> directives, the <strong>app/assets/stylesheets/1st_load_framework.css.scss</strong> contains a collection of Sass mixins. We’ll look at these later in the chapter.</p>
<h2 id="1714-using-bootstrap-css-classes"><a href="#cid171">17.14 Using Bootstrap CSS Classes</a></h2>
<p>Now that you’ve installed Bootstrap, you have a rich library of interactive effects you can add to your pages.</p>
<p>Take a look at the <a href="https://getbootstrap.com/">Bootstrap documentation</a> to see your options. Here are just a few examples:</p>
<ul>
<li><a href="https://getbootstrap.com/css/#buttons">buttons</a></li>
<li><a href="https://getbootstrap.com/components/#navbar">navigation bar</a></li>
<li><a href="https://getbootstrap.com/components/#alerts">alerts</a></li>
</ul>
<p>At a simpler level, Bootstrap provides a collection of carefully-crafted styling rules in the form of CSS classes. These are building blocks you use for page layout and typographic styling. For example, Bootstrap gives you CSS classes to set up rows and columns in a grid system.</p>
<p>Let’s take a closer look at the Bootstrap grid system.</p>
<h3 id="17141-bootstrap-grid"><a href="#uid328">17.14.1 Bootstrap Grid</a></h3>
<p>The <a href="https://getbootstrap.com/css/#grid">Bootstrap grid</a> is responsive because it has “breakpoints.” There are actually four grids:</p>
<ul>
<li>Extra small: browser windows 0 to 768 pixels wide (phones)</li>
<li>Small: browser windows 768 to 992 pixels wide (tablets)</li>
<li>Medium: browser windows 992 to 1200 pixels wide (desktops)</li>
<li>Large: browser windows 1200 pixels and wider (large desktops)</li>
</ul>
<p>Start by designing for the extra small screen; then add classes prefixed “small,” “medium,” or “large” if you want a different layout for larger screens. The layout will change at each breakpoint.</p>
<p>The grid gives you 12 columns by default. You can organize your layout in horizontal and vertical sections using <code>row</code> and <code>columns</code> classes.</p>
<p>For example, you could use Bootstrap grid classes to set up an application layout with a footer as a row with two sections:</p>
<div class="container"\>
  <footer class="row"\>
    <section class="col-xs-4"\>
      Copyright 2016
    </section>
    <section class="col-xs-8"\>
      All rights reserved.
    </section>
  </footer>
</div>

<p>The Bootstrap <code>row</code> class will create a horizontal break. The footer will contain two side-by-side sections. The first will be four columns wide; the second will be eight columns wide.</p>
<p>Here’s the same footer with a responsive design:</p>
<div class="container"\>
  <footer class="row"\>
    <section class="col-xs-12 col-sm-4"\>
      Copyright 2016
    </section>
    <section class="col-xs-12 col-sm-8"\>
      All rights reserved.
    </section>
  </footer>
</div>

<p>On desktops and tablets, the footer will contain two side-by-side sections. On phones, each section will expand to take the full browser width, appearing as stacked rows.</p>
<p>To better understand the grid system with all its options, see the <a href="https://getbootstrap.com/css/#grid">documentation for the Bootstrap grid</a>.</p>
<h3 id="17142-presentational-versus-semantic-styles"><a href="#uid333">17.14.2 Presentational Versus Semantic Styles</a></h3>
<p>There are two schools of thought among front-end developers. Some developers are content to use Bootstrap’s classes directly in Rails view files. For these developers, the Bootstrap classes are both practical and descriptive, making it easy for any developer who knows the Bootstrap framework to visualize the layout of a page.</p>
<p>Other developers take issue with this approach. They argue that Bootstrap’s markup is often <em>presentational</em>, with class names describing the appearance of the page. In an ideal world, all markup would be <em>semantic</em>, with class names describing the function or purpose of a style. For example, a submit button often needs styling. Compare these two approaches to markup:</p>
<ul>
<li>presentational: <code>&lt;button class="big red button"&gt;Order Now&lt;/button&gt;</code></li>
<li>semantic: <code>&lt;button class="submit"&gt;Order Now&lt;/button&gt;</code></li>
</ul>
<p>Suppose your user testing indicates a green button generates more sales. With the presentational approach you’d have to change both the Rails view file and the CSS file. With a semantic approach, you’d just change the CSS file to reassign the color of the <code>submit</code> class.</p>
<h3 id="17143-use-bootstrap-classes-directly"><a href="#uid336">17.14.3 Use Bootstrap Classes Directly</a></h3>
<p>For quick and simple websites, where you don’t need to be concerned about long-term maintenance, use Bootstrap’s CSS classes directly.</p>
<p>For example, you can style a button like this:</p>
<ul>
<li><code>&lt;button type="button" class="btn btn-success"&gt;Order Now&lt;/button&gt;</code></li>
</ul>
<p>The <code>btn-success</code> class is semantic and applies an “alert color” which is green, by default, in Bootstrap.</p>
<h3 id="17144-or-use-sass-mixins-with-bootstrap"><a href="#uid338">17.14.4 Or Use Sass Mixins with Bootstrap</a></h3>
<p>You can use Sass mixins to create your own semantic class names.</p>
<p>Sass mixins add a layer of complexity that can map Bootstrap class names to your own semantic class names.</p>
<p>For example, the Bootstrap grid system is presentational. Specifying rows and columns, and quantifying the size of columns, describes the visual appearance of sections of the layout rather than the purpose of each section. The presentational approach makes it easy to visualize the layout of a page. But you’ll be tied to Bootstrap 3 class names for the life of your website. If class names change in a future version of Bootstrao, or you decide to switch to another front-end framework, it will be difficult to update your application, as you will have to carefully rebuild each view file.</p>
<p>Is it worth the effort to add the complexity of Sass mixins just to future-proof your website? Probably not for a simple website such as the one you are building for Foobar Kadigan.</p>
<p>The rails_layout gem uses Sass mixins to apply CSS style rules to the default application layout. In doing so, the default application layout is free of framework-specific code and can be used with either Bootstrap or Zurb Foundation.</p>
<p>Before we examine the default application layout, let’s take a look at the Sass mixins supplied by the rails_layout gem.</p>
<p>Look again at the file <strong>app/assets/stylesheets/1st_load_framework.css.scss</strong> created by the rails_layout gem:</p>
<p>// import the CSS framework
@import "bootstrap-sprockets";
@import "bootstrap";</p>
<p>// make all images responsive by default
img {
  @extend .img-responsive;
  margin: 0 auto;
  }
// override for the 'Home' navigation link
.navbar-brand {
  font-size: inherit;
  }</p>
<p>// THESE ARE EXAMPLES YOU CAN MODIFY
// create your own classes
// to make views framework-neutral
.column {
  @extend .col-md-6;
  @extend .text-center;
  }
.form {
  @extend .col-md-6;
  }
.form-centered {
  @extend .col-md-6;
  @extend .text-center;
  }
.submit {
  @extend .btn;
  @extend .btn-primary;
  @extend .btn-lg;
  }
// apply styles to HTML elements
// to make views framework-neutral
main {
  @extend .container;
  background-color: #eee;
  padding-bottom: 80px;
  width: 100%;
  margin-top: 51px; // accommodate the navbar
  }
section {
  @extend .row;
  margin-top: 20px;
  }</p>
<p>The rails_layout gem is in active development so the file you’ve created may be different from the example in this tutorial. It will probably be very similar.</p>
<p>At the top of the file we import the Bootstrap framework CSS files from the gem.</p>
<p>We override a Bootstrap style rule so the “Home” navigation link matches the other links in the navigation bar.</p>
<p>Then we use mixins to create semantic classes.</p>
<p>Mixins can take a block of CSS styles, other mixins, or a CSS selector (a CSS class or ID).</p>
<p>If you’d like to combine CSS classes, or rename a CSS class, use the <code>@extend</code> directive.</p>
<p>The first declaration <code>column</code> combines the Bootstrap classes <code>col-md-6</code> and <code>text-center</code> to make a new class, <code>column</code>.</p>
<p>Next we create a few classes that combine Bootstrap CSS classes. For example, the new <code>submit</code> class can be used for a button. When we use it in a view, this class will be purely semantic since it describes the purpose of the element, allowing us to set its appearance outside of any view file.</p>
<p>Finally, to avoid applying Bootstrap classes in the application layout file, we apply styles to HTML elements <code>main</code> and <code>section</code> to make the views framework-neutral. We use the <code>@extend</code> directive to add a Bootstrap CSS class. And we directly set standard CSS properties such as <code>background-color</code> and <code>margin-top</code>.</p>
<p>Using this technique, the file <strong>app/assets/stylesheets/1st_load_framework.css.scss</strong> becomes the single point of intersection between the Bootstrap framework and the application layout. For a simple website, this could be over-engineering and counter-productive. The rails_layout gem uses the technique so that either Bootstrap or Zurb Foundation can be used without any change to the default application layout.</p>
<p>We’ll use the CSS classes provided by the rails_layout gem in the tutorial application, but if you choose to customize the application, feel free to use Bootstrap classes directly to keep your project simple.</p>
<h2 id="1715-application-layout-with-bootstrap"><a href="#cid172">17.15 Application Layout with Bootstrap</a></h2>
<p>Let’s look at the application layout file created by the rails_layout gem:</p>
<p>Examine the contents of the file <strong>app/views/layouts/application.html.erb</strong>:</p>
<!DOCTYPE html>
<p><html>
 <head>
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>&lt;%= content_for?(:title) ? yield(:title) : "Learn Rails" %&gt;</title>
 &lt;meta name="description"
 content="&lt;%= content_for?(:description) ? yield(:description) : "Learn Rails" %&gt;"&gt;
 &lt;%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track' \=&gt; 'reload' %&gt;
 &lt;%= javascript_include_tag 'application', 'data-turbolinks-track' \=&gt; 'reload' %&gt;
 &lt;%= csrf_meta_tags %&gt;
 </head>
 
<body>
 <header>
 <%= render 'layouts/navigation' %>
 </header>
 <main role="main">
 <%= render 'layouts/messages' %>
 <%= yield %>
 </main>
 </body></p>
<p></html></p>
<p>This file is almost identical to the simple application layout file we looked at in the previous chapter.</p>
<p>Because we’ve applied Bootstrap classes to the HTML element <code>main</code> in the <strong>app/assets/stylesheets/1st_load_framework.css.scss</strong> file, there’s no need to use Bootstrap classes directly in the application layout.</p>
<h2 id="1716-flash-messages-with-bootstrap"><a href="#cid173">17.16 Flash Messages with Bootstrap</a></h2>
<p>The messages partial we use with Bootstrap is complex.</p>
<p>Examine the file <strong>app/views/layouts/_messages.html.erb</strong>:</p>
<p>&lt;%# Rails flash messages styled for Bootstrap 3.0 %&gt;
&lt;% flash.each do |name, msg| %&gt;
 &lt;% if msg.is_a?(String) %&gt;
 
<div class="alert alert-dismissible
 alert-<%= name.to\_s \== 'notice' ? 'success' : 'danger' %>">
 <button type="button" class="close" data-dismiss="alert"
 aria-hidden="true">&times;</button>
 <%= content\_tag :div, msg, :id \=> "flash\_#{name}" %>
 </div></p>
<p>&lt;% end %&gt;
&lt;% end %&gt;</p>
<p>We use <code>each</code> to iterate through the flash hash, retrieving a <code>name</code> and <code>msg</code> that are passed to a block to be output as a string. The expression <code>if msg.is_a?(String)</code> serves as a test to make sure we only display messages that are strings.</p>
<p>We construct a div that applies Bootstrap CSS styling around the message. Bootstrap provides classes <code>alert</code> and <code>alert-dismissible</code> to style the message.</p>
<p>We use the Ruby ternary operator to check the type of the alert. A class of either <code>success</code> or <code>danger</code> styles the message. Rails <code>notice</code> messages will get styled with the Bootstrap <code>success</code> class. Any other Rails messages, including <code>alert</code> messages, will get styled with the Bootstrap <code>danger</code> class.</p>
<p>We use the Rails <code>content_tag</code> view helper to create a div containing the message.</p>
<p>Bootstrap creates a “close” icon by applying the class <code>alert-dismissible</code>. Bootstrap’s integrated JavaScript library will hide the alert box when the “close” link is clicked.</p>
<p>Bootstrap provides <a href="https://getbootstrap.com/components/#alerts">detailed documentation</a> if you want to change the styling of the alert boxes.</p>
<h2 id="1717-navigation-partial-with-bootstrap"><a href="#cid174">17.17 Navigation Partial with Bootstrap</a></h2>
<p>The layout and styling required for the Bootstrap navigation bar are in the navigation partial file.</p>
<p>Examine the file <strong>app/views/layouts/_navigation.html.erb</strong>:</p>
<p>&lt;%# navigation styled for Bootstrap 3.0 %&gt;</p>
<nav class="navbar navbar-inverse navbar-fixed-top">
 <div class="container">
 <div class="navbar-header">
 <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
 <span class="sr-only">Toggle navigation</span>
 <span class="icon-bar"></span>
 <span class="icon-bar"></span>
 <span class="icon-bar"></span>
 </button>
 <%= link\_to 'Home', root\_path, class: 'navbar-brand' %>
 </div>
 <div class="collapse navbar-collapse">
 <ul class="nav navbar-nav">
 <%= render 'layouts/navigation\_links' %>
 </ul>
 </div>
 </div>
</nav>

<p>The navigation partial is now more complex, with layout and Bootstrap classes needed to produce a responsive navigation bar.</p>
<p>At the conclusion of this chapter, you’ll test the responsive navigation by resizing the window. At small sizes, the navigation links will disappear and be replaced by an icon labeled “Menu.” Clicking the icon will reveal a vertical menu of navigation links. The navigation menu is a great demonstration of the ability of Bootstrap to adjust to the small screen size of a tablet or smartphone.</p>
<p>If you’d like to add a site name or logo to the tutorial application, you can replace the link helper <code>&lt;%= link_to ’Home’, root_path %&gt;</code>. It is important to preserve the enclosing layout and classes, even if you don’t want to display a site name or logo. The enclosing layout is used to generate the navigation menu when the browser window shrinks to accommodate a tablet or smartphone.</p>
<p>You’ll see we wrap the nested partial <code>render ’layouts/navigation_links’</code> with Bootstrap classes to complete the navigation bar.</p>
<h2 id="1718-navigation-links-partial"><a href="#cid175">17.18 Navigation Links Partial</a></h2>
<p>The file <strong>app/views/layouts/_navigation_links.html.erb</strong> is unchanged:</p>
<p>&lt;%# add navigation links to this file %&gt;</p>
<p>Later we’ll add links to “About” and “Contact” pages.</p>
<p>The navigation links partial will be simply a list of navigation links.</p>
<p>We’re following the <em>separation of concerns</em> principle here. By separating the links from the styling that creates the navigation bar, we segregate the code that is unique to Bootstrap. In the future, if the Bootstrap layout or CSS classes change, we can make changes without touching the navigation links. If we wish, we can replace the navigation partial and substitute one that uses a different framework instead of Bootstrap, leaving the navigation links intact.</p>
<h2 id="1719-test-the-application"><a href="#cid176">17.19 Test the Application</a></h2>
<p>Let’s see how the application looks with Bootstrap. The web server may already be running. If not, enter the command:</p>
<p>$ rails server</p>
<p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>.</p>
<p>You should see a new page design that displays Bootstrap styling. Thanks to the open source efforts of the Bootstrap core team and contributors, we’ve added powerful front-end features to our website with little effort.</p>
<p>You can click the “X” close icons to hide the flash messages, thanks to the integrated CSS and JavaScript of the Bootstrap framework.</p>
<p>Next we’ll add “About” and “Contact” pages to the application. After we update the navigation links, you’ll see how the Bootstrap responsive web design adjusts the navigation bar at different browser widths.</p>
<h2 id="1720-remove-the-flash-messages"><a href="#cid177">17.20 Remove the Flash Messages</a></h2>
<p>Before we continue, we’ll remove the flash messages we created for our demonstration.</p>
<p>Update the file <strong>app/controllers/visitors_controller.rb</strong>:</p>
<p>class VisitorsController &lt; ApplicationController</p>
<p>def new
    @owner \= Owner.new
  end</p>
<p>end</p>
<h2 id="1721-git"><a href="#cid178">17.21 Git</a></h2>
<p>Let’s commit our changes to the Git repository and push to GitHub:</p>
<p>$ git add -A
$ git commit -m "front-end framework"
$ git push</p>
<h1 id="chapter-18-add-pages"><a href="#cid179">Chapter 18 Add Pages</a></h1>
<p>Let’s begin adding pages to our web application.</p>
<p>There are three types of web pages in a Rails application. We’ve looked at two types so far:</p>
<ul>
<li>static pages in the <strong>public/</strong> folder that contain no Ruby code</li>
<li>dynamic pages such as our home page that use the application layout</li>
</ul>
<p>There’s another type of web page that is required on many websites. It has static content; that is, no dynamic data is needed on the page. But it uses the default application layout to maintain consistency in the website look and feel. We classify this type of page as a:</p>
<ul>
<li>static view that uses the application layout</li>
</ul>
<p>Examples include:</p>
<ul>
<li>“About” page</li>
<li>Legal page</li>
<li>FAQ page</li>
</ul>
<p>It’s possible to place these pages in the <strong>public/</strong> folder and copy the HTML and CSS from the default application layout but this leads to duplicated code and maintenance headaches. And dynamic elements such as navigation links can’t be included. For these reasons, developers seldom create static pages in the <strong>public/</strong> folder.</p>
<p>Alternatively, a dynamic page can be created that has no model, a nearly-empty controller, and a view that contains no instance variables. This solution is quite common for static views that use the application layout.</p>
<p>This solution is implemented so frequently that many developers create a gem to encapsulate the functionality. We’re going to use the best-known of these gems, the <a href="https://github.com/thoughtbot/high_voltage">high_voltage gem</a> created by the <a href="https://www.thoughtbot.com/">Thoughtbot</a> consulting firm.</p>
<p>We’ll use the High Voltage gem to create an “About” Page.</p>
<p>We also will create a Contact page. We’ll again use the High Voltage gem, but only for the first version of the Contact page. Later we’ll discard the page we created with the High Voltage gem and replace it with a full model-view-controller implementation. The process will show the difference between an older form of web application architecture and a newer “Rails way.”</p>
<h2 id="181-high-voltage-gem"><a href="#cid180">18.1 High Voltage Gem</a></h2>
<p>We can add a page using the High Voltage gem almost effortlessly. The gem implements Rails “convention over configuration” so well that there is nothing to configure. There are alternatives to its defaults which can be useful but we won’t need them; visit the GitHub home page for the <a href="https://github.com/thoughtbot/high_voltage">high_voltage gem</a> if you want to explore all the options.</p>
<p>In your <strong>Gemfile</strong>, you’ve already added:</p>
<p>gem 'high_voltage'</p>
<p>and previously run <code>$ bundle install</code>.</p>
<h2 id="182-views-folder"><a href="#cid181">18.2 Views Folder</a></h2>
<p>Create a folder <strong>app/views/pages</strong>:</p>
<p>$ mkdir app/views/pages</p>
<p>Any view files we add to this directory will automatically use the default application layout and appear when we use a URL that contains the filename.</p>
<p>The High Voltage gem contains all the controller and routing magic required for this to happen.</p>
<p>Let’s try it out.</p>
<h2 id="183-about-page"><a href="#cid182">18.3 “About” Page</a></h2>
<p>Create a file <strong>app/views/pages/about.html.erb</strong>:</p>
<p>&lt;% content_for :title do %&gt;About&lt;% end %&gt;</p>
<h3>About Foobar Kadigan</h3>
<p>He was born in Waikikamukau, New Zealand. He left New Zealand for England,
 excelled at the University of Mopery, and served in the Royal Loamshire Regiment.
 While in service, he invented the kanuten valve used in the processing of
 unobtainium for industrial use. With a partner, Granda Fairbook, he founded
 Acme Manufacturing, later acquired by the Advent Corporation, to develop his
 discovery for use in the Turboencabulator. Mr. Kadigan is now retired and
 lives in Middlehampton with a favorite cat, where he raises Griadium frieda
 and collects metasyntactic variables.</p>
<p>His favorite quotation is:</p>
<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
 tempor incididunt ut labore et dolore magna aliqua.</p>

<p>Our simple “About” view will be combined with the default application layout by the High Voltage gem.</p>
<p>We include a <code>content_for</code> Rails view helper that passes a page title to the application layout.</p>
<h2 id="184-contact-page"><a href="#cid183">18.4 Contact Page</a></h2>
<p>For the initial version of the Contact page, create a file <strong>app/views/pages/contact.html.erb</strong>:</p>
<p>&lt;% content_for :title do %&gt;Contact&lt;% end %&gt;</p>
<h3>Contact</h3>

<p>This is a placeholder page we’ll use to test a navigation link.</p>
<p>We include a <code>content_for</code> Rails view helper that passes a page title to the application layout.</p>
<h2 id="185-routing-for-the-high-voltage-gem"><a href="#cid184">18.5 Routing for the High Voltage Gem</a></h2>
<p>The High Voltage gem provides a PagesController. You’ll never see it; it is packaged inside the gem.</p>
<p>In addition to providing a controller, the High Voltage gem provides default routing so any URL with the form <a href="http://localhost:3000/pages/about">http://localhost:3000/pages/about</a> will obtain a view from the <strong>app/views/pages</strong> directory.</p>
<p>Like the PagesController, the code that sets up the route is packaged inside the gem. For details about the syntax of routing directives, refer to <a href="http://guides.rubyonrails.org/routing.html">RailsGuides: Routing from the Outside In</a>.</p>
<h2 id="186-update-the-navigation-partial"><a href="#cid185">18.6 Update the Navigation Partial</a></h2>
<p>You can use a Rails route helper to create a link to any view in the <strong>app/views/pages</strong> directory like this:</p>
<p>link_to 'About', page_path('about')</p>
<p>Let’s add links to the “About” and “Contact” pages.</p>
<p>Replace the contents of the file <strong>app/views/layouts/_navigation_links.html.erb</strong> with this:</p>
<p>&lt;%# add navigation links to this file %&gt;</p>
<li><%= link\_to 'About', page\_path('about') %></li>
<li><%= link\_to 'Contact', page\_path('contact') %></li>

<p>With an updated navigation bar, we can test the application.</p>
<h2 id="187-test-the-application"><a href="#cid186">18.7 Test the Application</a></h2>
<p>The web server may already be running. If not, enter the command:</p>
<p>$ rails server</p>
<p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>.</p>
<p>Links to the pages “About” and “Contact” should work.</p>
<p>If you get an error “uninitialized constant PagesController,” make sure the <strong>config/routes.rb</strong> file looks like this:</p>
<p>Rails.application.routes.draw do
  root to: 'visitors#new'
end</p>
<p>Watch what happens when you resize the page. At smaller sizes, the navigation bar changes to display a menu icon. Clicking the menu icon reveals a drop-down menu of navigation links. You’re seeing the power of the Bootstrap framework.</p>
<p>Here’s a troubleshooting tip. If clicking the menu icon doesn’t reveal a drop-down menu, the application may not be loading the Bootstrap JavaScript library. Make sure that the file <strong>app/assets/javascripts/application.js</strong> contains:</p>
<p>//= require jquery
//= require jquery_ujs
//= require turbolinks
//= require bootstrap-sprockets
//= require_tree .</p>
<h2 id="188-git"><a href="#cid187">18.8 Git</a></h2>
<p>Let’s commit our changes to the Git repository and push to GitHub:</p>
<p>$ git add -A
$ git commit -m "add 'about' and 'contact' pages"
$ git push</p>
<p>There is nothing more we need for our “About” page.</p>
<p>In the next chapter, we’ll explore two different implementations for the Contact page.</p>
<h1 id="chapter-19-contact-form"><a href="#cid188">Chapter 19 Contact Form</a></h1>
<p>Forms are ubiquitous on the web, to the degree we seldom notice how often they are used for data entry, whether we’re logging into a website or posting a blog comment. To build any interactive website, you’ll need to understand forms. Here we’ll build a contact form for our tutorial application.</p>
<p>A contact form is common on many websites. If you think about it, contact forms are often unnecessary; simply displaying an email address is sufficient, more convenient, and easier to implement. But building a contact form is an excellent way to learn how to handle user data input. We’ll pretend that our odd client, Mr. Foobar Kadigan, insists that he needs a contact form on his website.</p>
<p>We’re not backing the tutorial application with a database so we won’t store the contact data after the information is submitted. Instead, in a subsequent chapter we’ll learn how to send the contents of the form by email to the website owner.</p>
<h2 id="191-the-old-way-and-the-rails-way"><a href="#cid189">19.1 The “Old Way” and the “Rails Way”</a></h2>
<p>In this chapter, we’ll explore two ways to implement a contact form. The first way will be familiar to anyone who has used PHP or similar web platforms. It is an obvious and straightforward way to handle a form. As we look closer, we’ll see the approach has limitations. We’ll discard our first approach and rebuild the Contact page, discovering how the “Rails way” is more powerful.</p>
<p>You may wonder why I’m going to show you two different ways to implement the contact form.</p>
<p>First, it is worthwhile to see there is more than one way to implement a web application. Maturity as a software developer means imagining different approaches and evaluating your options. With this exercise, you’ll contrast two approaches and see how we make choices about software architecture.</p>
<p>More importantly, it is not always obvious why we do things in a “Rails way.” It would be easy to simply walk you through the steps to build a contact form without showing you alternative implementations (that’s how most tutorials do it). But you’ll gain a deeper understanding of Rails by building the contact form in a less sophisticated fashion and then seeing the more elegant Rails approach.</p>
<h2 id="192-user-story"><a href="#cid190">19.2 User Story</a></h2>
<p>Let’s plan our work with a user story:</p>
<p>*Contact Page*
As a visitor to the website
I want to fill out a form with my name, email address, and some text
In order to send a message to the owner of the website</p>
<p>Our first step will be to create a route to a controller that will process the submitted form.</p>
<h2 id="193-routing"><a href="#cid191">19.3 Routing</a></h2>
<p>We’re going to create a ContactsController to process the submitted form data. Every form must have a destination URL that receives the form submission. We need to set a route to generate the destination URL.</p>
<p>Open the file <strong>config/routes.rb</strong>. Replace the contents with this:</p>
<p>Rails.application.routes.draw do
  post 'contact', to: 'contacts#process_form'
  root to: 'visitors#new'
end</p>
<p>The route <code>post ’contact’, to: ’contacts#process_form’</code> will create a route helper that generates a URL and hands off the request to a controller.</p>
<p>You can run the <code>rails routes</code> command to see our routes in the console:</p>
<p>$ rails routes
 Prefix Verb URI Pattern        Controller#Action
contact POST /contact(.:format) contacts#process_form
 root GET  /                  visitors#new
 page GET  /pages/*id         high_voltage/pages#show</p>
<p>The output of the <code>rails routes</code> command is somewhat cryptic but confirms we’ve created the routes we need.</p>
<p>The first item in the <code>rails routes</code> output indicates we can add “contact” to “_path” to get our route helper, <code>contact_path</code>:</p>
<ul>
<li><code>contact_path</code> - a route helper that can be used in a controller or view</li>
</ul>
<p>The second item indicates the request will be handled with the HTTP POST protocol:</p>
<ul>
<li><code>POST</code> - HTTP method to submit form data</li>
</ul>
<p>The third item indicates the application will respond to the following URL:</p>
<ul>
<li><a href="http://localhost:3000/contact">http://localhost:3000/contact</a> - URL generated by the route helper</li>
</ul>
<p>The fourth item indicates a request to the URL will be handled by:</p>
<ul>
<li><code>contacts</code> - the name of the controller</li>
<li><code>process_form</code> - a controller action</li>
</ul>
<p>For details about the syntax of routing directives, refer to <a href="http://guides.rubyonrails.org/routing.html">RailsGuides: Routing from the Outside In</a>.</p>
<p>The route won’t work yet; we need to create a ContactsController. But first we’ll create the form.</p>
<h2 id="194-adding-a-form-to-the-contact-page"><a href="#cid192">19.4 Adding a Form to the Contact Page</a></h2>
<p>Let’s add the code for a contact form to the Contact page.</p>
<p>Forms were simple in the early days of the web. An HTML <code>&lt;form&gt;</code> tag creates a container for a form. The form element specifies a URL (an “action”) which receives and processes the form submission. Form fields accept input such as text or checkboxes. A submit button gathers the input and sends a request to the URL specified in the form action.</p>
<p>Rails tries to simplify forms and make them more powerful. First, to simplify forms, Rails provides a set of view helpers for forms. These view helpers automate the creation of the necessary HTML elements. Some developers use an alternative set of form helpers (such as the <a href="https://github.com/plataformatec/simple_form">SimpleForm gem</a>) which make the syntax of forms even simpler. Form helpers such as SimpleForm add a dependency that I like to avoid (sometimes the gem is not updated or breaks). We’ll use the standard Rails form helpers.</p>
<p>Rails also makes forms more powerful by providing a form builder that can be associated with a model. Associating a model with a form allows Rails to perform validation on the input data. We’ll first build a form without a model (the “old way”) and then add a model (the “Rails way”).</p>
<p>Unfortunately, in the quest for simplicity and power, the Rails maintainers have made forms much more complicated than the original HTML specification. A large part of the complication is a new forms syntax introduced in Rails 5.1. Prior to Rails 5.1, Rails provided two different ways to create forms. One approach, using the <code>form_tag</code> directive, was simpler and didn’t use a form builder and associated model. The second approach, using the <code>form_for</code> directive, was more powerful and widely used because it enabled validation of form data using an associated model. In Rails 5.1, the Rails maintainers introduced a third approach, using the <code>form_with</code> directive. The <code>form_with</code> approach replaces both the <code>form_tag</code> and <code>form_for</code> directives, combining both earlier approaches in one set of view helpers.</p>
<p>There is very little documentation to explain how to use the <code>form_with</code> approach. As of this writing, the <a href="http://guides.rubyonrails.org/form_helpers.html">RailsGuides: Rails Form Helpers</a> official document has not been updated for the new <code>form_with</code> syntax. Most tutorials (and Stack Overflow answers) explain forms using the <code>form_tag</code> or <code>form_for</code> helpers. The only official documentation is the <a href="http://api.rubyonrails.org/v5.1.2/classes/ActionView/Helpers/FormHelper.html#method-i-form_with">Rails API document</a>. These are persuasive reasons not to use the new <code>form_with</code> syntax. However, a future version of Rails will deprecate (remove) the <code>form_tag</code> or <code>form_for</code> helpers. It’s best to learn to use <code>form_with</code> for your forms. Our tutorial will use <code>form_with</code>.</p>
<p>Replace the contents of the file <strong>app/views/pages/contact.html.erb</strong>:</p>
<p>&lt;% content_for :title do %&gt;Contact&lt;% end %&gt;</p>
<h3>Contact</h3>
<div class="form">
 <%= form\_with(url: contact\_path) do |form| %>
 <%= form.label :name %>
 <%= form.text\_field :name, autofocus: true %>
 <br/>
 <br/>
 <%= form.label :email %>
 <%= form.email\_field :email %>
 <br/>
 <br/>
 <%= form.label 'message' %>
 <%= form.text\_area :content, size: '40x5' %>
 <br/>
 <br/>
 <%= form.submit 'Submit', class: 'submit' %>
 <% end %>
</div>

<p>The code is compact but complex. We see several elements:</p>
<ul>
<li><code>content_for</code> is a view helper that passes a page title to the application layout</li>
<li><code>&lt;div class="form"&gt;</code> sets the width of the form and applies any styles we desire</li>
<li><code>form_with</code> is the view helper for the form</li>
</ul>
<p>The <code>form_with</code> view helper instantiates a form builder object which we assign to a variable named <code>form</code>. The form builder offers many standard form elements, such as text fields and submit buttons. Each element is available as a method call on the form object.</p>
<p>The view helper <code>form_with</code> requires <em>parameters</em> and a <em>block</em>.</p>
<p>Every form needs a URL that will handle processing of the form data. In this case, we specify a route in the application:</p>
<ul>
<li><code>url</code> - set to <code>contact_path</code>, the destination for the form data</li>
</ul>
<p>Later, when we change this form to accommodate the”Rails way,” we’ll replace these two parameters with a single instance variable. The magic of Rails will generate the name of the form and the destination URL from the instance variable. For now, to implement the “old way,” we simply supply the destination URL.</p>
<p>The <code>form_with</code> view helper accommodates a Ruby block. The block begins with <code>do</code> and closes with <code>end</code>. The code inside the block works just like code inside a method. In this case, the <code>form</code> object is passed to the block and methods belonging to the <code>form</code> object are called to produce HTML output.</p>
<p>Inside the block, the <code>form</code> object methods generate HTML for:</p>
<ul>
<li>a name field</li>
<li>an email field</li>
<li>a content field (labeled “message”)</li>
<li>a submit button</li>
</ul>
<p>Each of the form methods takes various parameters, such as:</p>
<ul>
<li><code>autofocus</code> - displays the cursor in the field</li>
</ul>
<p>The structure of the form is clearly visible in the code. The form begins with a <code>form_with</code> helper and closes with the <code>end</code> keyword. Each line of code produces an element in the form such as a field or a button.</p>
<p>This is a common structure for a Rails view helper and it will soon become familiar.</p>
<h2 id="195-controller"><a href="#cid193">19.5 Controller</a></h2>
<p>We need code to process the form data. The form data is sent to the server as a POST request attached to a URL. As we’ve learned, in Rails we use controllers to respond to browser requests. For this implementation, we’ll create a ContactsController to process the submitted form data.</p>
<p>Create a file <strong>app/controllers/contacts_controller.rb</strong>:</p>
<p>class ContactsController &lt; ApplicationController</p>
<p>def process_form
    Rails.logger.debug "DEBUG: params are #{params.inspect}"
    flash[:notice] \= "Received request from #{params[:name]}"
    redirect_to root_path
  end</p>
<p>end</p>
<p>The ContactsController inherits the behavior of the base ApplicationController.</p>
<p>We create a <code>process_form</code> method to respond when the form is submitted. Later we’ll learn that <code>process_form</code> doesn’t fit the “Rails way.” We’ll use it for now.</p>
<p>Before we look closely at the code for the <code>process_form</code> method, we need to learn about the <code>params</code> hash.</p>
<h3 id="1951-params-hash"><a href="#uid359">19.5.1 Params Hash</a></h3>
<p>Take a close look at these two lines:</p>
<pre><code>Rails.logger.debug "DEBUG: params are #{params.inspect}"
flash\[:notice\] \= "Received request from #{params\[:name\]}"
</code></pre>
<p>Notice the <code>params</code> object.</p>
<p>Earlier we learned about the Ruby <em>Hash</em> class. It is a data structure for key/value pairs and Hash instances are ideal for storing form data. Each field on the form can be mapped as <em>label</em> and <em>data</em>, or key and value, and stored in a Hash.</p>
<p>Rails does all the work of extracting the form data from the browser’s POST request. Rails creates a hash with the form field data mapped to the form field labels. Here’s part of the hash:</p>
<p>{... "name"\=&gt;"Daniel", "email"\=&gt;"<a href="/cdn-cgi/l/email-protection">[email protected]</a>", "content"\=&gt;"hi" ...}</p>
<p>The full <code>params</code> hash actually contains more data which we can see with a debug command:</p>
<p>{"utf8"\=&gt;"✓", "authenticity_token"\=&gt;"...", "name"\=&gt;"Daniel",
"email"\=&gt;"<a href="/cdn-cgi/l/email-protection">[email protected]</a>", "content"\=&gt;"hi", "commit"\=&gt;"Submit",
"controller"\=&gt;"contacts", "action"\=&gt;"process_form"}</p>
<p>The <code>params</code> hash includes these elements:</p>
<ul>
<li>the utf8 checkmark character forces browsers to recognize Unicode</li>
<li>the authenticity token prevents CSRF (<a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">Cross Site Request Forgery</a>)</li>
<li>form data</li>
<li>current controller</li>
<li>current action</li>
</ul>
<p>You will see the contents of the <code>params</code> hash in the console log after you submit the form. We’ll look at the console log when we test the implementation.</p>
<h3 id="1952-process_form-method"><a href="#uid365">19.5.2 Process_form Method</a></h3>
<p>Now that we know about the <code>params</code> hash, take a look again at the <code>process_form</code> method:</p>
<p>def process_form
    Rails.logger.debug "DEBUG: params are #{params.inspect}"
    flash[:notice] \= "Received request from #{params[:name]}"
    redirect_to root_path
  end</p>
<p>We use a <code>logger.debug</code> method to reveal the form data in our console log by revealing the contents of the <code>params</code> hash. The <code>inspect</code> method shows the parameters in an easy-to-read list.</p>
<p>Then we extract the data posted to the name field of the form and construct a flash message. A hash containing the data from the contact form is nested inside the <code>params</code> hash. We can retrieve the value of the name field with the expression <code>params[:name]</code>. We use double quotes and string interpolation to form the message using the <code>#{...}</code> syntax that evaluates a Ruby expression and combines it with a string.</p>
<p>Finally we use the <code>redirect_to</code> directive to render the home page.</p>
<p>We haven’t actually sent the contact data to anyone. We’ll add code for that later, after we refactor the controller to be a better example of the “Rails way.” Before we do that, let’s test the current implementation. We’ve already set up routing for the new controller.</p>
<h2 id="196-test-the-application"><a href="#cid194">19.6 Test the Application</a></h2>
<p>If you need to start the server:</p>
<p>$ rails server</p>
<p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>.</p>
<p>Click the “Contact” link; then fill out and submit the form.</p>
<p>You should see the flash message “Received request from …” on the home page. If you see the message “My birthday is soon” you need to delete your earlier experiment from the Visitors controller.</p>
<p>If you get an error message “uninitialized constant ContactsController,” make sure you created the file <strong>app/controllers/contacts_controller.rb</strong> as instructed above.</p>
<p>Notice what appears in the console log:</p>
<p>Started POST "/contact" for 127.0.0.1 at 2017-07-19 16:22:13 +0800
Processing by ContactsController#process_form as JS
 Parameters: {"utf8"=&gt;"✓", "authenticity_token"=&gt;"..", "name"=&gt;"Daniel", "email"=&gt;"<a href="/cdn-cgi/l/email-protection">[email protected]</a>", "content"=&gt;"hi", "commit"=&gt;"Submit"}
DEBUG: params are <ActionController::Parameters {"utf8"=>"✓", "authenticity_token"=&gt;"...", "name"=&gt;"Daniel", "email"=&gt;"<a href="/cdn-cgi/l/email-protection">[email protected]</a>", "content"=&gt;"hi", "commit"=&gt;"Submit", "controller"=&gt;"contacts", "action"=&gt;"process_form"} permitted: false&gt;
Redirected to http://localhost:3000/
Completed 200 OK in 7ms</p>
<p>The console log is our most important tool for debugging. Let’s analyze what we see:</p>
<ul>
<li><em>Started POST</em> - shows the server is responding to an HTTP POST request</li>
<li><em>“/contact”</em> - the path portion of the URL</li>
<li><em>at …</em> - timestamp</li>
<li><em>Processing by ContactsController</em> - the controller</li>
<li><em>process_form</em> - the controller action (the method that handles the request)</li>
<li><em>as JS</em> - the standard syntax (not XML or some other markup)</li>
<li><em>Parameters:</em> - the <code>params</code> hash containing all the submitted data</li>
<li><em>“utf8”=”✓”</em> - a Rails workaround to set the language encoding in Internet Explorer</li>
<li><em>“authenticity token”</em> - prevents CSRF security exploits</li>
<li>the form data</li>
<li><em>“commit”</em> - the “Submit” label from the button</li>
<li><em>DEBUG</em> - our debug message containing the form data</li>
<li><em>Redirected to http://localhost:3000/</em> - responded by displaying the home page</li>
<li><em>Completed 200 OK</em> - HTTP response status code 200 indicating success</li>
<li><em>in 7ms</em> - time required to process the request</li>
</ul>
<p>That’s a lot of data. For now, we really only care about the form data buried in the <code>params</code> hash.</p>
<p>You can see that we really don’t need the debug message because the console log shows us the contents of the <code>params</code> hash.</p>
<h2 id="197-the-validation-problem"><a href="#cid195">19.7 The Validation Problem</a></h2>
<p>It looks like we’ve got everything we need to handle a form submission. As a next step, we could implement code to send an email message using form data extracted from the <code>params</code> hash.</p>
<p>But consider a potential problem. What if the email address is poorly formed? The visitor will think the message has been sent but it will never be delivered.</p>
<p>Or what if the name field or message is blank? It’s not just a problem for the hapless visitor. An evildoer could repeatedly click the submit button, filling Foobar Kadigan’s email inbox with endless empty messages.</p>
<p>We need <em>validation</em> of the form data before we process it.</p>
<p>We could dig into the Rails <code>String</code> API and look for a way to test if the string is empty or contains only whitespaces. And we could raise an <code>Exception</code> if the string is blank.</p>
<p>Here’s what validation code could look like. We won’t use this code (because there’s a better way to do this):</p>
<p>class ContactsController &lt; ApplicationController</p>
<p>def process_form
    if params[:name].blank?
      raise 'Name is blank!'
    end
    if params[:email].blank?
      raise 'Email is blank!'
    end
    if params[:content].blank?
      raise 'Message is blank!'
    end
    message \= "Received request from #{params[:name]}"
    redirect_to root_path, :notice \=&gt; message
  end</p>
<p>end</p>
<p>We would need additional code to test for invalid email addresses (it will be a complex <em>regex</em>, or <em>regular expression</em>). And we would need a nicer way of showing the error to the visitor (right now, raising the exception displays an error message that makes it appear the application is broken). If we were implementing this on another web application platform, we might go further down this path, googling for code examples, and implementing a lengthy but bulletproof validation function.</p>
<p>Rails offers a better way.</p>
<h2 id="198-remove-the-contact-page"><a href="#cid196">19.8 Remove the Contact Page</a></h2>
<p>We will implement a model-view-controller architecture for our Contact feature. That means we need a Contact model, a Contacts controller, and view files in the <strong>app/views/contacts/</strong> folder.</p>
<p>We no longer need the Contact page in the <strong>app/views/pages/</strong> folder.</p>
<p>Let’s get started by removing the file <strong>app/views/pages/contact.html.erb</strong>:</p>
<p>$ rm app/views/pages/contact.html.erb</p>
<p>Before we implement a model-view-controller architecture, let’s take time to understand the advantages of the Rails model-view-controller approach.</p>
<h2 id="199-implementing-the-rails-way"><a href="#cid197">19.9 Implementing the “Rails Way”</a></h2>
<p>Our initial implementation of the contact form is consistent with the earliest approach to web application development. That’s why I call it the “old way.” It is an approach that originated in 1993 with a specification for CGI, the <a href="https://en.wikipedia.org/wiki/Common_Gateway_Interface">Common Gateway Interface</a>. Before CGI, every page on the web existed only as a static HTML file. CGI made it possible to run a program, or CGI script, that dynamically generated HTML. In the early years of the web, every web URL matched either an HTML file or a CGI script. This is the “page paradigm” of the web.</p>
<p>So far, we’re following the “page paradigm.” Our Contact page hosts the form. Clicking the submit button makes a request to another page that is actually a program that returns HTML. Until the late 1990s, this is how the web worked. But soon after the introduction of CGI, developers began exploring the possibility of running a single program (an application server) that responds to any URL, parsing the URL to establish routing, and generating pages dynamically. This was the genesis of the “web application paradigm.” It’s how Rails works.</p>
<p>The web application paradigm frees us from one-to-one correspondence of a URL with a single file or script. It allows us to refactor our code into object-oriented classes and methods that can be inherited rather than duplicated, which means we don’t repeat the same code on every page that processes a form.</p>
<p>The web application paradigm makes it possible to use the model-view-controller architecture. Instead of looking at the web as URLs that return pages, we see requests that are routed to controllers that render views. We can segregate any code that manipulates data into a model class, instead of mixing HTML with data manipulation in a single script. With the “web application paradigm,” we can have a generic model class that isolates the code that connects to a database or validates form data. We can create models that inherit the generic behavior from a parent class and get a database connection or validation “for free.” Unlike the “page paradigm,” we’ll avoid duplicating validation code every time we need to process a form.</p>
<p>Consider our <code>process_form</code> method again:</p>
<p>class ContactsController &lt; ApplicationController</p>
<p>def process_form
    if params[:name].blank?
      raise 'Name is blank!'
    end
    if params[:email].blank?
      raise 'Email is blank!'
    end
    if params[:content].blank?
      raise 'Message is blank!'
    end
    message \= "Received request from #{params[:name]}"
    redirect_to root_path, :notice \=&gt; message
  end</p>
<p>end</p>
<p>We’ll replace it with something better.</p>
<p>Our “segregation of concerns” philosophy suggests that validation belongs in a model, since validation is a type of data manipulation (strictly speaking, a test of data integrity). Furthermore, it would be nice to make the validation tests generic so they could be used to validate data submitted from any form.</p>
<p>Rails, as a framework, provides all this for us. We call it the “Rails way.”</p>
<h2 id="1910-activemodel"><a href="#cid198">19.10 ActiveModel</a></h2>
<p>Rails extracts and generalizes common code that every website requires. The code that websites need for access to databases is abstracted into the Rails <a href="https://github.com/rails/rails/tree/master/activerecord">ActiveRecord</a> class. ActiveRecord includes code from the <a href="https://github.com/rails/rails/tree/master/activemodel">ActiveModel</a> class that handles interaction with forms and data validation.</p>
<p>The ActiveModel class interfaces with SimpleForm to provide sophisticated validation and error handling. We can mix in behavior from the ActiveModel class to add validation and error handling to any model we create.</p>
<p>SimpleForm will recognize ActiveModel methods if we provide a model as an argument to the SimpleForm view helper. SimpleForm will give the form a name that matches the model name. And SimpleForm will automatically generate a destination URL for the form based on the model name.</p>
<p>More significantly, SimpleForm will add sophisticated error handling to the form. If a visitor doesn’t enter a name or submits an invalid email address, and we declare in our model that we require validation, SimpleForm will highlight the invalid field and display an inline message indicating the problem. Compared to what we’ve implemented so far, this kind of error handling provides a vastly superior user experience. Instead of displaying a message that the application failed, the form will be redisplayed with the problem marked and noted.</p>
<p>Now that we’ve seen the advantages of the “Rails way,” let’s re-implement our contact form using the model-view-controller architecture.</p>
<h2 id="1911-model"><a href="#cid199">19.11 Model</a></h2>
<p>When we build database-backed applications with Rails, we base our models on a parent class named ActiveRecord. We are not using a database for our tutorial application, so we’ll mix in behavior from ActiveModel, which adds validation and error handling to our model. Let’s set up a model that doesn’t require a database.</p>
<p>Create a file <strong>app/models/contact.rb</strong>:</p>
<p>class Contact
  include ActiveModel::Model
  attr_accessor :name, :email, :content</p>
<p>validates_presence_of :name
  validates_presence_of :email
  validates_presence_of :content
  validates_format_of :email,
    with: /\A[-a-z0-9_+\.]+\@([-a-z0-9]+\.)+[a-z0-9]{2,4}\z/i
  validates_length_of :content, :maximum \=&gt; 500</p>
<p>end</p>
<p>When you copy this, be careful to keep the long regex expression (<code>with: /.../i</code>) on one line (no line breaks).</p>
<p>We give the model the name “Contact.”</p>
<p>We mix in behavior from the ActiveModel class using <code>include ActiveModel::Model</code>.</p>
<p>We create attributes (data fields) for the model by using the <code>attr_accessor</code> keyword. The attributes match the fields in the contact form. If we were using a database for our tutorial application, we would not need to use <code>attr_accessor</code> because ActiveRecord would create access methods for reading and writing attributes directly from the database.</p>
<p>ActiveModel gives us validation methods named <code>validates_presence_of</code>, <code>validates_format_of</code>, and <code>validates_length_of</code>. We check that <code>name</code>, <code>email</code>, and <code>content</code> exist (no blanks are allowed). We provide a complex <em>regex</em>, or <em>regular expression</em>, to test if the email address is valid. Finally, we declare that the message content cannot exceed 500 characters.</p>
<p>The model is elegant. We describe the fields we need and state our validation requirements. ActiveModel does all the rest.</p>
<p>Next we’ll add a new Contact page by creating a view in the <strong>app/views/contacts/</strong> folder.</p>
<p>The new contact form will use our new model.</p>
<h2 id="1912-create-a-new-contact-page"><a href="#cid200">19.12 Create a New Contact Page</a></h2>
<p>First, let’s create the <strong>app/views/contacts/</strong> folder:</p>
<p>$ mkdir app/views/contacts/</p>
<p>Create a file <strong>app/views/contacts/new.html.erb</strong>:</p>
<p>&lt;% content_for :title do %&gt;Contact&lt;% end %&gt;</p>
<h3>Contact</h3>
<div class="form">
 <%= form\_with(model: @contact) do |form| %>
 <%= form.label :name %>
 <%= form.text\_field :name, autofocus: true %>
 <br/>
 <br/>
 <%= form.label :email %>
 <%= form.email\_field :email %>
 <br/>
 <br/>
 <%= form.label 'message' %>
 <%= form.text\_area :content, size: '40x5' %>
 <br/>
 <br/>
 <%= form.submit 'Submit', class: 'submit' %>
 <% end %>
</div>

<p>The form is the same as we used before, but we’re now providing only one argument, the <code>@contact</code> instance variable, to the form_with view helper. That’s enough to generate the form name and destination URL.</p>
<p>We haven’t yet created a controller that assigns the Contact model to the <code>@contact</code> instance variable. We’ll do that soon.</p>
<p>The form helper uses the <code>@contact</code> instance variable to name the form, set a destination for the form data, and initialize each field in the form using attributes from the Contact model. Setting the values for the form fields from the attributes in the model is called “binding the form to the object” and you can read about it in the <a href="http://guides.rubyonrails.org/form_helpers.html#binding-a-form-to-an-object">RailsGuides: Form Helpers</a> article.</p>
<p>We’ve added the <code>error_notification</code> method which provides all the error handling. The method call is very simple but the results will be impressive.</p>
<p>We’ll need a controller and routing to complete our model-view-controller architecture. But first, we’ll detour to learn about seven standard controller actions.</p>
<h2 id="1913-seven-controller-actions"><a href="#cid201">19.13 Seven Controller Actions</a></h2>
<p>Consider all the possibilities for managing a list. It’s a list of anything: users, inventory, thingamajigs. We use a web application to manage the list, so we’ll fill out a form to record each item in our list.</p>
<p>The web application offers seven features to help us manage our records:</p>
<ul>
<li><em><strong>index</strong></em> - display a list of all items</li>
<li><em><strong>show</strong></em> - display a record of one item</li>
<li><em><strong>new</strong></em> - display an empty form</li>
<li><em><strong>create</strong></em> - save a record of a new item</li>
<li><em><strong>edit</strong></em> - display a record for editing</li>
<li><em><strong>update</strong></em> - save an edited record</li>
<li><em><strong>destroy</strong></em> - delete a record</li>
</ul>
<p>You can manage any list using these seven actions. There are a few extra actions that are helpful, such as:</p>
<ul>
<li><em>pagination</em> - displaying a portion of a list</li>
<li><em>sorting</em> - displaying the list in a different order</li>
<li><em>bulk edit</em> - changing multiple items at once</li>
</ul>
<p>But seven basic actions are all you need for managing any list of items.</p>
<p>The “Rails way” is about taking advantage of structure and convention to leverage the power of the framework.</p>
<p>The ApplicationController contains code to implement each of the seven standard actions. When we create a controller that inherits from the ApplicationController, we get these standard actions “for free.” That’s why our <code>new</code> method in our VisitorsController was so simple. The controller knew to render a view file named <strong>new.html.erb</strong> from the <strong>views/visitors/</strong> folder because of behavior inherited from the ApplicationController.</p>
<p>Just like the Rails directory structure provides consistency to make it easy for any Rails developer to collaborate with other Rails developers, relying on the seven standard controller actions makes it easy for other team members to understand how your controllers work.</p>
<p>A controller that uses these actions is said to be “RESTful” (a term that refers to <a href="https://en.wikipedia.org/wiki/Representational_state_transfer">representational state transfer</a>, a software design abstraction). Experienced Rails developers follow the “Rails way” and try to use RESTful controller methods when possible.</p>
<p>When necessary, you will add other controller actions. For example, imagine you’ve built a subscription website. When a user’s subscription ends, you may not want to <code>destroy</code> the subscriber record. Instead you might add a controller <code>expire</code> or <code>suspend</code> action that marks the subscriber record as expired so you can continue to access the subscriber’s contact information for customer service or renewal offers. To the extent you can, use the seven standard controller actions and be cautious about adding more.</p>
<p>Earlier, I said our ContactsController <code>process_form</code> method isn’t suitable for the “Rails way.” With our model-view-controller architecture, we can piggyback on the ApplicationController to display our empty contact form and process the form when it is submitted.</p>
<p>We’ll use only two of the seven standard controller actions:</p>
<ul>
<li><em><strong>new</strong></em> - display the empty contact form</li>
<li><em><strong>create</strong></em> - validate and process the submitted form</li>
</ul>
<p>Our ContactsController will know to render a view from the <strong>app/views/contacts/new.html.erb</strong> file when we call the controller <code>new</code> method.</p>
<p>We won’t piggyback on behavior from the ApplicationController <code>create</code> method. But we’ll implement a <code>create</code> method because, by convention, the form will submit the data to the controller’s <code>create</code> method. SimpleForm will create a destination URL that corresponds to the ContactsController#create action.</p>
<h2 id="1914-controller"><a href="#cid202">19.14 Controller</a></h2>
<p>Replace the contents of the file <strong>app/controllers/contacts_controller.rb</strong>:</p>
<p>class ContactsController &lt; ApplicationController</p>
<p>def new
    @contact \= Contact.new
  end</p>
<p>def create
    @contact \= Contact.new(secure_params)
    if @contact.valid?
      # TODO send message
      flash[:notice] \= "Message sent from #{@contact.name}."
      redirect_to root_path
    else
      render :new
    end
  end</p>
<p>private</p>
<p>def secure_params
    params.require(:contact).permit(:name, :email, :content)
  end</p>
<p>end</p>
<p>We’ve dropped the “old school” <code>process_form</code> method and added the “Rails way” <code>new</code> and <code>create</code> methods.</p>
<p>The controller <code>new</code> action will instantiate an empty Contact model, assign it to the <code>@contact</code> instance variable, and render the <strong>app/views/contacts/new.html.erb</strong> view. We’ve already created the view file containing the form.</p>
<p>SimpleForm will set a destination URL that corresponds to the ContactsController#create action. The <code>create</code> method will instantiate a new Contact model using the data from the form (we take steps to avoid security vulnerabilities first—more on that later).</p>
<p>The ActiveModel class provides a method <code>valid?</code> which we can call on the Contact model. Our conditional statement <code>if @contact.valid?</code> checks each of the validation requirements we’ve set in the model.</p>
<p>If all the Contact fields are valid, we can send a message (which we’ll add later), prepare a flash message, and redirect to the home page. Notice that we don’t need to dig into the <code>params</code> hash for the visitor’s name; it is now available as <code>@contact.name</code> directly from the model.</p>
<p>If any validation fails, the controller <code>create</code> action will render the <strong>app/views/contacts/new.html.erb</strong> view. This time, appropriate error messages are set and the form object’s <code>error_notification</code> method will highlight the invalid field and display a matching prompt.</p>
<p>You’re looking at the tightly bound interaction of the “Rails way” model, view, and controller.</p>
<p>The only element we are missing is routing. But first, let’s look closer at the steps we take to avoid security exploits.</p>
<h3 id="19141-mass-assignment-vulnerabilities"><a href="#uid393">19.14.1 Mass-Assignment Vulnerabilities</a></h3>
<p>Rails protects us from a class of security exploits called “mass-assignment vulnerabilities.” Rails won’t let us initialize a model with just any parameters submitted on a form. Suppose we were creating a new user and one of the user attributes was a flag allowing administrator access. A malicious hacker could create a fake form that provides a user name and sets the administrator status to “true.” Rails forces us to “white list” each of the parameters used to initialize the model.</p>
<p>We create a method named <code>secure_params</code> to screen the parameters sent from the browser. The <code>params</code> hash contains two useful methods we use for our screening:</p>
<ul>
<li><code>require(:contact)</code> - makes sure that <code>params[:contact]</code> is present</li>
<li><code>permit(:name, :email, :content)</code> - our “white list”</li>
</ul>
<p>With this code, we make sure that <code>params[:contact]</code> only contains <code>:name, :email, :content</code>. If other parameters are present, they are stripped out. Rails will raise an error if a controller attempts to pass params to a model method without explicitly permitting attributes via <code>permit</code>.</p>
<p>In older versions of Rails (before Rails 4.0), the mass-assignment exploit was blocked by using a “white list” of acceptable parameters with the <code>attr_accessible</code> keyword in a model. You’ll see this code in examples and tutorials that were written before Rails 4.0 introduced “strong parameters” in the controller.</p>
<h3 id="19142-private-methods"><a href="#uid396">19.14.2 Private Methods</a></h3>
<p>If you paid close attention to the code you added to the Contacts controller, you may have noticed the keyword <code>private</code> above the <code>secure_params</code> method definition. This is a bit of software architecture that limits access to the <code>secure_params</code> method (plus any more methods we might add beneath it).</p>
<p>Very simply, adding the <code>private</code> keyword restricts access to the <code>secure_params</code> method so only methods in the same class can use it. You might be puzzled; after all, how else could it be accessed? We haven’t explored calling methods from other classes, so I’ll just say that without the <code>private</code> keyword, the <code>secure_params</code> method could be used from code anywhere in our application. In this case, we apply the <code>private</code> keyword because we want to be sure the <code>secure_params</code> method is only used in the <code>ContactsController</code> class. It’s just a bit of “best practice” and for now, you can simply learn that <code>secure_params</code> method should be a private method.</p>
<p>Now let’s look at routing for controllers that are built the “Rails way.”</p>
<h2 id="1915-routing"><a href="#cid203">19.15 Routing</a></h2>
<p>Rails routing is aware of the seven standard controller actions.</p>
<p>In fact, it takes only one keyword (with one parameter) to generate seven different routes for any controller.</p>
<p>The keyword is <code>resources</code> and supplying a name that matches a model and controller provides all seven routes.</p>
<p>Open the file <strong>config/routes.rb</strong>. Replace the contents with this:</p>
<p>Rails.application.routes.draw do
  resources :contacts, only: [:new, :create]
  root to: 'visitors#new'
end</p>
<p>Here we’ve added <code>resources :contacts, only: [:new, :create]</code>.</p>
<p>We only want two routes so we’ve added the restriction <code>only: [:new, :create]</code>.</p>
<p>The <code>new</code> route has these properties:</p>
<ul>
<li><code>new_contact_path</code> - route helper</li>
<li><code>contacts</code> - name of the controller (ContactsController)</li>
<li><code>new</code> - controller action</li>
<li><a href="http://localhost:3000/contacts/new">http://localhost:3000/contacts/new</a> - URL generated by the route helper</li>
<li><code>GET</code> - HTTP method to display a page</li>
</ul>
<p>The <code>create</code> route has these properties:</p>
<ul>
<li><code>contacts_path</code> - route helper</li>
<li><code>contacts</code> - name of the controller (ContactsController)</li>
<li><code>create</code> - controller action</li>
<li><a href="http://localhost:3000/contacts">http://localhost:3000/contacts</a> - URL generated by the route helper</li>
<li><code>POST</code> - HTTP method to submit form data</li>
</ul>
<p>You can run the <code>rails routes</code> command to see these in the console:</p>
<p>$ rails routes
 Prefix Verb URI Pattern             Controller#Action
 contacts POST /contacts(.:format)     contacts#create
new_contact GET  /contacts/new(.:format) contacts#new
 root GET  /                       visitors#new
 page GET  /pages/*id              high_voltage/pages#show</p>
<p>The output of the <code>rails routes</code> command shows we’ve created the routes we need.</p>
<p>Our new route <code>new_contact_path</code> can now be used. We’ve completed our move to the model-view-controller architecture by adding the appropriate routes.</p>
<h2 id="1916-change-navigation-links"><a href="#cid204">19.16 Change Navigation Links</a></h2>
<p>With our new model-view-controller architecture, we need to change the navigation links.</p>
<p>Change the file <strong>app/views/layouts/_navigation_links.html.erb</strong>:</p>
<p>&lt;%# add navigation links to this file %&gt;</p>
<li><%= link\_to 'About', page\_path('about') %></li>
<li><%= link\_to 'Contact', new\_contact\_path %></li>

<p>We’re ready to test the model-view-controller implementation of the Contact feature.</p>
<p>Be sure you’ve removed the file <strong>app/views/pages/contact.html.erb</strong>, as it is no longer used.</p>
<h2 id="1917-test-the-application"><a href="#cid205">19.17 Test the Application</a></h2>
<p>If you need to restart the server:</p>
<p>$ rails server</p>
<p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>.</p>
<p>Click the “Contact” link; then fill out and submit the form.</p>
<p>You should see the flash message “Message sent from …” on the home page.</p>
<p>Try submitting the form with a blank name. You’ll see a warning message, “Please review the problems below.”</p>
<p>Try submitting the form with an invalid email address such as “<a href="/cdn-cgi/l/email-protection">[email protected]</a>”. The form will re-display with a message, “Please review the problems below,” and next to the email field, “is invalid.”</p>
<p>Combining SimpleForm error handling with ActiveModel validation is powerful. If validation fails after the form is submitted, the page will redisplay and SimpleForm will display an appropriate error message.</p>
<h2 id="1918-git"><a href="#cid206">19.18 Git</a></h2>
<p>Let’s commit our changes to the Git repository and push to GitHub:</p>
<p>$ git add -A
$ git commit -m "contact form"
$ git push</p>
<p>We’ve built a sophisticated Contact form.</p>
<h1 id="chapter-20-send-mail"><a href="#cid207">Chapter 20 Send Mail</a></h1>
<p>Email sent from a web application is called <a href="https://blog.mailchimp.com/what-is-transactional-email/">transactional email</a>. As a website visitor, you’ve probably seen transactional email such as these messages:</p>
<ul>
<li>sign up confirmation email</li>
<li>response to a password reset request</li>
<li>acknowledgment of a purchase</li>
<li>notice of a change to a user profile setting</li>
</ul>
<p>A web application can send email to a visitor. It can also send messages to its owner or webmaster. On large active sites, email notices can be impractical (an admin interface is better) but for our small-volume tutorial application, it makes sense to email the contact request directly to the site owner (Foobar Kadigan is retired and enjoys receiving email).</p>
<h2 id="201-user-story"><a href="#cid208">20.1 User Story</a></h2>
<p>Let’s plan our work with a user story:</p>
<p>*Send Contact Message*
As the owner of the website
I want to receive email messages with a visitor's name, email address, and some text
In order to communicate with visitors</p>
<p>To implement the user story, let’s create a feature that sends the contact data as an email message.</p>
<h2 id="202-implementation"><a href="#cid209">20.2 Implementation</a></h2>
<p>Rails makes it easy to send email. The <a href="https://github.com/rails/rails/tree/master/actionmailer">ActionMailer</a> gem is part of any Rails installation.</p>
<p>Implementation of email closely follows the model-view-controller architecture. To implement email, you’ll need:</p>
<ul>
<li>model</li>
<li>view</li>
<li>mailer</li>
</ul>
<p>The “mailer” is similar to a controller, combining data attributes from a model with a view file. Any methods we add to the mailer class can be called from a controller, triggering delivery of an email message.</p>
<p>The model can be any we’ve already created. In this case, we’ll use the Contact model, since it gives us access to the visitor’s name, email address, and message.</p>
<p>We’ll create a mail-specific view file in the <strong>app/views/user_mailer/</strong> folder. Our folder for mail-specific views will go in the <strong>app/views/</strong> directory as a sibling of the <strong>app/views/layouts</strong> folder.</p>
<p>The Rails directory structure already gives us a folder <strong>app/mailers/</strong> for the mailer class and, not surprisingly, it is a sibling of the <strong>app/controllers/</strong> folder.</p>
<p>We don’t have to create the necessary folders and files manually, as the <code>rails generate</code> command runs a utility to create what we need.</p>
<h2 id="203-create-view-folder-and-mailer"><a href="#cid210">20.3 Create View Folder and Mailer</a></h2>
<p>Use the <code>rails generate</code> command to create a mailer with a folder for views:</p>
<p>$ rails generate mailer UserMailer</p>
<p>The name of the mailer isn’t important; we’ll use <code>UserMailer</code> because it is obvious.</p>
<p>The <code>rails generate</code> command will create a file:</p>
<ul>
<li><strong>app/mailers/user_mailer.rb</strong></li>
</ul>
<p>It also creates test files which we won’t use in this tutorial.</p>
<p>It uses three additional files which are provided by default in a Rails 5 application:</p>
<ul>
<li><strong>app/mailers/application_mailer.rb</strong></li>
<li><strong>app/views/layouts/mailer.html.erb</strong></li>
<li><strong>app/views/layouts/mailer.text.erb</strong></li>
</ul>
<p>This implements our model-view-mailer architecture.</p>
<h2 id="204-edit-the-mailer"><a href="#cid211">20.4 Edit the Mailer</a></h2>
<p>Add a <code>contact_email</code> method to the mailer by editing the file <strong>app/mailers/user_mailer.rb</strong>:</p>
<p>class UserMailer &lt; ApplicationMailer
  default from: "<a href="/cdn-cgi/l/email-protection">[email protected]</a>"</p>
<p>def contact_email(contact)
    @contact \= contact
    mail(to: Rails.application.secrets.owner_email, from: @contact.email, :subject \=&gt; "Website Contact")
  end
end</p>
<p>The <code>UserMailer</code> class inherits behavior from the <code>ApplicationMailer</code> class. We’ll create a method definition that assigns the <code>contact</code> argument to the instance variable <code>@contact</code>. Like a controller that combines a model with a view, our mailer class makes the instance variable available in the view.</p>
<p>The name of the method isn’t important; it can be anything obvious. We’ll use it in the ContactsController to trigger mail delivery.</p>
<p>Like the <code>render</code> method in a web page controller, the ActionMailer parent class has a <code>mail</code> method that renders the view.</p>
<p>You’ll need to use your email address in the mailer. You should have already set a configuration variable for your email address in the file <strong>config/secrets.yml</strong>. If you haven’t done so, do it now. By inserting the configuration variable with your email address after <code>to:</code>, your inbox will receive the message. If Foobar Kadigan was a real person, we’d supply his email address here.</p>
<p>We need to insert a “from” address in two places. First there is a default, for all messages that do not set a “from” address. We will use “<a href="/cdn-cgi/l/email-protection">[email protected]</a>” for the default “from” address. The email is originating from a web application that does not receive email, so this indicates the email address should not be used for replies. For emails going to website visitors, it would be best to provide a default email address for a customer service representative on the “from” line, so the recipient can easily reply. We’re not sending email messages to visitors so we can ignore this nicety.</p>
<p>For our <code>contact_email</code> method, we’ll insert the email address of the visitor as the “from” address since we are sending a message to the site owner. This makes it easy for Foobar Kadigan to click “reply” when he is reading the contact messages in his inbox. You can see our use of the email attribute from the Contact model in the expression <code>from: @contact.email</code>.</p>
<p>That’s all we need for mailer class. Next we’ll create a view containing the message.</p>
<h2 id="205-create-mailer-view"><a href="#cid212">20.5 Create Mailer View</a></h2>
<p>There are two types of mailer views. One contains plain text, for recipients who don’t like formatted email (some people still read email from the Unix command line). The other type contains HTML markup to provide formatting. It’s good to create a message of both types, though most recipients will benefit from HTML formatting.</p>
<p>The mailer view for formatted email looks very similar to a web page view file. It contains HTML markup plus Ruby expressions embedded in <code>&lt;%= ... %&gt;</code> delimiters. In the <code>UserMailer</code> class, we’ve assigned the Contact model to the instance variable <code>@contact</code> so any attributes are available for use in the message.</p>
<p>Create a file <strong>app/views/user_mailer/contact_email.html.erb</strong>:</p>
<!DOCTYPE html>
<p><html>
 <head>
 <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />
 </head>
 
<body>
 <h1>Website Contact</h1>
 <p>
 This visitor requested contact:
 </p>
 <p>
 <%= @contact.name %><br/>
 <%= @contact.email %><br/>
 </p>
 <p>
 The visitor said:
 </p>
 <p>
 "<%= @contact.content %>"
 </p>
 </body></p>
<p></html></p>
<p>You can easily imagine how this view would look as a web page. You’ll soon see it as an email message in your inbox.</p>
<p>For those recipients who like plain text, create a view without HTML markup.</p>
<p>Create a file <strong>app/views/user_mailer/contact_email.text.erb</strong>:</p>
<p>You received a message from &lt;%= @contact.name %&gt; with email address &lt;%= @contact.email %&gt;.</p>
<p>The visitor said:</p>
<p>"&lt;%= @contact.content %&gt;"</p>
<p>You’ve created views for the email message.</p>
<p>Now we can integrate our email feature with the ContactsController.</p>
<h2 id="206-modify-controller"><a href="#cid213">20.6 Modify Controller</a></h2>
<p>We’ll add code to the ContactsController:</p>
<p>UserMailer.contact_email(@contact).deliver_now</p>
<p>Replace the contents of the file <strong>app/controllers/contacts_controller.rb</strong>:</p>
<p>class ContactsController &lt; ApplicationController</p>
<p>def new
    @contact \= Contact.new
  end</p>
<p>def create
    @contact \= Contact.new(secure_params)
    if @contact.valid?
      UserMailer.contact_email(@contact).deliver_now
      flash[:notice] \= "Message sent from #{@contact.name}."
      redirect_to root_path
    else
      render :new
    end
  end</p>
<p>private</p>
<p>def secure_params
    params.require(:contact).permit(:name, :email, :content)
  end</p>
<p>end</p>
<p>The <code>UserMailer</code> class is available to any controller in the application. We call the <code>contact_email</code> method we’ve created, passing the <code>@contact</code> instance variable as an argument, which renders the email message. Finally, the <code>deliver_now</code> method initiates delivery.</p>
<p>For more on sending email from a Rails application, see <a href="http://guides.rubyonrails.org/action_mailer_basics.html">RailsGuides: Action Mailer Basics</a>.</p>
<h2 id="207-test-the-application"><a href="#cid214">20.7 Test the Application</a></h2>
<p>If your web server is not running, start it:</p>
<p>$ rails server</p>
<p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>.</p>
<p>Click the “Contact” link and try submitting the form.</p>
<p>The email message should be visible in the console.</p>
<p>If you didn’t get an email message in your inbox, make sure you set your <strong>config/environments/development.rb</strong> file to perform deliveries as described in the “Configuration” chapter. Be sure to restart your server if you change the configuration file.</p>
<h2 id="208-troubleshooting"><a href="#cid215">20.8 Troubleshooting</a></h2>
<p>If you get an error, you can practice troubleshooting. You’ve set up a complex system with many dependencies. It’s great if it works, but there are several opportunities for errors.</p>
<p>The most likely errors are a missing user name or password. We are trying to connect to the SendGrid email service. SendGrid expects your SendGrid user name. Mine is <code>DanielKehoe</code> (it is not my email address). SendGrid also expects a password.</p>
<h3 id="2081-user-name-issues"><a href="#uid418">20.8.1 User Name Issues</a></h3>
<p>If you get the error message, “SMTP-AUTH requested but missing user name,” SendGrid is not receiving a user name it recognizes.</p>
<p>Check that the user name is set in your Unix environment variables:</p>
<p>$ echo "$SENDGRID_USERNAME"</p>
<p>You should see your SendGrid user name.</p>
<p>Make sure you’ve used underscores consistently. If your Unix environment variable is <code>SENDGRID_USER_NAME</code> and the <strong>config/secrets.yml</strong> file contains <code>SENDGRID_USERNAME</code>, you’ll have a problem.</p>
<h3 id="2082-password-issues"><a href="#uid419">20.8.2 Password Issues</a></h3>
<p>If you get the error message, “SMTP-AUTH requested but missing secret phrase,” SendGrid is not receiving the SendGrid password.</p>
<p>Check that the SendGrid password is set in your Unix environment variables:</p>
<p>$ echo "$SENDGRID_PASSWORD"</p>
<p>You should see the long cryptic string in the console response. Again, make sure you’ve used underscores consistently, and <code>SENDGRID_PASSWORD</code> is used for the Unix environment variable as well as the <strong>config/secrets.yml</strong> file.</p>
<h3 id="2083-problems-with-environment-variables"><a href="#uid420">20.8.3 Problems with Environment Variables</a></h3>
<p>First, close and reopen your terminal to make sure your environment reflects any recent changes you’ve made to your shell configuration. Then try <code>echo "$SENDGRID_USERNAME"</code> to see if you get the credentials you set in your <strong>.bash_profile</strong> or <strong>.bashrc</strong> files.</p>
<p>If you’ve set up Unix environment variables but <code>echo "$SENDGRID_USERNAME"</code> doesn’t return the correct variable in the console, you may have a problem with the way you’ve set Unix environment variables. Most computers use the bash shell and you can set environment variables in your <strong>.bash_profile</strong> or <strong>.bashrc</strong> files. But not every system is alike. If it seems Unix environment variables are not working, you may have to find a colleague who can help you troubleshoot.</p>
<p>If your Unix environment variables are not working, you can hardcode the variables in your <strong>config/secrets.yml</strong> file:</p>
<p>Replace the following:</p>
<p>development:
  email_provider_username: &lt;%= ENV["SENDGRID_USERNAME"] %&gt;
  email_provider_password: &lt;%= ENV["SENDGRID_PASSWORD"] %&gt;</p>
<p>with:</p>
<p>development:
  email_provider_username: example
  email_provider_password: 's#cr*t'</p>
<p>In a YAML file, you do not need quotes unless your string contains special characters. If your password contains any of these characters you should surround the string with single quotes:</p>
<p>: { } [ ] &amp; * # ? | - &lt; &gt; = ! % @ \</p>
<p>Remember the security rule: Don’t commit the <strong>config/secrets.yml</strong> file to Git if it contains any secrets. Test the application and finish your troubleshooting. Then remove the hardcoded values from the <strong>config/secrets.yml</strong> file before committing to Git.</p>
<h2 id="209-asynchronous-mailing"><a href="#cid216">20.9 Asynchronous Mailing</a></h2>
<p>You may notice a delay in the responsiveness of the Contact form after adding the email feature. Unfortunately, there’s a performance penalty with our new feature. Our controller code connects to the SendGrid server and waits for a response before it renders the home page and displays the acknowledgment message.</p>
<p>The performance penalty can be avoided by changing the implementation so that the controller doesn’t wait for a response from the SendGrid server. We call this <em>asynchronous</em> behavior because sending email does not need to be “in sync” with displaying the acknowledgment. Eliminating a delay improves the user experience and makes the site feel more responsive. Asynchronous mailing requires a <em>queueing system</em> for <em>background jobs</em>.</p>
<p>For our tutorial application, and for a typical small business website, the delay caused by lack of queueing is no big deal. Keep in mind, though, as you tackle bigger projects in Rails, you will need to implement a queueing system. Rails includes the <a href="https://github.com/rails/rails/tree/master/activejob">Active Job</a> feature for background processing. The <a href="https://tutorials.railsapps.org/tutorials/rails-mailinglist-activejob">Mailing List with Active Job</a> tutorial in the <a href="https://tutorials.railsapps.org/">Capstone Rails Tutorials</a> series explains how to use it.</p>
<h2 id="2010-git"><a href="#cid217">20.10 Git</a></h2>
<p>Let’s commit our changes to the Git repository and push to GitHub:</p>
<p>$ git add -A
$ git commit -m "sending mail"
$ git push</p>
<p>You’ve created a Rails application that handles a form and sends email to the site owner.</p>
<p>Mail is a practical way to connect with site visitors. Let’s implement a feature that collects email addresses for mass mailing of a newsletter.</p>
<h1 id="chapter-21-mailing-list"><a href="#cid218">Chapter 21 Mailing List</a></h1>
<p>Even as other messaging avenues become increasingly popular, such as messaging apps or Facebook messages, email remains the most practical way to stay in touch with website visitors. Encouraging a visitor to provide an email address means offering an invitation to a dialog and a relationship beyond a single visit.</p>
<p>If you have a legitimate reason to stay in touch, and you’ve motivated the visitor to leave an email address, you’ll need a mailing list service. You’ve seen how Rails can send an email message. From what you’ve seen so far, you can imagine it would not take much code to loop through a list of email addresses from a database, sending a message to each. In the early days of the web, it was easy for any system administrator to write a script for mass mailings. Since there is negligible cost to sending bulk email, unscrupulous and ignorant operators sent email to any address they could scrape, borrow, or steal. The resulting flood of spam made checking one’s inbox an icky experience and destroyed much of the early culture of the Internet. Fortunately, services such as Gmail arose to filter email. There is now a thick (but leaky) layer of screening protocols that redirect spam to a junk folder. One reason you won’t use a Rails application to send bulk email is that a web application server is not the most efficient tool for sending email. More significantly, there’s a good chance your email won’t go through or, if it does (and someone complains), you’ll quickly see your IP address blacklisted. That’s why we use mailing list services to send bulk email such as newsletters or promotional offers.</p>
<p>Considerable expertise is required to keep email from being filtered as spam (see MailChimp’s article <a href="https://static.mailchimp.com/web/guides/email-delivery-for-it-professionals/package/email-delivery-for-it-professionals.pdf">Email Delivery For IT Professionals</a>. Email service providers increase reliability of delivery. These services track deliveries and show how well your email is being delivered. You’ll also get features such as management of “unsubscribe” requests and templates to design attractive messages.</p>
<p>There are at least a dozen well-established email service providers that allow a Rails application to programmatically connect to the service (via an API) to add or remove email addresses. For a list, see the article <a href="https://railsapps.github.io/rails-send-email.html">Send Email with Rails</a>. For this tutorial application, we’ll use <a href="https://mailchimp.com/pricing/">MailChimp</a> because there is no cost to open an account and you can send up to 12,000 emails/month to list of 2000 or fewer subscribers for free.</p>
<p>Spam is unsolicited email. Don’t ever send spam, whether for yourself, a client, or an employer. If recipients complain, your IP address and domain name will be blacklisted. So be very careful to only send to subscribers who signed up, send what subscribers expect, and be sure to offer value. If you get complaints, or the unsubscribe rate is high, stop.</p>
<p>We’ll assume we’ve discussed the rules with Foobar Kadigan and he is eager to offer a newsletter to his visitors that will be genuinely appreciated.</p>
<h2 id="211-user-story"><a href="#cid219">21.1 User Story</a></h2>
<p>Let’s plan our work with a user story:</p>
<p>*Subscribe to Mailing List*
As a visitor to the website
I want to sign up for a mailing list
In order to receive news and announcements</p>
<p>To implement the user story, we’ll add a mailing list feature.</p>
<h2 id="212-implementation"><a href="#cid220">21.2 Implementation</a></h2>
<p>We’ll use the Rails model-view-controller architecture. We’ll need:</p>
<ul>
<li>Visitors model</li>
<li>view for visitors#new</li>
<li>Visitors controller with <code>new</code> and <code>create</code> methods</li>
<li>routing for visitors#new and visitors#create</li>
</ul>
<p>We’ll add a Visitor model that has a data attribute for an email address. We already have a Visitors controller that renders the home page using the file in the <strong>app/views/visitors/</strong> folder. We’ll replace the contents of the view file with a nice photo, a marketing message, and a form.</p>
<p>Our Visitors controller <code>new</code> and <code>create</code> methods will be very similar to what we created for the Contacts controller. Instead of connecting to SendGrid to send a message, we’ll call a method to save the visitor’s email address to a MailChimp mailing list.</p>
<h2 id="213-gibbon-gem"><a href="#cid221">21.3 Gibbon Gem</a></h2>
<p>The <a href="https://github.com/amro/gibbon">Gibbon gem</a> is a convenient wrapper for the <a href="https://apidocs.mailchimp.com/">MailChimp API</a>. We could connect to the MailChimp API using other gems that provide low-level plumbing such as HTTP connections (<a href="http://johnnunemaker.com/httparty/">httparty</a>) and data parsing (<a href="https://github.com/intridea/multi_json">multi_json</a>), but other developers have already done the work of wrapping the plumbing in a higher-level abstraction that easily fits into a Rails application. Amro Mousa’s Gibbon gem is popular and actively maintained.</p>
<p>In your <strong>Gemfile</strong>, you’ve already added:</p>
<p>gem 'gibbon'</p>
<p>and previously run <code>$ bundle install</code>.</p>
<h2 id="214-home-page"><a href="#cid222">21.4 Home Page</a></h2>
<p>Earlier we built a home page that provided a simple demonstration of the Ruby language. We’ll discard it and replace it with a page that you could adapt for a typical small-business website.</p>
<p>We want a nice photo, space for a marketing message, and the “sign up” form.</p>
<p>Replace the contents of the file <strong>app/views/visitors/new.html.erb</strong>:</p>
<p>&lt;% content_for :title do %&gt;Foobar Kadigan&lt;% end %&gt;
&lt;% content_for :description do %&gt;Website of Foobar Kadigan&lt;% end %&gt;</p>
<section>
 <img src="http://lorempixel.com/1170/600/cats/1">
</section>
<section>
 <div class="column">
 <h3>Stay in touch.</h3>
 </div>
 <div class="column">
 <div class="form-centered">
 <%= form\_with(model: @visitor) do |f| %>
 <%= f.email\_field :email, placeholder: 'Your email address...', autofocus: true %>
 <br/>
 <br/>
 <%= f.submit 'Sign up for the newsletter', class: 'submit' %>
 <% end %>
 </div>
 </div>
</section>

<p>We include <code>content_for</code> view helpers that pass a title and description to the application layout.</p>
<p>We add a photo to the page with an <code>&lt;img&gt;</code> tag. We’re taking a shortcut and using a placeholder photo from the <a href="http://lorempixel.com/">lorempixel.com</a> service.</p>
<p>The <code>section</code> and <code>&lt;div class="column"&gt;</code> tags apply our CSS grid to create a row with two columns, one for our marketing message, and one for the form.</p>
<p>Our marketing message is merely a placeholder. For a real website, you’d likely craft a stronger call to action than merely “Stay in touch.”</p>
<p>The form is very similar to the form on the Contact page, except we initialize it with the <code>@visitor</code> instance variable and only need a field for an email address. We use the <code>:placeholder</code> parameter to create a hint in the empty input field.</p>
<p>A submit element will contain the text, “Sign up for the newsletter,” and we apply a CSS class to style the element as a button.</p>
<h3 id="2141-photo-options"><a href="#uid425">21.4.1 Photo Options</a></h3>
<p>You’re free to modify this page as you wish, as long as you keep the form intact.</p>
<p>You might wish to modify the placeholder photo. If you don’t like cats, try <a href="http://lorempixel.com/1170/600/nightlife/1">http://lorempixel.com/1170/600/nightlife/1</a> or any other categories from the <a href="http://lorempixel.com/">lorempixel.com</a> service. You can change the size by modifying the dimensions from 1170 (pixel width) by 600 (pixel height).</p>
<p>You can replace the placeholder photo with your own. Look for the <strong>app/assets/images</strong> folder and add an image. Instead of the HTML <code>&lt;img&gt;</code> tag, use the Rails <code>image_tag</code> view helper, like this:</p>
<p>&lt;%= image_tag "myphoto.jpg" %&gt;</p>
<p>We’ll need a Visitor model to initialize the form.</p>
<h2 id="215-visitor-model"><a href="#cid223">21.5 Visitor Model</a></h2>
<p>The Visitor model is almost identical to the Contact model we created earlier, except there is just one data attribute for the email field.</p>
<p>We’ll also add a <code>subscribe</code> method to add a visitor to a MailChimp list. We’ll call this method from the controller when we process the submitted form.</p>
<p>Create a file <strong>app/models/visitor.rb</strong>:</p>
<p>class Visitor
  include ActiveModel::Model
  attr_accessor :email
  validates_presence_of :email
  validates_format_of :email, with: /\A[-a-z0-9_+\.]+\@([-a-z0-9]+\.)+[a-z0-9]{2,4}\z/i</p>
<p>def subscribe
    mailchimp \= Gibbon::Request.new(api_key: Rails.application.secrets.mailchimp_api_key)
    list_id \= Rails.application.secrets.mailchimp_list_id
    result \= mailchimp.lists(list_id).members.create(
      body: {
        email_address: self.email,
        status: 'subscribed'
    })
    Rails.logger.info("Subscribed #{self.email} to MailChimp") if result
  end</p>
<p>end</p>
<p>When you copy this, be careful to keep the long regex expression <code>with: /.../i</code> on one line (no line breaks).</p>
<p>Just as we did for the Contact model, we use <code>include ActiveModel::Model</code> to mix in behavior from the ActiveModel class. This is the best way to create a model that does not use a database. In other applications, where models use a database, you will create a model class that inherits from ActiveRecord instead.</p>
<p>We create the email attribute using the <code>attr_accessor</code> keyword. We set validation requirements using <code>validates_presence_of</code> and <code>validates_format_of</code> keywords.</p>
<p>To subscribe a visitor to a mailing list, you need to provide:</p>
<ul>
<li>list_id - identify the MailChimp list</li>
<li>email_address - address of the visitor</li>
<li>status - subscribed, pending, or unsubscribed</li>
</ul>
<p>We specify “subscribed” to immediately add the address without asking the user for confirmation. We could specify “Pending” if we wanted to add the address with double-opt-in so the visitor receives a request to confirm the email address before they are subscribed.</p>
<p>Our <code>subscribe</code> method does the work of connecting to the MailChimp server to add the visitor to the mailing list. We instantiate the Gibbon object which provides all the connectivity, providing the <code>mailchimp_api_key</code> value, which we’ve set in the <strong>config/secrets.yml</strong> file. We assign the Gibbon object to the <code>mailchimp</code> variable (we could name it anything).</p>
<p>We set the <code>list_id</code> from a configuration variable in the <strong>config/secrets.yml</strong> file.</p>
<p>The visitor’s <code>email_address</code> is an attribute of the model we obtain from <code>self</code>.</p>
<p>We must set the <code>status</code> property to <code>’subscribed’</code> to indicate the visitor should receive mailings.</p>
<p>Finally, if the application successfully adds the new subscriber, we write a message to the logger. If we get an error when trying to add the subscriber, Gibbon will raise an exception.</p>
<h2 id="216-visitors-controller"><a href="#cid224">21.6 Visitors Controller</a></h2>
<p>We already have a Visitors controller that contains a simple <code>new</code> method. We’ll change the <code>new</code> method, add a <code>create</code> method, and provide a <code>secure_params</code> private method to secure the controller from mass assignment exploits.</p>
<p>Replace the contents of the file <strong>app/controllers/visitors_controller.rb</strong>:</p>
<p>class VisitorsController &lt; ApplicationController</p>
<p>def new
    @visitor \= Visitor.new
  end</p>
<p>def create
    @visitor \= Visitor.new(secure_params)
    if @visitor.valid?
      @visitor.subscribe
      flash[:notice] \= "Signed up #{@visitor.email}."
      redirect_to root_path
    else
      render :new
    end
  end</p>
<p>private</p>
<p>def secure_params
    params.require(:visitor).permit(:email)
  end</p>
<p>end</p>
<p>Our <code>new</code> method now assigns the Visitor model to an instance variable instead of the Owner model.</p>
<p>The <code>create</code> method is almost identical to the Contacts controller <code>create</code> method. We instantiate the Visitor model with scrubbed parameters from the submitted form.</p>
<p>If the validation check succeeds, we subscribe the visitor to the MailChimp mailing list with the <code>@visitor.subscribe</code> method. All the work of connecting to MailChimp happens in the Visitor model.</p>
<p>If the validation check fails, we redisplay the home page (the <code>new</code> action).</p>
<h2 id="217-clean-up"><a href="#cid225">21.7 Clean Up</a></h2>
<p>We no longer use the Owner model, so we can delete the file <strong>app/models/owner.rb</strong>:</p>
<p>$ rm app/models/owner.rb</p>
<p>There’s no harm if it remains but it is good practice to remove code that is no longer used.</p>
<h2 id="218-routing"><a href="#cid226">21.8 Routing</a></h2>
<p>Our routing is now more complex. In addition to rendering the visitors# new view as the application root (the home page), we need to handle the <code>create</code> action. We can use a “resourceful route” as we did with the Contacts controller.</p>
<p>Open the file <strong>config/routes.rb</strong>. Replace the contents with this:</p>
<p>Rails.application.routes.draw do
  resources :contacts, only: [:new, :create]
  resources :visitors, only: [:new, :create]
  root to: 'visitors#new'
end</p>
<p>The root path remains <code>visitors#new</code>. Order is significant in the <strong>config/routes.rb</strong> file. As the final designated route, the root path will only be active if nothing above it matches the route.</p>
<p>We’ve added <code>resources :visitors, only: [:new, :create]</code>.</p>
<p>We only want two routes so we’ve added the restriction <code>only: [:new, :create]</code>.</p>
<p>The <code>new</code> route has these properties:</p>
<ul>
<li><code>new_visitor_path</code> - route helper</li>
<li><code>visitors</code> - name of the controller (VisitorsController)</li>
<li><code>new</code> - controller action</li>
<li><a href="http://localhost:3000/visitors/new">http://localhost:3000/visitors/new</a> - URL generated by the route helper</li>
<li><code>GET</code> - HTTP method to display a page</li>
</ul>
<p>The <code>create</code> route has these properties:</p>
<ul>
<li><code>visitors_path</code> - route helper</li>
<li><code>visitors</code> - name of the controller (VisitorsController)</li>
<li><code>create</code> - controller action</li>
<li><a href="http://localhost:3000/visitors">http://localhost:3000/visitors</a> - URL generated by the route helper</li>
<li><code>POST</code> - HTTP method to submit form data</li>
</ul>
<p>You can run the <code>rails routes</code> command to see these in the console:</p>
<p>$ rails routes
 Prefix Verb URI Pattern             Controller#Action
 contacts POST /contacts(.:format)     contacts#create
new_contact GET  /contacts/new(.:format) contacts#new
 visitors POST /visitors(.:format)     visitors#create
new_visitor GET  /visitors/new(.:format) visitors#new
 root GET  /                       visitors#new
 page GET  /pages/*id              high_voltage/pages#show</p>
<p>The output of the <code>rails routes</code> command shows we’ve created the routes we need.</p>
<h2 id="219-test-the-application"><a href="#cid227">21.9 Test the Application</a></h2>
<p>If you need to start the server:</p>
<p>$ rails server</p>
<p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>.</p>
<p>You’ll see our new home page with the placeholder photo and the “sign up” form.</p>
<p>Enter your email address and click the “sign up” button. You should see the page redisplay with an acknowledgment message. Try entering an invalid email address such as “<a href="/cdn-cgi/l/email-protection">[email protected]</a>@”, or click the submit button without entering an email address, and you should see an error message.</p>
<p>You’ll have to <a href="https://admin.mailchimp.com/">log in to MailChimp</a> and check your list of subscribers to see if the new email address was added successfully.</p>
<p>With MailChimp, you can send a welcome message automatically when the visitor signs up for the mailing list. Use the welcome message to inform the visitor that they’ve successfully subscribed to the mailing list and will receive the next newsletter email.</p>
<p>It’s a bit difficult to find the MailChimp option to create a welcome message. Strangely, MailChimp considers a welcome message a “form.” Here’s how to find it. On the MailChimp “Lists” page, click the “down arrow” for a list and click “Signup forms.” Then click “General forms.” On the “Create Forms” page, there is a drop-down list of “Forms &amp; Response Emails.” The gray box shows “Signup form.” Click the down arrow. Select the menu item named “Final ‘Welcome’ Email” and you’ll be able to create a welcome message.</p>
<h2 id="2110-git"><a href="#cid228">21.10 Git</a></h2>
<p>Let’s commit our changes to the Git repository and push to GitHub:</p>
<p>$ git add -A
$ git commit -m "mailing list"
$ git push</p>
<p>Our tutorial application is feature complete.</p>
<p>Let’s deploy it so we can see it running as a real website.</p>
<h1 id="chapter-22-deploy"><a href="#cid229">Chapter 22 Deploy</a></h1>
<p>You’ve been running the default web server on your local machine. If you wanted, you could leave your computer running, set up a <a href="https://en.wikipedia.org/wiki/List_of_managed_DNS_providers">managed DNS service</a>, and your web application would be accessible to anyone. But even if you wanted to leave your computer running 24 hours a day, you’re probably not a security expert, your web server isn’t tuned to handle much traffic, and your computer is distant from the interconnection hubs where most websites are hosted. For these reasons, when we move a web application from development to production, we deploy it to a <a href="https://en.wikipedia.org/wiki/Web_hosting_service">web hosting service</a> that provides a hosting platform on a server located in a strategically-located <a href="https://en.wikipedia.org/wiki/Data_center">data center</a>.</p>
<p>Data centers offer <a href="https://en.wikipedia.org/wiki/Colocation_centre">colocation services</a>, renting rack-mounted computers with fast Internet connections that can be configured as web servers. In the early days of the web, deploying a web application required <a href="https://en.wikipedia.org/wiki/System_administration">system administration</a> skills to configure and maintain a web server. Today, some developers like to set up their web servers “from bare metal” using <a href="https://en.wikipedia.org/wiki/Virtual_private_server">virtual private servers</a> from Linode, Slicehost, Rackspace, Amazon EC2, or others. With sufficent skills and study, they say there is a feeling of satisfaction from doing it yourself. But not everyone wants to be a system administrator. Most Rails developers simply use a hosted <a href="https://en.wikipedia.org/wiki/Platform_as_a_service">platform as a service</a> (PaaS) provider such as <a href="https://www.heroku.com/">Heroku</a>, <a href="https://www.digitalocean.com/">DigitalOcean</a>, <a href="https://www.engineyard.com/">EngineYard</a>, <a href="https://www.openshift.com/">OpenShift</a>, or <a href="https://pivotal.io/platform">Pivotal Cloud Foundry</a>.</p>
<p>If you’ve previously built web sites, you may already be using a <a href="https://en.wikipedia.org/wiki/Shared_web_hosting_service">shared web hosting</a> service such as GoDaddy or DreamHost. Be skeptical if a shared web hosting service, designed for WordPress or static websites, claims to support Rails applications; most do so badly. Shared hosting services offer file space for static websites on servers that are shared by thousands of websites. A Rails application requires considerably greater computing resources and specialized expertise. In contrast, a platform as a service provider offers a hardware and software stack optimized for application performance and developer convenience.</p>
<p><a href="https://www.heroku.com/">Heroku</a> is the best known and most popular PaaS provider and we’ll use it to deploy the tutorial application. Using Heroku or another PaaS provider means you don’t need skills as a system administrator to manage your web server. Instead, you’ll have experts maintaining the production environment, tuning system performance, and keeping the servers running.</p>
<h2 id="221-heroku-costs"><a href="#cid230">22.1 Heroku Costs</a></h2>
<p>It costs nothing to set up a Heroku account and deploy as many applications as you want. You’ll pay only if you upgrade your hosting to accommodate a busy website.</p>
<p>Heroku pricing is based on a measure of computing resources the company calls a “dyno.” Think of a dyno as a virtual server (though it is not). For personal projects, you can run your Rails application on a single dyno and never incur a charge, as long as it is not active more than 12 hours a day.</p>
<p>A single dyno idles after one hour of inactivity, “going to sleep” until it receives a new web request. For a personal project, this means your web application will respond with a few seconds delay if it hasn’t received a web request in over an hour. After it wakes up, it will respond quickly to every browser request.</p>
<p>If you want your web application running 24 hours per day and responding to every request without delay, Heroku will charge $7 per month for a “hobby” account. You’ll be able to set up a custom domain, using your own domain name. Heroku offers the option of adding dynos to handle more traffic for $25 per month; here’s an article that <a href="http://www.octolabs.com/blogs/octoblog/2015/03/31/analysis-of-the-rumored-heroku-pricing-changes/">compares Heroku costs</a>.</p>
<p>A single dyno can serve thousands of requests per second, but performance depends greatly on your application. As a default, Heroku supports <a href="http://puma.io/">Puma</a>, the recommended web server for Rails 5. Serving a typical Rails application that takes 100ms on average to process each request, Puma can accommodate about 50 requests per second per dyno, which is adequate for a personal project. If traffic surges on your website and exceeds 50 requests per second, you can scale up with more dynos.</p>
<p>Heroku is ideal for hosting our application:</p>
<ul>
<li>no system administration expertise is required</li>
<li>hosting is free</li>
<li>performance is excellent</li>
</ul>
<p>For this tutorial application, we won’t concern ourselves with the possibility that the website may get a lot of traffic. I’m sure you’ll join me in offering hearty thanks to Heroku for providing a convenient service that beginners can use for free.</p>
<p>Let’s deploy!</p>
<h2 id="222-test-the-application"><a href="#cid231">22.2 Test the Application</a></h2>
<p>Before deploying an application to production, a professional Rails developer runs <em>integration</em> or <em>acceptance</em> tests. If the developer follows the discipline of <em>test-driven development</em>, he or she will have a complete test suite that confirms the application runs as expected. Often the developer uses a <em>continuous integration</em> server which automatically runs the test suite each time the code is checked into the GitHub repository.</p>
<p>We haven’t used test-driven development to build this application so no test suite is available. You’ve tested the application manually at each stage.</p>
<h2 id="223-preparing-for-heroku"><a href="#cid232">22.3 Preparing for Heroku</a></h2>
<p>You’ll need to prepare your Rails application for deployment to Heroku.</p>
<h3 id="2231-gemfile"><a href="#uid442">22.3.1 Gemfile</a></h3>
<p>We need to modify the Gemfile for Heroku.</p>
<p>We add a <code>group :production</code> block for a gem that Heroku needs:</p>
<ul>
<li><a href="https://rubygems.org/gems/pg">pg</a> - PostgreSQL gem</li>
</ul>
<p>Heroku doesn’t support the SQLite database; the company provides a PostgreSQL database. Though we won’t need it for our tutorial application, we must include the PostgreSQL gem for Heroku. We’ll mark the <a href="https://rubygems.org/gems/sqlite3">sqlite3</a> gem to be used in development only.</p>
<p>Open your <strong>Gemfile</strong> and replace the contents with the following:</p>
<p><strong>Gemfile</strong></p>
<p>source 'https://rubygems.org'
ruby '2.4.1'
gem 'rails', '~&gt; 5.1.2'</p>
<p># Rails defaults
gem 'sqlite3'
gem 'puma', '~&gt; 3.7'
gem 'sass-rails', '~&gt; 5.0'
gem 'uglifier', '&gt;= 1.3.0'
gem 'coffee-rails', '~&gt; 4.2'
gem 'turbolinks', '~&gt; 5'
gem 'jbuilder', '~&gt; 2.5'
group :development, :test do
  gem 'byebug', platforms: [:mri, :mingw, :x64_mingw]
  gem 'capybara', '~&gt; 2.13'
  gem 'selenium-webdriver'
end
group :development do
  gem 'web-console', '&gt;= 3.3.0'
  gem 'listen', '&gt;= 3.0.5', '&lt; 3.2'
  gem 'spring'
  gem 'spring-watcher-listen', '~&gt; 2.0.0'
end</p>
<p># learn-rails
gem 'bootstrap-sass'
gem 'gibbon'
gem 'high_voltage'
gem 'jquery-rails'
group :development do
  gem 'better_errors'
  gem 'rails_layout'
  gem 'sqlite3'
end
group :production do
  gem 'pg'
end</p>
<p>We have to run <code>bundle install</code> because we’ve changed the Gemfile. The gem we’ve added is only needed in production so we don’t install it on our local machine. When we deploy, Heroku will read the Gemfile and install the gem in the production environment. We’ll run <code>bundle install</code> with the <code>–without production</code> argument so we don’t install the new gem locally:</p>
<p>$ bundle install --without production</p>
<p>You’ll see:</p>
<p>.
.
.
Gems in the group production were not installed.
Use `bundle show [gemname]` to see where a bundled gem is installed.</p>
<p>Let’s commit our changes to the Git repository and push to GitHub:</p>
<p>$ git add -A
$ git commit -m "gems for Heroku"
$ git push</p>
<h3 id="2232-asset-pipeline-in-production"><a href="#uid444">22.3.2 Asset Pipeline in Production</a></h3>
<p>It is important to understand that assets are compiled by Heroku at the time of deployment. Rails compiles assets to make our application faster for the user.</p>
<p>The Rails asset pipeline produces single CSS and JavaScript files that combine all the files in the folders <strong>app/assets/javascripts/</strong> and <strong>app/assets/stylesheets/</strong>. In development mode, the Rails asset pipeline “live compiles” all CSS and JavaScript files so any changes are reflected immediately. But compiling assets adds processing overhead. In production, a web application would be slowed unnecessarily if assets were compiled for every web request. Consequently, assets are precompiled by Heroku at the time we deploy our application to production.</p>
<p>When assets are compiled, the Rails asset pipeline will automatically produce concatenated and minified <strong>application.js</strong> and <strong>application.css</strong> files from files listed in the manifest files <strong>app/assets/javascripts/application.js</strong> and <strong>app/assets/stylesheets/application.css.scss</strong>. The result will be several files added to the <strong>public/assets/</strong> folder. The filenames will contain a long unique identifier that prevents caching when you change the application CSS or JavaScript.</p>
<p>You can precompile assets manually with the command <code>rails assets:precompile</code> but ordinarily it is not necessary. It is a likely indicator that the asset pipeline is not working or assets are not compiled if CSS styling is missing from your web pages.</p>
<p>If you want to learn more about the asset pipeline, refer to the Rails Guide on the <a href="http://guides.rubyonrails.org/asset_pipeline.html">Asset Pipeline</a> or an <a href="https://launchschool.com/blog/rails-asset-pipeline-best-practices">article from LaunchSchool</a>.</p>
<h3 id="2233-option-to-ban-spiders"><a href="#uid445">22.3.3 Option to Ban Spiders</a></h3>
<p>Do you want your website to show up in Google search results? If there’s a link anywhere on the web to your site, within a few days (sometimes hours) the Googlebot spider will visit your site and add it to the database for the Google search engine. Most webmasters want their sites to be found in Google search results. If that’s not what you want, you may want to modify the file <strong>public/robots.txt</strong> to prevent indexing by search engines.</p>
<p>Only change this file if you want to prevent your website from appearing in search engine listings:</p>
<p># See http://www.robotstxt.org/robotstxt.html for documentation</p>
<h1 id="_4"></h1>
<h1 id="to-ban-all-spiders-from-the-entire-site-uncomment-the-next-two-lines">To ban all spiders from the entire site uncomment the next two lines:</h1>
<h1 id="user-agent">User-agent: *</h1>
<h1 id="disallow">Disallow: /</h1>
<p>To block all search engine spiders, remove the commenting from the <code>User-Agent</code> and <code>Disallow</code> lines.</p>
<p>You can learn more about the format of the <a href="https://en.wikipedia.org/wiki/Robots_exclusion_standard">robots exclusion standard</a>.</p>
<h3 id="2234-humanstxt"><a href="#uid446">22.3.4 Humans.txt</a></h3>
<p>Many websites include a <strong>robots.txt</strong> file for nosy bots so it’s only fair that you offer a <strong>humans.txt</strong> file for nosy people. Few people will look for it but you can add a file <strong>public/humans.txt</strong> to credit and identify the creators and software behind the website. The HTML5 Boilerplate project offers an <a href="http://html5boilerplate.com/humans.txt">example file</a> or you can <a href="https://tutorials.railsapps.org/humans.txt">borrow from RailsApps</a>.</p>
<h2 id="224-sign-up-for-a-heroku-account"><a href="#cid233">22.4 Sign Up for a Heroku Account</a></h2>
<p>In the chapter, “Accounts You May Need,” I suggested you sign up for a Heroku account.</p>
<p>To deploy an app to Heroku, you must have a Heroku account. Visit <a href="https://id.heroku.com/signup/devcenter">https://id.heroku.com/signup/devcenter</a> to set up an account.</p>
<p>Be sure to use the same email address you used to configure Git locally. You can check the email address you used for Git with:</p>
<p>$ git config --get user.email</p>
<h2 id="225-heroku-toolbelt"><a href="#cid234">22.5 Heroku Toolbelt</a></h2>
<p>Heroku provides a command line utility for creating and managing Heroku apps.</p>
<p>Visit <a href="https://toolbelt.heroku.com/">https://toolbelt.heroku.com/</a> to install the Heroku Toolbelt. A one-click installer is available for Mac OS X, Windows, and Linux.</p>
<p>The installation process will install the Heroku command line utility. It also installs the <a href="http://blog.daviddollar.org/2011/05/06/introducing-foreman.html">Foreman</a> gem which is useful for duplicating the Heroku production environment on a local machine. The installation process will also make sure Git is installed.</p>
<p>To make sure the Heroku command line utility is installed, try:</p>
<p>$ heroku version
heroku-toolbelt/...</p>
<p>You’ll see the heroku-toolbelt version number.</p>
<p>You should be able to login using the email address and password you used when creating your Heroku account:</p>
<p>$ heroku login
Enter your Heroku credentials.
Email: <a href="/cdn-cgi/l/email-protection">[email protected]</a>
Password:
Could not find an existing public key.
Would you like to generate one? [Yn]
Generating new SSH public key.
Uploading ssh public key /Users/adam/.ssh/id_rsa.pub</p>
<p>The Heroku command line utility will create SSH keys if necessary to guarantee a secure connection to Heroku.</p>
<h2 id="226-heroku-create"><a href="#cid235">22.6 Heroku Create</a></h2>
<p>Be sure you are in your application root directory and you’ve committed the tutorial application to your Git repository.</p>
<p>Use the Heroku create command to create and name your application.</p>
<p>$ heroku create myapp</p>
<p>Replace <code>myapp</code> with something unique. Heroku demands a unique name for every hosted application. If it is not unique, you’ll see an error, “name is already taken.” Chances are, “learn-rails” is already taken.</p>
<p>The name must start with a letter and can only contain lowercase letters, numbers, and dashes.</p>
<p>If you don’t specify your app name (<code>myapp</code> in the example above), Heroku will supply a placeholder name. You can easily change Heroku’s placeholder name to a name of your choice with the <code>heroku apps:rename</code> command (see <a href="https://devcenter.heroku.com/articles/renaming-apps">Renaming Apps from the CLI</a>).</p>
<p>Don’t worry too much about getting the “perfect name” for your Heroku app. The name of your Heroku app won’t matter if you plan to set up your Heroku app to use your own domain name. You’ll just use the name for access to the instance of your app running on the Heroku servers; if you have a custom domain name, you’ll set up DNS (<em>domain name service</em>) to point your domain name to the app running on Heroku.</p>
<p>The <code>heroku create</code> command sets your Heroku application as a Git remote repository. That means you’ll use the <code>git push</code> command to deploy your application to Heroku.</p>
<h2 id="227-enable-email"><a href="#cid236">22.7 Enable Email</a></h2>
<p>You’ll need to enable email for production or else you’ll get errors when your application tries to send email from Heroku.</p>
<p>To use SendGrid, add the following to your <strong>config/environments/production.rb</strong> file:</p>
<p># email enabled in production
config.action_mailer.smtp_settings \= {
  address: "smtp.sendgrid.net",
  port: 587,
  domain: Rails.application.secrets.domain_name,
  authentication: "plain",
  enable_starttls_auto: true,
  user_name: Rails.application.secrets.email_provider_username,
  password: Rails.application.secrets.email_provider_password
}
# ActionMailer Config
config.action_mailer.default_url_options \= { :host \=&gt; Rails.application.secrets.domain_name }
config.action_mailer.delivery_method \= :smtp
config.action_mailer.perform_deliveries \= true
config.action_mailer.raise_delivery_errors \= false</p>
<p>You can use port 25, 587, or 2525 (some ISPs restrict connections on port 25).</p>
<p>Be sure to add the new settings before the <code>end</code> keyword in the file. The settings can be added anywhere, as long as they precede the <code>end</code> keyword!</p>
<p>You’ll need to specify the unique name you’ve selected for your hosted application. We’re using the <code>Rails.application.secrets.domain_name</code> configuration variable in two places in the file. The <strong>config/secrets.yml</strong> file provides configuration variables for use in production.</p>
<p>Be sure to commit your code to the Git local repository:</p>
<p>$ git add -A
$ git commit -m "email set for Heroku"
$ git push</p>
<p>Next we’ll set Heroku environment variables.</p>
<h2 id="228-set-heroku-environment-variables"><a href="#cid237">22.8 Set Heroku Environment Variables</a></h2>
<p>When you run your application, configuration values are obtained from the <strong>config/secrets.yml</strong> file, which contains Unix environment variables which are set in the <strong>.bash_profile</strong> or <strong>.bashrc</strong> files.</p>
<p>Heroku doesn’t have a <strong>.bash_profile</strong> or <strong>.bashrc</strong> file, so you’ll need a way to set environment variables on Heroku. You can use the <code>heroku config:add</code> command.</p>
<p>$ heroku config:add SENDGRID_USERNAME\='example'
$ heroku config:add SENDGRID_PASSWORD\='secret'
$ heroku config:add MAILCHIMP_API_KEY\='my-key'
$ heroku config:add MAILCHIMP_LIST_ID\='mylistid'
$ heroku config:add OWNER_EMAIL\='<a href="/cdn-cgi/l/email-protection">[email protected]</a>'
$ heroku config:add DOMAIN_NAME\='myapp.herokuapp.com'</p>
<p>Don’t use the values shown above. Instead, look in your <strong>.bash_profile</strong> or <strong>.bashrc</strong> files and copy the values you find there.</p>
<p>When you set <code>myapp.herokuapp.com</code>, replace <code>myapp</code> with the name that Heroku is using for your application. If you want to use a custom domain name, you’ll need to set up DNS (<em>domain name service</em>), which we won’t cover in this tutorial.</p>
<p>You don’t need to set <code>SECRET_KEY_BASE</code>, even though it is in your <strong>config/secrets.yml</strong> file. Heroku sets it automatically.</p>
<p>Check that the environment variables are set with:</p>
<p>$ heroku config</p>
<p>See the Heroku documentation on <a href="https://devcenter.heroku.com/articles/config-vars">Configuration and Config Vars</a> and the article <a href="https://railsapps.github.io/rails-environment-variables.html">Rails Environment Variables</a> for more information.</p>
<h2 id="229-push-to-heroku"><a href="#cid238">22.9 Push to Heroku</a></h2>
<p>After all this preparation, you can finally push your application to Heroku.</p>
<p>Be sure to commit any recent changes to the Git local repository before you push to Heroku.</p>
<p>You commit your code to Heroku just like you push your code to GitHub.</p>
<p>Here’s how to push to Heroku:</p>
<p>$ git push heroku master</p>
<p>You may see a message, “The authenticity of host ‘heroku.com’ can’t be established. Are you sure you want to continue connecting (yes/no)?”. You can answer “yes” and safely continue.</p>
<p>The push to Heroku takes several minutes. You’ll see a sequence of diagnostic messages in the console, beginning with:</p>
<p>Counting objects...</p>
<p>and finishing with:</p>
<p>remote: Verifying deploy.... done.</p>
<h2 id="2210-updating-the-application"><a href="#cid239">22.10 Updating the Application</a></h2>
<p>It is likely you’ll make changes to your application after deploying to Heroku.</p>
<p>Each time you update your site and push the changes to GitHub, you’ll also have to push the new version to Heroku. A typical update scenario looks like this:</p>
<p>$ git add -A
$ git commit -m "revised application"
$ git push
$ git push heroku master</p>
<h2 id="2211-visit-your-site"><a href="#cid240">22.11 Visit Your Site</a></h2>
<p>Your application will be running at <a href="https://my-app-name.herokuapp.com/">http://my-app-name.herokuapp.com/</a>. You can open any web browser and visit the site. For a shortcut, you can open your default web browser and visit your site from the command line:</p>
<p>$ heroku open</p>
<p>If you’re using hosted development such as Cloud9, you’ll need to open a browser manually to visit the site.</p>
<p>If you’ve configured everything correctly, you should be able to sign up for the newsletter and send a contact request.</p>
<h2 id="2212-customizing"><a href="#cid241">22.12 Customizing</a></h2>
<p>For a real application, you’ll likely want to use your own domain name for your app.</p>
<p>See <a href="https://devcenter.heroku.com/articles/custom-domains">Heroku’s article about custom domains</a> for instructions.</p>
<p>You may also want to improve website responsiveness by adding page caching with a content delivery network such as <a href="https://cloudflare.com/">CloudFlare</a>. CloudFlare can also provide an SSL connection for secure connections between the browser and server.</p>
<p>Heroku offers many <a href="https://addons.heroku.com/">add-on services</a>. These are particularly noteworthy:</p>
<ul>
<li><a href="http://www.adeptscale.com/">Adept Scale</a> - automated scaling of Heroku dynos</li>
<li><a href="https://newrelic.com/">New Relic</a> - performance monitoring</li>
</ul>
<p>For an in-depth look at your options, see the <a href="https://railsapps.github.io/rails-heroku-tutorial.html">Rails Heroku Tutorial</a>.</p>
<h2 id="2213-troubleshooting"><a href="#cid242">22.13 Troubleshooting</a></h2>
<p>When you get errors, troubleshoot by reviewing the log files:</p>
<p>$ heroku logs</p>
<p>If necessary, use the Unix <code>tail</code> flag to monitor your log files. Open a new terminal window and enter:</p>
<p>$ heroku logs -t</p>
<p>to watch the server logs in real time.</p>
<h2 id="2214-where-to-get-help"><a href="#cid243">22.14 Where to Get Help</a></h2>
<p>Your best source for help with Heroku is <a href="https://stackoverflow.com/questions/tagged/heroku">Stack Overflow</a>. Use the tag “heroku,” “learn-ruby-on-rails,” or “railsapps” when you post your question. Your issue may have been encountered and addressed by others.</p>
<p>You can also check the <a href="https://devcenter.heroku.com/">Heroku Dev Center</a> or the <a href="https://groups.google.com/group/heroku/">Heroku Google Group</a>.</p>
<h1 id="chapter-23-analytics"><a href="#cid244">Chapter 23 Analytics</a></h1>
<p>In earlier chapters, we built the tutorial application and deployed it for hosting on Heroku.</p>
<p>We’ve left something out. Though not obvious, it’s very important: analytics.</p>
<p>Analytics services provide reports about website traffic and usage.</p>
<p>You’ll use the data to increase visits and improve your site. Analytics close the communication loop with your users; your website puts out a message and analytics reports show how visitors respond.</p>
<p>Google Analytics is the best known tracking service. It is free, easy to use, and familiar to most web developers. In this chapter we’ll integrate Google Analytics with the tutorial application.</p>
<p>There are several ways to install Google Analytics for Rails. The article on <a href="https://railsapps.github.io/rails-google-analytics.html">Analytics for Rails</a> looks at various approaches and explains how Google Analytics works.</p>
<p>For this tutorial, we’ll use the <a href="https://segment.com/">Segment.com</a> service. The service provides an API to send analytics data to dozens of different services, including Google Analytics.</p>
<h2 id="231-segmentcom"><a href="#cid245">23.1 Segment.com</a></h2>
<p><a href="https://segment.com/">Segment.com</a> is a subscription service that gathers analytics data from your application and sends it to dozens of different services, including Google Analytics. The service is free for low-volume websites, accommodating 1000 tracked users per month at no cost. There is no charge to sign up for the service.</p>
<p>Using Segment.com means you install one JavaScript library and get access to reports from dozens of analytics services. You can <a href="https://segment.com/docs/integrations">see a list of supported services</a>. The company offers helpful advice about <a href="https://segment.com/academy/">which analytics tools to choose from</a>. For low-volume sites, many of the analytics services are free, so Segment.com makes it easy to experiment and learn about the available analytics tools. The service is fast and reliable, so there’s no downside to trying it.</p>
<h2 id="232-accounts-you-will-need"><a href="#cid246">23.2 Accounts You Will Need</a></h2>
<p>You will need an account with Segment.com. <a href="https://segment.com/signup">Sign up for Segment.com</a>.</p>
<p>You will need accounts with each of the services that you’ll use via Segment.com.</p>
<p>You’ll likely want to start with Google Analytics, so you’ll need a Google Analytics account and tracking ID.</p>
<p>Visit the <a href="https://www.google.com/analytics/">Google Analytics website</a> to obtain the Tracking ID for your website. You’ll need to know the domain name of your website to get an account for your website. If you’ve deployed to Heroku without a custom domain, use the domain that looks like “myapp.herokuapp.com”. Or use your custom domain if you have one. Use it for fields for “Website Name,” “Web Site URL,” and “Account Name.”</p>
<p>Choose the defaults when you create your Google Analytics account and click “Get Tracking ID.” Your tracking ID will look like this: <code>UA-XXXXXXX-XX</code>. You won’t need the tracking code snippet as we will use the Segment.com JavaScript snippet instead.</p>
<p>You’ll check your Google Analytics account later to verify that Google is collecting data.</p>
<h2 id="233-installing-the-javascript-library"><a href="#cid247">23.3 Installing the JavaScript Library</a></h2>
<p>Segment.com provides a JavaScript snippet that sets an API token to identify your account and installs a library named <strong>analytics.js</strong>. This is similar to how Google Analytics works. The Segment.com library loads asynchronously, so it won’t affect page load speed.</p>
<p>The Segment.com JavaScript snippet should be loaded on every page and it can be included as an application-wide asset using the Rails asset pipeline.</p>
<p>We’ll add the Segment.com JavaScript snippet to a file named <strong>app/assets/javascripts/segment.js</strong>. The manifest directive <code>//= require_tree .</code> in the file <strong>app/assets/javascripts/application.js</strong> will ensure that the new file is included in the concatenated application JavaScript file. If you’ve removed the <code>//= require_tree .</code> directive, you’ll have to add a directive to include the <strong>app/assets/javascripts/segment.js</strong> file.</p>
<p>Create a file <strong>app/assets/javascripts/segment.js</strong> and include the following:</p>
<p>(function(){</p>
<p>// Create a queue, but don't obliterate an existing one!
  var analytics \= window.analytics \= window.analytics || [];</p>
<p>// If the real analytics.js is already on the page return.
  if (analytics.initialize) return;</p>
<p>// If the snippet was invoked already show an error.
  if (analytics.invoked) {
    if (window.console &amp;&amp; console.error) {
      console.error('Segment snippet included twice.');
    }
    return;
  }</p>
<p>// Invoked flag, to make sure the snippet
  // is never invoked twice.
  analytics.invoked \= true;</p>
<p>// A list of the methods in Analytics.js to stub.
  analytics.methods \= [
    'trackSubmit',
    'trackClick',
    'trackLink',
    'trackForm',
    'pageview',
    'identify',
    'reset',
    'group',
    'track',
    'ready',
    'alias',
    'debug',
    'page',
    'once',
    'off',
    'on'
  ];</p>
<p>// Define a factory to create stubs. These are placeholders
  // for methods in Analytics.js so that you never have to wait
  // for it to load to actually record data. The `method` is
  // stored as the first argument, so we can replay the data.
  analytics.factory \= function(method){
    return function(){
      var args \= Array.prototype.slice.call(arguments);
      args.unshift(method);
      analytics.push(args);
      return analytics;
    };
  };</p>
<p>// For each of our methods, generate a queueing stub.
  for (var i \= 0; i &lt; analytics.methods.length; i++) {
    var key \= analytics.methods[i];
    analytics[key] \= analytics.factory(key);
  }</p>
<p>// Define a method to load Analytics.js from our CDN,
  // and that will be sure to only ever load it once.
  analytics.load \= function(key){
    // Create an async script element based on your key.
    var script \= document.createElement('script');
    script.type \= 'text/javascript';
    script.async \= true;
    script.src \= ('https:' \=== document.location.protocol
      ? 'https://' : 'http://')
      + 'cdn.segment.com/analytics.js/v1/'
      + key + '/analytics.min.js';</p>
<pre><code>// Insert our script next to the first script element.
var first \= document.getElementsByTagName('script')\[0\];
first.parentNode.insertBefore(script, first);
</code></pre>
<p>};</p>
<p>// Add a version to keep track of what's in the wild.
  analytics.SNIPPET_VERSION \= '4.0.0';</p>
<p>// Load Analytics.js with your key, which will automatically
  // load the tools you've enabled for your account. Boosh!
  analytics.load("YOUR_WRITE_KEY");</p>
<p>})();</p>
<p>You can get the newest version of the code from the <a href="https://segment.com/docs/sources/website/analytics.js/quickstart/">Segment.com Quickstart</a> page. If you copy a newer version of the code, remove the <code>&lt;script type="text/javascript"&gt;</code> and <code>&lt;/script&gt;</code> tags from the top and bottom. The Rails asset pipeline will add the code to the <strong>application.js</strong> file which already contains the necessary <code>&lt;script&gt;</code> tags.</p>
<p>If you copy the code from the Segment.com Quickstart instructions, also remove:</p>
<p>// Make the first page call to load the integrations. If
  // you'd like to manually name or tag the page, edit or
  // move this call however you'd like.
  analytics.page();</p>
<p>We’ll add <code>analytics.page();</code> later, wrapping it in additional code to accommodate Rails Turbolinks.</p>
<p>Note that the Segment.com website offers a minified version of the snippet for faster page loads. We’ve used the non-minified version so you can read the code and comments. If you want, you can get minified version from the Segment.com website for improved speed.</p>
<h2 id="234-replace-the-write-key"><a href="#cid248">23.4 Replace the Write Key</a></h2>
<p>You <strong>must replace</strong> <code>YOUR_WRITE_KEY</code> with your Segment.com “Write Key.” After you <a href="https://segment.com/">log in to Segment.com</a>, click on your “workspace,” then choose a “source,” click “settings,” and click “API Keys” in the side navigation bar. Add the “Write Key” in the file where you see this line:</p>
<p>// Load Analytics.js with your key, which will automatically
// load the tools you've enabled for your account. Boosh!
analytics.load("YOUR_WRITE_KEY");</p>
<p>Now you must add extra code to the Segment.com JavaScript snippet. The extra code accommodates Turbolinks, plus page view and event tracking, which we’ll look at next.</p>
<h2 id="235-add-integration-code"><a href="#cid249">23.5 Add Integration Code</a></h2>
<p>To make sure every page is tracked when Rails Turbolinks is used, plus track page views and events, you must add the following JavaScript to the end of the <strong>app/assets/javascripts/segment.js</strong> file:</p>
<p>// accommodate Turbolinks
// track page views and form submissions
$(document).on('turbolinks:load', function() {
  console.log('page loaded');
  analytics.page();
  analytics.trackForm($('#new_visitor'), 'Signed Up');
  analytics.trackForm($('#new_contact'), 'Contact Request');
})</p>
<p>Add it after the last line. Add it after the orthographic car wreck that looks like <code>})();</code>.</p>
<p>I’ll explain the purpose of this code next.</p>
<h2 id="236-page-view-tracking-with-turbolinks"><a href="#cid250">23.6 Page View Tracking with Turbolinks</a></h2>
<p>To make sure every page is tracked when Rails Turbolinks is used, we’ve added the following JavaScript to the <strong>app/assets/javascripts/segment.js</strong> file:</p>
<p>// accommodate Turbolinks
// track page views and form submissions
$(document).on('turbolinks:load', function() {
.
.
.
  analytics.page();
.
.
.
})</p>
<p>Rails 4.0 introduced a feature named <a href="https://github.com/rails/turbolinks/">Turbolinks</a> to increase the perceived speed of a website.</p>
<p>Turbolinks makes an application appear faster by only updating the body and the title of a page when a link is followed. By not reloading the full page, Turbolinks reduces browser rendering time and trips to the server.</p>
<p>With Turbolinks, the user follows a link and sees a new page but Segment.com or Google Analytics thinks the page hasn’t changed because a new page has not been loaded. To resolve the issue, you could disable Turbolinks by removing the turbolinks gem from the Gemfile. However, it’s nice to have both the speed of Turbolinks and tracking data, so I’ll show you how to get tracking data with Turbolinks.</p>
<p>Turbolinks fires a <code>load</code> event when a page has been replaced. The code listens for the <code>load</code> event and calls the Segment.com <code>analytics.page()</code> method. This code will work even on pages that are not visited through Turbolinks (for example, the first page visited).</p>
<h2 id="237-event-tracking"><a href="#cid251">23.7 Event Tracking</a></h2>
<p>Segment.com gives us a convenient method to track page views. Page view tracking gives us data about our website traffic, showing visits to the site and information about our visitors.</p>
<p>It’s also important to learn about a visitor’s activity on the site. Site usage data helps us improve the site and determine whether we are meeting our business goals. This requires tracking events as well as page views.</p>
<p>The Segment.com JavaScript library gives us two methods to track events:</p>
<ul>
<li><code>trackLink</code></li>
<li><code>trackForm</code></li>
</ul>
<p>Link tracking can be used to send data to Segment.com whenever a visitor clicks a link. It is not useful for our tutorial application because we simply record a new page view when a visitor clicks a link on our site. However, if you add links to external sites and want to track click-throughs, you could use the <code>trackLink</code> method. The method can also be used to track clicks that don’t result in a new page view, such as changing elements on a page.</p>
<p>The <code>trackForm</code> method is more useful for our tutorial application. We’ve already appended it to the <strong>app/assets/javascripts/segment.js</strong> file:</p>
<p>// accommodate Turbolinks
// track page views and form submissions
$(document).on('turbolinks:load', function() {
  console.log('page loaded');
  analytics.page();
  analytics.trackForm($('#new_visitor'), 'Signed Up');
  analytics.trackForm($('#new_contact'), 'Contact Request');
})</p>
<p>I’ve included a <code>console.log(’page loaded’)</code> statement so you can check the browser JavaScript console to see if the code runs as expected.</p>
<p>The <code>trackForm</code> method takes two parameters, the ID attribute of a form and a name given to the event.</p>
<p>Form tracking will show us how many visitors sign up for the newsletter or submit the contact request form. Obviously we can count the number of subscribers in MailChimp or look in the site owner’s inbox to see how many contact requests we’ve received. But form tracking helps us directly correlate the data with visitor data. For example, we can analyze our site usage data and see which traffic sources result in the most newsletter sign-ups.</p>
<p>You can read more about the Segment.com JavaScript library in the <a href="https://segment.com/libraries/analytics.js">Segment.com documentation</a>.</p>
<h2 id="238-troubleshooting"><a href="#cid252">23.8 Troubleshooting</a></h2>
<p>Click “Debugger” in the navigation bar so you can monitor data sent to Segment.com from your application.</p>
<p>When you test the application locally, you should see the results of page visits and form submissions within seconds in the Segment.com debugger.</p>
<p>If you don’t see your page visits in the Segment.com debugger, open the browser JavaScript console, visit a page, and check for the message “page loaded” in the JavaScript console. In the Chrome browser, the JavaScript console is available under the item “Developer” in the “View” menu.</p>
<h2 id="239-segmentcom-integrations"><a href="#cid253">23.9 Segment.com Integrations</a></h2>
<p>After installing the Segment.com JavaScript snippet in your application, go to your “sources” page and click the “integrations” link to visit the integrations page to select the services that will receive your data.</p>
<p>Each service requires a different configuration information. At a minimum, you’ll have to provide an account identifier or API key that you obtained when you signed up for the service.</p>
<p>For Google Analytics, enter your Google Analytics tracking id. It looks like <code>UA-XXXXXXX-XX</code>.</p>
<p>With Google Analytics enabled as a Segment.com integration, you’ll see form submissions appear in the Google Analytics Real-Time report, under the “Events” heading.</p>
<p>Note that Google doesn’t process their data in real-time in most of its reports. Data appears immediately in the Google Analytics Real-Time report. Other Google Analytics reports, such as the Audience report, won’t show data immediately. Check the next day for updated reports.</p>
<h2 id="2310-deploy"><a href="#cid254">23.10 Deploy</a></h2>
<p>Commit to the Git repo and deploy to Heroku:</p>
<p>$ git add -A
$ git commit -m "analytics"
$ git push</p>
<p>Then you can deploy to Heroku:</p>
<p>$ git push heroku master</p>
<p>When you visit the site, you should see real-time tracking of data sent to Segment.com in the Segment.com debugger.</p>
<p>Log into your Google Analytics account to see real-time tracking of visits to your website. Under “Standard Reports” see “Real-Time Overview.” You’ll see data within seconds after visiting any page.</p>
<h2 id="2311-improving-the-user-experience"><a href="#cid255">23.11 Improving the User Experience</a></h2>
<p>Website analytics can be used to improve visitors’ experience of the website. Deploying the website is not the last step in your project. Unlike many earlier forms of communication (such as releasing a film, publishing a book, or broadcasting an advertisement), we can see how every visitor responds to the website. That means your work is not done when you deploy the site. Look at your usage data to see which elements of the site are getting attention and which are being used.</p>
<p>Does no one visit the “About” page? Maybe the navigation link is difficult to find. Do many people visit the Contact page but few submit a contact request form? Maybe you should change the label on the button or offer other ways to contact the site owner.</p>
<p>Effective and successful websites often are the result of systematic <a href="https://en.wikipedia.org/wiki/A/B_testing">A/B testing</a> (sometimes called <em>split testing</em>). A/B testing is a technique of creating variations on a web page, such as changing text, layout, or button colors, and using website analytics to measure the effect of the change. You can learn more about services such as <a href="https://www.google.com/analytics/features/content.html">Content Analytics</a> in Google Analytics, <a href="https://www.optimizely.com/">Optimizely</a>, or <a href="http://visualwebsiteoptimizer.com/">Visual Website Optimizer</a>. These services provide complete “dashboards” to set up usage experiments and measure results (<a href="https://www.optimizely.com/">Optimizely</a> is available as a Segment.com integration).</p>
<h2 id="2312-conversion-tracking"><a href="#cid256">23.12 Conversion Tracking</a></h2>
<p>You may only be interested in knowing that people visit your site, without measuring visitors’ engagement or response to the site. But in most cases, if you build a website, you’ll offer a way for visitors to respond, whether it is by purchasing a product, signing up for a newsletter, or clicking a “like” button.</p>
<p>The ultimate measure of website effectiveness is the <a href="https://en.wikipedia.org/wiki/Conversion_rate">conversion rate</a>. The term comes from the direct marketing industry and originally referred to a measure of how people responded to “junk mail” offers. For a website, the conversion rate indicates the proportion of visitors who respond to a <em>call to action</em>, which may be an offer to make a purchase, register for a membership, sign up for a newsletter, or any other activity which shows the visitor is engaged and interested.</p>
<p>For our tutorial application, we can measure our website effectiveness by looking at the conversion rate for newsletter sign-ups.</p>
<p>We’re tracking page views which will give us a count of visits to the website home page. And we’ve got event tracking in place to count newsletter sign-ups. If 100 people visit the home page and 10 people request a newsletter, we’ve got a conversion rate of 10%.</p>
<p>We can try to improve the conversion rate by improving the user experience (perhaps through A/B testing) or focusing on increasing traffic from sources that provide a higher conversion rate.</p>
<p>You can monitor your site’s conversion rate by <a href="https://support.google.com/analytics/answer/1032415?hl=en">setting up events as goals</a> in Google Analytics. Segment.com also integrates with many services which provide conversion tracking.</p>
<h2 id="2313-enjoy-what-youve-achieved"><a href="#cid257">23.13 Enjoy What You’ve Achieved</a></h2>
<p>You’ve completed building the tutorial application.</p>
<p>If your project was to build an application for someone else, whether the company you work for, or a client like Foobar Kadigan, you’ve completed the <a href="https://en.wikipedia.org/wiki/Deliverable">deliverable</a>.</p>
<p>You started with project planning, in the form of user stories. You implemented the application using a variety of technologies supported by the Ruby on Rails development platform. And you’ve deployed the application for others to use, with analytics in place to track traffic and usage.</p>
<p>Not every manager or client will appreciate the effort or the complexity of the project you’ve built. Mr. Kadigan’s happiness may depend on how well you’ve understood his goals and the degree to which you’ve met his expectations. If you’re working for yourself, or launching your startup, you may be your own toughest boss, because there is always more to do.</p>
<p>With technology projects, like many other aspects of life, though it seems you’ll never get it right, and never get it done, there are moments when you can savor a sense of accomplishment. This is one of those moments.</p>
<p>Before you start thinking about adding one more feature, or updating the application for the new releases that inevitably came out during the time you were working, take time to bask in the satisfaction of seeing the results of your work.</p>
<p>Software development has its own unique rhythm of frustration and satisfaction. As software developers, we subject ourselves to hours, days, or weeks of struggle with code that is cryptic and resists understanding. We gain mastery for a few minutes and then turn to the next problem. With each feature you implement, or issue you resolve, you’ll experience brief elation before resuming the grind of development. But at each milestone, and at the completion of the project, you’ve built something tangible that you can use. You can try it out yourself and show it to others.</p>
<p>Give yourself full credit. You’ve built something extraordinary with little more than intelligence and attention. You’ve leveraged the work of other developers who have contributed to the open source Ruby on Rails platform and you’ve created your own unique product. This is what drives us as developers; to create something from nothing, using only our collective intelligence and ambition.</p>
<h1 id="chapter-24-testing"><a href="#cid258">Chapter 24 Testing</a></h1>
<p>You don’t need to read this chapter if you will always be a student, or a hobbyist, working on personal projects. But if you wish to work as a professional Rails developer, or launch your own startup, with money and reputation at stake, you must learn about testing. In this chapter, I’ll introduce the basic concepts of testing and show how to build a test suite for the tutorial application.</p>
<h2 id="241-why-test"><a href="#cid259">24.1 Why Test?</a></h2>
<p>Software applications are fragile. When you write a song, you can include a wrong note and the song won’t break. In a film, technical flaws like a “jump cut” or a microphone in the frame won’t ruin an entire movie. But an unseen error in a software program can disrupt a key feature or crash the entire application.</p>
<p>Software applications are never finished. Songs and movies reach a stage of completion and are delivered to their audience, with no expectation that the completed work will change. With software applications, there’s always an upcoming version with bug fixes or new features. As web developers, we continue to make changes to the applications that our customers are actively using. Sometimes new features are delivered within minutes, or hours, of committing new code to the repository.</p>
<p>Software applications are complex. A web application, or any software program, is a machine with intricately connected parts, or <em>dependencies</em>. As an application grows, the connections quickly grow more complex, to the point where no one is able to see all the dependencies at once. Plus, web applications are often a collaborative effort, so no one person is familiar with every line of code.</p>
<p>Combine the evolving nature of an application, with the complexity of the product, and the likelihood that flaws will be immediately noticed by users, and you’ll realize why testing is so important to the software development process.</p>
<p>Testing was once considered the sole responsibility of a <em>quality assurance</em> (QA) department. Senior developers created new features or fixed bugs. When the work was “done,” lesser paid (and lower status) developers “in QA” clicked through screens, with written notes or scripts, as if they were users testing every feature of a program. Invariably, manual testing led to oversights, because testing notes were out of date, “edge cases” were overlooked, and the work was monotonous. In the best-run companies, QA engineers are now expert consultants on testing methods and a source of guidance for other developers. We now rely on <em>automated testing</em>. Even more important, the job of writing test code now belongs to the developer who creates a feature or fixes a bug. It’s our responsibility to write adequate tests for any code we add to the repository.</p>
<h2 id="242-what-are-tests"><a href="#cid260">24.2 What Are Tests?</a></h2>
<p>Developers talk about testing as if it were an activity different from writing code. It is not. Testing is something we do while writing code. We create tests with the same text editor we use use to write code. The tests themselves are written in Ruby, just like any other part of a Rails application. You’ll put the test code in either a <strong>tests/</strong> or <strong>spec/</strong> folder, committed to the Git repository with all the other code. You’ll use the specialized API of a testing framework for the methods of your tests, either <a href="https://github.com/seattlerb/minitest">Minitest</a> or <a href="http://rspec.info/">RSpec</a>. Test code is different from code that implements features in one significant way: Instead of supporting interactions with a user, test code interacts with the code you’ve written, verifying the code behaves as intended.</p>
<h2 id="243-scripted-or-exploratory"><a href="#cid261">24.3 Scripted or Exploratory</a></h2>
<p>When testing is used for quality assurance, the goal is to create a suite of automated tests that will reveal any bugs that creep into code and break the application. Sometimes this is called <em>scripted testing</em>. These tests are checked into the software repository and maintained with the application. Often developers will set up a system for <em>continuous integration</em> (CI), which will automatically run the test suite whenever the repository is updated. Developers can set up a CI server such as <a href="https://jenkins-ci.org/">Jenkins</a> or use a hosted CI service such as <a href="https://travis-ci.com/">Travis CI</a>, <a href="https://circleci.com/">CircleCI</a>, or <a href="https://semaphoreapp.com/">Semaphore</a> to run tests automatically. Automated testing with continuous integration serves as a safety net for developers.</p>
<p>There is another role for testing, which is often called <em>exploratory testing</em>, or <em>developer testing</em>. These tests may end up in an application test suite, but the primary purpose is to help a developer construct an application. Many developers, after gaining experience in writing tests for quality assurance, realize that writing tests can be a useful first step in figuring out how a feature should be implemented. It may seem odd to write tests first, but exploratory testing can clarify what behavior will be required, and help the developer think through alternatives and edge cases. This approach is called <em>test-first development</em>, and many developers will tell you that when you write tests first, you’ll be more satisfied; you’ll be more focused; and you’ll avoid tangents and detours of the “nice-to-have-but-not-really-needed” variety. We’ll look closely at test-first development in conjunction with Test-Driven Development (TDD) and Behavior-Driven Development (BDD) at the end of this chapter. First, let’s gain an understanding of testing terminology and practice.</p>
<h2 id="244-regression-and-acceptance"><a href="#cid262">24.4 Regression and Acceptance</a></h2>
<p>We describe tests by the purpose they serve. In addition to exploratory testing used in test-first development, there are several kinds of tests used for quality assurance.</p>
<p><em>Regression tests</em> are run every time we change code. Sometimes we want to make sure new features don’t break the existing application. More often, we run tests after changing existing code to make it more readable, elegant, or effective. We call this tinkering “<em>refactoring</em>.” Refactoring is very similar to what we call editing or rewriting when we work with the written word. Before we refactor, we need to know what results we expect from our code, and we need automated tests to execute our code and check for the expected results. If our automated tests are adequate, we can use the tests as regression tests, making sure our refactoring hasn’t introduced new bugs.</p>
<p><em>Acceptance tests</em> are sometimes identical to regression tests, and may use the same test code. The purpose is different, so we give this kind of testing a different name. Acceptance tests provide accountability and serve a management function. These are tests that determine if a feature has been implemented as expected. It is common to run acceptance tests when an outside contractor delivers code, so we can determine if the team has delivered what we requested. We can also use acceptance tests to determine if our internal team has implemented the stated requirements. Proponents of behavior-driven development claim that the process of creating acceptance tests clarifies the product requirements. Obviously, if we want adequate acceptance tests, we need to plan carefully when specifying the product requirements. If we’ve planned well, we can turn our user stories into automated tests that serve as acceptance tests.</p>
<h2 id="245-units-and-integration"><a href="#cid263">24.5 Units and Integration</a></h2>
<p>We also describe tests by their relationship to the rest of the code.</p>
<p><em>Unit tests</em> probe the internal workings of the machine. If we’ve written our code well, a small section of the code, such as a class or a method, will be a discrete unit that can be tested independently of all other units. Unit tests inspect the integrity of small parts of the application in isolation. When a unit test fails, we can quickly identify and fix broken code.</p>
<p>We use <em>integration tests</em> to make sure the entire application works as expected. Integration tests mimic the behavior of real users. For a web application, an integration test may simulate a user signing in, filling out forms, clicking between pages, and verifying that contents of pages match expected results. Integration tests can also be called <em>feature tests</em> if they are designed to confirm that product features work as expected. Our feature tests can serve as acceptance tests if we use the test suite to determine if we’ve correctly implemented our user stories or other product specifications. Sometimes these tests are called <em>black box tests</em> because the code is tested as if the application was a black box, with the internal workings of the application hidden from the observer. They are also called <em>system tests</em> or <em>end-to-end tests</em>.</p>
<h2 id="246-sample-data"><a href="#cid264">24.6 Sample Data</a></h2>
<p>When we write tests, either feature tests or unit tests, we often want to check whether a method returns the data we expect. That means we have to create the data we need in advance of the test. Either we populate a database with the data we expect, or we disconnect the database and instantiate an object that provides the data we expect. Test frameworks give us a tool named a <em>factory</em> or a <em>fixture</em> to create sample data. Developers argue about what is better, factories or fixtures, but you’ll encounter factories more often, particularly the popular <a href="https://github.com/thoughtbot/factory_girl">FactoryGirl</a> gem. A factory is an object that creates other objects. When you use FactoryGirl, you have the option of saving your object to the database (which is slow) or building your object in memory only (which is faster). Fixtures are used to populate a database with sample data before your tests run. If you use fixtures, you’ll save sample data in a configuration file. Before tests run, Rails automatically loads all fixtures from configuration files in the <strong>test/fixtures</strong> folder. As you gain experience with testing, you’ll become familiar with both factories and fixtures.</p>
<h2 id="247-test-doubles"><a href="#cid265">24.7 Test Doubles</a></h2>
<p>In unit testing, to isolate small parts of the application, sometimes we artificially decouple the code from the rest of the application. For example, with a unit test, we don’t want to connect to an external service with an API to obtain data. Or we simply want a method to get a predictable response from another object.</p>
<p><em>Test doubles</em> stand in for external dependencies. The term is borrowed from Hollywood, where stunt doubles stand in for actors in action scenes. A test double is any kind of pretend object used in place of a real object for testing purposes. There are two types of test doubles, <em>stubs</em> and <em>mocks</em>. Stubs provide canned answers to calls made during the test, only responding when queried by the test. Sometimes stubs record information about the call, for example, the message sent or the number of times called. Mocks are pre-programmed objects that reproduce the behavior of the object they represent, forming a specification of an object’s behavior. It takes time to write stubs and mocks and lots of experience to use them correctly, so as a beginner, you probably won’t write stubs and mocks without help. As you can gain experience, you’ll better understand the difference between stubs and mocks and learn how to use them. For now, it is enough to recognize the terminology and remember that tests run faster and better when we reduce coupling and complexity with test doubles.</p>
<h2 id="248-minitest-and-rspec"><a href="#cid266">24.8 Minitest and RSpec</a></h2>
<p>You’ve already learned that Rails developers mix and match gems to create a favorite technology <em>stack</em>. Not everyone likes ERB for view templates. Some prefer Haml or Slim syntax for mixing HTML and Ruby in a view. Developers often stray from the default Rails stack when it comes to testing. Since the release of Ruby 1.9, <a href="https://github.com/seattlerb/minitest">Minitest</a> has been supplied as a standard gem with all Ruby installations. Yet most Rails developers use <a href="http://rspec.info/">RSpec</a> for testing.</p>
<p>In this tutorial, I’ll use Minitest to introduce you to testing. Minitest is easier to set up and offers a syntax that is very similar to RSpec. Some developers say that there is no reason to use RSpec because Minitest provides almost all the convenience of RSpec with smaller size, faster speed, and less complexity. Other developers insist that RSpec is more expressive and flexible. Realistically, if you want a job working on most Rails teams, you’ll need to learn RSpec. Get started with Minitest to learn the basics of testing. When you’re ready for the next step, the <a href="https://tutorials.railsapps.org/">Capstone Rails Tutorials</a> will take you deeper. I also recommend the books <a href="https://pragprog.com/book/nrtest2/rails-4-test-prescriptions">Rails 4 Test Prescriptions</a> by Noel Rappin and <a href="https://leanpub.com/everydayrailsrspec">Everyday Rails Testing with RSpec</a> by Aaron Sumner.</p>
<h2 id="249-capybara-the-ghost-in-the-machine"><a href="#cid267">24.9 Capybara, the Ghost in the Machine</a></h2>
<p>Unit tests are simple, in principle and often in practice. The tests are just Ruby code, supplemented with methods from the test framework API. If we want unit tests for all the methods of a User class, we instantiate the class and write code that calls each method and verifies if the response matches our expectations. Using methods from the Minitest or RSpec test framework, we output a message that indicates whether each unit test passes or fails.</p>
<p>Integration tests, or feature tests, require more of a framework than unit tests. We want our tests to be as realistic as possible, as if a robot was using a web browser and interacting with our web application. Fortunately, the maintainers of the <a href="https://jnicklas.github.io/capybara/">Capybara</a> gem have created such a robot. To create integration tests, we add the Capybara gem, using it with either Minitest or RSpec. Capybara gives us a <code>visit</code> method that simulates a user visiting a page. After we call the <code>visit</code> method, Capybara gives us a <code>page</code> object and allows us to test whether the page contains the content we expect. Every Rails application relies on a layer of <em>middleware</em> named <a href="https://rack.github.io/">Rack</a> that ties into a web server. Capybara interacts with the web application, via calls to Rack, as if it was a browser making requests and receiving HTML files as a response.</p>
<p>When we use Capybara, by default it operates in <em>headless mode</em>, interacting directly with the Rails application via Rack. “Headless” means there is no graphical user interface (as if the absent screen was a computer’s head). In headless mode, JavaScript is unavailable. If some of our application features require JavaScript, we must set up Capybara to act as a robot using a real web browser. Capybara has a built-in <em>driver</em> (named <a href="http://docs.seleniumhq.org/projects/webdriver/">Selenium</a>) that gives our robot the option of automatically launching and using a real web browser for each test. By default, Capybara will use the Firefox web browser if it is installed on your computer. What you’ll see is amazing. When you run tests using Capybara with the JavaScript option, the Firefox web browser will pop open on your desktop and you’ll watch a ghost flying through your web application. With Capybara, you now have a ghostly QA department running your integration tests.</p>
<h2 id="2410-four-phases-of-feature-tests"><a href="#cid268">24.10 Four Phases of Feature Tests</a></h2>
<p>Test code is easier to understand when you recognize that tests proceed in stages, or phases. Code that simulates a user visiting a web page tends to be organized in four phases:</p>
<ul>
<li>set up</li>
<li>visit page</li>
<li>verify page contents</li>
<li>neutralize</li>
</ul>
<p>The setup phase may include creating a user, signing in, or any other activity that creates the conditions for a test. With Capybara, the test visits the page, which requires Capybara to simulate a browser request to the Rails application. Then, in the third stage, we check if the server response contains the data we expect. Finally, we may need to clean up, resetting the original state of the application, or removing any data the test added to the database.</p>
<h2 id="2411-four-phases-of-unit-tests"><a href="#cid269">24.11 Four Phases of Unit Tests</a></h2>
<p>Unit tests also are organized in four stages:</p>
<ul>
<li>set up</li>
<li>exercise</li>
<li>verify</li>
<li>teardown</li>
</ul>
<p>When you test a small part of the application in isolation, you’ll focus on an object or method which we call the “system under test.” The setup phase prepares the system under test. Often this means instantiating an object. Here is an example:</p>
<p>user \= User.new(email: '<a href="/cdn-cgi/l/email-protection">[email protected]</a>')</p>
<p>During the exercise phase, something is executed. Often this is a method call:</p>
<p>user.save</p>
<p>During verification, the result of the exercise is verified against the developer’s expectations:</p>
<p>user.email.must_equal '<a href="/cdn-cgi/l/email-protection">[email protected]</a>'</p>
<p>During teardown, the system under test is reset to its initial state. Rails integrates with Minitest or RSpec to reset a database to its initial state. You will seldom write code for the teardown phase.</p>
<p>Now that you’ve learned about the basic concepts of testing, let’s set up Minitest for our first tests.</p>
<h2 id="2412-set-up-minitest"><a href="#cid270">24.12 Set Up Minitest</a></h2>
<p>We’ll set up testing with both Minitest and Capybara, so we can write both unit tests and feature tests. Minitest is a standard Ruby gem, installed when you install Ruby in your environment. We’ll install the <a href="https://github.com/metaskills/minitest-spec-rails">minitest-spec-rails</a> gem which makes it easy to use an RSpec-like syntax with Minitest. We’ll also add the <a href="https://github.com/blowmage/minitest-rails-capybara">minitest-rails-capybara</a> gem to integrate Capybara with Minitest and Rails.</p>
<p>Open your <strong>Gemfile</strong> and replace the contents with the following:</p>
<p><strong>Gemfile</strong></p>
<p>source 'https://rubygems.org'
ruby '2.4.1'
gem 'rails', '~&gt; 5.1.2'</p>
<p># Rails defaults
gem 'sqlite3'
gem 'puma', '~&gt; 3.7'
gem 'sass-rails', '~&gt; 5.0'
gem 'uglifier', '&gt;= 1.3.0'
gem 'coffee-rails', '~&gt; 4.2'
gem 'turbolinks', '~&gt; 5'
gem 'jbuilder', '~&gt; 2.5'
group :development, :test do
  gem 'byebug', platforms: [:mri, :mingw, :x64_mingw]
  gem 'capybara', '~&gt; 2.13'
  gem 'selenium-webdriver'
end
group :development do
  gem 'web-console', '&gt;= 3.3.0'
  gem 'listen', '&gt;= 3.0.5', '&lt; 3.2'
  gem 'spring'
  gem 'spring-watcher-listen', '~&gt; 2.0.0'
end</p>
<p># learn-rails
gem 'bootstrap-sass'
gem 'gibbon'
gem 'high_voltage'
gem 'jquery-rails'
group :development do
  gem 'better_errors'
  gem 'rails_layout'
  gem 'sqlite3'
end
group :production do
  gem 'pg'
end
group :test do
  gem 'minitest-spec-rails'
  gem 'minitest-rails-capybara'
end</p>
<p>We’ve added the two gems to the <code>test</code> group. Now, some gems are loaded only when we’re writing code (during development), some are loaded only when the application is running on Heroku (deployed to production), and our newest additions only are loaded when we run tests.</p>
<p>Next, install the additional gems:</p>
<p>$ bundle install</p>
<p>The <code>bundle install</code> command will download and install the gems from the <a href="https://rubygems.org/">rubygems.org</a> server.</p>
<h3 id="24121-run-tests"><a href="#uid459">24.12.1 Run Tests</a></h3>
<p>The command <code>rails test</code> will execute Minitest. Let’s see what happens when we run tests:</p>
<p>$ rails test
Running via Spring preloader in process 29254
/Users/danielkehoe/workspace/learn-rails/db/schema.rb doesn't exist yet.
Run `rails db:migrate` to create it, then try again. If you do not intend
to use a database, you should instead alter /Users/danielkehoe/workspace/
/learn-rails/config/application.rb to limit the frameworks that will be loaded.
Run options: --seed 35136</p>
<h1 id="running">Running:</h1>
<p>Finished in 0.005570s, 0.0000 runs/s, 0.0000 assertions/s.
0 runs, 0 assertions, 0 failures, 0 errors, 0 skips</p>
<p>Rails Minitest informs us that our application is not set up to use a database. The easiest way to resolve the issue is to run <code>rails db:migrate</code> which sets up the database schema file. We’re not using a database for this application so the database schema file will be empty.</p>
<p>$ rails db:migrate</p>
<p>The <code>rails db:migrate</code> command doesn’t produce any result in the terminal but it will create a new <strong>db/schema.rb</strong> file.</p>
<p>Try running <code>rails test</code> again:</p>
<p>$ rails test
Running via Spring preloader in process 29468
Run options: --seed 46952</p>
<h1 id="running_1">Running:</h1>
<p>Finished in 0.005945s, 0.0000 runs/s, 0.0000 assertions/s.
0 runs, 0 assertions, 0 failures, 0 errors, 0 skips</p>
<p>The output shows that Minitest executes but we have no tests for it to run.</p>
<p>Let’s commit our changes to the Git repository and push to GitHub:</p>
<p>$ git add -A
$ git commit -m "set up minitest"
$ git push</p>
<h2 id="2413-unit-test-standard-syntax"><a href="#cid271">24.13 Unit Test (Standard Syntax)</a></h2>
<p>In its default form, Minitest uses the syntax of the older <a href="https://test-unit.github.io/">test_unit framework</a> that was supplied with Ruby before version 1.9. The test_unit syntax uses explicit Ruby to set up tests. Here’s an example of Minitest using the test_unit syntax:</p>
<p>require 'test_helper'</p>
<p>class VisitorTest &lt; ActiveSupport::TestCase</p>
<p>def valid_params
    { email: '<a href="/cdn-cgi/l/email-protection">[email protected]</a>' }
  end</p>
<p>def test_valid
    visitor \= Visitor.new valid_params
    assert visitor.valid?, "Can't create with valid params: #{visitor.errors.messages}"
  end</p>
<p>def test_invalid_without_email
    params \= valid_params.clone
    params.delete :email
    visitor \= Visitor.new params
    refute visitor.valid?, "Can't be valid without email"
    assert visitor.errors[:email], "Missing error when without email"
  end</p>
<p>end</p>
<p>Notice that we must declare a class <code>VisitorTest</code> that inherits from <code>ActiveSupport::TestCase</code>. Then we must define a new method for each test case using the <code>def</code> keyword. This syntax is not popular with Rails developers. RSpec offers its own DSL (domain specific language) that hides the overhead of setting up classes and methods behind convenience methods. Minitest offers its own version of the the RSpec DSL, allowing us to use the more popular syntax. I’ll use the new RSpec-like syntax in this tutorial, since you are likely to encounter RSpec more frequently.</p>
<h2 id="2414-unit-test-spec-syntax"><a href="#cid272">24.14 Unit Test (Spec Syntax)</a></h2>
<p>For our first test, let’s create a simple unit test for our Visitor model. Every time we run our tests, we want to know that we’re able to create a Visitor model. We’ll also check that the Visitor model contains a method that returns an email address.</p>
<p>The default Rails directory structure already contains a <strong>test/models/</strong> folder. Thanks to Rails conventions, we know exactly where to create our test file.</p>
<p>Create a file <strong>test/models/visitor_test.rb</strong>:</p>
<p>require 'test_helper'</p>
<p>describe Visitor do</p>
<p>let(:visitor_params) { {email: '<a href="/cdn-cgi/l/email-protection">[email protected]</a>'} }
  let(:visitor) { Visitor.new visitor_params }</p>
<p>it 'is valid when created with valid parameters' do
    visitor.must_be :valid?
  end</p>
<p>it 'is invalid without an email' do
    # Delete email before visitor let is called
    visitor_params.delete :email
    visitor.wont_be :valid? # Must not be valid without email
    visitor.errors[:email].must_be :present? # Must have error for missing email
  end</p>
<p>end</p>
<p>The test above, written in the RSpec-like syntax, is functionally identical to the previous example, written in the old test_unit syntax. Take a close look at both, so the structure and keywords will be familiar when you see it again.</p>
<p>We need <code>require ’test_helper’</code> to enable the test framework and apply any configuration settings.</p>
<p>The keywords <code>describe</code>, <code>let</code>, and <code>it</code> are keywords that are also used in the RSpec DSL (domain-specific language). When you see these keywords, you know you are looking at test code, either Minitest or RSpec.</p>
<p>The purpose of a unit test is to describe the system under test, in terms of its expected behavior. We create a <code>do ... end</code> block using the <code>describe</code> keyword and specifying a class we wish to test:</p>
<p>describe Visitor do
  .
  .
  .
end</p>
<h3 id="24141-create-a-test-class-with-describe"><a href="#uid460">24.14.1 Create a Test Class With Describe</a></h3>
<p>The <code>describe</code> keyword creates a test class. In this case, the <code>describe</code> keyword will create a class named <code>VisitorTest</code> that inherits from <code>ActiveSupport::TestCase</code>. Using the old test_unit syntax, we could do this with <code>class VisitorTest &lt; ActiveSupport::TestCase</code> but the <code>describe</code> keyword is more convenient. When Minitest runs, it recognizes and executes test classes. By including our code inside a test class, we get to use methods such as <code>let</code> and <code>it</code> which are useful for writing tests. Minitest will recognize various classes like models or controllers and provide appropriate behavior.</p>
<h3 id="24142-setup-phase"><a href="#uid461">24.14.2 Setup Phase</a></h3>
<p>We must set up everything we need for the test. Minitest provides a simple way to set up everything before a test using the <code>before</code> keyword:</p>
<p>before do
  do_some_setup
end</p>
<p>We could initialize the Visitor model using a <code>before</code> block and setting instance variables:</p>
<p>before do
  @visitor_params \= {email: '<a href="/cdn-cgi/l/email-protection">[email protected]</a>'}
  @visitor \= Visitor.new(visitor_params)
end</p>
<p>Instead of using a <code>before</code> block, we’ll use the convenient <code>let</code> keyword:</p>
<p>let(:visitor_params) { {email: '<a href="/cdn-cgi/l/email-protection">[email protected]</a>'} }
let(:visitor) { Visitor.new visitor_params }</p>
<p>The <code>let</code> keyword is a specialized version of the <code>before</code> keyword. It caches the objects that you create so they are ready for every test you write in the test class. And it is <em>lazy-loaded</em>, which means it does not require any processing overhead until the first time it is used.</p>
<h3 id="24143-do-it"><a href="#uid462">24.14.3 Do It</a></h3>
<p>Each test is defined by the <code>it</code> keyword and a <code>do ... end</code> block that contains the exercise and verify phases of the test. The <code>it</code> keyword must be accompanied by a description. The description will be displayed if the test fails.</p>
<p>For our first test, we want to check if the Visitor model can be created when we provide a valid email address. Before the test runs, the <code>let</code> statement makes sure the Visitor object is instantiated with an email value.</p>
<p>The verification phase of each test consists of a comparison between the results of an operation and our expectations. We expect that each time we create a Visitor object with a valid email address, the <code>visitor.valid?</code> method will return true. We can create a test:</p>
<p>it 'is valid when created with valid parameters' do
  assert_equal visitor.valid?, true
end</p>
<p>The keyword <code>assert_equal</code> is the old test_unit syntax. It compares the result of <code>visitor.valid?</code> with <code>true</code> and tells Minitest the test has passed or failed.</p>
<p>We can write the same thing using the new RSpec-style syntax:</p>
<p>it 'is valid when created with valid parameters' do
  visitor.must_be :valid?
end</p>
<p>The method <code>must_be</code> is an <em>expectation</em>. You can see a <a href="http://cheat.errtheblog.com/s/minitest">Minitest cheat sheet</a> with a list of all the expectation methods. As you might guess, <code>must_be</code> functions as a comparison operator, checking if a call to <code>visitor.valid?</code> returns true.</p>
<p>For our second test, we want to make sure the Visitor object is invalid when no email address is provided:</p>
<p>it 'is invalid without an email' do
  # Delete email before visitor let is called
  visitor_params.delete :email
  visitor.wont_be :valid? # Must not be valid without email
  visitor.errors[:email].must_be :present? # Must have error for missing email
end</p>
<p>We created the <code>visitor_params</code> hash with a <code>let</code> statement. Before we invoke the Visitor object and call the <code>visitor.valid?</code> method, we delete the email address from the <code>visitor_params</code> hash. When the Visitor object is invoked, it will be created by the <code>let</code> statement without an email address. The <code>wont_be</code> expectation confirms that the result of <code>visitor.valid?</code> method is <code>false</code>. Then we check if a validation error message is present.</p>
<p>At this point, don’t expect to be ready to write unit tests for every model method. You’ll need to spend time with the <a href="http://docs.seattlerb.org/minitest/Minitest/Expectations.html">documentation for Minitest expectations</a> or the <a href="http://cheat.errtheblog.com/s/minitest">Minitest cheat sheet</a> to become familiar with all the possible ways to write tests. This introduction should help you recognize the syntax of tests, understand the structure, and give you the background you need to learn more about unit testing.</p>
<h2 id="2415-run-tests"><a href="#cid273">24.15 Run Tests</a></h2>
<p>Let’s run our unit tests:</p>
<p>$ rails test
Running via Spring preloader in process 29585
Run options: --seed 7800</p>
<h1 id="running_2">Running:</h1>
<p>..</p>
<p>Finished in 0.020289s, 98.5770 runs/s, 147.8655 assertions/s.</p>
<p>2 runs, 3 assertions, 0 failures, 0 errors, 0 skips</p>
<p>The output shows that our tests pass.</p>
<h3 id="24151-breaking-the-test"><a href="#uid463">24.15.1 Breaking the Test</a></h3>
<p>Let’s see what happens if we purposefully break our Visitor model. Modify the file <strong>app/models/visitor.rb</strong>:</p>
<p>class Visitor
  include ActiveModel::Model
  attr_accessor :email
  # validates_presence_of :email
  # validates_format_of :email, with: /\A[-a-z0-9_+\.]+\@([-a-z0-9]+\.)+[a-z0-9]{2,4}\z/i</p>
<p>def subscribe
    mailchimp \= Gibbon::Request.new(api_key: Rails.application.secrets.mailchimp_api_key)
    list_id \= Rails.application.secrets.mailchimp_list_id
    result \= mailchimp.lists(list_id).members.create(
      body: {
        email_address: self.email,
        status: 'subscribed'
    })
    Rails.logger.info("Subscribed #{self.email} to MailChimp") if result
  end</p>
<p>end</p>
<p>When you copy this, be careful to keep the long regex expression (/\A…\z/i) on one line (no line breaks).</p>
<p>We’ve commented out the statements that require validation for the email attribute. Let’s run the tests again:</p>
<p>$ rails test
Running via Spring preloader in process 29655
Run options: --seed 45089</p>
<h1 id="running_3">Running:</h1>
<p>F</p>
<p>Failure:
Visitor#test_0002_is invalid without an email
[/Users/danielkehoe/workspace//learn-rails/test/models/visitor_test.rb:15]:
Expected #<Visitor:0x007fa5440a2260 @validation\_context=nil,
@errors=#\<ActiveModel::Errors:0x007fa5440a1f40 @base=#\<Visitor:0x007fa5440a2260 ...>,
@messages={}, @details={}>> to not be valid?.</p>
<p>bin/rails test test/models/visitor_test.rb:12</p>
<p>.</p>
<p>Finished in 0.008457s, 236.4993 runs/s, 236.4993 assertions/s.</p>
<p>2 runs, 2 assertions, 1 failures, 0 errors, 0 skips</p>
<p>The output shows a failure. The diagnostic message displays the description of the failing test, “Visitor#test_0002_is invalid without an email”, and indicates the line number where the test failed. Now you know what a failing test looks like.</p>
<p>Before you continue, restore the file <strong>app/models/visitor.rb</strong> to its original state, and make sure the tests pass.</p>
<p>If you wish, you can continue writing unit tests. You could create a similar unit test for the Contact model. With more experience, or some independent research, you could create a test for the <code>subscribe</code> method in the Visitor model. This method connects to an external API, so it requires test doubles to fake the response of the external services. Our goal here is to introduce you to the concepts of testing, so we’ll put aside advanced work on unit tests, and take a look at feature tests.</p>
<h2 id="2416-feature-test"><a href="#cid274">24.16 Feature Test</a></h2>
<p>Let’s start with a user story for our home page. It might seem trivial to call the home page a “feature” and describe it with a user story, but it illustrates a process that works just as well with more complex features. Here’s our user story:</p>
<p>*Feature: Home page*
 As a visitor
 I want to visit a home page
 And see a welcome message</p>
<p>For our test, we know we want to visit the home page and check if the words “Stay in touch” appear on the page. This is the scenario we’ll test:</p>
<p>*Scenario: Visit the home page*
 Given I am a visitor
 When I visit the home page
 Then I see "Stay in touch"</p>
<p>If you think of your application as a collection of features, and you describe each feature in terms of “As a (role), I want (goal), In order to (benefit),” and then imagine scenarios for each feature using the “Given…, When…, Then…” formula, you’ll be able to write automated tests to cover every feature in the application. Let’s try it for the home page.</p>
<p>Examine the folders within the <strong>test/</strong> directory. Remember that feature tests are also called integration tests. You’ll see a folder <strong>test/integration/</strong>. That’s where we’ll add our feature tests.</p>
<p>Create a file <strong>test/integration/home_page_test.rb</strong>:</p>
<p>require 'test_helper'</p>
<p># Feature: Home page
#   As a visitor
#   I want to visit a home page
#   So I can learn more about the website
feature 'Home page' do</p>
<p># Scenario: Visit the home page
  #   Given I am a visitor
  #   When I visit the home page
  #   Then I see "Welcome"
  scenario 'visit the home page' do
    visit root_path
    page.must_have_content 'Stay in touch'
  end
end</p>
<p>I’ve included the user story and scenario description in comments. There’s no convention to do so, but it will help you to see the relationship between testing and the product planning process. It should be easy to transform a “Given… When… Then…” scenario into the code needed for a feature test.</p>
<h3 id="24161-feature"><a href="#uid464">24.16.1 Feature</a></h3>
<p>When we created a unit test, we used the <code>describe</code> keyword to create a test class. The <code>feature</code> keyword creates a test class that inherits from the <code>Capybara::Rails::TestCase</code> class, giving us methods such as <code>visit</code> and <code>page</code>.</p>
<p>Feature tests are created with a <code>do ... end</code> block using the <code>feature</code> keyword and providing a description of the feature:</p>
<p>feature 'Home page' do
  .
  .
  .
end</p>
<p>Notice that the description is placed in quotes. In this case, Minitest will automatically generate a class named <code>HomePageTest</code>.</p>
<h3 id="24162-scenario"><a href="#uid465">24.16.2 Scenario</a></h3>
<p>Typically we test a single feature with multiple scenarios in a single test file.</p>
<p>The <code>scenario</code> keyword is similar to the <code>it</code> keyword you’ve seen in unit tests. Each feature test is defined by the <code>scenario</code> keyword and a <code>do ... end</code> block that contains the visit and verify phases of the test. The <code>scenario</code> keyword must be accompanied by a description. The description will be displayed if the test fails.</p>
<p>scenario 'visit the home page' do
  visit root_path
  page.must_have_content 'Stay in touch'
end</p>
<p>The directive <code>visit</code> is a Capybara method that takes a URL or Rails route as an argument. You could specify either <code>visit ’/’</code> or <code>visit root_path</code> to direct Capybara to retrieve the home page.</p>
<p>Capybara provides other <em>actions</em> in addition to <code>visit</code>. You can see the <a href="http://rubydoc.info/github/jnicklas/capybara/master/Capybara/Node/Actions">documentation for Capybara actions</a> that include actions for filling in a form and clicking a button.</p>
<p>Capybara creates a <code>page</code> object for us as a response to the visit. The <code>page</code> object is a representation of the HTML file returned by the application. We can call the <code>must_have_content</code> method, testing if the string “Stay in touch” is present in the page.</p>
<p>Capybara gives us a collection of methods we can use to verify our expectations. The <a href="http://blowmage.com/minitest-rails-capybara/Capybara/Expectations.html">documentation for Capybara expectations</a> provides an extensive collection of methods we can use to verify what’s on a web page. For example, <code>must_have_link</code> checks for a link. With Capybara expectations, you can check almost anything on a page. Combining Capybara actions and expectations allows you to build a powerful page-checking robot.</p>
<h2 id="2417-run-tests"><a href="#cid275">24.17 Run Tests</a></h2>
<p>Let’s run all our tests:</p>
<p>$ rails test
Running via Spring preloader in process 30144
Run options: --seed 51858</p>
<h1 id="running_4">Running:</h1>
<p>...</p>
<p>Finished in 0.459255s, 6.5323 runs/s, 8.7098 assertions/s.</p>
<p>3 runs, 4 assertions, 0 failures, 0 errors, 0 skips</p>
<p>We have three tests (in two test files) making four assertions, all passing.</p>
<h3 id="24171-troubleshooting"><a href="#uid466">24.17.1 Troubleshooting</a></h3>
<p>You might get an error message:</p>
<p>rails aborted!
NoMethodError: undefined method `feature' for main:Object</p>
<p>You’ll see this error message if you neglected to modify the <strong>test/test_helper.rb</strong> file to allow use of the Capybara test framework methods.</p>
<h3 id="24172-breaking-the-test"><a href="#uid467">24.17.2 Breaking the Test</a></h3>
<p>Let’s see what happens if we purposefully break our home page. Modify the file <strong>app/view/visitors/new.html.erb</strong>:</p>
<p>&lt;% content_for :title do %&gt;Foobar Kadigan&lt;% end %&gt;
&lt;% content_for :description do %&gt;Website of Foobar Kadigan&lt;% end %&gt;
&lt;section>
  &lt;img src\="http://lorempixel.com/1170/600/cats/1">
</section></p>
<section>
 <div class="column">
 <h3>GO AWAY!</h3\>
  </div>
 <div class="column">
 <div class="form-centered">
 <%= form\_with(model: @visitor) do |f| %>
 <%= f.email\_field :email, placeholder: 'Your email address...', autofocus: true %>
 <br/\>
        <br/>
        <%= f.submit 'Sign up for the newsletter', class: 'submit' %>
 <% end %>
    </div>
 </div\>
</section>

<p>We’ve changed the welcome message from “Stay in touch” to “GO AWAY!”.</p>
<p>Let’s run the tests again:</p>
<p>$ rails test
Running via Spring preloader in process 30059
Run options: --seed 39958</p>
<h1 id="running_5">Running:</h1>
<p>F</p>
<p>Failure:
Home page Feature Test#test_0001_visit the home page
[/Users/danielkehoe/workspace//learn-rails/test/integration/home_page_test.rb:15]:
Expected to find text "Stay in touch" in "Toggle navigation Home About Contact GO AWAY!".</p>
<p>bin/rails test test/integration/home_page_test.rb:13</p>
<p>..</p>
<p>Finished in 5.124522s, 0.5854 runs/s, 0.7806 assertions/s.</p>
<p>3 runs, 4 assertions, 1 failures, 0 errors, 0 skips</p>
<p>The output shows a failure. The diagnostic message displays the description of the failing test, “Home page Feature Test#test_0001_visit the home page”, showing a failure, “Expected to include ‘Stay in touch’.”</p>
<p>Before you continue, restore the file <strong>app/view/visitors/new.html.erb</strong> to its original state, and make sure the tests pass.</p>
<p>Now that we have written a few basic tests, let’s commit our changes to the Git repository and push to GitHub:</p>
<p>$ git add -A
$ git commit -m "add tests"
$ git push</p>
<p>You’ve written a complete application with tests. Very good!</p>
<h3 id="24173-using-capybara"><a href="#uid468">24.17.3 Using Capybara</a></h3>
<p>There is an art to developing feature tests. You can test that all the text on the home page is exactly what you want. That would make your test files large. And your tests would be “brittle,” because any changes you made in development, even the slightest changes to the words on the page, would break your tests. For good integration tests, focus on the features that are essential to your application. For example, use the Capybara robot to make sure the user can follow a critical path through your application, visiting important pages, filling in forms, clicking buttons, and seeing results. Capybara lets you select any HTML element on a page, so you can check an ID or class attribute of an HTML tag, not just text on a page. You’ll want to be confident that application navigation and page flow continues to work after any code changes. That will serve you better than tests that tell you a word changed here or there.</p>
<h2 id="2418-other-tests"><a href="#cid276">24.18 Other Tests</a></h2>
<p>The art of testing lies in making good choices about what to test. It’s common to write feature tests because they will test the entire application from the viewpoint of the user. It is also common to write unit tests for models because models contain much of the uniqueness of an application.</p>
<p>Every other aspect of a Rails application can be tested, including controllers, helpers, and views. Developers seldom write tests for every aspect of a Rails application. If your controllers contain only the standard RESTful actions, with no extra logic, you probably don’t need to write unit tests for your controllers. If you only have simple HTML markup in helpers, helpers don’t need to be tested. And views are rarely tested with unit tests (use feature tests if you want to make sure a page contains what you expect). As a beginner, you’ll make a good start if you concentrate on unit tests for models and integration tests for your page flow.</p>
<h2 id="2419-behavior-driven-development"><a href="#cid277">24.19 Behavior-Driven Development</a></h2>
<p>In Book One, you learned about the software development approach called Behavior-Driven Development (BDD), or sometimes, Behavior-Driven Design. In writing the feature tests for the home page, you saw it in action. With BDD, you turn user stories into detailed scenarios that are accompanied by tests. BDD is a powerful approach for managing software development. It helps you define your product requirements, refine your project scope, and divide your project into well-defined tasks. The BDD process is complete when each feature has automated tests, when you enter <code>rails test</code> on the command line and see that every feature is implemented and functioning as expected.</p>
<p>You may feel lost or overwhelmed when you attempt to build a Rails application for the first time, especially if your only experience is following the step-by-step instructions of a tutorial. When you experience that panic, BDD is your lifeline. Start by writing user stories for a few simple features. Write feature tests and implement the code required to make the tests pass. As you focus on the process of writing scenarios and tests, and implementing the code for each feature, you’ll begin to gain momentum, and before you know it, you’ll be over the first hurdle.</p>
<h2 id="2420-test-driven-development"><a href="#cid278">24.20 Test-Driven Development</a></h2>
<p>You can see how the BDD approach refines the product requirements and user experience. At a microscopic level, a similar discipline, named <em>test-driven development</em>, helps refine the implementation. Where BDD is driven by feature tests, TDD is focused on unit tests.</p>
<p>TDD is an approach to software development that emphasizes that all code should be written to be tested. Excellent test coverage, allowing easy refactoring, is not the only goal of TDD. Just as important, the developer focuses on what needs to be accomplished and thinks through alternatives and edge cases. Some TDD aficionados say testing is a tool to write better code, and regression tests are a side effect. Unit tests are at the heart of TDD, and easiest to write when code is carefully decoupled into systems that can be tested in isolation. An application that is composed of decoupled units with clearly defined interfaces is a well-designed application that is easy to extend and maintain. If you make it a practice to write unit tests in conjunction with all the code you write, you’ll write better code, and you’ll be practicing TDD.</p>
<h2 id="2421-test-first-development"><a href="#cid279">24.21 Test-First Development</a></h2>
<p>Often when you are practicing TDD, you’ll write tests before you write implementation code. Earlier in this chapter, I referred to <em>test-first development</em> and explained that it serves a different purpose than testing for quality assurance. In some situations, test-first development is simply exploratory testing, a means of describing the behavior of the code that must be built. Test-first development is particularly useful when you’ve solved a similar problem and know exactly what results to expect, making it easy to write tests before writing the implementation.</p>
<p>Test-first development leads to a “red-green-refactor” workflow. A developer imagines the results of an operation, writes a test that checks for the results, and runs tests which fail (with the right configuration, failing tests display as red in the console). Then the developer writes code that produces the correct results and runs the tests again, improving the code until the tests pass (displaying in green). At this point, the developer has an adequate regression test and can begin to refactor to improve the implementation, checking that the tests continue to pass. Developers like the rhythm and coherency of the “red-green-refactor” workflow. Writing tests creates discrete, manageable tasks. When tests pass, turning green, there is a feeling of satisfaction, of a job well-done. By postponing concerns about improving the code to a refactoring phase, it’s easier to get the job done without trying to get it perfect. And perfection can be pursued in the refactoring phase without worrying about regressing to a broken state.</p>
<p>David Heinemeier Hansson, the creator of Rails, famously declared that <a href="http://david.heinemeierhansson.com/2014/tdd-is-dead-long-live-testing.html">TDD is dead. Long live testing.</a>. He pointed out that sometimes ardent advocates of TDD will try out an implementation before writing tests, to determine what needs to be done, or to clarify a problem. In the real world, even though developers recommend writing tests first, there are often times when a developer will write tests only after writing code and settling on an approach. TDD, which emphasizes the benefit of writing tests as a first step, doesn’t really require that you write tests before you write code, or even that you write tests for all code. The test-first emphasis of TDD is a recommendation, not a rule. You’ll be a better developer if you find opportunities to get “in the zone” with the red-green-refactor workflow of test-first development, but testing is worthwhile whether it comes first or last.</p>
<h2 id="2422-words-of-encouragement"><a href="#cid280">24.22 Words of Encouragement</a></h2>
<p>Testing often intimidates the newcomer. It is difficult to find good examples. The syntax of Minitest and RSpec has evolved over time, so there is little consistency among examples you’ll find. Older examples are not a good guide to current practices. But once you gain familiarity with the concepts in this chapter, you can start writing tests.</p>
<p>Testing is one of the few things in Rails that you can jump into without getting just right. You can’t screw up your code base by writing incorrect tests. Experienced developers seem to worry that inexperienced developers will write slow tests, but in truth, a slow test is better than no test. Tests won’t affect the performance of your application in production.</p>
<p>If your code is clumsy, don’t worry, you’ll get better with practice. What’s most important is that you’ve begun writing tests. That’s an indication you are committed to Rails best practices.</p>
<p>Your tests are only “bad” if they don’t cover your code adequately or if they give you a false sense of assurance. You will only discover this over time, as you find bugs you didn’t anticipate (which is inevitable). It’s better to just begin testing, even if you’re not sure you’re doing it right, than to not test at all.</p>
<h1 id="chapter-25-rails-composer"><a href="#cid281">Chapter 25 Rails Composer</a></h1>
<p>I’m going to show you how to skip all the work you already did, and build a ready-to-use Rails application in less than five minutes. When you’re done with this chapter, you may wonder why you read the rest of the book.</p>
<p>Watch the video for a demonstration of Rails Composer:</p>
<ul>
<li><a href="https://tutorials.railsapps.org/videos/10">Rails Composer</a></li>
</ul>
<h2 id="251-building-starter-applications"><a href="#cid282">25.1 Building Starter Applications</a></h2>
<p>This chapter is about <a href="http://www.railscomposer.com/">Rails Composer</a>, a tool for building starter applications. Rails Composer makes building applications so easy, it feels like a guilty pleasure.</p>
<p>In the introductory “Create the Application” chapter, you learned that developers often use a starter application instead of assembling an application from scratch. You’ve seen how the <code>rails new</code> command gives you a rudimentary starter application. Developers typically add a front-end framework, a testing framework, and a handful of favorite gems before they get started on any custom development. Since most applications start with the same basic components, it makes sense to rely on an open source effort to stitch them together, so any integration issues or update problems are quickly resolved by the community. That’s the idea behind the <a href="https://railsapps.github.io/">RailsApps project</a>. The project provides a collection of starter applications, plus Rails Composer, a tool that creates the starter applications.</p>
<p>I’ve been leading the RailsApps project for several years because I think the project saves time for developers and makes things easier. I may be biased, so take a look and judge for yourself.</p>
<h2 id="252-build-learn-rails-in-less-than-five-minutes"><a href="#cid283">25.2 Build ‘Learn Rails’ in Less Than Five Minutes</a></h2>
<p>In less than five minutes, we can build our tutorial application using Rails Composer. It will be identical to the application you’ve built, but we’ll call it “foobar-kadigan.” It’s a new application, so if you’re still in the <strong>workspace/learn-rails/</strong> project directory, move up a level to the <strong>workspace/</strong> project directory:</p>
<p>$ cd ../
$ pwd
/Users/danielkehoe/workspace</p>
<p>Or jump to it directly, if it’s one level below your home directory:</p>
<p>$ cd ~/workspace
$ pwd
/Users/danielkehoe/workspace</p>
<p>Use the “learn-rails” gemset we created earlier:</p>
<p>$ rvm use <a href="/cdn-cgi/l/email-protection">[email protected]</a></p>
<p>Now create the “foobar-kadigan” application:</p>
<p>$ rails new foobar-kadigan -m https://raw.github.com/RailsApps/rails-composer/master/composer.rb</p>
<p>We’re using the <code>rails new</code> command and designating “foobar-kadigan” as the name for the application. The <code>-m</code> flag applies an <em>application template</em>, which is a script that generates an application. The application template can be on your local computer, or retrieved from a remote server. Rails Composer is an application template that is stored on GitHub. When you run the <code>rails new</code> command as shown above, a new Rails application is built and then modified by the Rails Composer script.</p>
<p>Here’s the first prompt you’ll see:</p>
<p>option  Build a starter application?
 1)  Build a RailsApps example application
 2)  Contributed applications
 3)  Custom application
choose  Enter your selection:</p>
<p>Options #2 and #3 are not for beginners. We’ll skip any contributed applications. And the “Custom application” option is strictly for experts. Enter <code>1</code> to select “Build a RailsApps example application.” You’ll see a list of available starter applications:</p>
<p>option  Choose a starter application.
 1)  learn-rails
 2)  rails-bootstrap
 3)  rails-foundation
 4)  rails-mailinglist-activejob
 5)  rails-omniauth
 6)  rails-devise
 7)  rails-devise-roles
 8)  rails-devise-pundit
 9)  rails-signup-download
 10)  rails-stripe-checkout
 11)  rails-stripe-coupons
choose  Enter your selection:</p>
<p>We’ll explore the list later. For now, enter <code>1</code> to select “learn-rails”.</p>
<p>Here’s your chance to get news and announcements about Rails Composer:</p>
<p>Get on the mailing list for Rails Composer news?
option  Enter your email address:</p>
<p>Enter your email address (if you want news) or press “return” to skip it (if you’re shy).</p>
<p>In less than the time it took me to write a few sentences, you’ll have a new Rails application. Look for it in your folder:</p>
<p>$ ls -1
foobar-kadigan
learn-rails</p>
<p>You’ve just created a new application named “foobar-kadigan” that is almost identical to the “learn-rails” application you created from scratch. If you have a file compare tool on your computer, you can compare the folders and see that the only differences are the application name embedded in the application, plus a few configuration settings such as the secret keys in the <strong>config/secrets.yml</strong> file.</p>
<p>Move into the project directory:</p>
<p>$ cd foobar-kadigan</p>
<p>As soon as you move into the <strong>foobar-kadigan/</strong> folder, RVM will automatically begin using the gemset named “foobar-kadigan.” That’s because Rails Composer created hidden <strong>.ruby-gemset</strong> and <strong>.ruby-version</strong> files.</p>
<p>Run <code>bundle install</code> to install the necessary gems in the RVM gemset:</p>
<p>$ bundle install</p>
<p>Try running the application.</p>
<p>$ cd foobar-kadigan
$ rails server
\=&gt; Booting Puma
.
.
.</p>
<p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>. Try it out. You’ll see our new home page with the placeholder photo and the “sign up” form.</p>
<p>The application will be almost identical to the one you already built. Compare the project files side-by-side in your editor. The files will be nearly identical. In fact, if you made mistakes when you built the tutorial application, Rails Composer will give you the newest and most correct version of the application so you can check for your mistakes with a file compare tool.</p>
<p>You are probably already aware that a perfect version of the tutorial application is already on GitHub, in the <a href="https://github.com/RailsApps/learn-rails">learn-rails GitHub repository</a>. You could use <code>git clone</code> to get a copy to use as a starter application. The version generated by Rails Composer differs in one important respect. Rails Composer generates the application with any name you give it, so there’s no need to search and change every use of the name in the application.</p>
<p>I hope you’re not irritated that I asked you to spend hours building the “learn-rails” application, and then showed you how to build the same application in less than five minutes. I promise you the time you spent with the book is worthwhile, because you’ve gained a knowledge of Rails you can’t get from using Rails Composer.</p>
<h2 id="253-a-collection-of-starter-applications"><a href="#cid284">25.3 A Collection of Starter Applications</a></h2>
<p>Since you’ve already built the “learn-rails” application, the identical “foobar-kadigan” application may not be interesting. Let’s look at the other applications you can generate with Rails Composer.</p>
<h3 id="2531-rails-bootstrap"><a href="#uid470">25.3.1 Rails Bootstrap</a></h3>
<p>The “rails-bootstrap” application provides an integration of Rails and <a href="https://getbootstrap.com/">Bootstrap</a>, the popular front-end framework. This application gives you everything you built in this book’s chapters on “Layout and Views” and “Front-End Framework,” including flash messages and navigation, set up for Bootstrap. It’s a good beginning point for many custom applications.</p>
<p>You can examine the example application on GitHub, in the <a href="https://github.com/RailsApps/rails-bootstrap">rails-bootstrap</a> repository.</p>
<p>If you have subscribed for the Capstone Rails Tutorials, you can read the <a href="https://tutorials.railsapps.org/tutorials/bootstrap-quickstart">Bootstrap Quickstart Guide</a> to understand the code.</p>
<h3 id="2532-rails-foundation"><a href="#uid471">25.3.2 Rails Foundation</a></h3>
<p>The “rails-foundation” application is just like the “rails-bootstrap” application, only with the <a href="http://foundation.zurb.com/">Zurb Foundation</a> front-end framework instead of Bootstrap. It’s a stripped-down version of the “learn-rails” application you just built, without the contact form or mailing list sign-up, using Foundation. If you want to build a custom application, starting with nothing more than Foundation and an “about” page, generate the “rails-foundation” application.</p>
<p>You can examine the example application on GitHub, in the <a href="https://github.com/RailsApps/rails-foundation">rails-foundation</a> repository.</p>
<p>There’s a <a href="https://tutorials.railsapps.org/tutorials/foundation-quickstart">Foundation Quickstart Guide</a> with the Capstone Rails Tutorials.</p>
<h3 id="2533-rails-mailing-list-with-active-job"><a href="#uid472">25.3.3 Rails Mailing List with Active Job</a></h3>
<p>Rails 4.2 added the <a href="https://github.com/rails/rails/tree/master/activejob">Active Job</a> feature for background processing. The <a href="https://tutorials.railsapps.org/tutorials/rails-mailinglist-activejob">Mailing List with Active Job</a> tutorial explains how to use it. You can use Rails Composer to generate the <a href="https://github.com/RailsApps/rails-mailinglist-activejob">rails-mailinglist-activejob</a> starter application.</p>
<p>In the “Send Mail” chapter I wrote about “Asynchronous Mailing” which provides a queueing system for background jobs. For a production website, it is smart to use Active Job for better website performance for users. The <a href="https://tutorials.railsapps.org/tutorials/rails-mailinglist-activejob">Mailing List with Active Job</a> tutorial in the <a href="https://tutorials.railsapps.org/">Capstone Rails Tutorials</a> series explains the code.</p>
<h3 id="2534-rails-omniauth"><a href="#uid473">25.3.4 Rails OmniAuth</a></h3>
<p><a href="https://github.com/intridea/omniauth/wiki">OmniAuth</a> is a gem for authentication. Most web applications need a way for users to sign in, allowing access to some features of the application only for signed-in users. OmniAuth allows a user to sign in using an account they already have with a service such as Facebook, Twitter, or GitHub. If you’re building an application that needs quick and easy sign-in, this is a useful starter application.</p>
<p>You can examine the example application on GitHub, in the <a href="https://github.com/RailsApps/rails-omniauth">rails-omniauth</a> repository.</p>
<p>You can read the <a href="https://tutorials.railsapps.org/tutorials/rails-omniauth">OmniAuth Tutorial</a> in the <a href="https://tutorials.railsapps.org/">Capstone Rails Tutorials</a> series to learn about authentication with OmniAuth.</p>
<h3 id="2535-rails-devise"><a href="#uid474">25.3.5 Rails Devise</a></h3>
<p><a href="https://github.com/plataformatec/devise">Devise</a> is the most popular gem for authentication. Devise provides user management and authentication, letting a user sign up to create an account and log in with an email address and password. Most websites need email/password authentication, so this is a popular starter application.</p>
<p>You can examine the example application on GitHub, in the <a href="https://github.com/RailsApps/rails-devise">rails-devise</a> repository.</p>
<p>You can read the <a href="https://tutorials.railsapps.org/tutorials/devise-quickstart">Devise Quickstart Guide</a> in the <a href="https://tutorials.railsapps.org/">Capstone Rails Tutorials</a> series to learn about user management and authentication with Devise.</p>
<h3 id="2536-rails-devise-roles"><a href="#uid475">25.3.6 Rails Devise Roles</a></h3>
<p>Devise is a popular gem for <em>authentication</em>, verifying a user’s registered identity. In conjunction with authentication, <em>authorization</em> limits access to pages of a web application. With role-based authorization, a user can be assigned a role such as “user,” “admin,” or “VIP” (a “very important person”). If you want to control access to features of the website by checking a user’s role, this is a useful starter application.</p>
<p>You can examine the example application on GitHub, in the <a href="https://github.com/RailsApps/rails-devise-roles">rails-devise-roles</a> repository.</p>
<p>You can read the <a href="https://tutorials.railsapps.org/tutorials/rails-devise-roles">Rails Authorization Tutorial</a> in the <a href="https://tutorials.railsapps.org/">Capstone Rails Tutorials</a> series to learn about authorization.</p>
<h3 id="2537-rails-devise-pundit"><a href="#uid476">25.3.7 Rails Devise Pundit</a></h3>
<p>To keep controllers skinny, Rails developers often use the <a href="https://github.com/elabs/pundit">Pundit</a> gem for authorization. It improves upon simple role-based authorization to move access control code from controllers to separate “policy objects.” For complex applications with elegant architecture, use the “rails-devise-pundit” starter application.</p>
<p>You can examine the example application on GitHub, in the <a href="https://github.com/RailsApps/rails-devise-pundit">rails-devise-pundit</a> repository.</p>
<p>You can read the <a href="https://tutorials.railsapps.org/tutorials/pundit-quickstart">Pundit Quickstart Guide</a> in the <a href="https://tutorials.railsapps.org/">Capstone Rails Tutorials</a> series to learn about authorization with Pundit.</p>
<h3 id="2538-other-starter-applications"><a href="#uid477">25.3.8 Other Starter Applications</a></h3>
<p>Other applications in the Rails Composer collection include:</p>
<ul>
<li><a href="https://github.com/RailsApps/rails-signup-download">rails-signup-download</a></li>
<li><a href="https://github.com/RailsApps/rails-stripe-checkout">rails-stripe-checkout</a></li>
<li><a href="https://github.com/RailsApps/rails-stripe-coupons">rails-stripe-coupons</a></li>
</ul>
<p>You can use the <a href="https://github.com/RailsApps/rails-signup-download">rails-signup-download</a> application to build a website where a user can download a PDF file after registering with an email address. Using the code in the <a href="https://tutorials.railsapps.org/tutorials/rails-signup-download">Signup and Download Tutorial</a>, you could customize the “learn-rails” application so visitors could download an ebook by Foobar Kadigan after they sign up for his newsletter.</p>
<p><a href="https://stripe.com/">Stripe</a> is a popular service used to accept credit card payments. Stripe offers two approaches to implementing payment processing. Stripe Checkout is Stripe’s entry-level approach. Stripe Checkout competes with the button-based payment options from Google, PayPal, or Amazon, adding a pop-up payment form to any web page. Stripe Checkout is very limited because the pop-up payment form cannot be customized for use with a Rails application. Our <a href="https://tutorials.railsapps.org/rails-stripe-checkout">Stripe Checkout Tutorial</a> in the <a href="https://tutorials.railsapps.org/">Capstone Rails Tutorials</a> series shows how to combine Stripe Checkout with Devise for simple applications.</p>
<p><a href="https://stripe.com/docs/stripe.js">Stripe.js</a> is optimal for use with a Rails application, allowing full customization of a payment form and integration with Rails form processing. The <a href="https://github.com/RailsApps/rails-stripe-coupons">rails-stripe-coupons</a> application implements a payment feature using Stripe JS so a visitor pays to download a PDF file. The application accommodates promotional coupons and adds payment forms to landing pages, for real-world payment processing. Our <a href="https://tutorials.railsapps.org/rails-stripe-coupons">Stripe JS With Coupons</a> tutorial in the <a href="https://tutorials.railsapps.org/">Capstone Rails Tutorials</a> series provides the details.</p>
<h2 id="254-rails-composer-options"><a href="#cid285">25.4 Rails Composer Options</a></h2>
<p>If all Rails Composer did was copy example applications from GitHub repos, it would be convenient but not very interesting. When you built the “foobar-kadigan” application with Rails Composer, it simply built a replica of our tutorial application. When you build the other starter application, the options get more interesting. Rails Composer lets developers customize their starter applications for their favorite stack (we discussed stacks in the “Concepts” chapter in Book One).</p>
<p>Let’s see what options we get when we build the powerful <a href="https://github.com/RailsApps/rails-devise-roles">rails-devise-roles</a> starter application.</p>
<p>Jump to your <strong>workspace/</strong> folder so we can create a new application:</p>
<p>$ cd ~/workspace
$ pwd
/Users/danielkehoe/workspace</p>
<p>It’s okay to start with the “learn-rails” gemset. We have to start with a gemset that already has the Rails gem installed. After that, Rails Composer will create a new gemset for the new project.</p>
<p>$ rvm use <a href="/cdn-cgi/l/email-protection">[email protected]</a></p>
<p>Now generate the “rails-devise-roles” starter application:</p>
<p>$ rails new rails-devise-roles -m https://raw.github.com/RailsApps/rails-composer/master/composer.rb</p>
<p>Don’t worry if some of the prompts are different from the ones I describe here. Rails Composer changes often. At the time I wrote this, I saw:</p>
<p>option  Build a starter application?
 1)  Build a RailsApps example application
 2)  Contributed applications
 3)  Custom application
choose  Enter your selection:</p>
<p>Enter <code>1</code> to select “Build a RailsApps example application.”</p>
<p>option  Choose a starter application.
 1)  learn-rails
 2)  rails-bootstrap
 3)  rails-foundation
 4)  rails-mailinglist-activejob
 5)  rails-omniauth
 6)  rails-devise
 7)  rails-devise-roles
 8)  rails-devise-pundit
 9)  rails-signup-download
 10)  rails-stripe-checkout
 11)  rails-stripe-coupons
choose  Enter your selection:</p>
<p>Select “rails-devise-roles” (it was #7 when I wrote this, but the list may have changed).</p>
<p>Get on the mailing list for Rails Composer news?
option  Enter your email address:</p>
<p>Another chance to get on the mailing list. Just hit “return” if you already signed up.</p>
<p>option  Web server for development?
 1)  Puma (default)
 2)  Thin
 3)  Unicorn
 4)  Phusion Passenger (Apache/Nginx)
 5)  Phusion Passenger (Standalone)
choose  Enter your selection:</p>
<p>Our first option! We’ve always used Puma since it is the Rails default. Choose “Puma” to keep things familiar.</p>
<p>option  Web server for production?
 1)  Same as development
 2)  Thin
 3)  Unicorn
 4)  Puma
 5)  Phusion Passenger (Apache/Nginx)
 6)  Phusion Passenger (Standalone)
choose  Enter your selection:</p>
<p>We could get fancy for deployment. Choose “Same as development” to stay in our comfort zone.</p>
<p>option  Database used in development?
 1)  SQLite
 2)  PostgreSQL
 3)  MySQL
choose  Enter your selection:</p>
<p>We haven’t explored applications that use databases in this book, but Devise and role-based authorization require saving a User model to a database. Choose “SQLite,” which is built-in and ready to run in the Mac or Ubuntu environments. Developers prefer PostgreSQL for production applications, but it takes extra effort to set up, so we’ll stick with SQLite for now.</p>
<p>option  Template engine?
 1)  ERB
 2)  Haml
 3)  Slim
choose  Enter your selection:</p>
<p>In this book, all our view templates were written using the ERB template language. In the “Concepts” chapter in Book One, you learned that components of Rails can be mixed for different stacks. Some developers substitute <a href="http://haml.info/">Haml</a> or <a href="http://slim-lang.com/">Slim</a> for ERB. I’ve written an article on <a href="https://railsapps.github.io/rails-haml.html">Haml and Rails</a> if you’d like to know more. Choose “ERB” for now.</p>
<p>option  Test framework?
 1)  None
 2)  RSpec with Capybara
choose  Enter your selection:</p>
<p>You’ve had an introduction to testing with Minitest in the “Testing” chapter of this book. <a href="http://rspec.info/">RSpec</a> is popular among many developers, so Rails Composer offers an “RSpec with Capybara” option. Rails Composer will install a test suite for the <a href="https://github.com/RailsApps/rails-devise-roles">rails-devise-roles</a> application when RSpec is selected. You can read the <a href="https://tutorials.railsapps.org/tutorials/rspec-quickstart">RSpec Quickstart Guide</a> in the <a href="https://tutorials.railsapps.org/">Capstone Rails Tutorials</a> series to get started with RSpec. Choose “none” for now.</p>
<p>option  Front-end framework?
 1)  None
 2)  Bootstrap 4.0
 3)  Bootstrap 3.3
 4)  Bootstrap 2.3
 5)  Zurb Foundation 5.5
 6)  Zurb Foundation 4.0
 7)  Simple CSS
choose  Enter your selection:</p>
<p>You learned to use Bootstrap 3 in this book. Let’s stick with that. Choose “Bootstrap 3.3.”</p>
<p>option  Add support for sending email?
 1)  None
 2)  Gmail
 3)  SMTP
 4)  SendGrid
 5)  Mandrill
choose  Enter your selection:</p>
<p>Devise will need to send email for its “forgot password” feature. Configuring email took some time for our tutorial application. Rails Composer will instantly set up everything we need to send email using our choice of services. Choose “SendGrid” for now.</p>
<p>option  Devise modules?
 1)  Devise with default modules
 2)  Devise with Confirmable module
 3)  Devise with Confirmable and Invitable modules
choose  Enter your selection:</p>
<p>Choose “Devise with default modules.” Devise has options, like a Confirmable module that requires users to click a link in an email message to confirm a new account. The Invitable module provides a feature that allows administrators or other users to invite users to establish accounts. We won’t need these extra features.</p>
<p>option  Admin interface for database?
 1)  None
 2)  Thoughtbot Administrate
choose  Enter your selection:</p>
<p><a href="https://github.com/thoughtbot/administrate">Thoughtbot Administrate</a> adds an administrative interface to a database application. Choose “None” for now.</p>
<p>option  Use a form builder gem?
 1)  None
 2)  SimpleForm
choose  Enter your selection:</p>
<p>We could add the <a href="https://github.com/plataformatec/simple_form">SimpleForm</a> gem to make it easy to build forms. We didn’t use it in this book, so we’ll choose “none.”</p>
<p>Next you’ll see a menu of page layout options from Rails Composer. These are available if you use Bootstrap 3.</p>
<p>option  Add Bootstrap page templates?
 1)  None
 2)  1 Col Portfolio
 3)  2 Col Portfolio
 4)  3 Col Portfolio
 5)  4 Col Portfolio
 6)  Bare
 7)  Blog Home
 8)  Business Casual
 9)  Business Frontpage
 10)  Clean Blog
 11)  Full Width Pics
 12)  Heroic Features
 13)  Landing Page
 14)  Modern Business
 15)  One Page Wonder
 16)  Portfolio Item
 17)  Round About
 18)  Shop Homepage
 19)  Shop Item
 20)  Simple Sidebar
 21)  Small Business
 22)  Stylish Portfolio
 23)  The Big Picture
 24)  Thumbnail Gallery
choose  Enter your selection:</p>
<p>You’ll get an option to install any of 23 different Bootstrap page templates. Some of these are simple one page layouts. Others are complex, multipage websites. If you’d like to see what all the templates look like, browse the <a href="https://startbootstrap.com/template-categories/all/">Start Bootstrap</a> website to see the gallery of Bootstrap themes &amp; templates.</p>
<p>I like the “Modern Business” template for several ready-made website pages, so choose 14 to install the template.</p>
<p>option  Install page-view analytics?
 1)  None
 2)  Google Analytics
 3)  Segment.com
choose  Enter your selection:</p>
<p>In our “Analytics” chapter, I said every application needs a way to analyze traffic. Let’s choose “Segment.com” since we learned about it already.</p>
<p>option  Segment.com Write Key?</p>
<p>You can enter your Segment.com Write Key here, if you know it. Otherwise, hit return and you’ll get a placeholder you can replace later.</p>
<p>option  Prepare for deployment?
 1)  no
 2)  Heroku
 3)  Capistrano
choose  Enter your selection:</p>
<p>This option sets up your starter application for deployment to Heroku. Choose “no” for now.</p>
<p>Some developers find Rails Turbolinks annoying when they wish to integrate JavaScript with their Rails applications.</p>
<p>option  Disable Rails Turbolinks? (y/n)</p>
<p>We’re not adding any JavaScript so choose “n” to use Rails Turbolinks.</p>
<p>option  Set a robots.txt file to ban spiders? (y/n)</p>
<p>In the “Deploy” chapter you learned that you can leave your website out of Google search results with the <strong>robots.txt</strong> file. Let’s answer “y” or “yes” and play it safe.</p>
<p>option  Create a GitHub repository? (y/n)</p>
<p>Rails Composer will create a GitHub repository for your starter application if your credentials are set up correctly. Let’s play it safe and answer “n” or “no” to skip the repository option.</p>
<p>Rails Composer has all the answers it needs. On my computer, with a fast Internet connection in the heart of San Francisco, Rails composer takes about thirty seconds to build the starter application. It installs every needed gem; sets configuration files; and generates views, models, controllers, and routes. The developers who maintain the Rails Composer project have worked out any tricky integration issues so you can expect the starter application to work without any problems.</p>
<h2 id="255-try-it-out"><a href="#cid286">25.5 Try It Out</a></h2>
<p>You’ve added a new application to your collection of projects:</p>
<p>$ ls -1
foobar-kadigan
learn-rails
rails-devise-roles</p>
<p>Let’s examine the application.</p>
<p>$ cd rails-devise-roles
$ git log --oneline
087167a rails_apps_composer: extras
6d4f710 rails_apps_composer: add Bootstrap page layouts
be68589 rails_apps_composer: navigation links
3126403 rails_apps_composer: set up database
53a029f rails_apps_composer: add README files
7c78031 rails_apps_composer: add analytics
99e9c0c rails_apps_composer: add pages
1886d2c rails_apps_composer: front-end framework
38242d7 rails_apps_composer: add roles to a User model
839749f rails_apps_composer: devise
62753db rails_apps_composer: set email accounts
0754893 rails_apps_composer: generators
09104b9 rails_apps_composer: Gemfile
b61cd18 rails_apps_composer: initial commit</p>
<p>Rails Composer set up a Git repository and committed files as it built the application. We can see a list of Git commits with the <code>git log –oneline</code> command.</p>
<p>When you move into the <strong>rails-devise-roles/</strong> folder, RVM will automatically begin using the gemset named “rails-devise-roles” because of the hidden <strong>.ruby-gemset</strong> and <strong>.ruby-version</strong> files.</p>
<p>Run <code>bundle install</code> to install the necessary gems in the RVM gemset:</p>
<p>$ bundle install</p>
<p>Let’s try running the application:</p>
<p>$ rails server
\=&gt; Booting Puma
.
.
.</p>
<p>Open a web browser window and navigate to <a href="http://localhost:3000">http://localhost:3000/</a>. You’ll see a navigation bar with “Sign in” and “Sign up” links that implement an authentication feature using Devise.</p>
<p>Sign in with the email address “<a href="/cdn-cgi/l/email-protection">[email protected]</a>” and the password “changeme”. You’ll see a link to the Users page in the navigation bar that is only seen by administrators. Click the “Users” link and you’ll see a list of users (just one initially). The first user (created by Rails Composer) is automatically assigned administrator privileges.</p>
<p>Sign out and sign up to create a new account with your own email address and password. You’ll see a message “Welcome! You have signed up successfully.” You will not see the “Users” link. Your new account is an ordinary user without administrator privileges, so you are not allowed to see the list of all users. Notice the navigation link “Edit account.” It displays a page for account management where you can change your name, email address, or password.</p>
<p>Sign out and sign in again with the administrative account “<a href="/cdn-cgi/l/email-protection">[email protected]</a>” and the password “changeme”. Now you can view the list of users. You can change the role of any user.</p>
<p>You’ve got a useful starter application. Without Rails Composer, an experienced developer needs at least an hour or two to set up a similar starter application (and possibly more time if version updates have created integration issues).</p>
<p>Examine the application in your editor. Here’s where a starter application can be useful as a learning tool. Given what you’ve learned so far, what do recognize as familiar? Every Rails application shares a similar structure, so you will recognize files such as the Gemfile; and folders such as <strong>app/models/</strong>, <strong>app/controllers/</strong>, and <strong>app/views/</strong>. Explore the application. Try to guess the purpose of the unfamiliar files and code.</p>
<p>If you’re overwhelmed by unfamiliar files and code, try building one of the simpler starter applications, such as <a href="https://github.com/RailsApps/rails-bootstrap">rails-bootstrap</a> or <a href="https://github.com/RailsApps/rails-devise">rails-devise</a>. Every line of code is explained in the <a href="https://tutorials.railsapps.org/">Capstone Rails Tutorials</a> series so there’s no mystery code.</p>
<p>As a beginner, you can use Rails Composer for two purposes. You can quickly build apps that are guaranteed to work and then pick them apart. A “breakable toy” can be a wonderful instrument for learning. Make an effort to understand everything in the <a href="https://railsapps.github.io/">RailsApps example applications</a> and you’ll gain a solid understanding of the basic components used in real-world Rails projects. Secondly, start building custom applications based on the Rails Composer starter applications. By starting with Rails Composer, you’ll skip the frustrating preliminaries of setting up a front-end framework, authentication, or authorization and jump right into implementing your ideas for new features. Rails Composer is often used at hackathons, where teams race to build interesting applications for a prize, to avoid the time sink of setting up a basic application.</p>
<p>A final word: Use Rails Composer judiciously. It’s intended to be a tool for experienced developers who already know how to build starter applications from scratch using databases, front-end frameworks, authentication, or authorization, and all the bells and whistles offered in the Rails Composer options. Use it to pinpoint what you need to learn, or use it to turbocharge your learning process, but don’t use it as a crutch to avoid learning the basics. To learn Rails, you must be able to build every starter application from scratch, without Rails Composer.</p>
<p>To learn more about Rails Composer, see the <a href="http://www.railscomposer.com/">Rails Composer</a> home page and the README for the <a href="https://github.com/RailsApps/rails-composer/">Rails Composer project</a> on GitHub.</p>
<h1 id="chapter-26-version-notes"><a href="#cid287">Chapter 26 Version Notes</a></h1>
<p>If you are reading the online edition of the book, you have the most recent version of the book. If you’ve gotten your copy of the book elsewhere, you may have an older version that doesn’t have the newest updates.</p>
<p>You’ll find the version number and release date on the first page of this book (under the book title). Check the <a href="https://github.com/RailsApps/learn-rails">learn-rails GitHub repository</a> to find out if you have the newest version of the book. The README page on the GitHub repo always shows the most recent version number for the book and the tutorial application.</p>
<p>If you have trouble building the application in this book, and suspect something may be out of date, you can <a href="https://github.com/RailsApps/learn-rails/blob/master/Gemfile">check the Gemfile in the repo</a> to see if we’ve changed gems or specified version numbers to avoid compatibility issues. You can also check the <a href="https://github.com/RailsApps/learn-rails/blob/master/CHANGELOG.textile">CHANGELOG</a>, look at <a href="https://github.com/RailsApps/learn-rails/commits/master">recent commits</a>, and <a href="https://github.com/RailsApps/learn-rails/issues">check the issues</a> to see the current state of the application.</p>
<p>Here are the changes I’ve made.</p>
<h2 id="261-version-420"><a href="#cid288">26.1 Version 4.2.0</a></h2>
<p><em>Version 4.2.0 was released August 2, 2017</em></p>
<p>Additional revisions to accommodate Rails 5.1 <code>form_with</code>.</p>
<p>Add the jquery-rails gem for the jQuery JavaScript library because it was dropped as a default gem from Rails 5.1.</p>
<p>Minor revisions and corrections for clarity.</p>
<h2 id="262-version-410"><a href="#cid289">26.2 Version 4.1.0</a></h2>
<p><em>Version 4.1.0 was released July 3, 2017</em></p>
<p>Updated for Rails 5.1 and Ruby 2.4.1.</p>
<p>Removed SimpleForm and replaced with Rails 5.1 <code>form_with</code>.</p>
<p>No need to configure MiniTest for Capybara (included in Rails 5.1).</p>
<h2 id="263-version-402"><a href="#cid290">26.3 Version 4.0.2</a></h2>
<p><em>Version 4.0.2 was released November 25, 2016</em></p>
<p>Minor revisions for clarity.</p>
<p>Apple now calls the operating system macOS not Mac OS X.</p>
<p>Updated for Ruby 2.3.2.</p>
<h2 id="264-version-401"><a href="#cid291">26.4 Version 4.0.1</a></h2>
<p><em>Version 4.0.1 was released November 4, 2016</em></p>
<p>Fixed broken links.</p>
<p>Removed references to <a href="https://www.nitrous.io/">Nitrous.io</a> because Nitrous.io is out of business.</p>
<h2 id="265-version-400"><a href="#cid292">26.5 Version 4.0.0</a></h2>
<p><em>Version 4.0.0 was released October 31, 2016</em></p>
<p>Updated for Rails 5.0 and Ruby 2.3.1.</p>
<p>Switch to using Bootstrap instead of Zurb Foundation front-end framework.</p>
<p>Extensive revisions.</p>
<h2 id="266-version-310"><a href="#cid293">26.6 Version 3.1.0</a></h2>
<p><em>Version 3.1.0 was released March 1, 2016</em></p>
<p>Switch to using the SendGrid service to send email. Mandrill is no longer offering a free trial.</p>
<h2 id="267-version-302"><a href="#cid294">26.7 Version 3.0.2</a></h2>
<p><em>Version 3.0.2 was released January 30, 2016</em></p>
<p>Minor change: ‘email_provider_username’ was ‘mandrill_username’ and email_provider_api_key’ was ‘mandrill_apikey’.</p>
<h2 id="268-version-301"><a href="#cid295">26.8 Version 3.0.1</a></h2>
<p><em>Version 3.0.1 was released January 29, 2016</em></p>
<p>Specify version 5.5 of the foundation-rails gem. Foundation 6 is out but Zurb has not yet released documentation for migration from Foundation 5 to 6.</p>
<h2 id="269-version-300"><a href="#cid296">26.9 Version 3.0.0</a></h2>
<p><em>Version 3.0.0 was released January 14, 2016</em></p>
<p>Extensive revision throughout the book, and the length of the book increased, so the book is now two books. Book One contains the introductory and self-help chapters and can be read without access to a computer. Book Two contains the step-by-step tutorial and requires use of a computer.</p>
<p>Switch to using the Mandrill service to send email. Previously used Gmail but Google has taken steps to make Gmail more secure and now it can be difficult to send email from a Rails application using Gmail.</p>
<p>Sending mail now requires the method <code>deliver_now</code> instead of <code>deliver</code>. The UserMailer class now inherits from <code>ApplicationMailer</code>.</p>
<p>Updated references to Rails from version 4.2.4 to 4.2.5.</p>
<p>Updated references to Ruby from version 2.2.3 to 2.3.0.</p>
<h2 id="2610-version-222"><a href="#cid297">26.10 Version 2.2.2</a></h2>
<p><em>Version 2.2.2 was released October 30, 2015</em></p>
<p>In the “Front-End Framework” chapter, updated filename to <code>1st_load_framework.css.scss</code> from <code>framework_and_overrides.css.scss</code> to reflect a change in the rails_layout gem.</p>
<h2 id="2611-version-221"><a href="#cid298">26.11 Version 2.2.1</a></h2>
<p><em>Version 2.2.1 was released September 19, 2015</em></p>
<p>Updated references to Ruby from version 2.2.0 to 2.2.3.</p>
<p>Updated references to Rails from 4.2.0 to Rails 4.2.4.</p>
<p>Updated Visitor model <code>subscribe</code> method for the new Gibbon 2.0 API.</p>
<p>Recommending <a href="https://c9.io/">Cloud9</a> instead of <a href="https://www.nitrous.io/">Nitrous.io</a> because Nitrous.io is no longer free.</p>
<h2 id="2612-version-220"><a href="#cid299">26.12 Version 2.2.0</a></h2>
<p><em>Version 2.2.0 was released June 6, 2015</em></p>
<p>For Amazon customers, added an offer to access the online version or download a PDF at <a href="http://learn-rails.com/">learn-rails.com</a>.</p>
<p>Google now requires use of OAuth 2.0 for application access to Google Drive. The implementation is considerably more complex than the previous implementation using a Gmail address and password. I’ve dropped the “Spreadsheet Connection” chapter.</p>
<p>Minor clarification in the “Layout and Views” chapter.</p>
<h2 id="2613-version-216"><a href="#cid300">26.13 Version 2.1.6</a></h2>
<p><em>Version 2.1.6 was released March 17, 2015</em></p>
<p>Remove references to the Thin web server in the “Deploy” chapter.</p>
<p>Correct version number for <code>gem ’sass-rails’</code> in various Gemfile listings. Fixes <a href="https://github.com/RailsApps/learn-rails/issues/49">issue 49</a> and an error “Sass::SyntaxError - Invalid CSS” when the Foundation front-end framework is used.</p>
<p>In the “Testing” chapter, the file <em>test/integration/home_page_test.rb</em> was missing <code>require ’test_helper’</code>.</p>
<p>Updated “Rails Composer” chapter to describe new options.</p>
<p>Minor improvements and corrections of typos.</p>
<h2 id="2614-version-215"><a href="#cid301">26.14 Version 2.1.5</a></h2>
<p><em>Version 2.1.5 was released March 4, 2015</em></p>
<p>Use the Ruby 1.9 hash syntax in the <code>validates_format_of :email</code> statement.</p>
<p>Minor improvements and corrections of typos.</p>
<h2 id="2615-version-214"><a href="#cid302">26.15 Version 2.1.4</a></h2>
<p><em>Version 2.1.4 was released January 3, 2015</em></p>
<p>Updated references to Ruby from version 2.1.5 to 2.2.0.</p>
<p>Specify the “v0” version of the google_drive gem in the “Spreadsheet Connection” chapter.</p>
<h2 id="2616-version-213"><a href="#cid303">26.16 Version 2.1.3</a></h2>
<p><em>Version 2.1.3 was released December 25, 2014</em></p>
<p>Updated references to Rails 4.1.8 to Rails 4.2.0.</p>
<h2 id="2617-version-212"><a href="#cid304">26.17 Version 2.1.2</a></h2>
<p><em>Version 2.1.2 was released December 4, 2014</em></p>
<p>Released for sale as a Kindle book on Amazon, with new cover art (same cat, though).</p>
<p>RailsApps Tutorials now named the <a href="https://tutorials.railsapps.org/">Capstone Rails Tutorials</a>.</p>
<p>Updated references to Ruby from version 2.1.3 to 2.1.5.</p>
<p>Updated references to Rails 4.1.6 to Rails 4.1.8 (minor releases with bug and security fixes).</p>
<p>Removed link to the (now defunct?) <a href="http://lowdownapp.com/">Lowdown</a> web application in the “Plan Your Product” chapter.</p>
<p>Changes to the “Asynchronous Mailing” section of “Send Mail” chapter to describe Active Job in Rails 4.2.</p>
<p>Minor improvements to the “Dynamic Home Page,” “Deploy,” “Configure,” “Troubleshoot,” and “Create the Application” chapters.</p>
<h2 id="2618-version-211"><a href="#cid305">26.18 Version 2.1.1</a></h2>
<p><em>Version 2.1.1 was released October 22, 2014</em></p>
<p>Minor rewriting for clarity.</p>
<p>Updated “Precompile Assets” section of the “Deploy” chapter.</p>
<p>Mentioned <a href="http://explainshell.com/">explainshell.com</a> in the “Get Started” chapter.</p>
<p>Mentioned <a href="https://zealdocs.org/">Zeal</a> as a Linux alternative to <a href="http://kapeli.com/dash">Dash</a>.</p>
<p>Recommended book <a href="https://www.justinweiss.com/book/">Practicing Rails</a> by Justin Weiss.</p>
<h2 id="2619-version-210"><a href="#cid306">26.19 Version 2.1.0</a></h2>
<p><em>Version 2.1.0 was released October 12, 2014</em></p>
<p>Updated references to Ruby from version 2.1.1 to 2.1.3.</p>
<p>Updated references to Rails 4.1.1 to Rails 4.1.6 (minor releases with bug and security fixes).</p>
<p>Four new chapters:</p>
<ul>
<li>“Testing”</li>
<li>“Rails Composer”</li>
<li>“Crossing the Chasm”</li>
<li>“Level Up”</li>
</ul>
<p>Use ActiveModel instead of the <a href="https://github.com/softace/activerecord-tableless">activerecord-tableless</a> gem.</p>
<p>In the “Configuration” chapter, add a note to use spaces (not tabs) in the <strong>config/secrets.yml</strong> file.</p>
<p>Updated “Gems” chapter to add a troubleshooting note to the “Install the Gems” section (about errors with the Nokogiri gem).</p>
<p>Added a section on “Multiple Terminal Windows” to the “Create the Application” chapter.</p>
<p>In the “Get Help When You Need It” chapter, updated the list of recommended newsletters, replaced <a href="http://rubypair.com/">rubypair.com</a> with <a href="http://www.codermatch.me/">codermatch.me</a>, and added a section on code review. Removed reference to defunct <a href="http://www.railsdevelopment.com/">Rails Development Directory</a>.</p>
<h2 id="2620-version-202"><a href="#cid307">26.20 Version 2.0.2</a></h2>
<p><em>Version 2.0.2 was released May 6, 2014</em></p>
<p>Updated references to Rails 4.1.0 to Rails 4.1.1 (a minor release with a security fix).</p>
<p>For Nitrous.io users, clarify that “http://localhost:3000/” means the Preview browser window.</p>
<p>Update “Gems” chapter, section “Where Do Gems Live?” to add more explanation.</p>
<p>Minor change to code in the “Mailing List” chapter, setting ‘mailchimp_api_key’ explicitly when instantiating Gibbon, for easier troubleshooting.</p>
<h2 id="2621-version-201"><a href="#cid308">26.21 Version 2.0.1</a></h2>
<p><em>Version 2.0.1 was released April 16, 2014</em></p>
<p>Minor updates for Rails 4.1.0. Mostly small changes to the “Configure” and “Front-End Framework” chapters.</p>
<p>Added an explanation that, in the <strong>config/secrets.yml</strong> file, <code>domain_name</code> doesn’t have to be kept secret and set as a Unix environment variable.</p>
<p>Added a hint about passwords that use punctuation marks (plus a completely irrelevant note about profanitype).</p>
<p>Replaced <code>Rails.application.secrets.gmail_username</code> with <code>Rails.application.secrets.email_provider_username</code>. Also replaced <code>gmail_password</code> with <code>email_provider_password</code>. Just trying to make things a little more generic in case Gmail is not used as a provider.</p>
<p>Added a section explaining the horrid details of the <code>config.assets.precompile</code> configuration setting in the <strong>config/application.rb</strong> file. Please convey my displeasure to those responsible for subjecting beginners to this travesty.</p>
<p>In the “Deploy” chapter, restored <code>RAILS_ENV=production rake assets:precompile</code> because Rails 4.1.0 no longer barfs on this.</p>
<p>Added resources to the “Get Help When You Need It” chapter.</p>
<p>Minor rewriting of the introduction.</p>
<h2 id="2622-version-200"><a href="#cid309">26.22 Version 2.0.0</a></h2>
<p><em>Version 2.0.0 was released April 8, 2014</em></p>
<p>Updated references to Ruby from version 2.1.0 to 2.1.1.</p>
<p>Updated the book to Rails 4.1. The application name is no longer used in the <strong>config/routes.rb</strong> file.</p>
<p>Rails 4.1 changes the <strong>app/assets/stylesheets/application.css.scss</strong> file. Updated the “Front-End Framework” chapter. Also expanded the explanation of the Foundation grid.</p>
<p>In Rails 4.1, configuration variables are set in the <strong>config/secrets.yml</strong> file. The Figaro gem is dropped, along with the <strong>config/application.yml</strong> file. Updated the “Configure” chapter and references to configuration variables throughout the book.</p>
<p>In the “Deploy” chapter, changed <code>RAILS_ENV=production rake assets:precompile</code> to <code>rake assets:precompile</code> to avoid the error “database configuration does not specify adapter.”</p>
<p>Updated “The Parking Structure” chapter with comments about “Folders of Future Importance” that experienced developers often use: <strong>test/</strong>, <strong>spec/</strong>, <strong>features/</strong>, <strong>policies/</strong>, and <strong>services/</strong>. Updated the “Spreadsheet Connection” chapter to mention service-oriented architectures (SOA).</p>
<p>Extended the section on “Limitations of Metaphors” in the “Just Enough Ruby” chapter to include the example of gender when modeling a person.</p>
<p>Minor rewriting for clarity throughout.</p>
<h2 id="2623-version-119"><a href="#cid310">26.23 Version 1.19</a></h2>
<p><em>Version 1.19 was released February 1, 2014</em></p>
<p>Updated the book to use Foundation 5.0. Foundation 5.0.3 was released January 15, 2014 (earlier versions 5.0.1 and 5.0.2 were incompatible with Rails Turbolinks and the Rails asset pipeline). Changed the Gemfile to remove <code>gem ’compass-rails’</code> and replace <code>gem ’zurb-foundation’</code> with <code>gem ’foundation-rails’</code>. Updated a line in the “Front-End Framework” chapter for Foundation 5.0:</p>
<p>$ rails generate layout foundation5 --force</p>
<p>The files <strong>navigation.html.erb</strong> and <strong>application.html.erb</strong> are changed for Foundation 5.0. The Bootstrap front-end framework is now independent of Twitter, so I call it “Bootstrap” not “Twitter Bootstrap.” Revised the chapter “Just Enough Ruby” to incorporate suggestions from technical editor Pat Shaughnessy. Revised the chapter “Request and Response” to incorporate suggestions from technical editor Kirsten Jones. Minor rewriting for clarity throughout.</p>
<h2 id="2624-version-118"><a href="#cid311">26.24 Version 1.18</a></h2>
<p><em>Version 1.18 was released January 10, 2014</em></p>
<p>Updated references to Ruby from version 2.0.0 to 2.1.0. Changed one line in the “Front-End Framework” chapter to accommodate a change in the rails_layout gem version 1.0.1. The command was:</p>
<p>$ rails generate layout foundation4 —force</p>
<p>Changed to:</p>
<p>$ rails generate layout:install foundation4 —force</p>
<p>Updated the “Configure” chapter to add ActionMailer configuration values to the file <strong>config/environments/development.rb</strong>.</p>
<h2 id="2625-version-117"><a href="#cid312">26.25 Version 1.17</a></h2>
<p><em>Version 1.17 was released December 21, 2013</em></p>
<p>Updated Rails version from 4.0.1 to 4.0.2 .</p>
<p>Changed Gemfile to remove <code>gem ’compass-rails’, ’&gt; 2.0.alpha.0’</code> and replace it with <code>gem ’compass-rails’, ’&gt; 1.1.2’</code>. The 2.0.alpha.0 version was yanked from the RubyGems server. The compass-rails gem is needed for Foundation 4.3. It will not be needed for Foundation 5.0.</p>
<p>Changed Gemfile to replace <code>gem ’zurb-foundation’</code> with <code>gem ’zurb-foundation’, ’&gt; 4.3.2’</code>. Foundation 5.0 will require <code>gem ’foundation-rails’</code> but we can’t use it until an <a href="https://github.com/zurb/foundation/issues/3642">incompatibility with Turbolinks</a> is resolved. So we will stick with Foundation 4.3.2 for now.</p>
<p>Revised code in the “Analytics” chapter. Using <code>ready page:change</code> instead of <code>page:load</code> to accommodate Turbolinks. Updated the <strong>segmentio.js</strong> file to use a new tracking script from Segment.io. Updated instructions for setting up Google Analytics tracking on Segment.io. Added concluding paragraphs “Making Mr. Kadigan Happy” to the “Analytics” chapter.</p>
<p>Minor clarification in the “Front-End Framework” chapter to explain that the navigation bar won’t show a dropdown menu until the next chapter, when we add navigation links.</p>
<p>Minor clarification in the “Spreadsheet Connection” chapter to explain that Google may block access if you attempt access from a new and different computer (including Nitrous.io).</p>
<p>Added cat names in the “Credits and Comments” chapter.</p>
<p>Revised “Getting Help” chapter and added “Version Notes” chapter.</p>
<p>Minor clarifications, plus fixes for various typos and insignificant errors.</p>
<h1 id="chapter-27-credits-and-comments"><a href="#cid313">Chapter 27 Credits and Comments</a></h1>
<p>Was the book useful to you? Follow <a href="https://twitter.com/rails_apps">@rails_apps</a> on Twitter and tweet some praise. I’d love to know you were helped out by the tutorial.</p>
<p>You can find me on <a href="https://www.facebook.com/daniel.kehoe.sf">Facebook</a> or <a href="https://plus.google.com/+DanielKehoe/">Google+</a>. I’m happy to connect if you want to stay in touch.</p>
<p>If you’d like to recommend the book to others, the landing page for the book is here:</p>
<ul>
<li><a href="http://learn-rails.com/learn-ruby-on-rails.html">http://learn-rails.com/learn-ruby-on-rails.html</a></li>
</ul>
<p>I’d love it if you mention the book online, whether it is a blog post, Twitter, Facebook, or online forums. Recommending the book with a link makes it easier for people to find the book.</p>
<h2 id="271-credits"><a href="#cid314">27.1 Credits</a></h2>
<p>The book was created with the encouragement, financial support, and editorial assistance of hundreds of people in the Rails community.</p>
<p>Daniel Kehoe wrote the book and implemented the application.</p>
<h3 id="2711-kickstarter"><a href="#uid486">27.1.1 Kickstarter</a></h3>
<p>Thank you to contributors to two Kickstarter campaigns, for the first edition of the book and for the revision for Rails 5.0.</p>
<ul>
<li><a href="https://www.kickstarter.com/projects/909377477/learn-ruby-on-rails">Learn Ruby on Rails</a></li>
<li><a href="https://www.kickstarter.com/projects/909377477/learn-ruby-on-rails-5">Learn Ruby on Rails 5</a></li>
</ul>
<h3 id="2712-financial-backers-for-the-first-edition"><a href="#uid489">27.1.2 Financial Backers for the First Edition</a></h3>
<p>The following individuals provided financial contributions of over $50 to help launch the book. Please join me in thanking them for their encouragement and support.</p>
<p>Al Zimmerman, Alan W. Smith, Alberto A. Colón Viera, Andrew Terry, Avi Flombaum, Brian Hays, Charles Treece, Dave Doolin, Denzil Villarico, Derek Rockwell, Eito Katagiri, Evan Sparkman, Frank Castle, Fred Dixon, Fred Schoeneman, Gant Laborde, Gardner Monks, Gerard de Brieder, GoodWorksOnEarth.org, Hanspeter Leupin, Harald Lazardzig, Harsh Patel, James Bond, Jared Koumentis, Jason Landry, Jeff Whitmire, Jesse House, Joe Wilmoth Jr., John Shannon, Joost Baaij, Juan Cristobal Pazos, Kathleen Sidenblad, Laird Hayward, Logan Hasson, Ludovic Kuty, Mark Gilbert, Matt Esterly, Mike Gilbert, Niko Roberts, Norman Cohen, Paul Philippov, Robert Nadar, Rogier Hof, Ross Kinney, Ruben Calzadilla, Stephane Moreau, Susan Wilson, Sven Fuchs, Thomas Nitsche, Tom Michel, Youn Shin Kang, Yuen Lock</p>
<h3 id="2713-technical-editors"><a href="#uid490">27.1.3 Technical Editors</a></h3>
<p>Rails and Ruby experts are very busy. I am very grateful for the assistance I received from my colleagues for the technical review of individual chapters.</p>
<ul>
<li><a href="http://www.princesspolymath.com/">Kirsten Jones</a>, reviewed the chapter “Request and Response”</li>
<li><a href="http://patshaughnessy.net">Pat Shaughnessy</a>, author of <a href="http://patshaughnessy.net/ruby-under-a-microscope">Ruby Under a Microscope</a>, reviewed the chapter “Just Enough Ruby”</li>
<li><a href="http://www.noelrappin.com/">Noel Rappin</a>, author of <a href="https://pragprog.com/book/nrtest/rails-test-prescriptions">Rails Test Prescriptions</a>, reviewed chapters 1-7, and the “Testing” chapter</li>
<li><a href="https://twitter.com/ruralocity">Aaron Sumner</a>, author of <a href="https://leanpub.com/everydayrailsrspec">Everyday Rails Testing with RSpec</a>, reviewed the “Testing” chapter</li>
<li><a href="https://twitter.com/metaskills">Ken Collins</a> reviewed the “Testing” chapter</li>
</ul>
<p>Buy their books. I recommend them.</p>
<h3 id="2714-editors-and-proofreaders"><a href="#uid496">27.1.4 Editors and Proofreaders</a></h3>
<p>Dozens of volunteers offered corrections and made suggestions, from fixing typos to advice about organizing the chapters.</p>
<p>Alberto Dubois Ribó, Alex Finnarn, Alex Zielonko, Alexandru Muntean, Alexey Dotokin, Alexey Ershov, André Arko, Andreas Basurto, Ben Swee, Brandon Schabel, Cam Skene, Daniella Zimmermann, Dapo Babatunde, Dave Levine, Dave Mox, David Kim, Duany Dreyton Bezerra Sousa, Erik Trautman, Erin Nedza, Flavio Bordoni, Fritz Rodriguez Jr, Hendri Firmana, Ishan Shah, James Hamilton, Jasna Vukovic, Jeremy Schneider, Joanne Daudier, Joel Dezenzio, Jonah Ruiz, Jonathan Lai, Jonathan Miller, Jordan Stone, Joreal Whitfield, Josh Morrow, Joyce Hsu, Julia Mokus, Julie Hamwood, Jutta Frieden, Laura Pierson Wadden, Marc Ignacio, Mark D. Blackwell, Mark Everhart, Michael Wong, Miguel Herrera, Mike Janicki, Miran Omanovic, Neha Jain, Norman Cohen, Oana Sipos, Peter Rangelov, Richard Afolabi, Robin Paul, Roderick Silva, Sakib Ash, Sebastian Lobato Genco, Silvia Obajdin, Stas Sușcov, Stefan Streichsbier, Sven Fuchs, Tam Eastley, Tim Goshinski, Timothy Jones, Tom Connolly, Tom Michel, Tomas Olivares, Verena Brodbeck, Will Schive, William Yorgan, Zachary Davy</p>
<h3 id="2715-photos"><a href="#uid497">27.1.5 Photos</a></h3>
<p>Images provided by the <a href="http://lorempixel.com/">lorempixel.com</a> service are used under the <a href="https://creativecommons.org/licenses/by-sa/3.0/">Creative Commons license</a>. Visit the Flickr accounts of the photographers to learn more about their work:</p>
<ul>
<li>photo of a white cat by <a href="https://www.flickr.com/photos/tomitapio/4305303148/">Tomi Tapio</a></li>
<li>photo of a cat by <a href="https://www.flickr.com/people/22032337`N02/">Steve Garner</a></li>
<li>photo of a cat by <a href="https://www.flickr.com/people/barbourians/">Ian Barbour</a></li>
</ul>
<p>The photo of a fluffy white cat by <a href="https://www.flickr.com/photos/tomitapio/4305303148/">Tomi Tapio</a> is used in the application.</p>
<h2 id="272-comments"><a href="#cid315">27.2 Comments</a></h2>
<p>I regularly update the book. Your comments and suggestions for improvements are welcome.</p>
<p>Feel free to email me directly at <a href="/cdn-cgi/l/email-protection#0165606f68646d4165606f68646d6a64696e642f626e6c">[email protected]</a>.</p>
<p>Are you stuck with code that won’t work? <a href="https://stackoverflow.com/questions/tagged/learn-ruby-on-rails">Stack Overflow</a> provides a question-and-answer forum for readers of this book. Use the tag “learn-ruby-on-rails” or “railsapps” when you post your question.</p>
<p>Found a bug in the tutorial application? Please create an <a href="https://github.com/RailsApps/learn-rails/issues">issue</a> on GitHub.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>&copy; 2018 - 2020 Roy Canseco <br> Feedback: 03rvlc+mkdocs@gmail.com</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
