<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Roy Vincent Luna Canseco">
        <link rel="canonical" href="https://roycan.github.io/postgresql/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Postgresql - roycan docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/docco.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">roycan docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../2019-01-cv/" class="nav-link">About</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">skills <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../2014-01-15-maple-review/" class="dropdown-item"> Quickly relearning Maple </a>
</li>
                                    
<li>
    <a href="../2014-03-03-joomla-backup/" class="dropdown-item">Backing up a Joomla Site</a>
</li>
                                    
<li>
    <a href="../2018-07-13-aws-jasperreports/" class="dropdown-item">Jasper Server on AWS Attempt</a>
</li>
                                    
<li>
    <a href="../2018-08-10-laravel/" class="dropdown-item">PHP Laravel</a>
</li>
                                    
<li>
    <a href="../2019-01-09-digital-ads/" class="dropdown-item">2019 01 09 digital ads</a>
</li>
                                    
<li>
    <a href="../2019-01-09-email-marketing/" class="dropdown-item">Email marketing</a>
</li>
                                    
<li>
    <a href="../2019-01-10-digital-marketing/" class="dropdown-item">Digitial marketing</a>
</li>
                                    
<li>
    <a href="../2019-01-12-pro-rails-project/" class="dropdown-item">Professional Rails Project Steps</a>
</li>
                                    
<li>
    <a href="../2019-03-30-se_proj_planning/" class="dropdown-item">This Project Planning from SDLC</a>
</li>
                                    
<li>
    <a href="../2019-04-xp_virtualbox/" class="dropdown-item">Setting up Networking for WinXP on virtualbox</a>
</li>
                                    
<li>
    <a href="../2019-03-phalcon_php/" class="dropdown-item">Installing Phalcon PHP in Ubuntu 18.04</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">research <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../2018-07-07-phd-hunt/" class="dropdown-item">To PhD Abroad I Go</a>
</li>
                                    
<li>
    <a href="../2018-07-08-EUSE-seminar/" class="dropdown-item">End-User Software Engineering</a>
</li>
                                    
<li>
    <a href="../2018-07-08-phd-hunt/" class="dropdown-item">My PhD Hunt  (day 2)</a>
</li>
                                    
<li>
    <a href="../2018-07-09-phd-hunt/" class="dropdown-item">My PhD Hunt  (day 3)</a>
</li>
                                    
<li>
    <a href="../2018-07-10-phd-thoughts/" class="dropdown-item">My PhD Hunt  (day 4)</a>
</li>
                                    
<li>
    <a href="../2018-07-11-phd-australia/" class="dropdown-item">Australian Uni's w/ good CS PhD Programs </a>
</li>
                                    
<li>
    <a href="../2018-07-12-phd-hunt/" class="dropdown-item">Deeper look Australian Uni's - part 1</a>
</li>
                                    
<li>
    <a href="../2018-07-13-phd-hunt/" class="dropdown-item">Deeper look Australian Uni's - part 2</a>
</li>
                                    
<li>
    <a href="../2018-07-15-phd-hunt/" class="dropdown-item">Deeper look Australian Uni's - part 3 (last)</a>
</li>
                                    
<li>
    <a href="../2018-07-19-phd-hunt/" class="dropdown-item">PhD Top 3</a>
</li>
                                    
<li>
    <a href="../2018-07-20-phd-hunt/" class="dropdown-item">Melbourne for PhD</a>
</li>
                                    
<li>
    <a href="../2019-01-09-marketing-trends-ph/" class="dropdown-item">Philippine Digital Marketing Trends 2018</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">relationships <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../2018-08-27-self-made/" class="dropdown-item"> Billionaire's Habits </a>
</li>
                                    
<li>
    <a href="../2018-10-19-block_rosary/" class="dropdown-item">Block Rosary</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">teaching <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../2018-09-14-gslides/" class="dropdown-item">Google slides with Audio</a>
</li>
                                    
<li>
    <a href="../2018-09-16-info_sys/" class="dropdown-item">My Information System Development Philosophy</a>
</li>
                                    
<li>
    <a href="../2018-09-25-IS_prog-js_dates/" class="dropdown-item">Javascript Date Object</a>
</li>
                                    
<li>
    <a href="../2018-09-25-js_loops/" class="dropdown-item">Javascript loops</a>
</li>
                                    
<li>
    <a href="../2018-09-26-mysql_datatypes/" class="dropdown-item">MySQL datatypes</a>
</li>
                                    
<li>
    <a href="../2018-10-01-WAPP-setup/" class="dropdown-item">WAPP Setup</a>
</li>
                                    
<li>
    <a href="../2018-10-14-BA186_syllabus/" class="dropdown-item">BA186 SYSTEMS ANALYSIS AND DESIGN</a>
</li>
                                    
<li>
    <a href="../2018-10-19-configure_git/" class="dropdown-item">Setup Git and Github</a>
</li>
                                    
<li>
    <a href="../2018-10-19-install_rails/" class="dropdown-item">Install rails in Ubuntu 18.04</a>
</li>
                                    
<li>
    <a href="../2018-10-19-setup_mysql/" class="dropdown-item">Setting Up MySQL in Ubuntu 18.04</a>
</li>
                                    
<li>
    <a href="../2018-10-19-setup_postgresql/" class="dropdown-item">Setting Up PostgreSQL in Ubuntu 18.04</a>
</li>
                                    
<li>
    <a href="../2018-11-01-aws_upkeep/" class="dropdown-item">Setting up an AWS account for Team Development</a>
</li>
                                    
<li>
    <a href="../2019-02-pisay_application/" class="dropdown-item">Teacher Career Path Evaluation Sheet</a>
</li>
                                    
<li>
    <a href="../2018-01-IPSE-syllabus/" class="dropdown-item">2018 01 IPSE syllabus</a>
</li>
                                    
<li>
    <a href="../2019-04-pisay_promotion/" class="dropdown-item">Teacher Career Path Evaluation Sheet</a>
</li>
                                    
<li>
    <a href="../2019-03-pisay_cs4_setup/" class="dropdown-item">2019 03 pisay cs4 setup</a>
</li>
                                    
<li>
    <a href="../2020-03-pisay_cs4_setup/" class="dropdown-item">2020 03 pisay cs4 setup</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">projects <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../KHub%20linode%20migration/" class="dropdown-item">KHub linode migration</a>
</li>
                                    
<li>
    <a href="../2019-01-05-pcari-site/" class="dropdown-item">2019 01 05 pcari site</a>
</li>
                                    
<li>
    <a href="../pcari-site-proposal/" class="dropdown-item">Pcari site proposal</a>
</li>
                                    
<li>
    <a href="../UP-IC/" class="dropdown-item">UP IC</a>
</li>
                                    
<li>
    <a href="../2019-01-05-IS-proj-start/" class="dropdown-item">Beginning an Information System Project</a>
</li>
                                    
<li>
    <a href="../2018-collated_screens/" class="dropdown-item">2018 collated screens</a>
</li>
                                    
<li>
    <a href="../2018-11-IC-comments/" class="dropdown-item">2018 11 IC comments</a>
</li>
                                    
<li>
    <a href="../2018-mobile_screens/" class="dropdown-item">2018 mobile screens</a>
</li>
                                    
<li>
    <a href="../2019-01-16-DENR_TOR/" class="dropdown-item">2019 01 16 DENR TOR</a>
</li>
                                    
<li>
    <a href="../2019-02-UPPFI-WW-DOD-1/" class="dropdown-item">Definitions of Done - UPPFI-WW web app</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#postgresql" class="nav-link">postgresql</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#postgresql-11" class="nav-link">postgresql 11</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#pgloader" class="nav-link">pgloader</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="postgresql">postgresql</h1>
<h2 id="postgresql-11">postgresql 11</h2>
<h3 id="installing-postgresql-11">installing postgresql 11</h3>
<p>Step 1: Update system and install dependencies</p>
<p>Step 2: Add PostgreSQL 11 APT repository</p>
<pre><code>wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -

RELEASE=$(lsb_release -cs)
echo &quot;deb http://apt.postgresql.org/pub/repos/apt/ ${RELEASE}&quot;-pgdg main | sudo tee  /etc/apt/sources.list.d/pgdg.list

</code></pre>
<pre><code>$ cat /etc/apt/sources.list.d/pgdg.list
deb http://apt.postgresql.org/pub/repos/apt/ bionic-pgdg main
</code></pre>
<p>Step 3:  Install PostgreSQL 11 on Ubuntu 20.04/18.04/16.04</p>
<pre><code>sudo apt update
sudo apt-cache search postgresql-11
sudo apt -y install postgresql-11
sudo apt install postgresql-client-11
</code></pre>
<pre><code>sudo systemctl start postgresql.service
sudo systemctl enable postgresql.service
sudo systemctl status postgresql.service
</code></pre>
<p><img alt="media-FMAjaq" src="../media/media-FMAjaq.png" /></p>
<p>Step 4: Allow access to PostgreSQL from remote hosts</p>
<p>By default, access to PostgreSQL database server is only from localhost.</p>
<pre><code>$ sudo ss -tunelp | grep 5432
tcp   LISTEN  0  128  127.0.0.1:5432         0.0.0.0:*      users:((&quot;postgres&quot;,pid=15785,fd=3)) uid:111 ino:42331 sk:6 &lt;-&gt;
</code></pre>
<pre><code>sudo vim /etc/postgresql/11/main/postgresql.conf

</code></pre>
<p>Add below line under CONNECTIONS AND AUTHENTICATION section.
You can also specify server IP Address.
Or you can skip this. It might be more secure to skip it anyway.  :)</p>
<pre><code>listen_addresses = '*'
</code></pre>
<p>or</p>
<pre><code>listen_addresses = '192.168.17.12'
</code></pre>
<h3 id="setup-postgresql">setup postgresql</h3>
<p><a href="https://gist.github.com/burningTyger/9a8be114731a3cc041d7689247bbdd52">reference</a></p>
<p><a href="https://www.linode.com/docs/guides/how-to-install-use-postgresql-ubuntu-20-04/">reference</a></p>
<p><code>sudo -i -u postgres psql</code></p>
<ul>
<li>-i :: interactive (simulate login)</li>
<li>-u :: user</li>
</ul>
<pre><code class="language-sql">CREATE ROLE sir_roy WITH SUPERUSER CREATEDB CREATEROLE LOGIN ENCRYPTED PASSWORD 'sir_roy_password';
CREATE DATABSE sir_roy WITH OWNER sir_roy;
\du
SHOW hba_file;
\q
</code></pre>
<p>choose a suitablystrongpassword.</p>
<p>do some tcp socket process testing:</p>
<pre><code>ss -plnt
ss -plt
</code></pre>
<ul>
<li>-l :: listen</li>
<li>-p :: process</li>
<li>-t :: tcp</li>
<li>-n :: number ports</li>
</ul>
<pre><code class="language-sql">postgres=# CREATE USER moodle_user WITH PASSWORD 'yourpassword';
postgres=# CREATE DATABASE moodle_db WITH OWNER moodle_user;
postgres=# \l
</code></pre>
<pre><code>$ cd /etc/postgresql/11/main/
$ sudo cp pg_hba.conf.bak
$ sudo vim pg_hba.conf
</code></pre>
<p>In the client authentication file, you'll find the following line (starting with a '#' sign), which tells you the order to add each piece of data. To grant permission for Moodle to connect to a PostgreSQL server on the same machine, just add the following line, changing the DATABASE and USER columns to your actual database name and the username you set up above. The METHOD field should say "password" - don't put your actual password here.</p>
<pre><code>   # TYPE      DATABASE    USER            CIDR-ADDRESS        METHOD
   host        moodle_db      moodle_user      127.0.0.1/32        password
</code></pre>
<p>If your database lives on a separate server from your Moodle installation, you can change the IP address above to match. In this case, it is recommended to not use 'password' in the method field unless the connection between the two servers is secure, as 'password' sends the password in plain text. In these circumstances, you should consider changing METHOD to 'md5' instead.</p>
<p><code>sudo systemctl restart postgresql.service</code></p>
<h3 id="another-setup-for-postgresql">another setup for postgresql</h3>
<pre><code>su -
su - postgres
createdb test
psql test
=# create user username password ' password ';
-- To change a password:
=# alter role username password ' password ';
=# create database databasename with encoding 'utf8';
=# grant all privileges on database databasename to username;
=# \l
=# \c databasename
=# \q
</code></pre>
<p>$ sudo vim /etc/postgresql/11/main/pg_hba.conf</p>
<p><code>host    all         all         0.0.0.0           0.0.0.0            md5</code></p>
<p>be SURE to cover this security issue with <strong>iptables</strong>!</p>
<p><code>/etc/init.d/postgresql reload or /usr/lib/postgresql/bin/pg_ctl reload</code></p>
<p><code>psql -h server -d databasename -U username</code></p>
<h2 id="pgloader">pgloader</h2>
<p>pgloader is a data loading tool for PostgreSQL, using the COPY command.</p>
<p><code>$ sudo apt-get install pgloader</code></p>
<p>For example, for a full migration from SQLite:</p>
<pre><code>$ createdb newdb
$ pgloader ./test/sqlite/sqlite.db postgresql:///newdb
</code></pre>
<p>Or for a full migration from MySQL,</p>
<pre><code>$ createdb pagila
$ pgloader mysql://user:password@localhost/sakila postgresql:///pagila
</code></pre>
<p>Another option:</p>
<p><code>sudo -u www-data /usr/bin/php /path/to/moodle/admin/tool/dbtransfer/cli/migrate.php --help</code></p>
<p><code>sudo -u www-data /usr/bin/php /path/to/moodle/admin/tool/dbtransfer/cli/migrate.php --dbtype='pgsql' --dbhost='x.x.x.x' --dbname='moodleDbName' --dbuser='moodleUser' --dbpass='***' --dbport=5432 --prefix='mdl_' --dbsocket='/var/run/postgresql'</code></p>
<p><a href="https://en.wikibooks.org/wiki/Converting_MySQL_to_PostgreSQL">reference</a></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>&copy; 2018 - 2020 Roy Canseco <br> Feedback: roy+mkdocs@pshs.edu.ph</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
